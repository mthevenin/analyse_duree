<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction à l’analyse des durées - 14&nbsp; R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-annexe.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./13-R.html">Programmation</a></li><li class="breadcrumb-item"><a href="./13-R.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">**R**</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction à l’analyse des durées</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mthevenin/analyse_duree" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./introduction_bio_durees.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Présentation - bibliographie - outils</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><strong>L’analyse des durées</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Données et théorie</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><strong>Les Données</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theorie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><strong>La théorie</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Méthodes non paramétrique</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-fsurvie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Estimations des fonctions de survie</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-fsurvie_comp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><strong>Tests de comparaison</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Modèles à risques proportionnels</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-intro_mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>Introduction</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-cox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><strong>Le modèle de Cox</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-discret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><strong>Modèle à durée discrète</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-tvc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><strong>Variables dynamiques</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Compléments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-parametrique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><strong>Modèles paramétriques</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-concurrent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><strong>Risques concurrents</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-annexe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Programmation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><strong>R</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#packages-et-fonctions" id="toc-packages-et-fonctions" class="nav-link active" data-scroll-target="#packages-et-fonctions"><span class="header-section-number">14.1</span> Packages et fonctions</a></li>
  <li><a href="#analyse-non-paramétrique" id="toc-analyse-non-paramétrique" class="nav-link" data-scroll-target="#analyse-non-paramétrique"><span class="header-section-number">14.2</span> Analyse Non paramétrique</a>
  <ul class="collapse">
  <li><a href="#méthode-actuarielle" id="toc-méthode-actuarielle" class="nav-link" data-scroll-target="#méthode-actuarielle"><span class="header-section-number">14.2.1</span> Méthode actuarielle</a></li>
  <li><a href="#méthode-kaplan-meier" id="toc-méthode-kaplan-meier" class="nav-link" data-scroll-target="#méthode-kaplan-meier"><span class="header-section-number">14.2.2</span> Méthode Kaplan-Meier</a></li>
  <li><a href="#comparaison-des-st-méthode-km" id="toc-comparaison-des-st-méthode-km" class="nav-link" data-scroll-target="#comparaison-des-st-méthode-km"><span class="header-section-number">14.2.3</span> Comparaison des S(t) méthode KM</a></li>
  </ul></li>
  <li><a href="#modèle-de-cox" id="toc-modèle-de-cox" class="nav-link" data-scroll-target="#modèle-de-cox"><span class="header-section-number">14.3</span> Modèle de Cox</a>
  <ul class="collapse">
  <li><a href="#estimation-du-modèle" id="toc-estimation-du-modèle" class="nav-link" data-scroll-target="#estimation-du-modèle"><span class="header-section-number">14.3.1</span> Estimation du modèle</a></li>
  <li><a href="#hypothèse-ph" id="toc-hypothèse-ph" class="nav-link" data-scroll-target="#hypothèse-ph"><span class="header-section-number">14.3.2</span> Hypothèse PH</a></li>
  <li><a href="#introduction-dune-variable-dynamique-binaire" id="toc-introduction-dune-variable-dynamique-binaire" class="nav-link" data-scroll-target="#introduction-dune-variable-dynamique-binaire"><span class="header-section-number">14.3.3</span> Introduction d’une variable dynamique (binaire)</a></li>
  </ul></li>
  <li><a href="#analyse-en-durée-discrète" id="toc-analyse-en-durée-discrète" class="nav-link" data-scroll-target="#analyse-en-durée-discrète"><span class="header-section-number">14.4</span> <strong>Analyse en durée discrète</strong></a>
  <ul class="collapse">
  <li><a href="#ft-quantitative" id="toc-ft-quantitative" class="nav-link" data-scroll-target="#ft-quantitative"><span class="header-section-number">14.4.1</span> <strong><span class="math inline">\(f(t)\)</span> quantitative</strong></a></li>
  <li><a href="#ft-en-indicatrices" id="toc-ft-en-indicatrices" class="nav-link" data-scroll-target="#ft-en-indicatrices"><span class="header-section-number">14.4.2</span> <strong><span class="math inline">\(f(t)\)</span> en indicatrices </strong></a></li>
  </ul></li>
  <li><a href="#modèles-paramétriques-usuels" id="toc-modèles-paramétriques-usuels" class="nav-link" data-scroll-target="#modèles-paramétriques-usuels"><span class="header-section-number">14.5</span> Modèles paramétriques usuels</a></li>
  <li><a href="#risques-concurrents" id="toc-risques-concurrents" class="nav-link" data-scroll-target="#risques-concurrents"><span class="header-section-number">14.6</span> Risques concurrents</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mthevenin/analyse_duree/edit/main/13-R.qmd" class="toc-action">Modifier cette page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><strong>R</strong></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Programme de cette section: <a href="programme_R.R">Lien</a></p>
<section id="packages-et-fonctions" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="packages-et-fonctions"><span class="header-section-number">14.1</span> Packages et fonctions</h2>
<table class="table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Analyse</strong></th>
<th>Packages - Fonctions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Non paramétrique</strong></td>
<td><ul>
<li><p><code>discsurv</code></p>
<ul>
<li><code>lifetable</code></li>
<li><code>contToDisc</code></li>
</ul></li>
<li><p><code>survival</code></p>
<ul>
<li><code>survfit</code></li>
<li><code>survdif</code></li>
</ul></li>
<li><p><code>survRM2</code></p>
<ul>
<li><code>rmst2</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Modèles à risques proportionnel</strong></td>
<td><ul>
<li><code>survival</code>
<ul>
<li><code>coxph</code></li>
<li><code>cox.zph</code> (v3) <code>cox.zphold</code> (récupération v2)</li>
<li><code>survsplit</code></li>
</ul></li>
<li>base et <code>tydir</code>
<ul>
<li><code>uncount</code></li>
<li><code>glm</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Modèles paramétriques (ph ou aft)</strong></td>
<td><ul>
<li><p><code>survival</code></p>
<ul>
<li><code>survreg</code></li>
</ul></li>
<li><p><code>flexsurv</code></p>
<ul>
<li><code>survreg</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Risques concurents</strong></td>
<td><ul>
<li><p><code>cmprsk</code></p>
<ul>
<li><code>cuminc</code></li>
</ul></li>
<li><p><code>nnet</code></p>
<ul>
<li><code>multinom</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Autres (graphiques - mise en forme)</strong></td>
<td><ul>
<li><p><code>survminer</code></p></li>
<li><p><code>jtools</code></p></li>
<li><p><code>gtsummary</code></p></li>
</ul></td>
</tr>
</tbody>
</table>
<p><strong>Installation</strong></p>
<p>Les dernières versions de certains packages peuvent être installées via Github (ex: <code>survminer</code>). Pour les récupérer, passer par le package <code>devtools</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survival")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survminer")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("flexsurv")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survRM2")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyr")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("jtools")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtools")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("cmprsk")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#install.package("gtsummary")</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("muhaz")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("nnet")</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discSurv)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(muhaz)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyse-non-paramétrique" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="analyse-non-paramétrique"><span class="header-section-number">14.2</span> Analyse Non paramétrique</h2>
<p>Chargement de la base transplantation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="méthode-actuarielle" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1" class="anchored" data-anchor-id="méthode-actuarielle"><span class="header-section-number">14.2.1</span> Méthode actuarielle</h3>
<p>La fonction disponible du paquet <code>discsurv</code>, <em><code>lifetable</code></em>, a des fonctionalités plutôt limitées. Si on peut depuis une MAJ récente définir des intervalles de durée, il n’y a toujours pas d’estimateurs les différents quantiles de la courbe de survie.</p>
<p>La programmation est rendue un peu compliquée pour pas grand chose. Je donne les codes pour info, sans plus de commentaires.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">=</span> <span class="fu">as.data.frame</span>(trans)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Fonction <code>lifeTable</code></strong></p>
<p><strong><em>Intervalle par defaut <span class="math inline">\(dt=1\)</span></em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">=</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles t = journalier"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" title="S(t) méthode actuarielle avec discSurv (1)" data-gallery="quarto-lightbox-gallery-1"><img src="13-R_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
<figcaption class="figure-caption">S(t) méthode actuarielle avec <code>discSurv</code> (1)</figcaption>
</figure>
</div>
</div>
</div>
<p><strong><em>Intervalle <span class="math inline">\(dt=30\)</span></em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit un vecteur définissant les intervalles (il n'y avait pas plus simple????)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(<span class="fu">max</span>(trans<span class="sc">$</span>stime)<span class="sc">/</span><span class="dv">30</span>)<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Base dis avec une nouvelle variable de durée =&gt; timeDisc </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">contToDisc</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">intervalLimits =</span> dt )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>dis, <span class="at">timeColumn=</span><span class="st">"timeDisc"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles dt = 30 jours"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" title="Méthode actuarielle avec discSurv (2)" data-gallery="quarto-lightbox-gallery-2"><img src="13-R_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
<figcaption class="figure-caption">Méthode actuarielle avec <code>discSurv</code> (2)</figcaption>
</figure>
</div>
</div>
</div>
<p>Sur les abscisses, ce sont les valeurs des intervalles qui sont reportés: 10=300 jours. Ce n’est vraiment pas terrible. Pour ce type d’estimateurs, il est préférable d’utiliser Sas ou Stata.</p>
</section>
<section id="méthode-kaplan-meier" class="level3" data-number="14.2.2">
<h3 data-number="14.2.2" class="anchored" data-anchor-id="méthode-kaplan-meier"><span class="header-section-number">14.2.2</span> Méthode Kaplan-Meier</h3>
<p>Le package survival est le principal outil d’analyse des durée. Le package <strong><code>survminer</code></strong> permet d’améliorer la présentation des graphiques.</p>
<p><strong>Estimation des fonctions de survie</strong></p>
<p>Fonction <strong><code>survfit</code></strong></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>syntaxe</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> x, <span class="at">data =</span> base)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>On peut renseigner directement les variables permettant de calculer la durée et non la variable de durée elle-même. Cette méthode est utilisée lorsqu’on introduit une variable dynamique dans un modèle semi-paramétrique de Cox (<code>coxph</code>).</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Syntaxe</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(variable_start, variable_end, status) <span class="sc">~</span> x, <span class="at">data =</span> nom_base)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Sans comparaison de groupes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(stime, died) ~ 1, data = trans)

       n events median 0.95LCL 0.95UCL
[1,] 103     75    100      72     263</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(stime, died) ~ 1, data = trans)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1    103       1    0.990 0.00966       0.9715        1.000
    2    102       3    0.961 0.01904       0.9246        0.999
    3     99       3    0.932 0.02480       0.8847        0.982
    5     96       2    0.913 0.02782       0.8597        0.969
    6     94       2    0.893 0.03043       0.8355        0.955
    8     92       1    0.883 0.03161       0.8237        0.948
    9     91       1    0.874 0.03272       0.8119        0.940
   12     89       1    0.864 0.03379       0.8002        0.933
   16     88       3    0.835 0.03667       0.7656        0.910
   17     85       1    0.825 0.03753       0.7543        0.902
   18     84       1    0.815 0.03835       0.7431        0.894
   21     83       2    0.795 0.03986       0.7208        0.877
   28     81       1    0.785 0.04056       0.7098        0.869
   30     80       1    0.776 0.04122       0.6989        0.861
   32     78       1    0.766 0.04188       0.6878        0.852
   35     77       1    0.756 0.04250       0.6769        0.844
   36     76       1    0.746 0.04308       0.6659        0.835
   37     75       1    0.736 0.04364       0.6551        0.827
   39     74       1    0.726 0.04417       0.6443        0.818
   40     72       2    0.706 0.04519       0.6225        0.800
   43     70       1    0.696 0.04565       0.6117        0.791
   45     69       1    0.686 0.04609       0.6009        0.782
   50     68       1    0.675 0.04650       0.5902        0.773
   51     67       1    0.665 0.04689       0.5796        0.764
   53     66       1    0.655 0.04725       0.5690        0.755
   58     65       1    0.645 0.04759       0.5584        0.746
   61     64       1    0.635 0.04790       0.5479        0.736
   66     63       1    0.625 0.04819       0.5374        0.727
   68     62       2    0.605 0.04870       0.5166        0.708
   69     60       1    0.595 0.04892       0.5063        0.699
   72     59       2    0.575 0.04929       0.4857        0.680
   77     57       1    0.565 0.04945       0.4755        0.670
   78     56       1    0.554 0.04958       0.4654        0.661
   80     55       1    0.544 0.04970       0.4552        0.651
   81     54       1    0.534 0.04979       0.4451        0.641
   85     53       1    0.524 0.04986       0.4351        0.632
   90     52       1    0.514 0.04991       0.4251        0.622
   96     51       1    0.504 0.04994       0.4151        0.612
  100     50       1    0.494 0.04995       0.4052        0.602
  102     49       1    0.484 0.04993       0.3953        0.592
  110     47       1    0.474 0.04992       0.3852        0.582
  149     45       1    0.463 0.04991       0.3749        0.572
  153     44       1    0.453 0.04987       0.3647        0.562
  165     43       1    0.442 0.04981       0.3545        0.551
  186     41       1    0.431 0.04975       0.3440        0.541
  188     40       1    0.420 0.04966       0.3336        0.530
  207     39       1    0.410 0.04954       0.3233        0.519
  219     38       1    0.399 0.04940       0.3130        0.509
  263     37       1    0.388 0.04923       0.3027        0.498
  285     35       2    0.366 0.04885       0.2817        0.475
  308     33       1    0.355 0.04861       0.2713        0.464
  334     32       1    0.344 0.04834       0.2610        0.453
  340     31       1    0.333 0.04804       0.2507        0.442
  342     29       1    0.321 0.04773       0.2401        0.430
  583     21       1    0.306 0.04785       0.2252        0.416
  675     17       1    0.288 0.04830       0.2073        0.400
  733     16       1    0.270 0.04852       0.1898        0.384
  852     14       1    0.251 0.04873       0.1712        0.367
  979     11       1    0.228 0.04934       0.1491        0.348
  995     10       1    0.205 0.04939       0.1279        0.329
 1032      9       1    0.182 0.04888       0.1078        0.308
 1386      6       1    0.152 0.04928       0.0804        0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="13-R_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Le premier output <code>fit</code> permet d’obtenir la durée médiane, ici égale à 100 (<span class="math inline">\(S(100)=0.494\)</span>). Le second avec la fonction <strong><code>summary</code></strong> permet d’obtenir une table des estimateurs. La fonction de survie peut être tracée avec la fonction <strong><code>plot</code></strong> (en pointillés les intervalles de confiance).</p>
<p>On peut obtenir des graphes de meilleur qualité avec la librairie <strong><code>survminer</code></strong>, avec la fonction <strong><code>ggsurvplot</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="13-R_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>On peut ajouter la population encore soumise au risque à plusieurs points d’observation avec l’argument <code>risk.table = TRUE</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="13-R_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparaison-des-st-méthode-km" class="level3" data-number="14.2.3">
<h3 data-number="14.2.3" class="anchored" data-anchor-id="comparaison-des-st-méthode-km"><span class="header-section-number">14.2.3</span> Comparaison des S(t) méthode KM</h3>
<p>On va comparer les deuxfonctions de survie pour la variable <em>surgery</em>, celle pour les personnes non opérées et celle pour les personnes opérées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(stime, died) ~ surgery, data = trans)

           n events median 0.95LCL 0.95UCL
surgery=0 91     69     78      61     153
surgery=1 12      6    979     583      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="13-R_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Tests du logrank</strong></p>
<p>On utilise la fonction <strong><code>survdiff</code></strong>, avec comme variante le test de Peto-Peto (<code>rho=1</code>).<br>
La syntaxe est quasiment identique à la fonction <code>survdiff</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">rho=</span><span class="dv">1</span>, <span class="at">data =</span> trans)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(stime, died) ~ surgery, data = trans, 
    rho = 1)

           N Observed Expected (O-E)^2/E (O-E)^2/V
surgery=0 91    45.28    39.12     0.968      8.65
surgery=1 12     2.03     8.18     4.630      8.65

 Chisq= 8.7  on 1 degrees of freedom, p= 0.003 </code></pre>
</div>
</div>
<p>Ici la variable est binaire. Si on veux tester deux à deux les niveaux d’une variable catégorielle à plus de deux modalités, il est fortement conseillé d’utiliser la fonction <strong><code>pairwise_survdiff</code></strong> de <code>survminer</code> (syntaxe identique que <code>survdiff</code>).</p>
<p><strong>Comparaison des RMST</strong></p>
<p>La fonction <strong><code>rmst2</code></strong> du package <strong><code>survRM2</code></strong> permet de comparer les RMST entre 2 groupes . La strate pour les comparaisons doit être impérativement renommée <em>arm</em>. La fonction, issue d’une commande de Stata, n’est pas très souple.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>arm<span class="ot">=</span>trans<span class="sc">$</span>surgery</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">rmst2</span>(trans<span class="sc">$</span>stime, trans<span class="sc">$</span>died, trans<span class="sc">$</span>arm, <span class="at">tau=</span><span class="cn">NULL</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The truncation time, tau, was not specified. Thus, the default tau  1407  is used. 

Restricted Mean Survival Time (RMST) by arm 
                Est.      se lower .95 upper .95
RMST (arm=1) 884.576 151.979   586.702  1182.450
RMST (arm=0) 379.148  58.606   264.283   494.012


Restricted Mean Time Lost (RMTL) by arm 
                 Est.      se lower .95 upper .95
RMTL (arm=1)  522.424 151.979   224.550   820.298
RMTL (arm=0) 1027.852  58.606   912.988  1142.717


Between-group contrast 
                        Est. lower .95 upper .95     p
RMST (arm=1)-(arm=0) 505.428   186.175   824.682 0.002
RMST (arm=1)/(arm=0)   2.333     1.483     3.670 0.000
RMTL (arm=1)/(arm=0)   0.508     0.284     0.909 0.022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="13-R_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="modèle-de-cox" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="modèle-de-cox"><span class="header-section-number">14.3</span> Modèle de Cox</h2>
<p>Ici tout est estimé de nouveau avec des fonctions du package <code>survival</code>:</p>
<ul>
<li>Estimation du modèle: <code>coxph</code>.</li>
<li>Test de Grambsch-Therneau: <code>cox.zph</code> et <code>cox.oldzph</code>.</li>
<li>Introduction d’une variable dynamique: allongement de la base avec <code>survsplit</code>.</li>
</ul>
<section id="estimation-du-modèle" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1" class="anchored" data-anchor-id="estimation-du-modèle"><span class="header-section-number">14.3.1</span> Estimation du modèle</h3>
<p>Par défaut, R utilise la correction d’Efron pour les évènements simultanés. Il est préférable de ne pas la modifier.</p>
<p>Syntaxe:</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Syntaxe</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode e code-with-copy"><code class="sourceCode eiffel"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>coxph(Surv(time, status) ~ x1 + x2 + ....., data=base, ties=<span class="st">"nom_correction"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(stime, died) ~ year + age + surgery, data = trans)

  n= 103, number of events= 75 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)
year    -0.11963   0.88725  0.06734 -1.776   0.0757
age      0.02958   1.03002  0.01352  2.187   0.0287
surgery -0.98732   0.37257  0.43626 -2.263   0.0236

        exp(coef) exp(-coef) lower .95 upper .95
year       0.8872     1.1271    0.7775    1.0124
age        1.0300     0.9709    1.0031    1.0577
surgery    0.3726     2.6840    0.1584    0.8761

Concordance= 0.653  (se = 0.032 )
Likelihood ratio test= 17.63  on 3 df,   p=5e-04
Wald test            = 15.76  on 3 df,   p=0.001
Score (logrank) test = 16.71  on 3 df,   p=8e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(coxfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'sass':
  method    from  
  print.css memisc</code></pre>
</div>
<div class="cell-output-display">

<div id="qgikmzkemm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qgikmzkemm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qgikmzkemm thead, #qgikmzkemm tbody, #qgikmzkemm tfoot, #qgikmzkemm tr, #qgikmzkemm td, #qgikmzkemm th {
  border-style: none;
}

#qgikmzkemm p {
  margin: 0;
  padding: 0;
}

#qgikmzkemm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qgikmzkemm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qgikmzkemm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qgikmzkemm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qgikmzkemm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qgikmzkemm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qgikmzkemm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qgikmzkemm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qgikmzkemm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qgikmzkemm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qgikmzkemm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qgikmzkemm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qgikmzkemm .gt_spanner_row {
  border-bottom-style: hidden;
}

#qgikmzkemm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qgikmzkemm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qgikmzkemm .gt_from_md > :first-child {
  margin-top: 0;
}

#qgikmzkemm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qgikmzkemm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qgikmzkemm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qgikmzkemm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qgikmzkemm .gt_row_group_first td {
  border-top-width: 2px;
}

#qgikmzkemm .gt_row_group_first th {
  border-top-width: 2px;
}

#qgikmzkemm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qgikmzkemm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qgikmzkemm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qgikmzkemm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qgikmzkemm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qgikmzkemm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qgikmzkemm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qgikmzkemm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qgikmzkemm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qgikmzkemm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qgikmzkemm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qgikmzkemm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qgikmzkemm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qgikmzkemm .gt_left {
  text-align: left;
}

#qgikmzkemm .gt_center {
  text-align: center;
}

#qgikmzkemm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qgikmzkemm .gt_font_normal {
  font-weight: normal;
}

#qgikmzkemm .gt_font_bold {
  font-weight: bold;
}

#qgikmzkemm .gt_font_italic {
  font-style: italic;
}

#qgikmzkemm .gt_super {
  font-size: 65%;
}

#qgikmzkemm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qgikmzkemm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qgikmzkemm .gt_indent_1 {
  text-indent: 5px;
}

#qgikmzkemm .gt_indent_2 {
  text-indent: 10px;
}

#qgikmzkemm .gt_indent_3 {
  text-indent: 15px;
}

#qgikmzkemm .gt_indent_4 {
  text-indent: 20px;
}

#qgikmzkemm .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>HR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>HR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">year</td>
<td headers="estimate" class="gt_row gt_center">0.89</td>
<td headers="ci" class="gt_row gt_center">0.78, 1.01</td>
<td headers="p.value" class="gt_row gt_center">0.076</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center">1.03</td>
<td headers="ci" class="gt_row gt_center">1.00, 1.06</td>
<td headers="p.value" class="gt_row gt_center">0.029</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">0.37</td>
<td headers="ci" class="gt_row gt_center">0.16, 0.88</td>
<td headers="p.value" class="gt_row gt_center">0.024</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> HR = Hazard Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>L’output des résultats reporte le logarithme des Risques Ratios (coef) ainsi que les RR (exp(coef)). Il est intéressant de regarder la valeur de concordance (Harrel’s) qui donne des indications sur la qualité de l’ajustement (proche de l’AUC/ROC d’un modèle probabiliste standard).</p>
<p>On peut représenter sous forme graphique les résultats avec la fonction <strong><code>ggforest</code></strong> de <code>survminer</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(coxfit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .get_data(model, data = data): The `data` argument is not provided.
Data will be extracted from model fit.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="13-R_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hypothèse-ph" class="level3" data-number="14.3.2">
<h3 data-number="14.3.2" class="anchored" data-anchor-id="hypothèse-ph"><span class="header-section-number">14.3.2</span> Hypothèse PH</h3>
<section id="test-grambsch-therneau" class="level4" data-number="14.3.2.1">
<h4 data-number="14.3.2.1" class="anchored" data-anchor-id="test-grambsch-therneau"><span class="header-section-number">14.3.2.1</span> Test Grambsch-Therneau</h4>
<p><strong>Résidus de Schoenfeld</strong></p>
<p>On utilise la fonction <strong><code>cox.zph</code></strong> pour effectuer le test GLS (moindre carrés généralisés) qui a été substitué au test OLS (moindres carrés ordinaires) avec le passage à la v3 du package. <strong>Je donne plus loin un moyen de récupérer et d’exécuter le test OLS, que je conseille d’utiliser en présence de durées discrètes/groupées</strong>.</p>
<p>Le test peut utiliser plusieurs fonctions de la durée. Par défaut la fonction utilise <span class="math inline">\(1-KM\)</span>, soit le complémentaire de l’estimateur de Kaplan-Meier (option <code>transform="km"</code>).</p>
<ul>
<li><strong>Test GLS (V3 de survival)</strong></li>
</ul>
<p>Avec <code>transform="km"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        chisq df     p
year    3.309  1 0.069
age     0.922  1 0.337
surgery 5.494  1 0.019
GLOBAL  8.581  3 0.035</code></pre>
</div>
</div>
<p>Avec <code>transform="identity"</code> (<span class="math inline">\(f(t)=t\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        chisq df     p
year     4.54  1 0.033
age      1.71  1 0.191
surgery  4.92  1 0.027
GLOBAL   9.47  3 0.024</code></pre>
</div>
</div>
<p>Remarque: avec la v3 de survival, quelques options ont été ajoutées tel que <em><code>terms</code></em> qui permet pour une variable catégorielle à plus de deux modalités de choisir entre un sous test multiple sur la variable (k modalités =&gt; k-1 degré de liberté) et une série de tests à 1 degré de liberté sur chaque modalité (k-1 tests). De mon point de vue préférer la seconde solution avec <strong><code>terms=FALSE</code></strong>. le test de Grambsch-Therneau est particulièrement sensible au nombre de degré de liberté, et il convient donc d’éviter de l’utiliser dans un cadre multiple.</p>
<ul>
<li><strong>Test OLS (V2 de survival - Stata - Sas - Python)</strong></li>
</ul>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Récupération du test ols</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/main/cox.zphold/cox.zphold.R"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Exécution du test ols</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          rho chisq      p
year    0.102 0.797 0.3720
age     0.129 1.612 0.2043
surgery 0.297 5.539 0.0186
GLOBAL     NA 8.756 0.0327</code></pre>
</div>
</div>
</section>
<section id="introduction-dune-intéraction" class="level4" data-number="14.3.2.2">
<h4 data-number="14.3.2.2" class="anchored" data-anchor-id="introduction-dune-intéraction"><span class="header-section-number">14.3.2.2</span> Introduction d’une intéraction</h4>
<p>Lorsque la covariable n’est pas continue, elle doit être impérativement transformée en indicatrice <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Penser à vérifier en amont que les résultats du modèle sont bien identiques avec le modèle estimé précédemment (ne pas oublier d’omettre le niveau en référence).</p>
<p>La variable d’intéraction est <strong><code>tt(nom_variable)</code></strong>, la fonction de la durée (ici forme linéaire simple) est indiquée en option de la fonction: <strong><code>tt = function(x, t, ...) x*t</code></strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> <span class="fu">tt</span>(surgery), <span class="at">data =</span> trans, <span class="at">tt =</span> <span class="cf">function</span>(x, t, ...) x<span class="sc">*</span>t)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(stime, died) ~ year + age + surgery + tt(surgery), 
    data = trans, tt = function(x, t, ...) x * t)

  n= 103, number of events= 75 

                 coef exp(coef)  se(coef)      z Pr(&gt;|z|)
year        -0.123074  0.884198  0.066835 -1.841  0.06555
age          0.028888  1.029310  0.013449  2.148  0.03172
surgery     -1.754738  0.172953  0.674391 -2.602  0.00927
tt(surgery)  0.002231  1.002234  0.001102  2.024  0.04299

            exp(coef) exp(-coef) lower .95 upper .95
year           0.8842     1.1310   0.77564    1.0080
age            1.0293     0.9715   1.00253    1.0568
surgery        0.1730     5.7819   0.04612    0.6486
tt(surgery)    1.0022     0.9978   1.00007    1.0044

Concordance= 0.656  (se = 0.032 )
Likelihood ratio test= 21.58  on 4 df,   p=2e-04
Wald test            = 16.99  on 4 df,   p=0.002
Score (logrank) test = 19  on 4 df,   p=8e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(coxfit2, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="zshnotpzhh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zshnotpzhh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zshnotpzhh thead, #zshnotpzhh tbody, #zshnotpzhh tfoot, #zshnotpzhh tr, #zshnotpzhh td, #zshnotpzhh th {
  border-style: none;
}

#zshnotpzhh p {
  margin: 0;
  padding: 0;
}

#zshnotpzhh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zshnotpzhh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zshnotpzhh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zshnotpzhh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zshnotpzhh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zshnotpzhh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zshnotpzhh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zshnotpzhh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zshnotpzhh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zshnotpzhh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zshnotpzhh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zshnotpzhh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zshnotpzhh .gt_spanner_row {
  border-bottom-style: hidden;
}

#zshnotpzhh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zshnotpzhh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zshnotpzhh .gt_from_md > :first-child {
  margin-top: 0;
}

#zshnotpzhh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zshnotpzhh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zshnotpzhh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zshnotpzhh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zshnotpzhh .gt_row_group_first td {
  border-top-width: 2px;
}

#zshnotpzhh .gt_row_group_first th {
  border-top-width: 2px;
}

#zshnotpzhh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zshnotpzhh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zshnotpzhh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zshnotpzhh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zshnotpzhh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zshnotpzhh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zshnotpzhh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zshnotpzhh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zshnotpzhh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zshnotpzhh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zshnotpzhh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zshnotpzhh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zshnotpzhh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zshnotpzhh .gt_left {
  text-align: left;
}

#zshnotpzhh .gt_center {
  text-align: center;
}

#zshnotpzhh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zshnotpzhh .gt_font_normal {
  font-weight: normal;
}

#zshnotpzhh .gt_font_bold {
  font-weight: bold;
}

#zshnotpzhh .gt_font_italic {
  font-style: italic;
}

#zshnotpzhh .gt_super {
  font-size: 65%;
}

#zshnotpzhh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zshnotpzhh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zshnotpzhh .gt_indent_1 {
  text-indent: 5px;
}

#zshnotpzhh .gt_indent_2 {
  text-indent: 10px;
}

#zshnotpzhh .gt_indent_3 {
  text-indent: 15px;
}

#zshnotpzhh .gt_indent_4 {
  text-indent: 20px;
}

#zshnotpzhh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>HR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>HR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">year</td>
<td headers="estimate" class="gt_row gt_center">0.884</td>
<td headers="ci" class="gt_row gt_center">0.776, 1.008</td>
<td headers="p.value" class="gt_row gt_center">0.066</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center">1.029</td>
<td headers="ci" class="gt_row gt_center">1.003, 1.057</td>
<td headers="p.value" class="gt_row gt_center">0.032</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">0.173</td>
<td headers="ci" class="gt_row gt_center">0.046, 0.649</td>
<td headers="p.value" class="gt_row gt_center">0.009</td></tr>
    <tr><td headers="label" class="gt_row gt_left">tt(surgery)</td>
<td headers="estimate" class="gt_row gt_center">1.002</td>
<td headers="ci" class="gt_row gt_center">1.000, 1.004</td>
<td headers="p.value" class="gt_row gt_center">0.043</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> HR = Hazard Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p><strong>Rappel</strong>: le paramètre estimé pour <strong><code>tt(surgery)</code></strong> ne reporte pas un rapport de risques, mais un rapport de de deux rapports de risques. C’est bien une double différence sur l’échelle d’estimation (log).</p>
</section>
</section>
<section id="introduction-dune-variable-dynamique-binaire" class="level3" data-number="14.3.3">
<h3 data-number="14.3.3" class="anchored" data-anchor-id="introduction-dune-variable-dynamique-binaire"><span class="header-section-number">14.3.3</span> Introduction d’une variable dynamique (binaire)</h3>
<p>La dimension dynamique est ici le fait d’avoir été opéré pour une greffe du coeur.</p>
<ul>
<li><p><strong>Etape 1</strong>: créer un vecteur donnant les durées aux temps d’évènement.</p></li>
<li><p><strong>Etape 2</strong>: appliquer ce vecteurs de points de coupure à la fonction <code>survsplit</code>.</p></li>
<li><p><strong>Etape 3</strong>: modifier la variable transplant (ou créer une nouvelle) à l’aide de la variable <strong>wait</strong> qui prend la valeur 1 à partir du jour de la greffe, 0 avant.</p></li>
<li><p><em>Etape 1</em>: création de l’objet cut (vecteur), qui récupère les moments où au moins un évènement est observé.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cut<span class="ot">=</span> <span class="fu">unique</span>(trans<span class="sc">$</span>stime[trans<span class="sc">$</span>died <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>cut</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]    1    2    3    5    6    8    9   12   16   17   18   21   28   30   32
[16]   35   36   37   39   40   43   45   50   51   53   58   61   66   68   69
[31]   72   77   78   80   81   85   90   96  100  102  110  149  153  165  186
[46]  188  207  219  263  285  308  334  340  342  583  675  733  852  979  995
[61] 1032 1386</code></pre>
</div>
</div>
<p><em>Etape 2</em>: allonger la base aux durées d’évènement</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tvc <span class="ot">=</span> <span class="fu">survSplit</span>(<span class="at">data =</span> trans, <span class="at">cut =</span> cut, <span class="at">end =</span> <span class="st">"stime"</span>, <span class="at">start =</span> <span class="st">"stime0"</span>, <span class="at">event =</span> <span class="st">"died"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tvc, <span class="at">n=</span><span class="dv">20</span> )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id year age surgery transplant wait mois compet arm stime0 stime died
1  15   68  53       0          0    0    1      1   0      0     1    1
2  43   70  43       0          0    0    1      1   0      0     1    0
3  43   70  43       0          0    0    1      1   0      1     2    1
4  61   71  52       0          0    0    1      1   0      0     1    0
5  61   71  52       0          0    0    1      1   0      1     2    1
6  75   72  52       0          0    0    1      1   0      0     1    0
7  75   72  52       0          0    0    1      1   0      1     2    1
8   6   68  54       0          0    0    1      2   0      0     1    0
9   6   68  54       0          0    0    1      2   0      1     2    0
10  6   68  54       0          0    0    1      2   0      2     3    1
11 42   70  36       0          0    0    1      1   0      0     1    0
12 42   70  36       0          0    0    1      1   0      1     2    0
13 42   70  36       0          0    0    1      1   0      2     3    1
14 54   71  47       0          0    0    1      1   0      0     1    0
15 54   71  47       0          0    0    1      1   0      1     2    0
16 54   71  47       0          0    0    1      1   0      2     3    1
17 38   70  41       0          1    5    1      1   0      0     1    0
18 38   70  41       0          1    5    1      1   0      1     2    0
19 38   70  41       0          1    5    1      1   0      2     3    0
20 38   70  41       0          1    5    1      1   0      3     5    1</code></pre>
</div>
</div>
<p>On vérifie qu’on obtient les même résultats avec le modèle sans tvc</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> tvc)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(stime0, stime, died) ~ year + age + surgery, 
    data = tvc)

            coef exp(coef) se(coef)      z      p
year    -0.11963   0.88725  0.06734 -1.776 0.0757
age      0.02958   1.03002  0.01352  2.187 0.0287
surgery -0.98732   0.37257  0.43626 -2.263 0.0236

Likelihood ratio test=17.63  on 3 df, p=0.0005243
n= 3573, number of events= 75 </code></pre>
</div>
</div>
<ul>
<li><em>Etape 3</em>: on génère la variable dynamique de sorte que les personnes n’apparaissent pas greffés avant l’opération</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tvc<span class="sc">$</span>tvc<span class="ot">=</span><span class="fu">ifelse</span>(tvc<span class="sc">$</span>transplant<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> tvc<span class="sc">$</span>wait<span class="sc">&lt;=</span>tvc<span class="sc">$</span>stime,<span class="dv">1</span>,<span class="dv">0</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Estimation du modèle</strong><br>
En format long, on doit préciser dans la formule l’intervalle de durée avec les variables stime0 (début) et stime(fin)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>tvcfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> tvc, <span class="at">data =</span> tvc)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tvcfit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(stime0, stime, died) ~ year + age + surgery + 
    tvc, data = tvc)

  n= 3573, number of events= 75 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)
year    -0.12032   0.88664  0.06734 -1.787   0.0740
age      0.03044   1.03091  0.01390  2.190   0.0285
surgery -0.98289   0.37423  0.43655 -2.251   0.0244
tvc     -0.08221   0.92108  0.30484 -0.270   0.7874

        exp(coef) exp(-coef) lower .95 upper .95
year       0.8866      1.128    0.7770    1.0117
age        1.0309      0.970    1.0032    1.0594
surgery    0.3742      2.672    0.1591    0.8805
tvc        0.9211      1.086    0.5068    1.6741

Concordance= 0.659  (se = 0.032 )
Likelihood ratio test= 17.7  on 4 df,   p=0.001
Wald test            = 15.79  on 4 df,   p=0.003
Score (logrank) test = 16.74  on 4 df,   p=0.002</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(tvcfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="znqjppwghf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#znqjppwghf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#znqjppwghf thead, #znqjppwghf tbody, #znqjppwghf tfoot, #znqjppwghf tr, #znqjppwghf td, #znqjppwghf th {
  border-style: none;
}

#znqjppwghf p {
  margin: 0;
  padding: 0;
}

#znqjppwghf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#znqjppwghf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#znqjppwghf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#znqjppwghf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#znqjppwghf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#znqjppwghf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#znqjppwghf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#znqjppwghf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#znqjppwghf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#znqjppwghf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#znqjppwghf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#znqjppwghf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#znqjppwghf .gt_spanner_row {
  border-bottom-style: hidden;
}

#znqjppwghf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#znqjppwghf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#znqjppwghf .gt_from_md > :first-child {
  margin-top: 0;
}

#znqjppwghf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#znqjppwghf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#znqjppwghf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#znqjppwghf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#znqjppwghf .gt_row_group_first td {
  border-top-width: 2px;
}

#znqjppwghf .gt_row_group_first th {
  border-top-width: 2px;
}

#znqjppwghf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#znqjppwghf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#znqjppwghf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#znqjppwghf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#znqjppwghf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#znqjppwghf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#znqjppwghf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#znqjppwghf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#znqjppwghf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#znqjppwghf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#znqjppwghf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#znqjppwghf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#znqjppwghf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#znqjppwghf .gt_left {
  text-align: left;
}

#znqjppwghf .gt_center {
  text-align: center;
}

#znqjppwghf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#znqjppwghf .gt_font_normal {
  font-weight: normal;
}

#znqjppwghf .gt_font_bold {
  font-weight: bold;
}

#znqjppwghf .gt_font_italic {
  font-style: italic;
}

#znqjppwghf .gt_super {
  font-size: 65%;
}

#znqjppwghf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#znqjppwghf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#znqjppwghf .gt_indent_1 {
  text-indent: 5px;
}

#znqjppwghf .gt_indent_2 {
  text-indent: 10px;
}

#znqjppwghf .gt_indent_3 {
  text-indent: 15px;
}

#znqjppwghf .gt_indent_4 {
  text-indent: 20px;
}

#znqjppwghf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>HR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>HR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">year</td>
<td headers="estimate" class="gt_row gt_center">0.887</td>
<td headers="ci" class="gt_row gt_center">0.777, 1.012</td>
<td headers="p.value" class="gt_row gt_center">0.074</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center">1.031</td>
<td headers="ci" class="gt_row gt_center">1.003, 1.059</td>
<td headers="p.value" class="gt_row gt_center">0.029</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">0.374</td>
<td headers="ci" class="gt_row gt_center">0.159, 0.880</td>
<td headers="p.value" class="gt_row gt_center">0.024</td></tr>
    <tr><td headers="label" class="gt_row gt_left">tvc</td>
<td headers="estimate" class="gt_row gt_center">0.921</td>
<td headers="ci" class="gt_row gt_center">0.507, 1.674</td>
<td headers="p.value" class="gt_row gt_center">0.8</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> HR = Hazard Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(tvcfit)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .get_data(model, data = data): The `data` argument is not provided.
Data will be extracted from model fit.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="13-R_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analyse-en-durée-discrète" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="analyse-en-durée-discrète"><span class="header-section-number">14.4</span> <strong>Analyse en durée discrète</strong></h2>
<p>Pour la durée, on va utiliser la variable mois (regroupement sur 30 jours).</p>
<p>La fonction <strong><code>uncount</code></strong> du package <code>tidyr</code> permettra de splitter la base aux durées d’observation. C’est ici la principale différence avec le modèle de Cox qui est une estimation aux durées d’évènement</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La variable <em>mois</em>, va être supprimée avec <code>uncount</code>. Comme on en aura besoin plus loin pour générer proprement la variable évènement, on peut créer ici une variable mirroir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>T <span class="ot">=</span> trans<span class="sc">$</span>mois</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">uncount</span>(trans,mois)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> dt[<span class="fu">order</span>(dt<span class="sc">$</span>id),]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt,<span class="dv">11</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id year age died stime surgery transplant wait compet  T
48   1   67  30    1    50       0          0    0      1  2
49   1   67  30    1    50       0          0    0      1  2
10   2   68  51    1     6       0          0    0      1  1
18   3   68  54    1    16       0          1    1      1  1
36   4   68  40    1    39       0          1   36      2  2
37   4   68  40    1    39       0          1   36      2  2
20   5   68  20    1    18       0          0    0      1  1
5    6   68  54    1     3       0          0    0      2  1
466  7   68  50    1   675       0          1   51      1 23
467  7   68  50    1   675       0          1   51      1 23
468  7   68  50    1   675       0          1   51      1 23</code></pre>
</div>
</div>
<p>On va générer une variable type compteur pour mesurer la durée à chaque point d’observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt, <span class="at">n=</span><span class="dv">8</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id year age died stime surgery transplant wait compet T x t
48  1   67  30    1    50       0          0    0      1 2 1 1
49  1   67  30    1    50       0          0    0      1 2 1 2
10  2   68  51    1     6       0          0    0      1 1 1 1
18  3   68  54    1    16       0          1    1      1 1 1 1
36  4   68  40    1    39       0          1   36      2 2 1 1
37  4   68  40    1    39       0          1   36      2 2 1 2
20  5   68  20    1    18       0          0    0      1 1 1 1
5   6   68  54    1     3       0          0    0      2 1 1 1</code></pre>
</div>
</div>
<p>Si un individu est décédé, died=1 est reporté sur toute les lignes (idem qu’avec la variable dynamique). On va modifier la variable tel que <em>died=0 si t&lt;T$</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">arrange</span>(dt,id,t)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>died[dt<span class="sc">$</span>t<span class="sc">&lt;</span>dt<span class="sc">$</span>T]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt, <span class="at">n=</span><span class="dv">8</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id year age died stime surgery transplant wait compet T x t
1  1   67  30    0    50       0          0    0      1 2 1 1
2  1   67  30    1    50       0          0    0      1 2 1 2
3  2   68  51    1     6       0          0    0      1 1 1 1
4  3   68  54    1    16       0          1    1      1 1 1 1
5  4   68  40    0    39       0          1   36      2 2 1 1
6  4   68  40    1    39       0          1   36      2 2 1 2
7  5   68  20    1    18       0          0    0      1 1 1 1
8  6   68  54    1     3       0          0    0      2 1 1 1</code></pre>
</div>
</div>
<section id="ft-quantitative" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="ft-quantitative"><span class="header-section-number">14.4.1</span> <strong><span class="math inline">\(f(t)\)</span> quantitative</strong></h3>
<p>Avec un effet quadratique d’ordre 3 ^[Attention ici cela marche bien. Bien vérifier qu’il n’y a pas un problème d’overfitting, comme c’est le cas dans le TP.</p>
<p>On centre également les variables <em>year</em> et <em>age</em> sur leur valeur moyenne pour donner un sens à la constante</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t2<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t3<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>my <span class="ot">=</span> <span class="fu">mean</span>(dt<span class="sc">$</span>year)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>yearb <span class="ot">=</span> dt<span class="sc">$</span>year <span class="sc">-</span> my</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">=</span> <span class="fu">mean</span>(dt<span class="sc">$</span>age)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ageb <span class="ot">=</span> dt<span class="sc">$</span>age  <span class="sc">-</span> ma</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>dtfit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> t3 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data=</span>dt, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(dtfit, <span class="at">confint=</span><span class="cn">TRUE</span>, <span class="at">exp=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">1127</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">died</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">Generalized linear model</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Family</td>
<td style="text-align: right;">binomial</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Link</td>
<td style="text-align: right;">logit</td>
</tr>
</tbody>
</table>
</div>
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">χ²(6)</td>
<td style="text-align: right;">90.69</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Pseudo-R² (Cragg-Uhler)</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Pseudo-R² (McFadden)</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">AIC</td>
<td style="text-align: right;">474.67</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">BIC</td>
<td style="text-align: right;">509.86</td>
</tr>
</tbody>
</table>
</div>
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">exp(Est.)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">-3.29</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">t</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">-4.52</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">t2</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.02</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">t3</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-2.11</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">yearb</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">-1.80</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">ageb</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">2.27</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">surgery</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">-2.25</td>
<td style="text-align: right;">0.02</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: MLE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(dtfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="jvpziryuom" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jvpziryuom table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jvpziryuom thead, #jvpziryuom tbody, #jvpziryuom tfoot, #jvpziryuom tr, #jvpziryuom td, #jvpziryuom th {
  border-style: none;
}

#jvpziryuom p {
  margin: 0;
  padding: 0;
}

#jvpziryuom .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jvpziryuom .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jvpziryuom .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jvpziryuom .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jvpziryuom .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jvpziryuom .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jvpziryuom .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jvpziryuom .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jvpziryuom .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jvpziryuom .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jvpziryuom .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jvpziryuom .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jvpziryuom .gt_spanner_row {
  border-bottom-style: hidden;
}

#jvpziryuom .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jvpziryuom .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jvpziryuom .gt_from_md > :first-child {
  margin-top: 0;
}

#jvpziryuom .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jvpziryuom .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jvpziryuom .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jvpziryuom .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jvpziryuom .gt_row_group_first td {
  border-top-width: 2px;
}

#jvpziryuom .gt_row_group_first th {
  border-top-width: 2px;
}

#jvpziryuom .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jvpziryuom .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jvpziryuom .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jvpziryuom .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jvpziryuom .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jvpziryuom .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jvpziryuom .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jvpziryuom .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jvpziryuom .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jvpziryuom .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jvpziryuom .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jvpziryuom .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jvpziryuom .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jvpziryuom .gt_left {
  text-align: left;
}

#jvpziryuom .gt_center {
  text-align: center;
}

#jvpziryuom .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jvpziryuom .gt_font_normal {
  font-weight: normal;
}

#jvpziryuom .gt_font_bold {
  font-weight: bold;
}

#jvpziryuom .gt_font_italic {
  font-style: italic;
}

#jvpziryuom .gt_super {
  font-size: 65%;
}

#jvpziryuom .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jvpziryuom .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jvpziryuom .gt_indent_1 {
  text-indent: 5px;
}

#jvpziryuom .gt_indent_2 {
  text-indent: 10px;
}

#jvpziryuom .gt_indent_3 {
  text-indent: 15px;
}

#jvpziryuom .gt_indent_4 {
  text-indent: 20px;
}

#jvpziryuom .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">t</td>
<td headers="estimate" class="gt_row gt_center">0.689</td>
<td headers="ci" class="gt_row gt_center">0.582, 0.805</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">t2</td>
<td headers="estimate" class="gt_row gt_center">1.014</td>
<td headers="ci" class="gt_row gt_center">1.005, 1.025</td>
<td headers="p.value" class="gt_row gt_center">0.005</td></tr>
    <tr><td headers="label" class="gt_row gt_left">t3</td>
<td headers="estimate" class="gt_row gt_center">1.000</td>
<td headers="ci" class="gt_row gt_center">1.000, 1.000</td>
<td headers="p.value" class="gt_row gt_center">0.035</td></tr>
    <tr><td headers="label" class="gt_row gt_left">yearb</td>
<td headers="estimate" class="gt_row gt_center">0.876</td>
<td headers="ci" class="gt_row gt_center">0.756, 1.011</td>
<td headers="p.value" class="gt_row gt_center">0.072</td></tr>
    <tr><td headers="label" class="gt_row gt_left">ageb</td>
<td headers="estimate" class="gt_row gt_center">1.034</td>
<td headers="ci" class="gt_row gt_center">1.006, 1.066</td>
<td headers="p.value" class="gt_row gt_center">0.023</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">0.364</td>
<td headers="ci" class="gt_row gt_center">0.136, 0.815</td>
<td headers="p.value" class="gt_row gt_center">0.024</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</section>
<section id="ft-en-indicatrices" class="level3" data-number="14.4.2">
<h3 data-number="14.4.2" class="anchored" data-anchor-id="ft-en-indicatrices"><span class="header-section-number">14.4.2</span> <strong><span class="math inline">\(f(t)\)</span> en indicatrices </strong></h3>
<p>On va créer une variable de type dicrète regroupant la variable <em>t</em> sur ses quartiles (pour l’exemple seulement, tous types de regroupement est envisageable).<br>
On va utiliser la fonction <code>quantcut</code> du package <code>gtools</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ct4 <span class="ot">&lt;-</span> <span class="fu">quantcut</span>(dt<span class="sc">$</span>t)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt<span class="sc">$</span>ct4) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  [1,4]  (4,11] (11,23] (23,60] 
    299     275     282     271 </code></pre>
</div>
</div>
<p>On va générer un compteur et un total d’observations sur la strate regroupant <em>id</em> et <em>ct4</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>n <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>cumsum)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>N <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>sum)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On conserve la dernière observation dans la strate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">subset</span>(dt, n<span class="sc">==</span>N)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Estimation du modèle</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> ct4 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data=</span>dt2, <span class="at">family=</span>binomial)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(fit, <span class="at">confint=</span><span class="cn">TRUE</span>, <span class="at">exp=</span><span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">197</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">died</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">Generalized linear model</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Family</td>
<td style="text-align: right;">binomial</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Link</td>
<td style="text-align: right;">logit</td>
</tr>
</tbody>
</table>
</div>
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">χ²(6)</td>
<td style="text-align: right;">39.30</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Pseudo-R² (Cragg-Uhler)</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Pseudo-R² (McFadden)</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">AIC</td>
<td style="text-align: right;">236.48</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">BIC</td>
<td style="text-align: right;">259.46</td>
</tr>
</tbody>
</table>
</div>
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">exp(Est.)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">1.17</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">1.79</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">ct4(4,11]</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">-2.47</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">ct4(11,23]</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">-2.96</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">ct4(23,60]</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">2.01</td>
<td style="text-align: right;">-0.80</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">yearb</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">-2.18</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">ageb</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">surgery</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">-2.21</td>
<td style="text-align: right;">0.03</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: MLE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(fit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="wkcbecixxs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wkcbecixxs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wkcbecixxs thead, #wkcbecixxs tbody, #wkcbecixxs tfoot, #wkcbecixxs tr, #wkcbecixxs td, #wkcbecixxs th {
  border-style: none;
}

#wkcbecixxs p {
  margin: 0;
  padding: 0;
}

#wkcbecixxs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wkcbecixxs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wkcbecixxs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wkcbecixxs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wkcbecixxs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wkcbecixxs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkcbecixxs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wkcbecixxs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wkcbecixxs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wkcbecixxs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wkcbecixxs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wkcbecixxs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wkcbecixxs .gt_spanner_row {
  border-bottom-style: hidden;
}

#wkcbecixxs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wkcbecixxs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wkcbecixxs .gt_from_md > :first-child {
  margin-top: 0;
}

#wkcbecixxs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wkcbecixxs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wkcbecixxs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wkcbecixxs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wkcbecixxs .gt_row_group_first td {
  border-top-width: 2px;
}

#wkcbecixxs .gt_row_group_first th {
  border-top-width: 2px;
}

#wkcbecixxs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkcbecixxs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wkcbecixxs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wkcbecixxs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkcbecixxs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkcbecixxs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wkcbecixxs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wkcbecixxs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wkcbecixxs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wkcbecixxs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wkcbecixxs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkcbecixxs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wkcbecixxs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wkcbecixxs .gt_left {
  text-align: left;
}

#wkcbecixxs .gt_center {
  text-align: center;
}

#wkcbecixxs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wkcbecixxs .gt_font_normal {
  font-weight: normal;
}

#wkcbecixxs .gt_font_bold {
  font-weight: bold;
}

#wkcbecixxs .gt_font_italic {
  font-style: italic;
}

#wkcbecixxs .gt_super {
  font-size: 65%;
}

#wkcbecixxs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wkcbecixxs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wkcbecixxs .gt_indent_1 {
  text-indent: 5px;
}

#wkcbecixxs .gt_indent_2 {
  text-indent: 10px;
}

#wkcbecixxs .gt_indent_3 {
  text-indent: 15px;
}

#wkcbecixxs .gt_indent_4 {
  text-indent: 20px;
}

#wkcbecixxs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">ct4</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;[1,4]</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;(4,11]</td>
<td headers="estimate" class="gt_row gt_center">0.356</td>
<td headers="ci" class="gt_row gt_center">0.152, 0.792</td>
<td headers="p.value" class="gt_row gt_center">0.014</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;(11,23]</td>
<td headers="estimate" class="gt_row gt_center">0.199</td>
<td headers="ci" class="gt_row gt_center">0.061, 0.541</td>
<td headers="p.value" class="gt_row gt_center">0.003</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;(23,60]</td>
<td headers="estimate" class="gt_row gt_center">0.619</td>
<td headers="ci" class="gt_row gt_center">0.183, 1.981</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left">yearb</td>
<td headers="estimate" class="gt_row gt_center">0.816</td>
<td headers="ci" class="gt_row gt_center">0.677, 0.977</td>
<td headers="p.value" class="gt_row gt_center">0.029</td></tr>
    <tr><td headers="label" class="gt_row gt_left">ageb</td>
<td headers="estimate" class="gt_row gt_center">1.048</td>
<td headers="ci" class="gt_row gt_center">1.012, 1.089</td>
<td headers="p.value" class="gt_row gt_center">0.011</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">0.330</td>
<td headers="ci" class="gt_row gt_center">0.113, 0.837</td>
<td headers="p.value" class="gt_row gt_center">0.027</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="modèles-paramétriques-usuels" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="modèles-paramétriques-usuels"><span class="header-section-number">14.5</span> Modèles paramétriques usuels</h2>
<p>Pour le modèle de <strong>Weibull</strong> par exemple.</p>
<ul>
<li>De type <strong>AFT</strong></li>
</ul>
<p>On utilise la fonction <code>survreg</code> du package <strong><code>survival</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>weibull <span class="ot">=</span> <span class="fu">survreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibull"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weibull)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
survreg(formula = Surv(stime, died) ~ year + age + surgery, data = trans, 
    dist = "weibull")
              Value Std. Error     z       p
(Intercept) -3.0220     8.7284 -0.35   0.729
year         0.1620     0.1218  1.33   0.184
age         -0.0615     0.0247 -2.49   0.013
surgery      1.9703     0.7794  2.53   0.011
Log(scale)   0.5868     0.0927  6.33 2.5e-10

Scale= 1.8 

Weibull distribution
Loglik(model)= -488.2   Loglik(intercept only)= -497.6
    Chisq= 18.87 on 3 degrees of freedom, p= 0.00029 
Number of Newton-Raphson Iterations: 5 
n= 103 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(weibull, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `exponentiate` argument is not supported in the `tidy()` method
for `survreg` objects and will be ignored.</code></pre>
</div>
<div class="cell-output-display">

<div id="oxhizsizvh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oxhizsizvh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oxhizsizvh thead, #oxhizsizvh tbody, #oxhizsizvh tfoot, #oxhizsizvh tr, #oxhizsizvh td, #oxhizsizvh th {
  border-style: none;
}

#oxhizsizvh p {
  margin: 0;
  padding: 0;
}

#oxhizsizvh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oxhizsizvh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oxhizsizvh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oxhizsizvh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oxhizsizvh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oxhizsizvh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxhizsizvh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oxhizsizvh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oxhizsizvh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oxhizsizvh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oxhizsizvh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oxhizsizvh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oxhizsizvh .gt_spanner_row {
  border-bottom-style: hidden;
}

#oxhizsizvh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oxhizsizvh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oxhizsizvh .gt_from_md > :first-child {
  margin-top: 0;
}

#oxhizsizvh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oxhizsizvh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oxhizsizvh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oxhizsizvh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oxhizsizvh .gt_row_group_first td {
  border-top-width: 2px;
}

#oxhizsizvh .gt_row_group_first th {
  border-top-width: 2px;
}

#oxhizsizvh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxhizsizvh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oxhizsizvh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oxhizsizvh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxhizsizvh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxhizsizvh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oxhizsizvh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oxhizsizvh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oxhizsizvh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxhizsizvh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oxhizsizvh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxhizsizvh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oxhizsizvh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxhizsizvh .gt_left {
  text-align: left;
}

#oxhizsizvh .gt_center {
  text-align: center;
}

#oxhizsizvh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oxhizsizvh .gt_font_normal {
  font-weight: normal;
}

#oxhizsizvh .gt_font_bold {
  font-weight: bold;
}

#oxhizsizvh .gt_font_italic {
  font-style: italic;
}

#oxhizsizvh .gt_super {
  font-size: 65%;
}

#oxhizsizvh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oxhizsizvh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oxhizsizvh .gt_indent_1 {
  text-indent: 5px;
}

#oxhizsizvh .gt_indent_2 {
  text-indent: 10px;
}

#oxhizsizvh .gt_indent_3 {
  text-indent: 15px;
}

#oxhizsizvh .gt_indent_4 {
  text-indent: 20px;
}

#oxhizsizvh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>exp(Beta)</strong>"><strong>exp(Beta)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">year</td>
<td headers="estimate" class="gt_row gt_center">0.162</td>
<td headers="ci" class="gt_row gt_center">-0.077, 0.401</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="estimate" class="gt_row gt_center">-0.062</td>
<td headers="ci" class="gt_row gt_center">-0.110, -0.013</td>
<td headers="p.value" class="gt_row gt_center">0.013</td></tr>
    <tr><td headers="label" class="gt_row gt_left">surgery</td>
<td headers="estimate" class="gt_row gt_center">1.970</td>
<td headers="ci" class="gt_row gt_center">0.443, 3.498</td>
<td headers="p.value" class="gt_row gt_center">0.011</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<ul>
<li>De type <strong>PH</strong></li>
</ul>
<p>La paramétrisation PH n’est pas possible avec la fonction <code>survreg</code>. Il faut utiliser le package <strong><code>flexsurv</code></strong>, qui permet également d’estimer les modèles paramétriques disponibles avec <code>survival</code>. La syntaxe est quasiment identique.</p>
<p>Pour estimer le modèle de Weibull de type PH, on utilise en option l’agument <code>dist="weibullPH</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>weibullph <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibullPH"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>weibullph</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
flexsurvreg(formula = Surv(stime, died) ~ year + age + surgery, 
    data = trans, dist = "weibullPH")

Estimates: 
         data mean  est        L95%       U95%       se         exp(est) 
shape           NA   5.56e-01   4.64e-01   6.67e-01   5.16e-02         NA
scale           NA   5.37e+00   4.27e-04   6.75e+04   2.59e+01         NA
year      7.06e+01  -9.01e-02  -2.20e-01   3.97e-02   6.62e-02   9.14e-01
age       4.46e+01   3.42e-02   7.13e-03   6.13e-02   1.38e-02   1.03e+00
surgery   1.17e-01  -1.10e+00  -1.95e+00  -2.45e-01   4.34e-01   3.34e-01
         L95%       U95%     
shape           NA         NA
scale           NA         NA
year      8.03e-01   1.04e+00
age       1.01e+00   1.06e+00
surgery   1.43e-01   7.83e-01

N = 103,  Events: 75,  Censored: 28
Total time at risk: 31938
Log-likelihood = -488.1683, df = 5
AIC = 986.3366</code></pre>
</div>
</div>
</section>
<section id="risques-concurrents" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="risques-concurrents"><span class="header-section-number">14.6</span> Risques concurrents</h2>
<p>Le package <code>cmprsk</code> pour l’analyse non paramétrique et le modèle de Fine-Gray (non traité).</p>
<p>Package cmprsk pour l’analyse non paramétrique et le modèle de Fine-Gray. La variable de censure/évènement, <em>compet</em>, correspond à la variable died avec une modalité supplémentaire simulée. On suppose l’existence d’une cause supplémentaire au décès autre qu’une malformation cardiaque et non strictement indépendante de cell-ci.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variable compet</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>compet) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1  2 
28 56 19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable died</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>died) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1 
28 75 </code></pre>
</div>
</div>
<section id="incidences-cumulées" class="level4" data-number="14.6.0.1">
<h4 data-number="14.6.0.1" class="anchored" data-anchor-id="incidences-cumulées"><span class="header-section-number">14.6.0.1</span> Incidences cumulées</h4>
<p>On utilise la fonction <code>cuminc</code> du package <strong><code>cmprsk</code></strong>.</p>
<p><em>Pas de comparaison de groupes</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>ic </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and Variances:
$est
          500      1000      1500
1 1 0.5067598 0.5808345 0.6340038
1 2 0.1720161 0.2140841 0.2140841

$var
            500        1000        1500
1 1 0.002619449 0.003131847 0.003676516
1 2 0.001473283 0.002203770 0.002203770</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="13-R_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Avec <code>survminer</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="13-R_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><em>Comparaison de groupes</em></p>
<p>Le test de Gray est automatiquement exécuté.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, <span class="at">group=</span>compet<span class="sc">$</span>surgery, <span class="at">rho=</span><span class="dv">1</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ic </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tests:
      stat         pv df
1 4.604792 0.03188272  1
2 0.272147 0.60189515  1
Estimates and Variances:
$est
           500      1000      1500
0 1 0.54917896 0.5940358 0.6604903
1 1 0.18181818 0.4242424        NA
0 2 0.18168014 0.2066006 0.2066006
1 2 0.09090909 0.2121212        NA

$var
            500        1000        1500
0 1 0.002955869 0.003335897 0.004199157
1 1 0.014958678 0.033339569          NA
0 2 0.001727112 0.002271242 0.002271242
1 2 0.008449138 0.022024737          NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="13-R_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Avec <code>survminer</code>, pour obtenir un seul graphique pour toutes les courbes ajouter l’option <strong><code>multiple_panels = F</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="13-R_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic, <span class="at">multiple_panels =</span> F)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="13-R_files/figure-html/unnamed-chunk-45-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="13-R_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modèles" class="level4" data-number="14.6.0.2">
<h4 data-number="14.6.0.2" class="anchored" data-anchor-id="modèles"><span class="header-section-number">14.6.0.2</span> <strong>Modèles</strong></h4>
<p>On va utilisé seulement le modèle multinomial à durée discrète, le modèle <em>fine-gray</em> pendant du modèle de Cox pour les risques concurrents étant fortement critiqué. Si une analyse de type <em>cause-specific</em> est envisageable (issues concurrentes traitées comme des censures à droites) on utilise simplement la fonction <code>coxph</code> de <code>survival</code>.</p>
<p>On va de nouveau utiliser la variable mois (durée discrète). Le modèle sera estimé à l’aide la fonction <strong><code>multinom</code></strong> du très vieillissant package <code>nnet</code>, les p-values doivent-être programmées, l’output ne donnant que les erreurs-types.</p>
<p><em>Mise en formae de la base</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>compet<span class="sc">$</span>T <span class="ot">=</span> compet<span class="sc">$</span>mois</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">uncount</span>(compet, mois)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">arrange</span>(td, id)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(td<span class="sc">$</span>x, td<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t2 <span class="ot">=</span> td<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>my <span class="ot">=</span> <span class="fu">mean</span>(td<span class="sc">$</span>year)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>yearb <span class="ot">=</span> td<span class="sc">$</span>year <span class="sc">-</span> my</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">=</span> <span class="fu">mean</span>(td<span class="sc">$</span>age)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>ageb <span class="ot">=</span> td<span class="sc">$</span>age  <span class="sc">-</span> ma</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(td<span class="sc">$</span>t<span class="sc">&lt;</span>td<span class="sc">$</span>T,<span class="dv">0</span>, td<span class="sc">$</span>compet)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Estimation</em></p>
<p>Pour estimer le modèle, on utilise la fonction <strong><code>mlogit</code></strong>. Les p-values seront calculées à partir d’un test bilatéral (statistique z).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>competfit <span class="ot">=</span> <span class="fu">multinom</span>(<span class="at">formula =</span> e <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data =</span> td)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  21 (12 variable)
initial  value 1238.136049 
iter  10 value 608.949443
iter  20 value 341.102661
iter  30 value 277.143136
iter  40 value 275.005451
final  value 275.005419 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(competfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="hqczxpjsdu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hqczxpjsdu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hqczxpjsdu thead, #hqczxpjsdu tbody, #hqczxpjsdu tfoot, #hqczxpjsdu tr, #hqczxpjsdu td, #hqczxpjsdu th {
  border-style: none;
}

#hqczxpjsdu p {
  margin: 0;
  padding: 0;
}

#hqczxpjsdu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hqczxpjsdu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hqczxpjsdu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hqczxpjsdu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hqczxpjsdu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hqczxpjsdu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqczxpjsdu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hqczxpjsdu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hqczxpjsdu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hqczxpjsdu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hqczxpjsdu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hqczxpjsdu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hqczxpjsdu .gt_spanner_row {
  border-bottom-style: hidden;
}

#hqczxpjsdu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hqczxpjsdu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hqczxpjsdu .gt_from_md > :first-child {
  margin-top: 0;
}

#hqczxpjsdu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hqczxpjsdu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hqczxpjsdu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hqczxpjsdu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hqczxpjsdu .gt_row_group_first td {
  border-top-width: 2px;
}

#hqczxpjsdu .gt_row_group_first th {
  border-top-width: 2px;
}

#hqczxpjsdu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqczxpjsdu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hqczxpjsdu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hqczxpjsdu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqczxpjsdu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqczxpjsdu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hqczxpjsdu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hqczxpjsdu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hqczxpjsdu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hqczxpjsdu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hqczxpjsdu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqczxpjsdu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hqczxpjsdu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hqczxpjsdu .gt_left {
  text-align: left;
}

#hqczxpjsdu .gt_center {
  text-align: center;
}

#hqczxpjsdu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hqczxpjsdu .gt_font_normal {
  font-weight: normal;
}

#hqczxpjsdu .gt_font_bold {
  font-weight: bold;
}

#hqczxpjsdu .gt_font_italic {
  font-style: italic;
}

#hqczxpjsdu .gt_super {
  font-size: 65%;
}

#hqczxpjsdu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hqczxpjsdu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hqczxpjsdu .gt_indent_1 {
  text-indent: 5px;
}

#hqczxpjsdu .gt_indent_2 {
  text-indent: 10px;
}

#hqczxpjsdu .gt_indent_3 {
  text-indent: 15px;
}

#hqczxpjsdu .gt_indent_4 {
  text-indent: 20px;
}

#hqczxpjsdu .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <th colspan="4" class="gt_group_heading" scope="colgroup" id="1">1</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="1  label" class="gt_row gt_left">t</td>
<td headers="1  estimate" class="gt_row gt_center">0.82</td>
<td headers="1  ci" class="gt_row gt_center">0.75, 0.88</td>
<td headers="1  p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="1  label" class="gt_row gt_left">t2</td>
<td headers="1  estimate" class="gt_row gt_center">1.00</td>
<td headers="1  ci" class="gt_row gt_center">1.00, 1.00</td>
<td headers="1  p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="1  label" class="gt_row gt_left">yearb</td>
<td headers="1  estimate" class="gt_row gt_center">0.88</td>
<td headers="1  ci" class="gt_row gt_center">0.75, 1.03</td>
<td headers="1  p.value" class="gt_row gt_center">0.12</td></tr>
    <tr><td headers="1  label" class="gt_row gt_left">ageb</td>
<td headers="1  estimate" class="gt_row gt_center">1.04</td>
<td headers="1  ci" class="gt_row gt_center">1.01, 1.08</td>
<td headers="1  p.value" class="gt_row gt_center">0.012</td></tr>
    <tr><td headers="1  label" class="gt_row gt_left">surgery</td>
<td headers="1  estimate" class="gt_row gt_center">0.32</td>
<td headers="1  ci" class="gt_row gt_center">0.11, 0.91</td>
<td headers="1  p.value" class="gt_row gt_center">0.033</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="4" class="gt_group_heading" scope="colgroup" id="2">2</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="2  label" class="gt_row gt_left">t</td>
<td headers="2  estimate" class="gt_row gt_center">0.82</td>
<td headers="2  ci" class="gt_row gt_center">0.71, 0.94</td>
<td headers="2  p.value" class="gt_row gt_center">0.003</td></tr>
    <tr><td headers="2  label" class="gt_row gt_left">t2</td>
<td headers="2  estimate" class="gt_row gt_center">1.00</td>
<td headers="2  ci" class="gt_row gt_center">1.00, 1.01</td>
<td headers="2  p.value" class="gt_row gt_center">0.052</td></tr>
    <tr><td headers="2  label" class="gt_row gt_left">yearb</td>
<td headers="2  estimate" class="gt_row gt_center">0.82</td>
<td headers="2  ci" class="gt_row gt_center">0.62, 1.07</td>
<td headers="2  p.value" class="gt_row gt_center">0.14</td></tr>
    <tr><td headers="2  label" class="gt_row gt_left">ageb</td>
<td headers="2  estimate" class="gt_row gt_center">1.01</td>
<td headers="2  ci" class="gt_row gt_center">0.96, 1.06</td>
<td headers="2  p.value" class="gt_row gt_center">0.7</td></tr>
    <tr><td headers="2  label" class="gt_row gt_left">surgery</td>
<td headers="2  estimate" class="gt_row gt_center">0.54</td>
<td headers="2  ci" class="gt_row gt_center">0.12, 2.50</td>
<td headers="2  p.value" class="gt_row gt_center">0.4</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>c’est le cas ici, la variable <em>surgery</em> est bien codée (0;1)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12-annexe.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Annexes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb92" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">   - lightbox</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">#knitr::opts_chunk$set(echo = TRUE, render = knitr::normal_print)</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (rsconnect)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(memisc)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="co">#options(scipen=999)</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">show.signif.stars=</span><span class="cn">FALSE</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># **R**</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>Programme de cette section: <span class="co">[</span><span class="ot">Lien</span><span class="co">](programme_R.R)</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages et fonctions</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>| **Analyse**                             | Packages - Fonctions                                  |</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>+=========================================+=======================================================+</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>| **Non paramétrique**                    | -   <span class="in">`discsurv`</span>                                        |</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`lifetable`</span>                                   |</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`contToDisc`</span>                                  |</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survfit`</span>                                     |</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survdif`</span>                                     |</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`survRM2`</span>                                         |</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`rmst2`</span>                                       |</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>| **Modèles à risques proportionnel**     | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`coxph`</span>                                       |</span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`cox.zph`</span> (v3) <span class="in">`cox.zphold`</span> (récupération v2) |</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survsplit`</span>                                   |</span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>|                                         | -   base et <span class="in">`tydir`</span>                                   |</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`uncount`</span>                                     |</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`glm`</span>                                         |</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>| **Modèles paramétriques (ph ou aft)**   | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survreg`</span>                                     |</span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`flexsurv`</span>                                        |</span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survreg`</span>                                     |</span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>| **Risques concurents**                  | -   <span class="in">`cmprsk`</span>                                          |</span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`cuminc`</span>                                      |</span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`nnet`</span>                                            |</span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`multinom`</span>                                    |</span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>| **Autres (graphiques - mise en forme)** | -   <span class="in">`survminer`</span>                                       |</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`jtools`</span>                                          |</span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>|                                         | -  <span class="in">`gtsummary`</span>                                        |</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>**Installation**</span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>Les dernières versions de certains packages peuvent être installées via Github (ex: <span class="in">`survminer`</span>). Pour les récupérer, passer par le package ```devtools```.  </span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survival")</span></span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survminer")</span></span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("flexsurv")</span></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survRM2")</span></span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyr")</span></span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr")</span></span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("jtools")</span></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtools")</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("cmprsk")</span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a><span class="co">#install.package("gtsummary")</span></span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("muhaz")</span></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("nnet")</span></span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2)</span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discSurv)</span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(muhaz)</span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyse Non paramétrique</span></span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a>Chargement de la base transplantation</span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a><span class="fu">### Méthode actuarielle</span></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a>La fonction disponible du paquet <span class="in">`discsurv`</span>, *`lifetable`*, a des fonctionalités plutôt limitées. Si on peut depuis une MAJ récente définir des intervalles de durée, il n'y a toujours pas d'estimateurs les différents quantiles de la courbe de survie.   </span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a>La programmation est rendue un peu compliquée pour pas grand chose. Je donne les codes pour info, sans plus de commentaires.</span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">=</span> <span class="fu">as.data.frame</span>(trans)</span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a>**Fonction `lifeTable`**  </span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a>***Intervalle par defaut $dt=1$***  </span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "S(t) méthode actuarielle avec `discSurv` (1)"</span></span>
<span id="cb92-144"><a href="#cb92-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">=</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles t = journalier"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a>***Intervalle $dt=30$***</span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:  "Méthode actuarielle avec `discSurv` (2)"</span></span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit un vecteur définissant les intervalles (il n'y avait pas plus simple????)</span></span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(<span class="fu">max</span>(trans<span class="sc">$</span>stime)<span class="sc">/</span><span class="dv">30</span>)<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Base dis avec une nouvelle variable de durée =&gt; timeDisc </span></span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">contToDisc</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">intervalLimits =</span> dt )</span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>dis, <span class="at">timeColumn=</span><span class="st">"timeDisc"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles dt = 30 jours"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a>Sur les abscisses, ce sont les valeurs des intervalles qui sont reportés: 10=300 jours. Ce n'est vraiment pas terrible. Pour ce type d'estimateurs, il est préférable d'utiliser Sas ou Stata.</span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Méthode Kaplan-Meier</span></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a>Le package survival est le principal outil d'analyse des durée. Le package **`survminer`** permet d'améliorer la présentation des graphiques. </span>
<span id="cb92-172"><a href="#cb92-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-173"><a href="#cb92-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-174"><a href="#cb92-174" aria-hidden="true" tabindex="-1"></a>**Estimation des fonctions de survie**  </span>
<span id="cb92-175"><a href="#cb92-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-176"><a href="#cb92-176" aria-hidden="true" tabindex="-1"></a>Fonction **`survfit`**  </span>
<span id="cb92-177"><a href="#cb92-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-178"><a href="#cb92-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="syntaxe", eval=F}</span></span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> x, <span class="at">data =</span> base)</span>
<span id="cb92-180"><a href="#cb92-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-181"><a href="#cb92-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a>On peut renseigner directement les variables permettant de calculer la durée et non la variable de durée elle-même. Cette méthode est utilisée lorsqu'on introduit une variable dynamique dans un modèle semi-paramétrique de Cox (<span class="in">`coxph`</span>).</span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-184"><a href="#cb92-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="Syntaxe", eval=F}</span></span>
<span id="cb92-185"><a href="#cb92-185" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(variable_start, variable_end, status) <span class="sc">~</span> x, <span class="at">data =</span> nom_base)</span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-187"><a href="#cb92-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-188"><a href="#cb92-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a>Sans comparaison de groupes:  </span>
<span id="cb92-190"><a href="#cb92-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a>Le premier output <span class="in">`fit`</span> permet d'obtenir la durée médiane, ici égale à 100 ($S(100)=0.494$). Le second  avec la fonction **`summary`** permet d'obtenir une table des estimateurs. La fonction de survie peut être tracée avec la fonction **`plot`** (en pointillés les intervalles de confiance).  </span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-206"><a href="#cb92-206" aria-hidden="true" tabindex="-1"></a>On peut obtenir des graphes de  meilleur qualité avec la librairie **`survminer`**, avec la fonction **`ggsurvplot`**</span>
<span id="cb92-207"><a href="#cb92-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-211"><a href="#cb92-211" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-212"><a href="#cb92-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a>On peut ajouter la population encore soumise au risque à plusieurs points d'observation avec l'argument <span class="in">`risk.table = TRUE`</span></span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-222"><a href="#cb92-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-223"><a href="#cb92-223" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparaison des S(t) méthode KM</span></span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a>On va comparer les deuxfonctions de survie pour la variable *surgery*, celle pour les personnes non opérées et celle pour les personnes opérées.  </span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-229"><a href="#cb92-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-230"><a href="#cb92-230" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a>**Tests du logrank**</span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a>On utilise la fonction **`survdiff`**, avec comme variante le test de Peto-Peto (<span class="in">`rho=1`</span>).  </span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a>La syntaxe est quasiment identique à la fonction <span class="in">`survdiff`</span>.  </span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-245"><a href="#cb92-245" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">rho=</span><span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb92-246"><a href="#cb92-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-247"><a href="#cb92-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-248"><a href="#cb92-248" aria-hidden="true" tabindex="-1"></a>Ici la variable est binaire. Si on veux tester deux à deux les niveaux d'une variable catégorielle à plus de deux modalités, il est fortement conseillé d'utiliser la fonction **`pairwise_survdiff`** de <span class="in">`survminer`</span> (syntaxe identique que <span class="in">`survdiff`</span>).  </span>
<span id="cb92-249"><a href="#cb92-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-250"><a href="#cb92-250" aria-hidden="true" tabindex="-1"></a>**Comparaison des RMST**</span>
<span id="cb92-251"><a href="#cb92-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-252"><a href="#cb92-252" aria-hidden="true" tabindex="-1"></a>La fonction **`rmst2`** du package **`survRM2`** permet de comparer les RMST entre 2 groupes . La strate</span>
<span id="cb92-253"><a href="#cb92-253" aria-hidden="true" tabindex="-1"></a>pour les comparaisons doit être impérativement renommée *arm*. La fonction, issue d'une commande de Stata, n'est pas très souple.</span>
<span id="cb92-254"><a href="#cb92-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-257"><a href="#cb92-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-258"><a href="#cb92-258" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>arm<span class="ot">=</span>trans<span class="sc">$</span>surgery</span>
<span id="cb92-259"><a href="#cb92-259" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">rmst2</span>(trans<span class="sc">$</span>stime, trans<span class="sc">$</span>died, trans<span class="sc">$</span>arm, <span class="at">tau=</span><span class="cn">NULL</span>)</span>
<span id="cb92-260"><a href="#cb92-260" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb92-261"><a href="#cb92-261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a)</span>
<span id="cb92-262"><a href="#cb92-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-263"><a href="#cb92-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-264"><a href="#cb92-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-265"><a href="#cb92-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modèle de Cox</span></span>
<span id="cb92-266"><a href="#cb92-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-267"><a href="#cb92-267" aria-hidden="true" tabindex="-1"></a>Ici tout est estimé de nouveau avec des fonctions du package <span class="in">`survival`</span>:  </span>
<span id="cb92-268"><a href="#cb92-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-269"><a href="#cb92-269" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Estimation du modèle: <span class="in">`coxph`</span>.</span>
<span id="cb92-270"><a href="#cb92-270" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Test de Grambsch-Therneau: ```cox.zph``<span class="in">` et `</span>cox.oldzph`.</span>
<span id="cb92-271"><a href="#cb92-271" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Introduction d'une variable dynamique: allongement de la base avec ```survsplit```.</span>
<span id="cb92-272"><a href="#cb92-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-273"><a href="#cb92-273" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimation du modèle</span></span>
<span id="cb92-274"><a href="#cb92-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-275"><a href="#cb92-275" aria-hidden="true" tabindex="-1"></a>Par défaut, R utilise la correction d'Efron pour les évènements simultanés. Il est préférable de ne pas la modifier.</span>
<span id="cb92-276"><a href="#cb92-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-277"><a href="#cb92-277" aria-hidden="true" tabindex="-1"></a>Syntaxe:</span>
<span id="cb92-278"><a href="#cb92-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-279"><a href="#cb92-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{e filename="Syntaxe", eval=FALSE}</span></span>
<span id="cb92-280"><a href="#cb92-280" aria-hidden="true" tabindex="-1"></a><span class="in">coxph(Surv(time, status) ~ x1 + x2 + ....., data=base, ties="nom_correction"))</span></span>
<span id="cb92-281"><a href="#cb92-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-282"><a href="#cb92-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-285"><a href="#cb92-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-286"><a href="#cb92-286" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb92-287"><a href="#cb92-287" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span>
<span id="cb92-288"><a href="#cb92-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-289"><a href="#cb92-289" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(coxfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,)</span>
<span id="cb92-290"><a href="#cb92-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-291"><a href="#cb92-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-292"><a href="#cb92-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-293"><a href="#cb92-293" aria-hidden="true" tabindex="-1"></a>L'output des résultats reporte le logarithme des Risques Ratios (coef) ainsi que les RR (exp(coef)). Il est intéressant de regarder la valeur de concordance (Harrel's) qui donne des indications sur la qualité de l'ajustement (proche de l'AUC/ROC d'un modèle probabiliste standard).  </span>
<span id="cb92-294"><a href="#cb92-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-295"><a href="#cb92-295" aria-hidden="true" tabindex="-1"></a>On peut représenter sous forme graphique les résultats avec la fonction **`ggforest`** de <span class="in">`survminer`</span></span>
<span id="cb92-296"><a href="#cb92-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-299"><a href="#cb92-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-300"><a href="#cb92-300" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(coxfit)</span>
<span id="cb92-301"><a href="#cb92-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-302"><a href="#cb92-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-303"><a href="#cb92-303" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hypothèse PH</span></span>
<span id="cb92-304"><a href="#cb92-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-305"><a href="#cb92-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-306"><a href="#cb92-306" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Test Grambsch-Therneau</span></span>
<span id="cb92-307"><a href="#cb92-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-308"><a href="#cb92-308" aria-hidden="true" tabindex="-1"></a>**Résidus de Schoenfeld**  </span>
<span id="cb92-309"><a href="#cb92-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-310"><a href="#cb92-310" aria-hidden="true" tabindex="-1"></a>On utilise la fonction **`cox.zph`** pour effectuer le test GLS (moindre carrés généralisés) qui a été substitué au test OLS (moindres carrés ordinaires) avec le passage à la v3 du package. **Je donne plus loin un moyen de récupérer et d'exécuter le test OLS, que je conseille d'utiliser en présence de durées discrètes/groupées**.</span>
<span id="cb92-311"><a href="#cb92-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-312"><a href="#cb92-312" aria-hidden="true" tabindex="-1"></a>Le test peut utiliser plusieurs fonctions de la durée. Par défaut la fonction utilise $1-KM$, soit le complémentaire de l'estimateur de Kaplan-Meier (option <span class="in">`transform="km"`</span>).</span>
<span id="cb92-313"><a href="#cb92-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-314"><a href="#cb92-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-315"><a href="#cb92-315" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Test GLS (V3 de survival)**</span>
<span id="cb92-316"><a href="#cb92-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-317"><a href="#cb92-317" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`transform="km"`</span></span>
<span id="cb92-318"><a href="#cb92-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-321"><a href="#cb92-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-322"><a href="#cb92-322" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit)</span>
<span id="cb92-323"><a href="#cb92-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-324"><a href="#cb92-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-325"><a href="#cb92-325" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`transform="identity"`</span> ($f(t)=t$)</span>
<span id="cb92-326"><a href="#cb92-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-329"><a href="#cb92-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-330"><a href="#cb92-330" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span>
<span id="cb92-331"><a href="#cb92-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-332"><a href="#cb92-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-333"><a href="#cb92-333" aria-hidden="true" tabindex="-1"></a>Remarque: avec la v3 de survival, quelques options ont été ajoutées tel que *`terms`* qui permet pour une variable catégorielle à plus de deux modalités de choisir entre un sous test multiple sur la variable (k modalités =&gt; k-1 degré de liberté) et une série de tests à 1 degré de liberté sur chaque modalité (k-1 tests). De mon point de vue préférer la seconde solution avec **`terms=FALSE`**. le test de Grambsch-Therneau est particulièrement sensible au nombre de degré de liberté, et il convient donc d'éviter de l'utiliser dans un cadre multiple.</span>
<span id="cb92-334"><a href="#cb92-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-335"><a href="#cb92-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-336"><a href="#cb92-336" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Test OLS (V2 de survival - Stata - Sas - Python)**</span>
<span id="cb92-337"><a href="#cb92-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-338"><a href="#cb92-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="Récupération du test ols"}</span></span>
<span id="cb92-339"><a href="#cb92-339" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/main/cox.zphold/cox.zphold.R"</span>)</span>
<span id="cb92-340"><a href="#cb92-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-341"><a href="#cb92-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-342"><a href="#cb92-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename="Exécution du test ols"}</span></span>
<span id="cb92-343"><a href="#cb92-343" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span>
<span id="cb92-344"><a href="#cb92-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-345"><a href="#cb92-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-346"><a href="#cb92-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-347"><a href="#cb92-347" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Introduction d'une intéraction</span></span>
<span id="cb92-348"><a href="#cb92-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-349"><a href="#cb92-349" aria-hidden="true" tabindex="-1"></a>Lorsque la covariable n'est pas continue, elle doit être impérativement transformée en indicatrice ^<span class="co">[</span><span class="ot">c'est le cas ici, la variable *surgery* est bien codée (0;1)</span><span class="co">]</span>. Penser à vérifier en amont que les résultats du modèle sont bien identiques avec le modèle estimé précédemment (ne pas oublier d'omettre le niveau en référence).  </span>
<span id="cb92-350"><a href="#cb92-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-351"><a href="#cb92-351" aria-hidden="true" tabindex="-1"></a>La variable d'intéraction est **`tt(nom_variable)`**, la fonction de la durée (ici forme linéaire simple) est indiquée en option de la fonction: **`tt = function(x, t, ...) x*t`**. </span>
<span id="cb92-352"><a href="#cb92-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-355"><a href="#cb92-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-356"><a href="#cb92-356" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> <span class="fu">tt</span>(surgery), <span class="at">data =</span> trans, <span class="at">tt =</span> <span class="cf">function</span>(x, t, ...) x<span class="sc">*</span>t)</span>
<span id="cb92-357"><a href="#cb92-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-358"><a href="#cb92-358" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit2)</span>
<span id="cb92-359"><a href="#cb92-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-360"><a href="#cb92-360" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(coxfit2, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb92-361"><a href="#cb92-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-362"><a href="#cb92-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-363"><a href="#cb92-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-364"><a href="#cb92-364" aria-hidden="true" tabindex="-1"></a>**Rappel**: le paramètre estimé pour **`tt(surgery)`** ne reporte pas un rapport de risques, mais un rapport de de deux rapports de risques. C'est bien une double différence sur l'échelle d'estimation (log).  </span>
<span id="cb92-365"><a href="#cb92-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-366"><a href="#cb92-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-367"><a href="#cb92-367" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introduction d'une variable dynamique (binaire)</span></span>
<span id="cb92-368"><a href="#cb92-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-369"><a href="#cb92-369" aria-hidden="true" tabindex="-1"></a>La dimension dynamique est ici le fait d'avoir été opéré pour une greffe du coeur.  </span>
<span id="cb92-370"><a href="#cb92-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-371"><a href="#cb92-371" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 1**: créer un vecteur donnant les durées aux temps d'évènement.</span>
<span id="cb92-372"><a href="#cb92-372" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 2**: appliquer ce vecteurs de points de coupure à la fonction ```survsplit```.</span>
<span id="cb92-373"><a href="#cb92-373" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 3**: modifier la variable transplant (ou créer une nouvelle) à l'aide de la variable **wait** qui prend la valeur 1 à partir du jour de la greffe, 0 avant.</span>
<span id="cb92-374"><a href="#cb92-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-375"><a href="#cb92-375" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Etape 1*: création de l'objet cut (vecteur), qui récupère les moments où au moins un évènement est observé.</span>
<span id="cb92-378"><a href="#cb92-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb92-379"><a href="#cb92-379" aria-hidden="true" tabindex="-1"></a>cut<span class="ot">=</span> <span class="fu">unique</span>(trans<span class="sc">$</span>stime[trans<span class="sc">$</span>died <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb92-380"><a href="#cb92-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-381"><a href="#cb92-381" aria-hidden="true" tabindex="-1"></a>cut</span>
<span id="cb92-382"><a href="#cb92-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-383"><a href="#cb92-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-384"><a href="#cb92-384" aria-hidden="true" tabindex="-1"></a>*Etape 2*: allonger la base aux durées d'évènement</span>
<span id="cb92-385"><a href="#cb92-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-388"><a href="#cb92-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-389"><a href="#cb92-389" aria-hidden="true" tabindex="-1"></a>tvc <span class="ot">=</span> <span class="fu">survSplit</span>(<span class="at">data =</span> trans, <span class="at">cut =</span> cut, <span class="at">end =</span> <span class="st">"stime"</span>, <span class="at">start =</span> <span class="st">"stime0"</span>, <span class="at">event =</span> <span class="st">"died"</span>)</span>
<span id="cb92-390"><a href="#cb92-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-391"><a href="#cb92-391" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tvc, <span class="at">n=</span><span class="dv">20</span> )</span>
<span id="cb92-392"><a href="#cb92-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-393"><a href="#cb92-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-394"><a href="#cb92-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-395"><a href="#cb92-395" aria-hidden="true" tabindex="-1"></a>On vérifie qu'on obtient les même résultats avec le modèle sans tvc</span>
<span id="cb92-396"><a href="#cb92-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-399"><a href="#cb92-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-400"><a href="#cb92-400" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> tvc)</span>
<span id="cb92-401"><a href="#cb92-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-402"><a href="#cb92-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-403"><a href="#cb92-403" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Etape 3*: on génère la variable dynamique de sorte que les personnes n'apparaissent pas greffés avant l'opération</span>
<span id="cb92-404"><a href="#cb92-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-407"><a href="#cb92-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-408"><a href="#cb92-408" aria-hidden="true" tabindex="-1"></a>tvc<span class="sc">$</span>tvc<span class="ot">=</span><span class="fu">ifelse</span>(tvc<span class="sc">$</span>transplant<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> tvc<span class="sc">$</span>wait<span class="sc">&lt;=</span>tvc<span class="sc">$</span>stime,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb92-409"><a href="#cb92-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-410"><a href="#cb92-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-411"><a href="#cb92-411" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**  </span>
<span id="cb92-412"><a href="#cb92-412" aria-hidden="true" tabindex="-1"></a>En format long, on doit préciser dans la formule l'intervalle de durée avec les variables stime0 (début) et stime(fin) </span>
<span id="cb92-415"><a href="#cb92-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-416"><a href="#cb92-416" aria-hidden="true" tabindex="-1"></a>tvcfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> tvc, <span class="at">data =</span> tvc)</span>
<span id="cb92-417"><a href="#cb92-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-418"><a href="#cb92-418" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tvcfit)</span>
<span id="cb92-419"><a href="#cb92-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-420"><a href="#cb92-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-421"><a href="#cb92-421" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(tvcfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb92-422"><a href="#cb92-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-423"><a href="#cb92-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-424"><a href="#cb92-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-427"><a href="#cb92-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-428"><a href="#cb92-428" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(tvcfit)</span>
<span id="cb92-429"><a href="#cb92-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-430"><a href="#cb92-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-431"><a href="#cb92-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-432"><a href="#cb92-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-433"><a href="#cb92-433" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Analyse en durée discrète**</span></span>
<span id="cb92-434"><a href="#cb92-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-435"><a href="#cb92-435" aria-hidden="true" tabindex="-1"></a>Pour la durée, on va utiliser la variable mois (regroupement sur 30 jours).  </span>
<span id="cb92-436"><a href="#cb92-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-437"><a href="#cb92-437" aria-hidden="true" tabindex="-1"></a>La fonction **`uncount`** du package ```tidyr``` permettra de splitter la base aux durées d'observation. C'est ici la principale différence avec le modèle de Cox qui est une estimation aux durées d'évènement   </span>
<span id="cb92-438"><a href="#cb92-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-441"><a href="#cb92-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-442"><a href="#cb92-442" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb92-443"><a href="#cb92-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-444"><a href="#cb92-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-445"><a href="#cb92-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-446"><a href="#cb92-446" aria-hidden="true" tabindex="-1"></a>La variable *mois*, va être supprimée avec <span class="in">`uncount`</span>. Comme on en aura besoin plus loin pour générer proprement la variable évènement, on peut créer ici une variable mirroir.</span>
<span id="cb92-447"><a href="#cb92-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-450"><a href="#cb92-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-451"><a href="#cb92-451" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>T <span class="ot">=</span> trans<span class="sc">$</span>mois</span>
<span id="cb92-452"><a href="#cb92-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-453"><a href="#cb92-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-456"><a href="#cb92-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-457"><a href="#cb92-457" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">uncount</span>(trans,mois)</span>
<span id="cb92-458"><a href="#cb92-458" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> dt[<span class="fu">order</span>(dt<span class="sc">$</span>id),]</span>
<span id="cb92-459"><a href="#cb92-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-460"><a href="#cb92-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-463"><a href="#cb92-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-464"><a href="#cb92-464" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt,<span class="dv">11</span>) </span>
<span id="cb92-465"><a href="#cb92-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-466"><a href="#cb92-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-467"><a href="#cb92-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-468"><a href="#cb92-468" aria-hidden="true" tabindex="-1"></a>On va générer une variable type compteur pour mesurer la durée à chaque point d'observation. </span>
<span id="cb92-469"><a href="#cb92-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-472"><a href="#cb92-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-473"><a href="#cb92-473" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb92-474"><a href="#cb92-474" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb92-475"><a href="#cb92-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-476"><a href="#cb92-476" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt, <span class="at">n=</span><span class="dv">8</span>)</span>
<span id="cb92-477"><a href="#cb92-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-478"><a href="#cb92-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-479"><a href="#cb92-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-480"><a href="#cb92-480" aria-hidden="true" tabindex="-1"></a>Si un individu est décédé, died=1 est reporté sur toute les lignes (idem qu'avec la variable dynamique). On va modifier la variable tel que *died=0 si t&lt;T$*.</span>
<span id="cb92-481"><a href="#cb92-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-484"><a href="#cb92-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-485"><a href="#cb92-485" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">arrange</span>(dt,id,t)</span>
<span id="cb92-486"><a href="#cb92-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-487"><a href="#cb92-487" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>died[dt<span class="sc">$</span>t<span class="sc">&lt;</span>dt<span class="sc">$</span>T]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb92-488"><a href="#cb92-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-489"><a href="#cb92-489" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt, <span class="at">n=</span><span class="dv">8</span>)</span>
<span id="cb92-490"><a href="#cb92-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-491"><a href="#cb92-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-492"><a href="#cb92-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### **$f(t)$ quantitative**</span></span>
<span id="cb92-493"><a href="#cb92-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-494"><a href="#cb92-494" aria-hidden="true" tabindex="-1"></a>Avec un effet quadratique d'ordre 3 ^[Attention ici cela marche bien. Bien vérifier qu'il n'y a pas un problème d'overfitting, comme c'est le cas dans le TP. </span>
<span id="cb92-495"><a href="#cb92-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-496"><a href="#cb92-496" aria-hidden="true" tabindex="-1"></a>On centre également les variables *year* et *age* sur leur valeur moyenne pour donner un sens à la constante </span>
<span id="cb92-497"><a href="#cb92-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-498"><a href="#cb92-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-501"><a href="#cb92-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-502"><a href="#cb92-502" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t2<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb92-503"><a href="#cb92-503" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t3<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb92-504"><a href="#cb92-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-505"><a href="#cb92-505" aria-hidden="true" tabindex="-1"></a>my <span class="ot">=</span> <span class="fu">mean</span>(dt<span class="sc">$</span>year)</span>
<span id="cb92-506"><a href="#cb92-506" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>yearb <span class="ot">=</span> dt<span class="sc">$</span>year <span class="sc">-</span> my</span>
<span id="cb92-507"><a href="#cb92-507" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">=</span> <span class="fu">mean</span>(dt<span class="sc">$</span>age)</span>
<span id="cb92-508"><a href="#cb92-508" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ageb <span class="ot">=</span> dt<span class="sc">$</span>age  <span class="sc">-</span> ma</span>
<span id="cb92-509"><a href="#cb92-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-510"><a href="#cb92-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-511"><a href="#cb92-511" aria-hidden="true" tabindex="-1"></a>dtfit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> t3 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data=</span>dt, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb92-512"><a href="#cb92-512" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(dtfit, <span class="at">confint=</span><span class="cn">TRUE</span>, <span class="at">exp=</span><span class="cn">TRUE</span>)</span>
<span id="cb92-513"><a href="#cb92-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-514"><a href="#cb92-514" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(dtfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb92-515"><a href="#cb92-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-516"><a href="#cb92-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-517"><a href="#cb92-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-518"><a href="#cb92-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-519"><a href="#cb92-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-520"><a href="#cb92-520" aria-hidden="true" tabindex="-1"></a><span class="fu">### **$f(t)$ en indicatrices **</span></span>
<span id="cb92-521"><a href="#cb92-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-522"><a href="#cb92-522" aria-hidden="true" tabindex="-1"></a>On va créer une variable de type dicrète regroupant la variable *t* sur ses quartiles (pour l'exemple seulement, tous types de regroupement est envisageable).  </span>
<span id="cb92-523"><a href="#cb92-523" aria-hidden="true" tabindex="-1"></a>On va utiliser la fonction <span class="in">`quantcut`</span> du package <span class="in">`gtools`</span>.</span>
<span id="cb92-524"><a href="#cb92-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-525"><a href="#cb92-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-528"><a href="#cb92-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-529"><a href="#cb92-529" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ct4 <span class="ot">&lt;-</span> <span class="fu">quantcut</span>(dt<span class="sc">$</span>t)</span>
<span id="cb92-530"><a href="#cb92-530" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt<span class="sc">$</span>ct4) </span>
<span id="cb92-531"><a href="#cb92-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-532"><a href="#cb92-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-533"><a href="#cb92-533" aria-hidden="true" tabindex="-1"></a>On va générer un compteur et un total d'observations sur la strate regroupant *id* et *ct4*.</span>
<span id="cb92-534"><a href="#cb92-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-537"><a href="#cb92-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-538"><a href="#cb92-538" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>n <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>cumsum)</span>
<span id="cb92-539"><a href="#cb92-539" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>N <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>sum)</span>
<span id="cb92-540"><a href="#cb92-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-541"><a href="#cb92-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-542"><a href="#cb92-542" aria-hidden="true" tabindex="-1"></a>On conserve la dernière observation dans la strate.  </span>
<span id="cb92-543"><a href="#cb92-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-546"><a href="#cb92-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-547"><a href="#cb92-547" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">subset</span>(dt, n<span class="sc">==</span>N)</span>
<span id="cb92-548"><a href="#cb92-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-549"><a href="#cb92-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-550"><a href="#cb92-550" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**</span>
<span id="cb92-551"><a href="#cb92-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-554"><a href="#cb92-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-555"><a href="#cb92-555" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> ct4 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data=</span>dt2, <span class="at">family=</span>binomial)</span>
<span id="cb92-556"><a href="#cb92-556" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(fit, <span class="at">confint=</span><span class="cn">TRUE</span>, <span class="at">exp=</span><span class="cn">TRUE</span>)</span>
<span id="cb92-557"><a href="#cb92-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-558"><a href="#cb92-558" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(fit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb92-559"><a href="#cb92-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-560"><a href="#cb92-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-561"><a href="#cb92-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-562"><a href="#cb92-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-563"><a href="#cb92-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-564"><a href="#cb92-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-565"><a href="#cb92-565" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modèles paramétriques usuels</span></span>
<span id="cb92-566"><a href="#cb92-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-567"><a href="#cb92-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-568"><a href="#cb92-568" aria-hidden="true" tabindex="-1"></a>Pour le modèle de **Weibull** par exemple.</span>
<span id="cb92-569"><a href="#cb92-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-570"><a href="#cb92-570" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>De type **AFT** </span>
<span id="cb92-571"><a href="#cb92-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-572"><a href="#cb92-572" aria-hidden="true" tabindex="-1"></a>On utilise la fonction <span class="in">`survreg`</span> du package **`survival`**</span>
<span id="cb92-573"><a href="#cb92-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-574"><a href="#cb92-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb92-575"><a href="#cb92-575" aria-hidden="true" tabindex="-1"></a>weibull <span class="ot">=</span> <span class="fu">survreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibull"</span>)</span>
<span id="cb92-576"><a href="#cb92-576" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weibull)</span>
<span id="cb92-577"><a href="#cb92-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-578"><a href="#cb92-578" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(weibull, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">estimate_fun =</span> purrr<span class="sc">::</span><span class="fu">partial</span>(style_ratio, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb92-579"><a href="#cb92-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-580"><a href="#cb92-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-581"><a href="#cb92-581" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>De type **PH**  </span>
<span id="cb92-582"><a href="#cb92-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-583"><a href="#cb92-583" aria-hidden="true" tabindex="-1"></a>La paramétrisation PH n'est pas possible avec la fonction <span class="in">`survreg`</span>.   Il faut utiliser le package **`flexsurv`**, qui permet également d'estimer les modèles paramétriques disponibles avec <span class="in">`survival`</span>. La syntaxe est quasiment identique.  </span>
<span id="cb92-584"><a href="#cb92-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-585"><a href="#cb92-585" aria-hidden="true" tabindex="-1"></a>Pour estimer le modèle de Weibull de type PH, on utilise en option l'agument <span class="in">`dist="weibullPH`</span>.  </span>
<span id="cb92-586"><a href="#cb92-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-589"><a href="#cb92-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-590"><a href="#cb92-590" aria-hidden="true" tabindex="-1"></a>weibullph <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibullPH"</span>)</span>
<span id="cb92-591"><a href="#cb92-591" aria-hidden="true" tabindex="-1"></a>weibullph</span>
<span id="cb92-592"><a href="#cb92-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-593"><a href="#cb92-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-594"><a href="#cb92-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-595"><a href="#cb92-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-596"><a href="#cb92-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## Risques concurrents</span></span>
<span id="cb92-597"><a href="#cb92-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-598"><a href="#cb92-598" aria-hidden="true" tabindex="-1"></a>Le package <span class="in">`cmprsk`</span> pour l'analyse non paramétrique et le modèle de Fine-Gray (non traité).  </span>
<span id="cb92-599"><a href="#cb92-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-600"><a href="#cb92-600" aria-hidden="true" tabindex="-1"></a>Package cmprsk pour l’analyse non paramétrique et le modèle de Fine-Gray.</span>
<span id="cb92-601"><a href="#cb92-601" aria-hidden="true" tabindex="-1"></a>La variable de censure/évènement, *compet*, correspond à la variable died avec une modalité supplémentaire simulée. On suppose l’existence d’une cause supplémentaire au décès autre qu’une malformation cardiaque et non strictement indépendante de cell-ci.</span>
<span id="cb92-602"><a href="#cb92-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-603"><a href="#cb92-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-604"><a href="#cb92-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=F}</span></span>
<span id="cb92-605"><a href="#cb92-605" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb92-606"><a href="#cb92-606" aria-hidden="true" tabindex="-1"></a><span class="co"># variable compet</span></span>
<span id="cb92-607"><a href="#cb92-607" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>compet) </span>
<span id="cb92-608"><a href="#cb92-608" aria-hidden="true" tabindex="-1"></a><span class="co"># variable died</span></span>
<span id="cb92-609"><a href="#cb92-609" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>died) </span>
<span id="cb92-610"><a href="#cb92-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-611"><a href="#cb92-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-612"><a href="#cb92-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-613"><a href="#cb92-613" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Incidences cumulées</span></span>
<span id="cb92-614"><a href="#cb92-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-615"><a href="#cb92-615" aria-hidden="true" tabindex="-1"></a>On utilise la fonction <span class="in">`cuminc`</span> du package **`cmprsk`**.  </span>
<span id="cb92-616"><a href="#cb92-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-617"><a href="#cb92-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-618"><a href="#cb92-618" aria-hidden="true" tabindex="-1"></a>*Pas de comparaison de groupes*</span>
<span id="cb92-619"><a href="#cb92-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-622"><a href="#cb92-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-623"><a href="#cb92-623" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet)</span>
<span id="cb92-624"><a href="#cb92-624" aria-hidden="true" tabindex="-1"></a>ic </span>
<span id="cb92-625"><a href="#cb92-625" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span>
<span id="cb92-626"><a href="#cb92-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-627"><a href="#cb92-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-628"><a href="#cb92-628" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`survminer`</span></span>
<span id="cb92-629"><a href="#cb92-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-632"><a href="#cb92-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-633"><a href="#cb92-633" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span>
<span id="cb92-634"><a href="#cb92-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-635"><a href="#cb92-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-636"><a href="#cb92-636" aria-hidden="true" tabindex="-1"></a>*Comparaison de groupes*</span>
<span id="cb92-637"><a href="#cb92-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-638"><a href="#cb92-638" aria-hidden="true" tabindex="-1"></a>Le test de Gray est automatiquement exécuté.</span>
<span id="cb92-639"><a href="#cb92-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-640"><a href="#cb92-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE}</span></span>
<span id="cb92-641"><a href="#cb92-641" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, <span class="at">group=</span>compet<span class="sc">$</span>surgery, <span class="at">rho=</span><span class="dv">1</span>)</span>
<span id="cb92-642"><a href="#cb92-642" aria-hidden="true" tabindex="-1"></a>ic </span>
<span id="cb92-643"><a href="#cb92-643" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span>
<span id="cb92-644"><a href="#cb92-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-645"><a href="#cb92-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-646"><a href="#cb92-646" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`survminer`</span>, pour obtenir un seul graphique pour toutes les courbes ajouter l'option **`multiple_panels = F`**</span>
<span id="cb92-647"><a href="#cb92-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-648"><a href="#cb92-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE}</span></span>
<span id="cb92-649"><a href="#cb92-649" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span>
<span id="cb92-650"><a href="#cb92-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-651"><a href="#cb92-651" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic, <span class="at">multiple_panels =</span> F)</span>
<span id="cb92-652"><a href="#cb92-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-653"><a href="#cb92-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-654"><a href="#cb92-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-655"><a href="#cb92-655" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Modèles**</span></span>
<span id="cb92-656"><a href="#cb92-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-657"><a href="#cb92-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-658"><a href="#cb92-658" aria-hidden="true" tabindex="-1"></a>On va utilisé seulement le modèle multinomial à durée discrète, le modèle *fine-gray* pendant du modèle de Cox pour les risques concurrents étant fortement critiqué. Si une analyse de type *cause-specific* est envisageable (issues concurrentes traitées comme des censures à droites) on utilise simplement la fonction <span class="in">`coxph`</span> de <span class="in">`survival`</span>.</span>
<span id="cb92-659"><a href="#cb92-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-660"><a href="#cb92-660" aria-hidden="true" tabindex="-1"></a>On va de nouveau utiliser la variable mois (durée discrète).  Le modèle sera estimé à l'aide la fonction **`multinom`** du très vieillissant package <span class="in">`nnet`</span>, les p-values doivent-être programmées, l'output ne donnant que les erreurs-types.  </span>
<span id="cb92-661"><a href="#cb92-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-662"><a href="#cb92-662" aria-hidden="true" tabindex="-1"></a>*Mise en formae de la base*  </span>
<span id="cb92-663"><a href="#cb92-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-664"><a href="#cb92-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE}</span></span>
<span id="cb92-665"><a href="#cb92-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-666"><a href="#cb92-666" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb92-667"><a href="#cb92-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-668"><a href="#cb92-668" aria-hidden="true" tabindex="-1"></a>compet<span class="sc">$</span>T <span class="ot">=</span> compet<span class="sc">$</span>mois</span>
<span id="cb92-669"><a href="#cb92-669" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">uncount</span>(compet, mois)</span>
<span id="cb92-670"><a href="#cb92-670" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">arrange</span>(td, id)</span>
<span id="cb92-671"><a href="#cb92-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-672"><a href="#cb92-672" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb92-673"><a href="#cb92-673" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(td<span class="sc">$</span>x, td<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb92-674"><a href="#cb92-674" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t2 <span class="ot">=</span> td<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb92-675"><a href="#cb92-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-676"><a href="#cb92-676" aria-hidden="true" tabindex="-1"></a>my <span class="ot">=</span> <span class="fu">mean</span>(td<span class="sc">$</span>year)</span>
<span id="cb92-677"><a href="#cb92-677" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>yearb <span class="ot">=</span> td<span class="sc">$</span>year <span class="sc">-</span> my</span>
<span id="cb92-678"><a href="#cb92-678" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">=</span> <span class="fu">mean</span>(td<span class="sc">$</span>age)</span>
<span id="cb92-679"><a href="#cb92-679" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>ageb <span class="ot">=</span> td<span class="sc">$</span>age  <span class="sc">-</span> ma</span>
<span id="cb92-680"><a href="#cb92-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-681"><a href="#cb92-681" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(td<span class="sc">$</span>t<span class="sc">&lt;</span>td<span class="sc">$</span>T,<span class="dv">0</span>, td<span class="sc">$</span>compet)</span>
<span id="cb92-682"><a href="#cb92-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-683"><a href="#cb92-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-684"><a href="#cb92-684" aria-hidden="true" tabindex="-1"></a>*Estimation*</span>
<span id="cb92-685"><a href="#cb92-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-686"><a href="#cb92-686" aria-hidden="true" tabindex="-1"></a>Pour estimer le modèle, on utilise la fonction **`mlogit`**. Les p-values seront calculées à partir d'un test bilatéral (statistique z). </span>
<span id="cb92-687"><a href="#cb92-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-688"><a href="#cb92-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb92-689"><a href="#cb92-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-690"><a href="#cb92-690" aria-hidden="true" tabindex="-1"></a>competfit <span class="ot">=</span> <span class="fu">multinom</span>(<span class="at">formula =</span> e <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> yearb <span class="sc">+</span> ageb <span class="sc">+</span> surgery, <span class="at">data =</span> td)</span>
<span id="cb92-691"><a href="#cb92-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-692"><a href="#cb92-692" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_regression</span>(competfit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,)</span>
<span id="cb92-693"><a href="#cb92-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-694"><a href="#cb92-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-695"><a href="#cb92-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-696"><a href="#cb92-696" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","loop":true,"selector":".lightbox","closeEffect":"zoom","openEffect":"zoom"});</script>



</body></html>