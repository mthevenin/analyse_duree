<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction à l’analyse biographique des durées - 11&nbsp; Eléments de mise en forme des données</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-concurrent.html" rel="next">
<link href="./09-tvc.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-manipulation.html">Compléments</a></li><li class="breadcrumb-item"><a href="./10-manipulation.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">**Eléments de mise en forme des données**</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction à l’analyse biographique des durées</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mthevenin/analyse_duree" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./introduction_bio_durees.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><strong>Présentation - Bibliographie - Outils</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><strong>L’analyse biographique des durées</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Données et théorie</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><strong>Les Données</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theorie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><strong>La théorie</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Méthodes non paramétrique</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-fsurvie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Estimations des fonctions de survie</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-fsurvie_comp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><strong>Tests de comparaison</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Modèles à risques proportionnels</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-intro_mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>Introduction</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-cox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><strong>Le modèle de Cox</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-discret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><strong>Modèle à durée discrète</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-tvc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><strong>Variables dynamiques</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Compléments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-manipulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><strong>Eléments de mise en forme des données</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-concurrent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><strong>Risques concurrents</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-parametrique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><strong>Modèles paramétriques</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-annexe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><strong>Annexes</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Programmation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><strong>R</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Stata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title"><strong>Stata</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-Sas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><strong>SAS</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title"><strong>Python</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#calcul-des-variables-danalyses" id="toc-calcul-des-variables-danalyses" class="nav-link active" data-scroll-target="#calcul-des-variables-danalyses"><span class="header-section-number">11.1</span> Calcul des variables d’analyses</a></li>
  <li><a href="#appariement-de-modules-biographiques" id="toc-appariement-de-modules-biographiques" class="nav-link" data-scroll-target="#appariement-de-modules-biographiques"><span class="header-section-number">11.2</span> Appariement de modules biographiques</a>
  <ul class="collapse">
  <li><a href="#mise-en-forme-dune-base" id="toc-mise-en-forme-dune-base" class="nav-link" data-scroll-target="#mise-en-forme-dune-base"><span class="header-section-number">11.2.1</span> Mise en forme d’une base</a></li>
  <li><a href="#fusion-des-informations-biographiques" id="toc-fusion-des-informations-biographiques" class="nav-link" data-scroll-target="#fusion-des-informations-biographiques"><span class="header-section-number">11.2.2</span> Fusion des informations biographiques</a></li>
  </ul></li>
  <li><a href="#sélection-dun-type-de-séquence-et-mise-en-forme-pour-lanalyse" id="toc-sélection-dun-type-de-séquence-et-mise-en-forme-pour-lanalyse" class="nav-link" data-scroll-target="#sélection-dun-type-de-séquence-et-mise-en-forme-pour-lanalyse"><span class="header-section-number">11.3</span> Sélection d’un type de séquence et mise en forme pour l’analyse</a></li>
  <li><a href="#durée-jusquà-la-première-séquence" id="toc-durée-jusquà-la-première-séquence" class="nav-link" data-scroll-target="#durée-jusquà-la-première-séquence"><span class="header-section-number">11.4</span> Durée jusqu’à la première séquence</a></li>
  <li><a href="#durée-de-séjour-dans-la-séquence-dintérêt-et-variables-danalyse" id="toc-durée-de-séjour-dans-la-séquence-dintérêt-et-variables-danalyse" class="nav-link" data-scroll-target="#durée-de-séjour-dans-la-séquence-dintérêt-et-variables-danalyse"><span class="header-section-number">11.5</span> Durée de séjour dans la séquence d’intérêt et variables d’analyse</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mthevenin/analyse_duree/edit/main/10-manipulation.qmd" class="toc-action">Modifier cette page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><strong>Eléments de mise en forme des données</strong></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Montrer tout le code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Cacher tout le code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Voir les sources</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Ce qui suit est un premier jet réalisé en 2023, encore très perfectible, mais j’avais bien conscience depuis très longtemps que l’absence d’une partie dédiée aux manipulations des données biographiques était problématique. Ce qui suit ne peut pas couvrir toutes les problématiques que l’on peut rencontrer lorsqu’on met en forme ce type de données: le format de mise à disposition, l’extraction de l’information pertinente correspondant à la question analysée, voire le logiciel utilisé, rend quasiment impossible la production d’un guide clé en main.</p>
<p><strong>Quelques conseils</strong></p>
<ul>
<li>Comme l’analyse des durées/survie consiste à extraire une (ou plusieurs) séquence(s) bien identifier les situations types que l’on sera conduit à rencontrer et à traiter. Ici il peut être intéressant, de manière exploratoire, à conduire une analyse de séquences au préalable.</li>
<li>Vérifier à chaque étape de la programmation la validité ou la cohérence des informations contenues dans les variables créées et/ou de la mise en forme.</li>
</ul>
<p><strong>Le format des données utilisé dans cette section</strong></p>
<ul>
<li>Il est identique à celui utilisé dans l’enquête MAFE [<a href="https://mafeproject.site.ined.fr/fr/">lien</a>]<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> , donc de type individus-séquences avec un marquage des informations temporelles de type <em>année</em>.</li>
<li>Sur chaque séquence l’année de début et l’année de fin sont indiquée.</li>
<li>Les trajectoires peuvent être continues ou non. Si elle ne sont pas continues, un exemple montre comment récupérer les séquences en “creux”.</li>
</ul>
<p><strong>Programmation</strong></p>
<ul>
<li>Cette section n’est pas centrée sur la méthode de programmation, mais plutôt sur les questions que l’on doit se poser et leur résolution.</li>
<li>Comme la formation est appliquée en R, j’ai néanmoins donné les codes que j’ai utilisé.
<ul>
<li>Les codes R sont ici largement hérité d’une programmation Stata que je maîtrise encore bien mieux.</li>
<li>On pourrait aller <em>plus vite</em>, en s’y prenant différement, mais j’applique une programmation que j’assume prudente et en evitant les méthodes reposant sur des splits de bases.</li>
<li>Le type de programmation applique assez massivement l’utilisation de compteurs ou de double compteurs, et si nécessaire l’utilisation de variables décalée de type <em>lead</em> ou <em>lag</em>.</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Les support <strong>assistoolsms</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le service SMS de l’Ined a mis en place récemment un support de programmation dédié principalement à R [<a href="https://mthevenin.github.io/assistoolsms/">Lien</a>]. Ce support est construit sur l’idée d’une liste de fiches thématiques qui trouvent leur origine, mais pas que, dans des demandes d’assistances de programmation de la part de chercheur.e.s, (post)doctorant.e.s ou stagiaires. Bien que cela ne soit pas pour tout de suite, il est prévu d’alimenter ce support sur la question des manipulations des données biographiques avec: d’autres exemples, des alternatives aux codes proposés plus loin, ou l’application des exemples traités ici mais avec un format de mise à disposition des données différents.</p>
<p>… Tout ceci, au mieux pour l’été prochain.</p>
</div>
</div>
<p>Packages utilisés:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="calcul-des-variables-danalyses" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="calcul-des-variables-danalyses"><span class="header-section-number">11.1</span> Calcul des variables d’analyses</h2>
<p>Construction de la base:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On supposera que l’année de collecte, pour toutes les observations, est <strong>2025</strong> <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Si cela n’est pas donné dans le module biographique, il peut être intéressant de construire les numéros de séquences des trajectoires.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Exemple 1 : durée de séjour de la première séquence observée</strong></p>
<p>Supposons que x traduit un type de relation/union, par exemple x=1 est une relation non cohabitante et x=2 est une relation cohabitante. On s’intéresse à la durée de la première relation, sans distinction entre 1 et 2. Il suffit de séléctionner la première séquence.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nseq<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La variable de fin va permettre de repérer les informations censurées, et de générer la variable d’évènement. A ce niveau il est donc important de ne pas encore remplacer la date de censure par sa valeur.</p>
<ul>
<li>Si <em>fin</em> est une valeur manquante: observation censurée.</li>
<li>Si <em>fin</em> est une valeur renseignée: occurence de l’évènement.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>fin), <span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour la variable de durée <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, une repéré les observations censurées, elle est calculée directement avec les variables <em>fin</em> et <em>deb</em>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2025</span> <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Exemple 2 : changement de métrique temporelle</strong></p>
<p>Toujours avec le même exemple, mais en ajoutant une observation, supposons que l’on dispose également de l’information sur les mois. Sur les mois où l’évènement à eu lieu, mais également sur les mois où l’enquête a été réalisée.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb  =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>, <span class="dv">2021</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">debm =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">9</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin  =</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>,<span class="dv">2021</span>), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">finm =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">12</span>,<span class="cn">NA</span>,<span class="dv">11</span>), </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">enq  =</span> <span class="fu">c</span>(<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">enqm =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">debm</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">finm</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">enq</th>
<th style="text-align: right;">enqm</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On remarque que la nouvelle observation (id=3) a connu l’évènement, ici la fin de la relation, la même année qu’au début d’exposition (le début de la relation)…. mais au bout de 2,6,11 mois???? Commeon dispose de l’information sur les mois de début et de fin cela peut être intéressant de l’exploite. De la même manière si l’enquête a été réalisée la même année, les entretiens n’ont pas eu lieu le même mois. On aura besoin de cette information pour les observations censurées.</p>
<p>De nouveau on sélectionne la première séquence, et pour la lisibilité de la base on retire les informations qui ne seront pas ou plus exploitées (<em>nseq</em>, <em>x</em>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2,nseq<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(x,nseq))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">debm</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">finm</th>
<th style="text-align: right;">enq</th>
<th style="text-align: right;">enqm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On génère la variable censure/évènement (toujours à faire avant la variable de durée) de la même manière que pour l’exemple 1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df2<span class="sc">$</span>fin), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">debm</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">finm</th>
<th style="text-align: right;">enq</th>
<th style="text-align: right;">enqm</th>
<th style="text-align: right;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour la variable de durée, le principe est de multiplié par 12 la différence entre l’année de fin et l’année de début et d’ajouter la différence entre le mois de fin et le mois de début.<br>
Pour les observations censurées, ici l’année de fin est identique mais les mois varient. En terme de programmation, surtout si avec R on utilise <code>ifelse</code>, il est préférable d’y aller doucement en créant une durée pour les observations qui ont connu l’évènement et une durée pour les observations censurées. Puis de regrouper les deux cas. C’est ce qui est fait dans le code qui suit.</p>
<p>Durée selon les valeurs de <em>e</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur1 <span class="ot">=</span> <span class="fu">ifelse</span>(df2<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, <span class="dv">12</span><span class="sc">*</span>(df2<span class="sc">$</span>fin <span class="sc">-</span> df2<span class="sc">$</span>deb) <span class="sc">+</span> (df2<span class="sc">$</span>finm <span class="sc">-</span> df2<span class="sc">$</span>debm),  <span class="dv">0</span>) </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur0 <span class="ot">=</span> <span class="fu">ifelse</span>(df2<span class="sc">$</span>e<span class="sc">==</span><span class="dv">0</span>, <span class="dv">12</span><span class="sc">*</span>(<span class="dv">2025</span> <span class="sc">-</span> df2<span class="sc">$</span>deb)    <span class="sc">+</span> (df2<span class="sc">$</span>enqm  <span class="sc">-</span> df2<span class="sc">$</span>debm), <span class="dv">0</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">debm</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">finm</th>
<th style="text-align: right;">enq</th>
<th style="text-align: right;">enqm</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur1</th>
<th style="text-align: right;">dur0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On regroupe par simple sommation (le <em>else</em> étant 0).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur  <span class="ot">=</span> df2<span class="sc">$</span>dur1 <span class="sc">+</span> df2<span class="sc">$</span>dur0</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(dur1,dur0))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">debm</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">finm</th>
<th style="text-align: right;">enq</th>
<th style="text-align: right;">enqm</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On dispose ainsi des éléments nécessaire pour faire une analyse de durée avec une métrique mensuelle <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<p><strong>Exemple 3 : importation d’un début d’expositon externe</strong></p>
<p>On repart de la première base</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On suppose maintenant que x traduit des situations sur le marché du travail. Par exemple <strong>x=1</strong> est un emploi en CDD et <strong>x=2</strong> un emploi en CDI. On s’intéresse à la durée entre la fin des études et le premier emploi, quel que soit sont type.</p>
<ul>
<li>On ne dispose pas ici de toutes l’information pour calculer la durée, soit la fin des études. Elle peut être donnée dans une base classique regroupant l’ensemble des caractéristiques individuelles de type fixe (année de naissance, sexe…).</li>
<li>Comme on s’intéresse à la durée de recherche du premier emploi, dans le module biographique la date de début va devenir la date de fin.</li>
<li>Pour les observations présente dans la base biographique, il n’y a pas de censure à droite. Mais si on regarde le fichier des caractéristiques générales, fixe:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>etude <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">fin_etude =</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>,<span class="dv">2023</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(etude)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">fin_etude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Une nouvelle observation (id=3) apparaît. Au moment de l’enquête, elle n’a pas (<strong>encore</strong>) trouvé un emploi depuis la fin de ces études. On a donc une observation qui sera censurée.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Certaines bases biographiques peuvent être structurées avec des trajectoires strictement continue, l’année (l’âge) de fin étant l’année (l’âge) de début de la trajectoire suivante. Dans ce cas, l’information serait immédiatement disponible, avec la présence d’un nombre de séquences plus important dans la base.</p>
</div>
</div>
<p>On va devoir:</p>
<ul>
<li>Sélectionner la première sequence d’emploi dans la base df (variable <em>nseq</em>).</li>
<li>La fusionner avec la base étude.</li>
</ul>
<p>Avant la fusion, on peut conserver seulement les informations nécessaires (id, deb). La variable <em>deb</em> va changer également de statut en devenant l’année de <em>fin</em> de la période de recherche d’emploi.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nseq<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(fin,x,nseq))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">rename</span>(df, <span class="at">fin =</span> deb)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">fin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Après la fusion:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">full_join</span>(etude, df,  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'id'</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">rename</span>(df, <span class="at">deb =</span> fin_etude)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On a toutes les informations pour générer la variable censure/évènement et la variable de durée:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>fin),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2025</span> <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="appariement-de-modules-biographiques" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="appariement-de-modules-biographiques"><span class="header-section-number">11.2</span> Appariement de modules biographiques</h2>
<p>On repart de la première base, avec les numéros de séquence.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="mise-en-forme-dune-base" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="mise-en-forme-dune-base"><span class="header-section-number">11.2.1</span> Mise en forme d’une base</h3>
<p>Pour apparier des informations de plusieurs modules biographiques, on doit transformer les bases en format individus-séquences en format individus-périodes (ici individus années).</p>
<ul>
<li><strong>Etape 1</strong>: allongement sur chaque séquence après avoir générées leur durée</li>
<li><strong>Etape 2</strong>: générer une variable de période (année) sur chaque ligne. Elle servira pour l’appariement.</li>
</ul>
<p><strong>Pourquoi ne pas utiliser la simple différence entre la fin et le début ?</strong></p>
<p>Durée (fin - début) et allongement de la base:</p>
<p>On ne génère pas des variables d’analyse, on aurait besoin de l’information sur l’année de l’enquête pour les informations censurées.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Allongement de la base:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> df</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>dur1 <span class="ot">=</span> df1<span class="sc">$</span>fin <span class="sc">-</span> df1<span class="sc">$</span>deb</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>dur1b <span class="ot">=</span> df1<span class="sc">$</span>dur1 <span class="co"># uncount supprime la variable d'origine </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> <span class="fu">uncount</span>(df1,dur1b)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">dur1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour générer la variable période (année), on a besoin d’un compteur qui sera associé à la variable <em>deb</em>. On doit bien contrôler l’opération par identifiant et numéro de séquence.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> df1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c)) </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">dur1</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Problème</strong>: les années de début ne sont pas correncte: 2021 au lieu de 2020 pour la première séquence de id=1 par exemple.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>On doit donc impérativement augmenter la différence entre la fin et le début par +1 pour que l’ensemble des périodes (années) soit couvertes.</p>
</div>
</div>
<p>On reprend donc les opérations précédentes mais avec <strong>durée = fin - debut + 1</strong></p>
<ul>
<li>Allongement de la base avec durée augmentée</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur2 <span class="ot">=</span> df2<span class="sc">$</span>fin <span class="sc">-</span> df2<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur2b <span class="ot">=</span> df2<span class="sc">$</span>dur2 <span class="co"># uncount supprime la variable d'origine </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">uncount</span>(df2,dur2b)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">dur2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Création de la variable <em>year</em>: <strong>sur chaque individus-séquences, la somme entre le compteur et l’année de début doit être réduite de 11</strong>.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(deb,fin,dur2))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Les années sont toutes couvertes….mais un peu trop. En effet, lorsque les trajectoires sont continues soit lorsque l’année de fin d’une séquence est identique à l’année de début de la suivante, les années vont être doublonnées. On doit dont supprimer ce doublon.</p>
<ul>
<li>Suppression des doublons des trajectoires continues.</li>
</ul>
<p>De nouveaux on doit faire un choix, soit on priviligie l’année de fin, soit on privilégie l’année de début. Les applications ont des fonctions qui permettent de supprimer les doublons<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. On peut le faire manuellement en regardant pour chaque personnes-années le nombre de doublon. Cela se fait facilement à l’aide d’un compteur, ici la variable <em>nyear</em>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nyear =</span> <span class="fu">cumsum</span>(c))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">nyear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Si on souhaite garder l’année de fin on filtre les observations en conservant celles dont nyear=1. Si on souhaite privilégier les années de début on foltre les observations en conservant celles dont nyear=2. Si on souhaite conserver les années de fin de séquence:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2, nyear<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(nseq,c,nyear))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
En résumé
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>A la date (année/âge) de censure remplacer la valeur manquante par sa valeur. Si ultérieurement on a besoin de garder l’information sur la censure - valeur manquante - , on peut générer une variable mirroir de <em>fin</em>.</li>
<li>Sur chaque séquence calculer la durée avec une augmentation de +1.</li>
<li>Créer une variable période (année) sur chaque ligne. Elle servira à définir la clé d’appariement.</li>
<li>Supprimer les doublons sur les transition continue <span class="math inline">\(fin_t = debut_{t+1}\)</span>.</li>
</ul>
</div>
</div>
</section>
<section id="fusion-des-informations-biographiques" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="fusion-des-informations-biographiques"><span class="header-section-number">11.2.2</span> Fusion des informations biographiques</h3>
<section id="fusion-avec-lensemble-des-périodes-observables" class="level4" data-number="11.2.2.1">
<h4 data-number="11.2.2.1" class="anchored" data-anchor-id="fusion-avec-lensemble-des-périodes-observables"><span class="header-section-number">11.2.2.1</span> Fusion avec l’ensemble des périodes observables</h4>
<p>Pour commencer par un exemple plutôt simple, on note que pour id=1 l’année 2022 n’est pas renseignée (trajectoire non continue). Si on reprend un exemple précédent (relations de couple), cette année pourrait être identifiée comme une période sans relation. Une façon simple de boucher ce type “trous”, est d’utiliser les années de naissances des individus, et de créer une base individus-périodes qui couvre toutes les années de vie de l’individu jusqu’à l’enquête. On remontera jusque là, mais on va par exemple considérer que pour id=1 et id=2 ce <em>début de tout</em> est en 2018.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">t0  =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2018</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dftout)    </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">t0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>On ajoute l’information sur l’année de l’enquête (2025).</li>
<li>On génère la durée</li>
<li>On allonge la base</li>
<li>On génère la variable année sur chaque ligne (on contrôle seulement sur <em>id</em>)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>tmax <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>dur  <span class="ot">=</span> dftout<span class="sc">$</span>tmax <span class="sc">-</span> dftout<span class="sc">$</span>t0 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">uncount</span>(dftout,dur)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> dftout <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> t0  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">select</span>(dftout, <span class="sc">-</span><span class="fu">c</span>(t0,tmax,c))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dftout)    </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On peut maintenant apparier cette couverture de toutes les années de vie jusqu’à l’enquête à la base biographique:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">full_join</span>(df2, dftout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>,<span class="st">"year"</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">arrange</span>(df2, id, year)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour supprimer les informations qui précèdent la première séquence de la biographie, on peut générer un compteur sur la variable x après avoir remplacer ses valeurs manquantes par des 0. On gardera les lignes pour lesquels ce compteur est supérieur à 1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>x[<span class="fu">is.na</span>(df2<span class="sc">$</span>x)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nx =</span> <span class="fu">cumsum</span>(x))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">nx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On supprime les lignes lorsque nx=0.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2, nx<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(nx))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fusion-avec-une-autre-base-biographique" class="level4" data-number="11.2.2.2">
<h4 data-number="11.2.2.2" class="anchored" data-anchor-id="fusion-avec-une-autre-base-biographique"><span class="header-section-number">11.2.2.2</span> Fusion avec une autre base biographique</h4>
<p>On peut être amené à fusionner plusieurs modules biographique. Jusqu’à présent, une même année, tous les individus ne pouvaient être que dans une situation, par exemple une seul emploi, un seul lieu de résidence etc… Pour certains phénomènes, une même années ou pendant une période plus longue on peut observer simultanément plusieurs états différent, ou plus classiquement observer une somme d’un même état. On parle ici d’<strong><em>overlapping</em></strong>. Ce type de situation est typiquement celle qu’on observe avec le nombre d’enfants.</p>
<p>Supposons que le base ci-dessous traduit la naissance et potentiellement le décès des enfants.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2019</span>, <span class="dv">2023</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2024</span>,<span class="cn">NA</span>), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nseq =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>id=1 a un premier enfant en 2022 qui est toujours en vie au moment de l’enquête (2025)</li>
<li>id=2:
<ul>
<li>A un premier enfant en 2019 qui décède en 2024</li>
<li>A un second enfant en 2023, toujours en vie au moment de l’enquête</li>
<li>De la naissance du second enfant au décès du premier, on va donc avoir des doublons (overlapping) sur les années</li>
</ul></li>
</ul>
<p>Si on reprend les manipulations précédentes jusqu’à la création de la variable <em>year</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>fin[<span class="fu">is.na</span>(dfy<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>dur <span class="ot">=</span> dfy<span class="sc">$</span>fin <span class="sc">-</span> dfy<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>durb <span class="ot">=</span> dfy<span class="sc">$</span>dur  <span class="co"># Uncount supprime la variable d'origine </span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">uncount</span>(dfy,durb)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La variable <em>year</em> est bien renseignée 2 fois pour les années 2023 et 2024.</p>
<p>On peut s’intéresser au fait d’avoir ou non un enfant, ou de manière plus générale au nombre d’enfant. En créant cette information, on se donne également le moyen de corriger cet overlapping:</p>
<ul>
<li>On peut de nouveau générer un compteur contrôlé par individu année</li>
<li>En génerant un total de ligne doublonnée, on récupèrera par exemple ici le nombre d’enfant en vie chaque année.</li>
<li>En ne gardant que la ligne ou le compteur est égal à 1, on supprime les doublons tout en gardant l’information sur le nombre d’enfant en vie une année donnée.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ny =</span> <span class="fu">cumsum</span>(c))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tot_y =</span>  <span class="fu">sum</span>(c))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">dur</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">ny</th>
<th style="text-align: right;">tot_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Il ne reste plus qu’à supprimer les lignes où <em>ny&gt;1</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">filter</span>(dfy, ny<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">select</span>(dfy, <span class="sc">-</span><span class="fu">c</span>(ny,deb, fin, dur, nseq, c))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">tot_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Avec une ligne par année, on peut la fusionner avec une autre base biographique en format individus-années (même principe qu’avec la fusion avec la base sur toutes les années de vie).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">full_join</span>(dfy, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>,<span class="st">"year"</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">arrange</span>(df2y, id,year)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">select</span>(df2y, <span class="fu">c</span>(id,year,x,tot_y))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>df2y<span class="sc">$</span>tot_y[<span class="fu">is.na</span>(df2y<span class="sc">$</span>tot_y)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>df2y<span class="sc">$</span>x[<span class="fu">is.na</span>(df2y<span class="sc">$</span>x)]   <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2y)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">tot_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="sélection-dun-type-de-séquence-et-mise-en-forme-pour-lanalyse" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="sélection-dun-type-de-séquence-et-mise-en-forme-pour-lanalyse"><span class="header-section-number">11.3</span> Sélection d’un type de séquence et mise en forme pour l’analyse</h2>
</section>
<section id="durée-jusquà-la-première-séquence" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="durée-jusquà-la-première-séquence"><span class="header-section-number">11.4</span> Durée jusqu’à la première séquence</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span>  <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>, <span class="dv">2024</span>, <span class="dv">2019</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2023</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>, <span class="dv">2024</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y  =</span>   <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nseq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On va s’intéresser à la durée jusqu’à l’occurence de la séquence de type 2 ou 3 (variable <em>y</em>). On considéra que le début de l’exposition est donné par la variable <em>deb</em> sur la première séquence.</p>
<ul>
<li>id=1: début de l’exposition/observation en 2018, observe l’évènement en 2022.</li>
<li>id=2: début de l’exposition/observation en 2019, observe l’évènement la même année.</li>
<li>id=3: début de l’exposition/observation en 2019, observe l’évènement la même année.</li>
<li>id=4: début de l’exposition/observation en 2023, n’a pas connu l’évènement au moment de l’enquête.</li>
</ul>
<p><strong>Recupération de l’année de l’évènement</strong></p>
<p>On peut repérer la présence d’une des deux séquences d’intérêt avec une indicatrice.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>De nouveau l’utilisation d’un compteur sur cette variable indicatrice, peut s’avérer utile pour repérer le moment de l’occurence.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n  =</span> <span class="fu">cumsum</span>(e)) </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour id=(2,3,4), ce compteur permet d’obtenir l’information souhaitée, à savoir n=0 en situation d’attente/séjour/survie et n=1 l’année de l’évènement. Pour id=1 cependant, l’alternance en y=1 et y=(2,3) ne permet pas de récupérer l’année d’occurence (première fois en 2 ou 3). Cela peut être fait, en faisant un compteur sur le compteur précédent:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nn  =</span> <span class="fu">cumsum</span>(n)) </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Récupération des information censurée</strong></p>
<p>Pour récupérer l’information sur les observations qui seront censurée, on peut faire un total sur la variable <em>n</em> ou <em>e</em>: si n=0, l’individu n’aura pas connu l’évènement.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">N  =</span> <span class="fu">sum</span>(n)) </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nn</th>
<th style="text-align: right;">N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour id=4, N est bien égal à 0.</p>
<p><strong>Récupération du début de l’exposition</strong></p>
<p>Le début de l’exposition étant ici l’année de début de la première séquence. On peut facilement récupérer cette sur toute les lignes en la repérant (ici en générant une nouvelle variable avec la fonction <code>ifelse</code>), et en sommant sa valeur sur les autres lignes (=0).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-38"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-38-1" class="code-annotation-target"><a href="#annotated-cell-38-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span> debexp <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>nseq<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>deb, <span class="dv">0</span>)</span>
<span id="annotated-cell-38-2"><a href="#annotated-cell-38-2" aria-hidden="true" tabindex="-1"></a>                    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-38-3" class="code-annotation-target"><a href="#annotated-cell-38-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">debexp  =</span> <span class="fu">sum</span>(debexp))</span>
<span id="annotated-cell-38-4"><a href="#annotated-cell-38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-5"><a href="#annotated-cell-38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-38" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-annotation="1" data-code-lines="1">La variable <em>debex</em> est égale à <em>deb</em> si <em>nseq=1</em>, 0 sinon.</span>
</dd>
<dt data-target-cell="annotated-cell-38" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-annotation="2" data-code-lines="3">On somme cette valeur sur chaque individu pour l’ajouter aux séquences suivantes.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nn</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">debexp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2023</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Mise en forme finale de la base</strong></p>
<p>On peut maintenant conserver les lignes qui nous intéresse à savoir celle où <em>nn=1</em> (évènement) ou <em>N=0</em> (censure).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nn<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> N<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nn</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">debexp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2019</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2023</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On dispose déjà de la variable d’évènement/censure (<em>e</em> ou <em>n</em> = (0,1), on finit donc par la variable de durée.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>deb <span class="sc">-</span> df<span class="sc">$</span>debexp <span class="sc">+</span> <span class="dv">1</span>, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>debexp <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="fu">c</span>(id,e,dur))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Ces informations sont suffisantes pour estimer une fonction de séjour et on peut ajouter, si elles ne sont pas présentes, des covariables fixes issues du fichier des caractéristiques générales. Pour l’ajout de covariables dynamiques, leur ajout n’est pas forcément difficile pour une analyse en durée discrète <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Pour les analyses type Cox, selon la nature de la variable dynamique, l’opération (quel que soit le logiciel utilisé) risque d’être plus ou moins compliquée.</p>
</section>
<section id="durée-de-séjour-dans-la-séquence-dintérêt-et-variables-danalyse" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="durée-de-séjour-dans-la-séquence-dintérêt-et-variables-danalyse"><span class="header-section-number">11.5</span> Durée de séjour dans la séquence d’intérêt et variables d’analyse</h2>
<p>En première ou deuxième analyse, on peut également voir s’intéresser à la durée de séjour dans l’état précédent. Par exemple, si l’analyse précédent consistait à regarder la durée de séjour dans le premier emploi, on pourrait regarder ensuite la durée jusqu’à sa reprise.</p>
<p>Cela va un peu (voir plus) se compliquer. On va repartir de la base de départ précédente en ajoutant une observation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span>  <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span> , <span class="dv">5</span>),</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>, <span class="dv">2024</span>, <span class="dv">2019</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2023</span>, <span class="dv">2019</span>, <span class="dv">2021</span>, <span class="dv">2023</span>, <span class="dv">2024</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>, <span class="dv">2024</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">2021</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="cn">NA</span>), </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y  =</span>   <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nseq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Filtrage des observations hors champs</strong></p>
<p>On peut déjà supprimer les observations hors champs, à savoir ici id=4 qui n’a pas connu l’évènement dont on analyse la durée.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-42"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-42" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-42-1" class="code-annotation-target"><a href="#annotated-cell-42-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e23 <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="annotated-cell-42-2"><a href="#annotated-cell-42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-42-3"><a href="#annotated-cell-42-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n23  =</span> <span class="fu">cumsum</span>(e23)) </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-42" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-42-4" class="code-annotation-target"><a href="#annotated-cell-42-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, n23<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="annotated-cell-42-5"><a href="#annotated-cell-42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-42-6"><a href="#annotated-cell-42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-42" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-42" data-code-annotation="1" data-code-lines="1">Nom de la variable <em>e23</em> pour repérer la présence de l’évènement dont on analyse la durée.</span>
</dd>
<dt data-target-cell="annotated-cell-42" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-42" data-code-annotation="2" data-code-lines="4">Ce compteur est suffisant car l’observation n’a qu’une ligne.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e23</th>
<th style="text-align: right;">n23</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Récupération de l’évènement analysé</strong></p>
<p>Ici l’évènement sera un <em>retour</em> dans l’état y=1. Il y a de nouveau une possibilité de censure à droite si une observation reste dans l’état 2 ou 3 jusqu’au moment de l’enquête.</p>
<p>Il peut être utile d’utiliser des variables décalées pour repérer les changements d’état d’une séquence à une autre. Ces décalages sont appelées <em>lead</em> ou <em>lag</em>:</p>
<ul>
<li><strong><em>lead</em></strong>: <span class="math inline">\(x_t = x_{t+1}\)</span></li>
<li><strong><em>lag</em></strong>: <span class="math inline">\(x_t = x_{t-1}\)</span></li>
</ul>
<p>On va utilise ici des <strong><em>lead</em></strong> et donc pouvoir repérer les changements d’état d’une séquence à une autre. Comme on s’intéresse au retour à l’état 1:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-43"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-43-1" class="code-annotation-target"><a href="#annotated-cell-43-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="annotated-cell-43-2"><a href="#annotated-cell-43-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-43-3" class="code-annotation-target"><a href="#annotated-cell-43-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diff_e  =</span> e <span class="sc">-</span> <span class="fu">lead</span>(e))</span>
<span id="annotated-cell-43-4"><a href="#annotated-cell-43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-43-5"><a href="#annotated-cell-43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-43" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-annotation="1" data-code-lines="1"><em>e</em> est une indicatrice qui repère l’état 1</span>
</dd>
<dt data-target-cell="annotated-cell-43" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-annotation="2" data-code-lines="3">On fait <em>redescendre</em> la valeur de <em>e</em> sur la séquence précédente, et on calcule la difference.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e23</th>
<th style="text-align: right;">n23</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">diff_e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pour chaque dernière séquence la valeur du lag est une valeur manquante. On repère l’évènement avec une valeur de -1 (transition de 0 à 1). On ne peut pas encore filtrer les informations car il va falloir récupérer la fin de la séquence, mais on peut déjà construire l’information.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>diff_e<span class="sc">==-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e[<span class="fu">is.na</span>(df<span class="sc">$</span>e)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">e  =</span> <span class="fu">sum</span>(e)) </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">nseq</th>
<th style="text-align: right;">e23</th>
<th style="text-align: right;">n23</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">diff_e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Récupération de l’année final avec succesion d’états de même type</strong></p>
<p>La difficulté ici est apportée seulement par id=3. Jusqu’à 2025, on a successivement l’état 2 puis 3. Il va donc falloir récupérer cette dernière année de succession de 2 et 3, jusqu’à la censure ou jusqu’à un retour dans l’état 1. S’il n’y avait pas ce genre de situation, l’utilisation de la variable <em>diff_e</em> aurait été suffisante pour récupérer l’année de fin lorsqu’on a plusieurs séquences (situations pour id=1,5).</p>
<p>On va de nouveau utiliser un lead, mais sur la variable <em>e23</em>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-45"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-45-1" class="code-annotation-target"><a href="#annotated-cell-45-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(nseq, diff_e))</span>
<span id="annotated-cell-45-2"><a href="#annotated-cell-45-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-45-3" class="code-annotation-target"><a href="#annotated-cell-45-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lead_e23 =</span> <span class="fu">lead</span>(e23, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="cn">NA</span>))</span>
<span id="annotated-cell-45-4"><a href="#annotated-cell-45-4" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-45-5" class="code-annotation-target"><a href="#annotated-cell-45-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>idem <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e23 <span class="sc">==</span> df<span class="sc">$</span>lead_e23, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="annotated-cell-45-6"><a href="#annotated-cell-45-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>idem[<span class="fu">is.na</span>(df<span class="sc">$</span>idem)]<span class="ot">=</span><span class="dv">0</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-45-7" class="code-annotation-target"><a href="#annotated-cell-45-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">idem  =</span> <span class="fu">sum</span>(idem))</span>
<span id="annotated-cell-45-8"><a href="#annotated-cell-45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-9"><a href="#annotated-cell-45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-10"><a href="#annotated-cell-45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-45" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-annotation="1" data-code-lines="1">On supprime les colonnes non utilisées pour gagner ici de la lisibilité</span>
</dd>
<dt data-target-cell="annotated-cell-45" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-annotation="2" data-code-lines="3"><em>lead</em> sur la variable e23.</span>
</dd>
<dt data-target-cell="annotated-cell-45" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-annotation="3" data-code-lines="5">La variable <em>idem</em> permet de repérer une suite d’état 2 et 3. On ne passe pas ici par une variable de différence (le faire par prudence si on le souhaite).</span>
</dd>
<dt data-target-cell="annotated-cell-45" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-annotation="4" data-code-lines="7">Ici le total est égal à 1. Si on avait eu une séquence supplémentaire de 3, il serait égal à 2. L’important ici est de repérer la situation, soit 0 ou supérieur à 0.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">y</th>
<th style="text-align: right;">e23</th>
<th style="text-align: right;">n23</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">lead_e23</th>
<th style="text-align: right;">idem</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On doit maintenant récupérer la dernière année de fin des situations où idem&gt;0, et la placer sur la première.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-46"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-46-1" class="code-annotation-target"><a href="#annotated-cell-46-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-46-2" class="code-annotation-target"><a href="#annotated-cell-46-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lead_e23[<span class="fu">is.na</span>(df<span class="sc">$</span>lead_e23)]   <span class="ot">=</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="annotated-cell-46-3"><a href="#annotated-cell-46-3" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-46-4" class="code-annotation-target"><a href="#annotated-cell-46-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>truefin <span class="ot">=</span> <span class="fu">ifelse</span>((df<span class="sc">$</span>lead_e23 <span class="sc">!=</span> df<span class="sc">$</span>e23) <span class="sc">&amp;</span> df<span class="sc">$</span>idem<span class="sc">&gt;</span><span class="dv">0</span>, df<span class="sc">$</span>fin,<span class="dv">0</span>)</span>
<span id="annotated-cell-46-5"><a href="#annotated-cell-46-5" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-46-6" class="code-annotation-target"><a href="#annotated-cell-46-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">truefin =</span> <span class="fu">sum</span>(truefin))</span>
<span id="annotated-cell-46-7"><a href="#annotated-cell-46-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>idem<span class="sc">&gt;</span><span class="dv">0</span>, df<span class="sc">$</span>truefin, df<span class="sc">$</span>fin)</span>
<span id="annotated-cell-46-8"><a href="#annotated-cell-46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-46-9"><a href="#annotated-cell-46-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(y,e23,lead_e23,idem))</span>
<span id="annotated-cell-46-10"><a href="#annotated-cell-46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-46-11"><a href="#annotated-cell-46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-46" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-annotation="1" data-code-lines="1">On remplace l’année de la censure par sa valeur (important pour id=3).</span>
</dd>
<dt data-target-cell="annotated-cell-46" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-annotation="2" data-code-lines="2">Pour régler un problème de gestion des NA avec <code>ifelse</code>. A tester avec <code>if_else</code> ou <code>case_when</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-46" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-annotation="3" data-code-lines="4">On recupère la valeur de l’année de fin lorsqu’il y a une succession d’états de même nature pour l’analyse.</span>
</dd>
<dt data-target-cell="annotated-cell-46" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-annotation="4" data-code-lines="6,7">on remplace la valeur dans la variable <em>fin</em> en cas de succession seulement.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">n23</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">truefin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2025</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On peut [enfin] sélectionner et conserver une seule ligne par individu et générer la variable de durée</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span> <span class="fu">select</span>(df,<span class="sc">-</span>truefin)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nn23     =</span> <span class="fu">cumsum</span>(n23)) </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, n23<span class="sc">==</span>nn23)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur<span class="ot">=</span> df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(n23,nn23))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">deb</th>
<th style="text-align: right;">fin</th>
<th style="text-align: right;">e</th>
<th style="text-align: right;">dur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2021</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>


<!-- -->

</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Des éléments de manipulation/programmation pour un exemple volontairement très compliqué sont donnés dans <strong><em>méthodes</em></strong> =&gt; <strong><em>notes méthodologiques</em></strong>. Ayant été fait en 2015, le code pour R est largement <em>out of date</em><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Ici on a une enquête réalisée une même année pour toute les observations, ce n’est pas toujours le cas. De même au lieu de l’année, si les datations avaient été données par l’âge, au moment de l’enquête l’âge varierait d’une personne à une autre. Ces datations différentes (année ou âge) peuvent être présentes dans chaque module biographique d’une enquête, ou dans le fichier des caractéristiques fixes. Dans ce cas l’information devra être récupérée<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>La mesure est ici discrète/groupée, il me semble toujours préférable d’allonger les durées à +1. On démarre donc toujours un premier janvier pour terminer un 31 décembre sur l’information est donnée par des année. Ici t=1 représente la première année après la sortie des études. Une personne qui aura eu un emploi durant cette année, l’aura eu durant cette première année, que ce soit 2 semaines après ou 11 mois après. Si on disposait des mois, cela pourrait être intéressant de modifier cette métrique temporelle. Voir exemple 3<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Contrairement au durée annuelle je n’ai pas ajouté 1 à chaque durée, ce qui est de nouveau envisageable par exemple si on veut explicitement indiquer les évènements qui ont lieu le premier mois. Pour id=3 la relation a t-elle durée du 1er septembre au 30 novembre, ou du 30 septembre au 1er novembre?? On a toujours un problème de précision, mais ici d’une trentaine de jours<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>avec R par exemple la fonction <code>unique</code> de dplyr<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>En conservant l’information sur les années, on transformera la base en format individu-période et on procédera à une fusion des informations<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09-tvc.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><strong>Variables dynamiques</strong></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-concurrent.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><strong>Risques concurrents</strong></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Eléments de mise en forme des données**</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>Ce qui suit est un premier jet réalisé en 2023, encore très perfectible, mais j'avais bien conscience depuis très longtemps que l'absence d'une partie dédiée aux manipulations des données biographiques était problématique. </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Ce qui suit ne peut pas couvrir toutes les problématiques que l'on peut rencontrer lorsqu'on met en forme ce type de données: le format de mise à disposition, l'extraction de l'information pertinente correspondant à la question analysée, voire le logiciel utilisé, rend quasiment impossible la production d'un guide clé en main.</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>**Quelques conseils**  </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Comme l'analyse des durées/survie consiste à extraire une (ou plusieurs) séquence(s) bien identifier les situations types que l'on sera conduit à rencontrer et à traiter. Ici il peut être intéressant, de manière exploratoire, à conduire une analyse de séquences au préalable. </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Vérifier à chaque étape de la programmation la validité ou la cohérence des informations contenues dans les variables créées et/ou de la mise en forme.</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>**Le format des données utilisé dans cette section** </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Il est identique à celui utilisé dans l'enquête MAFE [<span class="co">[</span><span class="ot">lien</span><span class="co">](https://mafeproject.site.ined.fr/fr/)</span>]^<span class="co">[</span><span class="ot">Des éléments de manipulation/programmation pour un exemple volontairement très compliqué sont donnés dans ***méthodes*** =&gt; ***notes méthodologiques***. Ayant été fait en 2015, le code pour R est largement *out of date*</span><span class="co">]</span> , donc de type individus-séquences avec un marquage des informations temporelles de type *année*. </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Sur chaque séquence l'année de début et l'année de fin sont indiquée.</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Les trajectoires peuvent être continues ou non. Si elle ne sont pas continues, un exemple montre comment récupérer les séquences en "creux".</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>**Programmation** </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Cette section n'est pas centrée sur la méthode de programmation, mais plutôt sur les questions que l'on doit se poser et leur résolution. </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Comme la formation est appliquée en R, j'ai néanmoins donné les codes que j'ai utilisé. </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Les codes R sont ici largement hérité d'une programmation Stata que je maîtrise encore bien mieux. </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>On pourrait aller *plus vite*, en s'y prenant différement, mais j'applique une programmation que j'assume prudente et en evitant les méthodes reposant sur des splits de bases. </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Le type de programmation applique assez massivement l'utilisation de compteurs ou de double compteurs, et si nécessaire l'utilisation de variables décalée de type *lead* ou *lag*. </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les support **assistoolsms**</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>Le service SMS de l'Ined a mis en place récemment un support de programmation dédié principalement à R [<span class="co">[</span><span class="ot">Lien</span><span class="co">](https://mthevenin.github.io/assistoolsms/)</span>]. Ce support est construit sur l'idée d'une liste de fiches thématiques qui trouvent leur origine, mais pas que, dans des demandes d'assistances de programmation de la part de chercheur.e.s, (post)doctorant.e.s ou stagiaires. </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>Bien que cela ne soit pas pour tout de suite, il est prévu d'alimenter ce support sur la question des manipulations des données biographiques avec: d'autres exemples, des alternatives aux codes proposés plus loin, ou l'application des exemples traités ici mais avec un format de mise à disposition des données différents.</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>... Tout ceci, au mieux pour l'été prochain.</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>Packages utilisés:</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calcul des variables d'analyses</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>Construction de la base: </span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>),</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>), </span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>On supposera que l'année de collecte, pour toutes les observations, est **2025** ^<span class="co">[</span><span class="ot">Ici on a une enquête réalisée une même année pour toute les observations, ce n'est pas toujours le cas. De même au lieu de l'année, si les datations avaient été données par l'âge, au moment de l'enquête l'âge varierait d'une personne à une autre. Ces datations différentes (année ou âge) peuvent être présentes dans chaque module biographique d'une enquête, ou dans le fichier des caractéristiques fixes. Dans ce cas l'information devra être récupérée</span><span class="co">]</span>.</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>Si cela n'est pas donné dans le module biographique, il peut être intéressant de construire les numéros de séquences des trajectoires.</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>**Exemple 1 : durée de séjour de la première séquence observée** </span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>Supposons que x traduit un type de relation/union, par exemple x=1 est une relation non cohabitante et x=2 est une relation cohabitante.</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>On s'intéresse à la durée de la première relation, sans distinction entre 1 et 2. Il suffit de séléctionner la première séquence.</span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nseq<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>La variable de fin va permettre de repérer les informations censurées, et de générer la variable d'évènement. </span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>A ce niveau il est donc important de ne pas encore remplacer la date de censure par sa valeur.</span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Si *fin* est une valeur manquante: observation censurée.</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Si *fin* est une valeur renseignée: occurence de l'évènement.</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>fin), <span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>Pour la variable de durée ^<span class="co">[</span><span class="ot">La mesure est ici discrète/groupée, il me semble toujours préférable d'allonger les durées à +1. On démarre donc toujours un premier janvier pour terminer un 31 décembre sur l'information est donnée par des année. Ici t=1 représente la première année après la sortie des études. Une personne qui aura eu un emploi durant cette année, l'aura eu durant cette première année, que ce soit 2 semaines après ou 11 mois après. Si on disposait des mois, cela pourrait être intéressant de modifier cette métrique temporelle. Voir exemple 3</span><span class="co">]</span>, une repéré les observations censurées, elle est calculée directement avec les variables *fin* et *deb*. </span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2025</span> <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a>**Exemple 2 : changement de métrique temporelle**</span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>Toujours avec le même exemple, mais en ajoutant une observation, supposons que l'on dispose également de l'information sur les mois. Sur les mois où l'évènement à eu lieu, mais également sur les mois où l'enquête a été réalisée.</span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-134"><a href="#cb43-134" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb43-135"><a href="#cb43-135" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb  =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>, <span class="dv">2021</span>),</span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a>                <span class="at">debm =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">10</span>,<span class="dv">9</span>),</span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin  =</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>,<span class="dv">2021</span>), </span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a>                <span class="at">finm =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">12</span>,<span class="cn">NA</span>,<span class="dv">11</span>), </span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a>                <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a>                <span class="at">enq  =</span> <span class="fu">c</span>(<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>,<span class="dv">2025</span>),</span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a>                <span class="at">enqm =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a>On remarque que la nouvelle observation (id=3) a connu l'évènement, ici la fin de la relation, la même année qu'au début d'exposition (le début de la relation).... mais au bout de 2,6,11 mois???? Commeon dispose de l'information sur les mois de début et de fin cela peut être intéressant de l'exploite. De la même manière si l'enquête a été réalisée la même année, les entretiens n'ont pas eu lieu le même mois. On aura besoin de cette information pour les observations censurées.</span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a>De nouveau on sélectionne la première séquence, et pour la lisibilité de la base on retire les informations qui ne seront pas ou plus exploitées (*nseq*, *x*).</span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2,nseq<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(x,nseq))</span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a>On génère la variable censure/évènement (toujours à faire avant la variable de durée) de la même manière que pour l'exemple 1.</span>
<span id="cb43-167"><a href="#cb43-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-172"><a href="#cb43-172" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-173"><a href="#cb43-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-174"><a href="#cb43-174" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df2<span class="sc">$</span>fin), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb43-175"><a href="#cb43-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-176"><a href="#cb43-176" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-177"><a href="#cb43-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-178"><a href="#cb43-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-179"><a href="#cb43-179" aria-hidden="true" tabindex="-1"></a>Pour la variable de durée, le principe est de multiplié par 12 la différence entre l'année de fin et l'année de début et d'ajouter la différence entre le mois de fin et le mois de début.  </span>
<span id="cb43-180"><a href="#cb43-180" aria-hidden="true" tabindex="-1"></a>Pour les observations censurées, ici l'année de fin est identique mais les mois varient. En terme de programmation, surtout si avec R on utilise <span class="in">`ifelse`</span>, il est préférable d'y aller doucement en créant une durée pour les observations qui ont connu l'évènement et une durée pour les observations censurées. Puis de regrouper les deux cas. C'est ce qui est fait dans le code qui suit. </span>
<span id="cb43-181"><a href="#cb43-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-182"><a href="#cb43-182" aria-hidden="true" tabindex="-1"></a>Durée selon les valeurs de *e*: </span>
<span id="cb43-183"><a href="#cb43-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-186"><a href="#cb43-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-187"><a href="#cb43-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-188"><a href="#cb43-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-189"><a href="#cb43-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-190"><a href="#cb43-190" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur1 <span class="ot">=</span> <span class="fu">ifelse</span>(df2<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, <span class="dv">12</span><span class="sc">*</span>(df2<span class="sc">$</span>fin <span class="sc">-</span> df2<span class="sc">$</span>deb) <span class="sc">+</span> (df2<span class="sc">$</span>finm <span class="sc">-</span> df2<span class="sc">$</span>debm),  <span class="dv">0</span>) </span>
<span id="cb43-191"><a href="#cb43-191" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur0 <span class="ot">=</span> <span class="fu">ifelse</span>(df2<span class="sc">$</span>e<span class="sc">==</span><span class="dv">0</span>, <span class="dv">12</span><span class="sc">*</span>(<span class="dv">2025</span> <span class="sc">-</span> df2<span class="sc">$</span>deb)    <span class="sc">+</span> (df2<span class="sc">$</span>enqm  <span class="sc">-</span> df2<span class="sc">$</span>debm), <span class="dv">0</span>) </span>
<span id="cb43-192"><a href="#cb43-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-193"><a href="#cb43-193" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-194"><a href="#cb43-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-195"><a href="#cb43-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-196"><a href="#cb43-196" aria-hidden="true" tabindex="-1"></a>On regroupe par simple sommation (le *else* étant 0).</span>
<span id="cb43-197"><a href="#cb43-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-200"><a href="#cb43-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-201"><a href="#cb43-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-202"><a href="#cb43-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-203"><a href="#cb43-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-204"><a href="#cb43-204" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur  <span class="ot">=</span> df2<span class="sc">$</span>dur1 <span class="sc">+</span> df2<span class="sc">$</span>dur0</span>
<span id="cb43-205"><a href="#cb43-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-206"><a href="#cb43-206" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(dur1,dur0))</span>
<span id="cb43-207"><a href="#cb43-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-208"><a href="#cb43-208" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-209"><a href="#cb43-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-210"><a href="#cb43-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-211"><a href="#cb43-211" aria-hidden="true" tabindex="-1"></a>On dispose ainsi des éléments nécessaire pour faire une analyse de durée avec une métrique mensuelle ^<span class="co">[</span><span class="ot">Contrairement au durée annuelle je n'ai pas ajouté 1 à chaque durée, ce qui est de nouveau envisageable par exemple si on veut explicitement indiquer les évènements qui ont lieu le premier mois. Pour id=3 la relation a t-elle durée du 1er septembre au 30 novembre, ou du 30 septembre au 1er novembre?? On a toujours un problème de précision, mais ici d'une trentaine de jours</span><span class="co">]</span>.</span>
<span id="cb43-212"><a href="#cb43-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-213"><a href="#cb43-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-214"><a href="#cb43-214" aria-hidden="true" tabindex="-1"></a>**Exemple 3 : importation d'un début d'expositon externe** </span>
<span id="cb43-215"><a href="#cb43-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-216"><a href="#cb43-216" aria-hidden="true" tabindex="-1"></a>On repart de la première base</span>
<span id="cb43-217"><a href="#cb43-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-218"><a href="#cb43-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-219"><a href="#cb43-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-220"><a href="#cb43-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-221"><a href="#cb43-221" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb43-222"><a href="#cb43-222" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>),</span>
<span id="cb43-223"><a href="#cb43-223" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>), </span>
<span id="cb43-224"><a href="#cb43-224" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb43-225"><a href="#cb43-225" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb43-226"><a href="#cb43-226" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb43-227"><a href="#cb43-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-228"><a href="#cb43-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-229"><a href="#cb43-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-230"><a href="#cb43-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-231"><a href="#cb43-231" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-232"><a href="#cb43-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-233"><a href="#cb43-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-234"><a href="#cb43-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-235"><a href="#cb43-235" aria-hidden="true" tabindex="-1"></a>On suppose maintenant que x traduit des situations sur le marché du travail. Par exemple **x=1** est un emploi en CDD et **x=2** un emploi en CDI. On s'intéresse à la durée entre la fin des études et le premier emploi, quel que soit sont type.</span>
<span id="cb43-236"><a href="#cb43-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-237"><a href="#cb43-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On ne dispose pas ici de toutes l'information pour calculer la durée, soit la fin des études. Elle peut être donnée dans une base classique regroupant l'ensemble des caractéristiques individuelles de type fixe (année de naissance, sexe...).</span>
<span id="cb43-238"><a href="#cb43-238" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Comme on s'intéresse à la durée de recherche du premier emploi, dans le module biographique la date de début va devenir la date de fin.</span>
<span id="cb43-239"><a href="#cb43-239" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pour les observations présente dans la base biographique, il n'y a pas de censure à droite. Mais si on regarde le fichier des caractéristiques générales, fixe:</span>
<span id="cb43-240"><a href="#cb43-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-241"><a href="#cb43-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-242"><a href="#cb43-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-243"><a href="#cb43-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-244"><a href="#cb43-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-245"><a href="#cb43-245" aria-hidden="true" tabindex="-1"></a>etude <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">fin_etude =</span> <span class="fu">c</span>(<span class="dv">2020</span>,<span class="dv">2021</span>,<span class="dv">2023</span>))</span>
<span id="cb43-246"><a href="#cb43-246" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(etude)</span>
<span id="cb43-247"><a href="#cb43-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-248"><a href="#cb43-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-249"><a href="#cb43-249" aria-hidden="true" tabindex="-1"></a>Une nouvelle observation  (id=3) apparaît. Au moment de l'enquête, elle n'a pas (**encore**) trouvé un emploi depuis la fin de ces études. On a donc une observation qui sera censurée.</span>
<span id="cb43-250"><a href="#cb43-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-251"><a href="#cb43-251" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb43-252"><a href="#cb43-252" aria-hidden="true" tabindex="-1"></a>Certaines bases biographiques peuvent être structurées avec des trajectoires strictement continue, l'année (l'âge) de fin étant l'année (l'âge) de début de la trajectoire suivante. Dans ce cas, l'information serait immédiatement disponible, avec la présence d'un nombre de séquences plus important dans la base. </span>
<span id="cb43-253"><a href="#cb43-253" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-254"><a href="#cb43-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-255"><a href="#cb43-255" aria-hidden="true" tabindex="-1"></a>On va devoir: </span>
<span id="cb43-256"><a href="#cb43-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-257"><a href="#cb43-257" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Sélectionner la première sequence d'emploi dans la base df (variable *nseq*).</span>
<span id="cb43-258"><a href="#cb43-258" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>La fusionner avec la base étude.</span>
<span id="cb43-259"><a href="#cb43-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-260"><a href="#cb43-260" aria-hidden="true" tabindex="-1"></a>Avant la fusion, on peut conserver seulement les informations nécessaires (id, deb). La variable *deb* va changer également de statut en devenant l'année de *fin* de la période de recherche d'emploi.  </span>
<span id="cb43-261"><a href="#cb43-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-262"><a href="#cb43-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-263"><a href="#cb43-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-264"><a href="#cb43-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-265"><a href="#cb43-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-266"><a href="#cb43-266" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nseq<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb43-267"><a href="#cb43-267" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(fin,x,nseq))</span>
<span id="cb43-268"><a href="#cb43-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-269"><a href="#cb43-269" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">rename</span>(df, <span class="at">fin =</span> deb)</span>
<span id="cb43-270"><a href="#cb43-270" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-271"><a href="#cb43-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-272"><a href="#cb43-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-273"><a href="#cb43-273" aria-hidden="true" tabindex="-1"></a>Après la fusion: </span>
<span id="cb43-274"><a href="#cb43-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-275"><a href="#cb43-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-276"><a href="#cb43-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-277"><a href="#cb43-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-278"><a href="#cb43-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-279"><a href="#cb43-279" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">full_join</span>(etude, df,  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'id'</span>))</span>
<span id="cb43-280"><a href="#cb43-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-281"><a href="#cb43-281" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">rename</span>(df, <span class="at">deb =</span> fin_etude)</span>
<span id="cb43-282"><a href="#cb43-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-283"><a href="#cb43-283" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-284"><a href="#cb43-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-285"><a href="#cb43-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-286"><a href="#cb43-286" aria-hidden="true" tabindex="-1"></a>On a toutes les informations pour générer la variable censure/évènement et la variable de durée:</span>
<span id="cb43-287"><a href="#cb43-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-288"><a href="#cb43-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-289"><a href="#cb43-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-290"><a href="#cb43-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-291"><a href="#cb43-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-292"><a href="#cb43-292" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>fin),<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb43-293"><a href="#cb43-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-294"><a href="#cb43-294" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2025</span> <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb43-295"><a href="#cb43-295" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-296"><a href="#cb43-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-297"><a href="#cb43-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-298"><a href="#cb43-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-299"><a href="#cb43-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-300"><a href="#cb43-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appariement de modules biographiques </span></span>
<span id="cb43-301"><a href="#cb43-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-302"><a href="#cb43-302" aria-hidden="true" tabindex="-1"></a>On repart de la première base, avec les numéros de séquence.</span>
<span id="cb43-303"><a href="#cb43-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-306"><a href="#cb43-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-307"><a href="#cb43-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-308"><a href="#cb43-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-309"><a href="#cb43-309" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb43-310"><a href="#cb43-310" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2022</span>),</span>
<span id="cb43-311"><a href="#cb43-311" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>), </span>
<span id="cb43-312"><a href="#cb43-312" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb43-313"><a href="#cb43-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-314"><a href="#cb43-314" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>nseq <span class="ot">=</span> <span class="dv">1</span> </span>
<span id="cb43-315"><a href="#cb43-315" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nseq =</span> <span class="fu">cumsum</span>(nseq))  </span>
<span id="cb43-316"><a href="#cb43-316" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb43-317"><a href="#cb43-317" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)                              </span>
<span id="cb43-318"><a href="#cb43-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-319"><a href="#cb43-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-320"><a href="#cb43-320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mise en forme d'une base</span></span>
<span id="cb43-321"><a href="#cb43-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-322"><a href="#cb43-322" aria-hidden="true" tabindex="-1"></a>Pour apparier des informations de plusieurs modules biographiques, on doit transformer les bases en format individus-séquences en format individus-périodes (ici individus années).</span>
<span id="cb43-323"><a href="#cb43-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-324"><a href="#cb43-324" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 1**: allongement sur chaque séquence après avoir générées leur durée</span>
<span id="cb43-325"><a href="#cb43-325" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 2**: générer une variable de période (année) sur chaque ligne. Elle servira pour l'appariement.</span>
<span id="cb43-326"><a href="#cb43-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-327"><a href="#cb43-327" aria-hidden="true" tabindex="-1"></a>**Pourquoi ne pas utiliser la simple différence entre la fin et le début ?**</span>
<span id="cb43-328"><a href="#cb43-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-329"><a href="#cb43-329" aria-hidden="true" tabindex="-1"></a>Durée (fin - début) et allongement de la base:</span>
<span id="cb43-330"><a href="#cb43-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-331"><a href="#cb43-331" aria-hidden="true" tabindex="-1"></a>On ne génère pas des variables d'analyse, on aurait besoin de l'information sur l'année de l'enquête pour les informations censurées. </span>
<span id="cb43-332"><a href="#cb43-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-333"><a href="#cb43-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-334"><a href="#cb43-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-335"><a href="#cb43-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-336"><a href="#cb43-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-337"><a href="#cb43-337" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb43-338"><a href="#cb43-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-339"><a href="#cb43-339" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-340"><a href="#cb43-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-341"><a href="#cb43-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-342"><a href="#cb43-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-343"><a href="#cb43-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-344"><a href="#cb43-344" aria-hidden="true" tabindex="-1"></a>Allongement de la base:</span>
<span id="cb43-345"><a href="#cb43-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-346"><a href="#cb43-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-347"><a href="#cb43-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-348"><a href="#cb43-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-349"><a href="#cb43-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-350"><a href="#cb43-350" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> df</span>
<span id="cb43-351"><a href="#cb43-351" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>dur1 <span class="ot">=</span> df1<span class="sc">$</span>fin <span class="sc">-</span> df1<span class="sc">$</span>deb</span>
<span id="cb43-352"><a href="#cb43-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-353"><a href="#cb43-353" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>dur1b <span class="ot">=</span> df1<span class="sc">$</span>dur1 <span class="co"># uncount supprime la variable d'origine </span></span>
<span id="cb43-354"><a href="#cb43-354" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> <span class="fu">uncount</span>(df1,dur1b)</span>
<span id="cb43-355"><a href="#cb43-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-356"><a href="#cb43-356" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df1)</span>
<span id="cb43-357"><a href="#cb43-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-358"><a href="#cb43-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-359"><a href="#cb43-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-360"><a href="#cb43-360" aria-hidden="true" tabindex="-1"></a>Pour générer la variable période (année), on a besoin d'un compteur qui sera associé à la variable *deb*. On doit bien contrôler l'opération par identifiant et numéro de séquence.</span>
<span id="cb43-361"><a href="#cb43-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-364"><a href="#cb43-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-365"><a href="#cb43-365" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-366"><a href="#cb43-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-367"><a href="#cb43-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-368"><a href="#cb43-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-369"><a href="#cb43-369" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb43-370"><a href="#cb43-370" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> df1 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c)) </span>
<span id="cb43-371"><a href="#cb43-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-372"><a href="#cb43-372" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df1)</span>
<span id="cb43-373"><a href="#cb43-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-374"><a href="#cb43-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-375"><a href="#cb43-375" aria-hidden="true" tabindex="-1"></a>**Problème**: les années de début ne sont pas correncte: 2021 au lieu de 2020 pour la première séquence de id=1 par exemple. </span>
<span id="cb43-376"><a href="#cb43-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-377"><a href="#cb43-377" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb43-378"><a href="#cb43-378" aria-hidden="true" tabindex="-1"></a>On doit donc impérativement augmenter la différence entre la fin et le début par +1 pour que l'ensemble des périodes (années) soit couvertes. </span>
<span id="cb43-379"><a href="#cb43-379" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-380"><a href="#cb43-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-381"><a href="#cb43-381" aria-hidden="true" tabindex="-1"></a>On reprend donc les opérations précédentes mais avec **durée = fin - debut + 1**</span>
<span id="cb43-382"><a href="#cb43-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-383"><a href="#cb43-383" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Allongement de la base avec durée augmentée </span>
<span id="cb43-384"><a href="#cb43-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-385"><a href="#cb43-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-386"><a href="#cb43-386" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-387"><a href="#cb43-387" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-388"><a href="#cb43-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-389"><a href="#cb43-389" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df</span>
<span id="cb43-390"><a href="#cb43-390" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur2 <span class="ot">=</span> df2<span class="sc">$</span>fin <span class="sc">-</span> df2<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-391"><a href="#cb43-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-392"><a href="#cb43-392" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>dur2b <span class="ot">=</span> df2<span class="sc">$</span>dur2 <span class="co"># uncount supprime la variable d'origine </span></span>
<span id="cb43-393"><a href="#cb43-393" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">uncount</span>(df2,dur2b)</span>
<span id="cb43-394"><a href="#cb43-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-395"><a href="#cb43-395" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-396"><a href="#cb43-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-397"><a href="#cb43-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-398"><a href="#cb43-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-399"><a href="#cb43-399" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Création de la variable *year*: **sur chaque individus-séquences, la somme entre le compteur et l'année de début doit être réduite de 11**.</span>
<span id="cb43-400"><a href="#cb43-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-401"><a href="#cb43-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-402"><a href="#cb43-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-403"><a href="#cb43-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-404"><a href="#cb43-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-405"><a href="#cb43-405" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb43-406"><a href="#cb43-406" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb43-407"><a href="#cb43-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-408"><a href="#cb43-408" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(deb,fin,dur2))</span>
<span id="cb43-409"><a href="#cb43-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-410"><a href="#cb43-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-411"><a href="#cb43-411" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-412"><a href="#cb43-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-413"><a href="#cb43-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-414"><a href="#cb43-414" aria-hidden="true" tabindex="-1"></a>Les années sont toutes couvertes....mais un peu trop. En effet, lorsque les trajectoires sont continues soit</span>
<span id="cb43-415"><a href="#cb43-415" aria-hidden="true" tabindex="-1"></a>lorsque l'année de fin d'une séquence est identique à l'année de début de la suivante, les années vont être doublonnées. On doit dont supprimer ce doublon. </span>
<span id="cb43-416"><a href="#cb43-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-417"><a href="#cb43-417" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Suppression des doublons des trajectoires continues.</span>
<span id="cb43-418"><a href="#cb43-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-419"><a href="#cb43-419" aria-hidden="true" tabindex="-1"></a>De nouveaux on doit faire un choix, soit on priviligie l'année de fin, soit on privilégie l'année de début. </span>
<span id="cb43-420"><a href="#cb43-420" aria-hidden="true" tabindex="-1"></a>Les applications ont des fonctions qui permettent de supprimer les doublons^<span class="co">[</span><span class="ot">avec R par exemple la fonction `unique` de dplyr</span><span class="co">]</span>. On peut le faire manuellement en regardant pour chaque personnes-années le nombre de doublon. Cela se fait facilement à l'aide d'un compteur, ici la variable *nyear*.</span>
<span id="cb43-421"><a href="#cb43-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-422"><a href="#cb43-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-423"><a href="#cb43-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-424"><a href="#cb43-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-425"><a href="#cb43-425" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nyear =</span> <span class="fu">cumsum</span>(c))</span>
<span id="cb43-426"><a href="#cb43-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-427"><a href="#cb43-427" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-428"><a href="#cb43-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-429"><a href="#cb43-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-430"><a href="#cb43-430" aria-hidden="true" tabindex="-1"></a>Si on souhaite garder l'année de fin on filtre les observations en conservant celles dont nyear=1. Si on souhaite privilégier les années de début on foltre les observations en conservant celles dont nyear=2. </span>
<span id="cb43-431"><a href="#cb43-431" aria-hidden="true" tabindex="-1"></a>Si on souhaite conserver les années de fin de séquence:</span>
<span id="cb43-432"><a href="#cb43-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-433"><a href="#cb43-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb43-434"><a href="#cb43-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-435"><a href="#cb43-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-436"><a href="#cb43-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-437"><a href="#cb43-437" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2, nyear<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb43-438"><a href="#cb43-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-439"><a href="#cb43-439" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(nseq,c,nyear))</span>
<span id="cb43-440"><a href="#cb43-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-441"><a href="#cb43-441" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)</span>
<span id="cb43-442"><a href="#cb43-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-443"><a href="#cb43-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-444"><a href="#cb43-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-445"><a href="#cb43-445" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb43-446"><a href="#cb43-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-447"><a href="#cb43-447" aria-hidden="true" tabindex="-1"></a><span class="fu">### En résumé</span></span>
<span id="cb43-448"><a href="#cb43-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-449"><a href="#cb43-449" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A la date (année/âge) de censure remplacer la valeur manquante par sa valeur. Si ultérieurement on a besoin  de garder l'information sur la censure -  valeur manquante  - , on peut générer une variable mirroir de *fin*.</span>
<span id="cb43-450"><a href="#cb43-450" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Sur chaque séquence calculer la durée avec une augmentation de +1.</span>
<span id="cb43-451"><a href="#cb43-451" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Créer une variable période (année) sur chaque ligne. Elle servira à définir la clé d'appariement. </span>
<span id="cb43-452"><a href="#cb43-452" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Supprimer les doublons sur les transition continue $fin_t = debut_{t+1}$.</span>
<span id="cb43-453"><a href="#cb43-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-454"><a href="#cb43-454" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-455"><a href="#cb43-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-456"><a href="#cb43-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fusion des informations biographiques</span></span>
<span id="cb43-457"><a href="#cb43-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-458"><a href="#cb43-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-459"><a href="#cb43-459" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fusion avec l'ensemble des périodes observables</span></span>
<span id="cb43-460"><a href="#cb43-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-461"><a href="#cb43-461" aria-hidden="true" tabindex="-1"></a>Pour commencer par un exemple plutôt simple, on note que pour id=1 l'année 2022 n'est pas renseignée (trajectoire non continue). Si on reprend un exemple précédent (relations de couple), cette année pourrait être identifiée comme une période sans relation. </span>
<span id="cb43-462"><a href="#cb43-462" aria-hidden="true" tabindex="-1"></a>Une façon simple de boucher ce type "trous", est d'utiliser les années de naissances des individus, et de créer une base individus-périodes  qui couvre toutes les années de vie de l'individu jusqu'à l'enquête. On remontera jusque là, mais on va par exemple considérer que pour id=1 et id=2 ce *début de tout* est en 2018.</span>
<span id="cb43-463"><a href="#cb43-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-466"><a href="#cb43-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-467"><a href="#cb43-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-468"><a href="#cb43-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-469"><a href="#cb43-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-470"><a href="#cb43-470" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb43-471"><a href="#cb43-471" aria-hidden="true" tabindex="-1"></a>                    <span class="at">t0  =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2018</span>))</span>
<span id="cb43-472"><a href="#cb43-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-473"><a href="#cb43-473" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dftout)    </span>
<span id="cb43-474"><a href="#cb43-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-475"><a href="#cb43-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-476"><a href="#cb43-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-477"><a href="#cb43-477" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>On ajoute l'information sur l'année de l'enquête (2025).</span>
<span id="cb43-478"><a href="#cb43-478" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>On génère la durée </span>
<span id="cb43-479"><a href="#cb43-479" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>On allonge la base</span>
<span id="cb43-480"><a href="#cb43-480" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>On génère la variable année sur chaque ligne (on contrôle seulement sur *id*)</span>
<span id="cb43-481"><a href="#cb43-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-484"><a href="#cb43-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-485"><a href="#cb43-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-486"><a href="#cb43-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-487"><a href="#cb43-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-488"><a href="#cb43-488" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>tmax <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb43-489"><a href="#cb43-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-490"><a href="#cb43-490" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>dur  <span class="ot">=</span> dftout<span class="sc">$</span>tmax <span class="sc">-</span> dftout<span class="sc">$</span>t0 <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-491"><a href="#cb43-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-492"><a href="#cb43-492" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">uncount</span>(dftout,dur)</span>
<span id="cb43-493"><a href="#cb43-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-494"><a href="#cb43-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-495"><a href="#cb43-495" aria-hidden="true" tabindex="-1"></a>dftout<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb43-496"><a href="#cb43-496" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> dftout <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> t0  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb43-497"><a href="#cb43-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-498"><a href="#cb43-498" aria-hidden="true" tabindex="-1"></a>dftout <span class="ot">=</span> <span class="fu">select</span>(dftout, <span class="sc">-</span><span class="fu">c</span>(t0,tmax,c))</span>
<span id="cb43-499"><a href="#cb43-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-500"><a href="#cb43-500" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dftout)    </span>
<span id="cb43-501"><a href="#cb43-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-502"><a href="#cb43-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-503"><a href="#cb43-503" aria-hidden="true" tabindex="-1"></a>On peut maintenant apparier cette couverture de toutes les années de vie jusqu'à l'enquête à la base biographique:</span>
<span id="cb43-504"><a href="#cb43-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-505"><a href="#cb43-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-508"><a href="#cb43-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-509"><a href="#cb43-509" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-510"><a href="#cb43-510" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-511"><a href="#cb43-511" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">full_join</span>(df2, dftout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>,<span class="st">"year"</span>))</span>
<span id="cb43-512"><a href="#cb43-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-513"><a href="#cb43-513" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">arrange</span>(df2, id, year)</span>
<span id="cb43-514"><a href="#cb43-514" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span>
<span id="cb43-515"><a href="#cb43-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-516"><a href="#cb43-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-517"><a href="#cb43-517" aria-hidden="true" tabindex="-1"></a>Pour supprimer les informations qui précèdent la première séquence de la biographie, on peut générer un compteur sur la variable x après avoir remplacer ses valeurs manquantes par des 0. On gardera les lignes pour lesquels ce compteur est supérieur à 1.  </span>
<span id="cb43-518"><a href="#cb43-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-521"><a href="#cb43-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-522"><a href="#cb43-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-523"><a href="#cb43-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-524"><a href="#cb43-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-525"><a href="#cb43-525" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>x[<span class="fu">is.na</span>(df2<span class="sc">$</span>x)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb43-526"><a href="#cb43-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-527"><a href="#cb43-527" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nx =</span> <span class="fu">cumsum</span>(x))</span>
<span id="cb43-528"><a href="#cb43-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-529"><a href="#cb43-529" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span>
<span id="cb43-530"><a href="#cb43-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-531"><a href="#cb43-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-532"><a href="#cb43-532" aria-hidden="true" tabindex="-1"></a>On supprime les lignes lorsque nx=0.</span>
<span id="cb43-533"><a href="#cb43-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-536"><a href="#cb43-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-537"><a href="#cb43-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-538"><a href="#cb43-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-539"><a href="#cb43-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-540"><a href="#cb43-540" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">filter</span>(df2, nx<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb43-541"><a href="#cb43-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-542"><a href="#cb43-542" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> <span class="fu">select</span>(df2, <span class="sc">-</span><span class="fu">c</span>(nx))</span>
<span id="cb43-543"><a href="#cb43-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-544"><a href="#cb43-544" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2)    </span>
<span id="cb43-545"><a href="#cb43-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-546"><a href="#cb43-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-547"><a href="#cb43-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-548"><a href="#cb43-548" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fusion avec une autre base biographique</span></span>
<span id="cb43-549"><a href="#cb43-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-550"><a href="#cb43-550" aria-hidden="true" tabindex="-1"></a>On peut être amené à fusionner plusieurs modules biographique. Jusqu'à présent, une même année, tous les individus ne pouvaient être que dans une situation, par exemple une seul emploi, un seul lieu de résidence etc... </span>
<span id="cb43-551"><a href="#cb43-551" aria-hidden="true" tabindex="-1"></a>Pour certains phénomènes, une même années ou pendant une période plus longue on peut observer simultanément plusieurs états différent, ou plus classiquement observer une somme d'un même état. On parle ici d'***overlapping***.</span>
<span id="cb43-552"><a href="#cb43-552" aria-hidden="true" tabindex="-1"></a>Ce type de situation est typiquement celle qu'on observe avec le nombre d'enfants.</span>
<span id="cb43-553"><a href="#cb43-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-554"><a href="#cb43-554" aria-hidden="true" tabindex="-1"></a>Supposons que le base ci-dessous traduit la naissance et potentiellement le décès des enfants.  </span>
<span id="cb43-555"><a href="#cb43-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-558"><a href="#cb43-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-559"><a href="#cb43-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-560"><a href="#cb43-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-561"><a href="#cb43-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-562"><a href="#cb43-562" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb43-563"><a href="#cb43-563" aria-hidden="true" tabindex="-1"></a>                <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2019</span>, <span class="dv">2023</span>),</span>
<span id="cb43-564"><a href="#cb43-564" aria-hidden="true" tabindex="-1"></a>                <span class="at">fin =</span>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2024</span>,<span class="cn">NA</span>), </span>
<span id="cb43-565"><a href="#cb43-565" aria-hidden="true" tabindex="-1"></a>                <span class="at">nseq =</span>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb43-566"><a href="#cb43-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-567"><a href="#cb43-567" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span>
<span id="cb43-568"><a href="#cb43-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-569"><a href="#cb43-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-570"><a href="#cb43-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-571"><a href="#cb43-571" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=1 a un premier enfant en 2022 qui est toujours en vie au moment de l'enquête (2025)</span>
<span id="cb43-572"><a href="#cb43-572" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=2:</span>
<span id="cb43-573"><a href="#cb43-573" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>A un premier enfant en 2019 qui décède en 2024</span>
<span id="cb43-574"><a href="#cb43-574" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>A un second  enfant en 2023, toujours en vie au moment de l'enquête</span>
<span id="cb43-575"><a href="#cb43-575" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>De la naissance du second enfant au décès du premier, on va donc avoir des doublons (overlapping) sur les années</span>
<span id="cb43-576"><a href="#cb43-576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-577"><a href="#cb43-577" aria-hidden="true" tabindex="-1"></a>Si on reprend les manipulations précédentes jusqu'à la création de la variable *year*: </span>
<span id="cb43-578"><a href="#cb43-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-581"><a href="#cb43-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-582"><a href="#cb43-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-583"><a href="#cb43-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-584"><a href="#cb43-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-585"><a href="#cb43-585" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>fin[<span class="fu">is.na</span>(dfy<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb43-586"><a href="#cb43-586" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>dur <span class="ot">=</span> dfy<span class="sc">$</span>fin <span class="sc">-</span> dfy<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-587"><a href="#cb43-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-588"><a href="#cb43-588" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>durb <span class="ot">=</span> dfy<span class="sc">$</span>dur  <span class="co"># Uncount supprime la variable d'origine </span></span>
<span id="cb43-589"><a href="#cb43-589" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">uncount</span>(dfy,durb)</span>
<span id="cb43-590"><a href="#cb43-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-591"><a href="#cb43-591" aria-hidden="true" tabindex="-1"></a>dfy<span class="sc">$</span>c <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb43-592"><a href="#cb43-592" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,nseq) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> deb  <span class="sc">+</span> <span class="fu">cumsum</span>(c) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb43-593"><a href="#cb43-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-594"><a href="#cb43-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-595"><a href="#cb43-595" aria-hidden="true" tabindex="-1"></a>La variable *year* est bien renseignée 2 fois pour les années 2023 et 2024. </span>
<span id="cb43-596"><a href="#cb43-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-597"><a href="#cb43-597" aria-hidden="true" tabindex="-1"></a>On peut s'intéresser au fait d'avoir ou non un enfant, ou de manière plus générale au nombre d'enfant. En créant cette information, on se donne également le moyen de corriger cet overlapping: </span>
<span id="cb43-598"><a href="#cb43-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-599"><a href="#cb43-599" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On peut de nouveau générer un compteur contrôlé par individu année</span>
<span id="cb43-600"><a href="#cb43-600" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>En génerant un total de ligne doublonnée, on récupèrera par exemple ici le nombre d'enfant en vie chaque année. </span>
<span id="cb43-601"><a href="#cb43-601" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>En ne gardant que la ligne ou le compteur est égal à 1, on supprime les doublons tout en gardant l'information sur le nombre d'enfant en vie une année donnée.</span>
<span id="cb43-602"><a href="#cb43-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-603"><a href="#cb43-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-606"><a href="#cb43-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-607"><a href="#cb43-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-608"><a href="#cb43-608" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-609"><a href="#cb43-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-610"><a href="#cb43-610" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ny =</span> <span class="fu">cumsum</span>(c))</span>
<span id="cb43-611"><a href="#cb43-611" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> dfy <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id,year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tot_y =</span>  <span class="fu">sum</span>(c))</span>
<span id="cb43-612"><a href="#cb43-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-613"><a href="#cb43-613" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span>
<span id="cb43-614"><a href="#cb43-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-615"><a href="#cb43-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-616"><a href="#cb43-616" aria-hidden="true" tabindex="-1"></a>Il ne reste plus qu'à supprimer les lignes où *ny&gt;1*</span>
<span id="cb43-617"><a href="#cb43-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-618"><a href="#cb43-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-621"><a href="#cb43-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-622"><a href="#cb43-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-623"><a href="#cb43-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-624"><a href="#cb43-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-625"><a href="#cb43-625" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">filter</span>(dfy, ny<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb43-626"><a href="#cb43-626" aria-hidden="true" tabindex="-1"></a>dfy <span class="ot">=</span> <span class="fu">select</span>(dfy, <span class="sc">-</span><span class="fu">c</span>(ny,deb, fin, dur, nseq, c))</span>
<span id="cb43-627"><a href="#cb43-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-628"><a href="#cb43-628" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dfy)</span>
<span id="cb43-629"><a href="#cb43-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-630"><a href="#cb43-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-631"><a href="#cb43-631" aria-hidden="true" tabindex="-1"></a>Avec une ligne par année, on peut la fusionner avec une autre base biographique en format individus-années (même principe qu'avec la fusion avec la base sur toutes les années de vie).</span>
<span id="cb43-632"><a href="#cb43-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-635"><a href="#cb43-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-636"><a href="#cb43-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-637"><a href="#cb43-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-638"><a href="#cb43-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-639"><a href="#cb43-639" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">full_join</span>(dfy, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>,<span class="st">"year"</span>))</span>
<span id="cb43-640"><a href="#cb43-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-641"><a href="#cb43-641" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">arrange</span>(df2y, id,year)</span>
<span id="cb43-642"><a href="#cb43-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-643"><a href="#cb43-643" aria-hidden="true" tabindex="-1"></a>df2y <span class="ot">=</span> <span class="fu">select</span>(df2y, <span class="fu">c</span>(id,year,x,tot_y))</span>
<span id="cb43-644"><a href="#cb43-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-645"><a href="#cb43-645" aria-hidden="true" tabindex="-1"></a>df2y<span class="sc">$</span>tot_y[<span class="fu">is.na</span>(df2y<span class="sc">$</span>tot_y)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb43-646"><a href="#cb43-646" aria-hidden="true" tabindex="-1"></a>df2y<span class="sc">$</span>x[<span class="fu">is.na</span>(df2y<span class="sc">$</span>x)]   <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb43-647"><a href="#cb43-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-648"><a href="#cb43-648" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df2y)</span>
<span id="cb43-649"><a href="#cb43-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-650"><a href="#cb43-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-651"><a href="#cb43-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-652"><a href="#cb43-652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sélection d'un type de séquence et mise en forme pour l'analyse </span></span>
<span id="cb43-653"><a href="#cb43-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-654"><a href="#cb43-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-655"><a href="#cb43-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-656"><a href="#cb43-656" aria-hidden="true" tabindex="-1"></a><span class="fu">## Durée jusqu'à la première séquence</span></span>
<span id="cb43-657"><a href="#cb43-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-660"><a href="#cb43-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-661"><a href="#cb43-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-662"><a href="#cb43-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-663"><a href="#cb43-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-664"><a href="#cb43-664" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span>  <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb43-665"><a href="#cb43-665" aria-hidden="true" tabindex="-1"></a>                 <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>, <span class="dv">2024</span>, <span class="dv">2019</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2023</span>),</span>
<span id="cb43-666"><a href="#cb43-666" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>, <span class="dv">2024</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), </span>
<span id="cb43-667"><a href="#cb43-667" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y  =</span>   <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb43-668"><a href="#cb43-668" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nseq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb43-669"><a href="#cb43-669" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb43-670"><a href="#cb43-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-671"><a href="#cb43-671" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-672"><a href="#cb43-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-673"><a href="#cb43-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-674"><a href="#cb43-674" aria-hidden="true" tabindex="-1"></a>On va s'intéresser à la durée jusqu'à l'occurence de la séquence de type 2 ou 3 (variable *y*). On considéra que le début de l'exposition est donné par la variable *deb* sur la première séquence.</span>
<span id="cb43-675"><a href="#cb43-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-676"><a href="#cb43-676" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=1: début de l'exposition/observation en 2018, observe l'évènement en 2022.</span>
<span id="cb43-677"><a href="#cb43-677" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=2: début de l'exposition/observation en 2019, observe l'évènement la même année.</span>
<span id="cb43-678"><a href="#cb43-678" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=3: début de l'exposition/observation en 2019, observe l'évènement la même année. </span>
<span id="cb43-679"><a href="#cb43-679" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>id=4: début de l'exposition/observation en 2023, n'a pas connu l'évènement au moment de l'enquête.</span>
<span id="cb43-680"><a href="#cb43-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-681"><a href="#cb43-681" aria-hidden="true" tabindex="-1"></a>**Recupération de l'année de l'évènement**</span>
<span id="cb43-682"><a href="#cb43-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-683"><a href="#cb43-683" aria-hidden="true" tabindex="-1"></a>On peut repérer la présence d'une des deux séquences d'intérêt avec une indicatrice. </span>
<span id="cb43-684"><a href="#cb43-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-687"><a href="#cb43-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-688"><a href="#cb43-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-689"><a href="#cb43-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-690"><a href="#cb43-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-691"><a href="#cb43-691" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb43-692"><a href="#cb43-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-693"><a href="#cb43-693" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-694"><a href="#cb43-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-695"><a href="#cb43-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-696"><a href="#cb43-696" aria-hidden="true" tabindex="-1"></a>De nouveau l'utilisation d'un compteur sur cette variable indicatrice, peut s'avérer utile pour repérer le moment de l'occurence. </span>
<span id="cb43-697"><a href="#cb43-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-700"><a href="#cb43-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-701"><a href="#cb43-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-702"><a href="#cb43-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-703"><a href="#cb43-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-704"><a href="#cb43-704" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n  =</span> <span class="fu">cumsum</span>(e)) </span>
<span id="cb43-705"><a href="#cb43-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-706"><a href="#cb43-706" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-707"><a href="#cb43-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-708"><a href="#cb43-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-709"><a href="#cb43-709" aria-hidden="true" tabindex="-1"></a>Pour id=(2,3,4), ce compteur permet d'obtenir l'information souhaitée, à savoir n=0 en situation d'attente/séjour/survie et n=1 l'année de l'évènement. </span>
<span id="cb43-710"><a href="#cb43-710" aria-hidden="true" tabindex="-1"></a>Pour id=1 cependant, l'alternance en y=1 et y=(2,3) ne permet pas de récupérer l'année d'occurence (première fois en 2 ou 3). </span>
<span id="cb43-711"><a href="#cb43-711" aria-hidden="true" tabindex="-1"></a>Cela peut être fait, en faisant un compteur sur le compteur précédent: </span>
<span id="cb43-712"><a href="#cb43-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-715"><a href="#cb43-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-716"><a href="#cb43-716" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-717"><a href="#cb43-717" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-718"><a href="#cb43-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-719"><a href="#cb43-719" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nn  =</span> <span class="fu">cumsum</span>(n)) </span>
<span id="cb43-720"><a href="#cb43-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-721"><a href="#cb43-721" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-722"><a href="#cb43-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-723"><a href="#cb43-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-724"><a href="#cb43-724" aria-hidden="true" tabindex="-1"></a>**Récupération des information censurée**</span>
<span id="cb43-725"><a href="#cb43-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-726"><a href="#cb43-726" aria-hidden="true" tabindex="-1"></a>Pour récupérer l'information sur les observations qui seront censurée, on peut faire un total sur la variable *n* ou *e*: si n=0, l'individu n'aura pas connu l'évènement.</span>
<span id="cb43-727"><a href="#cb43-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-730"><a href="#cb43-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-731"><a href="#cb43-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-732"><a href="#cb43-732" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-733"><a href="#cb43-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-734"><a href="#cb43-734" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">N  =</span> <span class="fu">sum</span>(n)) </span>
<span id="cb43-735"><a href="#cb43-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-736"><a href="#cb43-736" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-737"><a href="#cb43-737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-738"><a href="#cb43-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-739"><a href="#cb43-739" aria-hidden="true" tabindex="-1"></a>Pour id=4, N est bien égal à 0.</span>
<span id="cb43-740"><a href="#cb43-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-741"><a href="#cb43-741" aria-hidden="true" tabindex="-1"></a>**Récupération du début de l'exposition**</span>
<span id="cb43-742"><a href="#cb43-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-743"><a href="#cb43-743" aria-hidden="true" tabindex="-1"></a>Le début de l'exposition étant ici l'année de début de la première séquence. On peut facilement récupérer</span>
<span id="cb43-744"><a href="#cb43-744" aria-hidden="true" tabindex="-1"></a>cette sur toute les lignes en la repérant (ici en générant une nouvelle variable avec la fonction <span class="in">`ifelse`</span>), et en sommant sa valeur sur les autres lignes (=0).</span>
<span id="cb43-745"><a href="#cb43-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-746"><a href="#cb43-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-749"><a href="#cb43-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-750"><a href="#cb43-750" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-751"><a href="#cb43-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-752"><a href="#cb43-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-753"><a href="#cb43-753" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span> debexp <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>nseq<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>deb, <span class="dv">0</span>)                    <span class="co"># &lt;1&gt;</span></span>
<span id="cb43-754"><a href="#cb43-754" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb43-755"><a href="#cb43-755" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">debexp  =</span> <span class="fu">sum</span>(debexp))    <span class="co"># &lt;2&gt;</span></span>
<span id="cb43-756"><a href="#cb43-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-757"><a href="#cb43-757" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-758"><a href="#cb43-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-759"><a href="#cb43-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-760"><a href="#cb43-760" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>La variable *debex* est égale à *deb* si *nseq=1*, 0 sinon.</span>
<span id="cb43-761"><a href="#cb43-761" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>On somme cette valeur sur chaque individu pour l'ajouter aux séquences suivantes.</span>
<span id="cb43-762"><a href="#cb43-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-763"><a href="#cb43-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-764"><a href="#cb43-764" aria-hidden="true" tabindex="-1"></a>**Mise en forme finale de la base**</span>
<span id="cb43-765"><a href="#cb43-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-766"><a href="#cb43-766" aria-hidden="true" tabindex="-1"></a>On peut maintenant conserver les lignes qui nous intéresse à savoir celle où *nn=1* (évènement) ou *N=0* (censure).</span>
<span id="cb43-767"><a href="#cb43-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-770"><a href="#cb43-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-771"><a href="#cb43-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-772"><a href="#cb43-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-773"><a href="#cb43-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-774"><a href="#cb43-774" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, nn<span class="sc">==</span><span class="dv">1</span> <span class="sc">|</span> N<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb43-775"><a href="#cb43-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-776"><a href="#cb43-776" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-777"><a href="#cb43-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-778"><a href="#cb43-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-779"><a href="#cb43-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-780"><a href="#cb43-780" aria-hidden="true" tabindex="-1"></a>On dispose déjà de la variable d'évènement/censure (*e* ou *n* = (0,1), on finit donc par la </span>
<span id="cb43-781"><a href="#cb43-781" aria-hidden="true" tabindex="-1"></a>variable de durée.  </span>
<span id="cb43-782"><a href="#cb43-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-785"><a href="#cb43-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-786"><a href="#cb43-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-787"><a href="#cb43-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-788"><a href="#cb43-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-789"><a href="#cb43-789" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span></span>
<span id="cb43-790"><a href="#cb43-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-791"><a href="#cb43-791" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e<span class="sc">==</span><span class="dv">1</span>, df<span class="sc">$</span>deb <span class="sc">-</span> df<span class="sc">$</span>debexp <span class="sc">+</span> <span class="dv">1</span>, df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>debexp <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb43-792"><a href="#cb43-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-793"><a href="#cb43-793" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="fu">c</span>(id,e,dur))</span>
<span id="cb43-794"><a href="#cb43-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-795"><a href="#cb43-795" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-796"><a href="#cb43-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-797"><a href="#cb43-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-798"><a href="#cb43-798" aria-hidden="true" tabindex="-1"></a>Ces informations sont suffisantes pour estimer une fonction de séjour et on peut ajouter, si elles ne sont pas présentes, des covariables fixes issues du fichier des caractéristiques générales. Pour l'ajout de covariables dynamiques, leur ajout n'est pas forcément difficile pour une analyse en durée discrète ^<span class="co">[</span><span class="ot">En conservant l'information sur les années, on transformera la base en format individu-période et on procédera à une fusion des informations</span><span class="co">]</span>. Pour les analyses type Cox, selon la nature de la variable dynamique, l'opération (quel que soit le logiciel utilisé) risque d'être plus ou moins compliquée.</span>
<span id="cb43-799"><a href="#cb43-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-800"><a href="#cb43-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-801"><a href="#cb43-801" aria-hidden="true" tabindex="-1"></a><span class="fu">## Durée de séjour dans la séquence d'intérêt et variables d'analyse</span></span>
<span id="cb43-802"><a href="#cb43-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-803"><a href="#cb43-803" aria-hidden="true" tabindex="-1"></a>En première ou deuxième analyse, on peut également voir s'intéresser à la durée de séjour dans l'état précédent. Par exemple, si l'analyse précédent consistait à regarder la durée de séjour dans le premier emploi, on pourrait regarder ensuite la durée jusqu'à sa reprise.</span>
<span id="cb43-804"><a href="#cb43-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-805"><a href="#cb43-805" aria-hidden="true" tabindex="-1"></a>Cela va un peu (voir plus) se compliquer. On va repartir de la base de départ précédente en ajoutant une observation. </span>
<span id="cb43-806"><a href="#cb43-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-807"><a href="#cb43-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-810"><a href="#cb43-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-811"><a href="#cb43-811" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-812"><a href="#cb43-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-813"><a href="#cb43-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-814"><a href="#cb43-814" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span>  <span class="fu">data.frame</span>(<span class="at">id  =</span>  <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span> , <span class="dv">5</span>),</span>
<span id="cb43-815"><a href="#cb43-815" aria-hidden="true" tabindex="-1"></a>                 <span class="at">deb =</span>  <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>, <span class="dv">2024</span>, <span class="dv">2019</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="dv">2023</span>, <span class="dv">2019</span>, <span class="dv">2021</span>, <span class="dv">2023</span>, <span class="dv">2024</span>),</span>
<span id="cb43-816"><a href="#cb43-816" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fin =</span>  <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2024</span>, <span class="dv">2025</span>, <span class="cn">NA</span>, <span class="dv">2024</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">2021</span>, <span class="dv">2023</span>, <span class="dv">2024</span>, <span class="cn">NA</span>), </span>
<span id="cb43-817"><a href="#cb43-817" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y  =</span>   <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb43-818"><a href="#cb43-818" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nseq =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb43-819"><a href="#cb43-819" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-820"><a href="#cb43-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-821"><a href="#cb43-821" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-822"><a href="#cb43-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-823"><a href="#cb43-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-824"><a href="#cb43-824" aria-hidden="true" tabindex="-1"></a>**Filtrage des observations hors champs** </span>
<span id="cb43-825"><a href="#cb43-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-826"><a href="#cb43-826" aria-hidden="true" tabindex="-1"></a>On peut déjà supprimer les observations hors champs, à savoir ici id=4 qui n'a pas </span>
<span id="cb43-827"><a href="#cb43-827" aria-hidden="true" tabindex="-1"></a>connu l'évènement dont on analyse la durée.</span>
<span id="cb43-828"><a href="#cb43-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-831"><a href="#cb43-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-832"><a href="#cb43-832" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-833"><a href="#cb43-833" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-834"><a href="#cb43-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-835"><a href="#cb43-835" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e23 <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">2</span> <span class="sc">|</span> df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>)                       <span class="co"># &lt;1&gt;</span></span>
<span id="cb43-836"><a href="#cb43-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-837"><a href="#cb43-837" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n23  =</span> <span class="fu">cumsum</span>(e23)) </span>
<span id="cb43-838"><a href="#cb43-838" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, n23<span class="sc">!=</span><span class="dv">0</span>)                                      <span class="co"># &lt;2&gt;</span></span>
<span id="cb43-839"><a href="#cb43-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-840"><a href="#cb43-840" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-841"><a href="#cb43-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-842"><a href="#cb43-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-843"><a href="#cb43-843" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Nom de la variable *e23* pour repérer la présence de l'évènement dont on analyse la durée.</span>
<span id="cb43-844"><a href="#cb43-844" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Ce compteur est suffisant car l'observation n'a qu'une ligne.</span>
<span id="cb43-845"><a href="#cb43-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-846"><a href="#cb43-846" aria-hidden="true" tabindex="-1"></a>**Récupération de l'évènement analysé**</span>
<span id="cb43-847"><a href="#cb43-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-848"><a href="#cb43-848" aria-hidden="true" tabindex="-1"></a>Ici l'évènement sera un *retour* dans l'état y=1. Il y a de nouveau une possibilité de censure à </span>
<span id="cb43-849"><a href="#cb43-849" aria-hidden="true" tabindex="-1"></a>droite si une observation reste dans l'état 2 ou 3 jusqu'au moment de l'enquête.</span>
<span id="cb43-850"><a href="#cb43-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-851"><a href="#cb43-851" aria-hidden="true" tabindex="-1"></a>Il peut être utile d'utiliser des variables décalées pour repérer les changements d'état d'une séquence à une autre. Ces décalages sont appelées *lead* ou *lag*:</span>
<span id="cb43-852"><a href="#cb43-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-853"><a href="#cb43-853" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>***lead***:  $x_t = x_{t+1}$</span>
<span id="cb43-854"><a href="#cb43-854" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>***lag***:   $x_t = x_{t-1}$</span>
<span id="cb43-855"><a href="#cb43-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-856"><a href="#cb43-856" aria-hidden="true" tabindex="-1"></a>On va utilise ici des ***lead*** et donc pouvoir repérer les changements d'état d'une séquence à une autre. Comme on s'intéresse au retour à l'état 1:</span>
<span id="cb43-857"><a href="#cb43-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-858"><a href="#cb43-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-861"><a href="#cb43-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-862"><a href="#cb43-862" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-863"><a href="#cb43-863" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-864"><a href="#cb43-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-865"><a href="#cb43-865" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>y<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)                                     <span class="co"># &lt;1&gt;</span></span>
<span id="cb43-866"><a href="#cb43-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-867"><a href="#cb43-867" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diff_e  =</span> e <span class="sc">-</span> <span class="fu">lead</span>(e))    <span class="co"># &lt;2&gt;</span></span>
<span id="cb43-868"><a href="#cb43-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-869"><a href="#cb43-869" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-870"><a href="#cb43-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-871"><a href="#cb43-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-872"><a href="#cb43-872" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>*e* est une indicatrice qui repère l'état 1</span>
<span id="cb43-873"><a href="#cb43-873" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>On fait *redescendre* la valeur de *e* sur la séquence précédente, et on calcule la difference.</span>
<span id="cb43-874"><a href="#cb43-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-875"><a href="#cb43-875" aria-hidden="true" tabindex="-1"></a>Pour chaque dernière séquence la valeur du lag est une valeur manquante.</span>
<span id="cb43-876"><a href="#cb43-876" aria-hidden="true" tabindex="-1"></a>On repère l'évènement avec une valeur de -1 (transition de 0 à 1). On ne peut pas </span>
<span id="cb43-877"><a href="#cb43-877" aria-hidden="true" tabindex="-1"></a>encore filtrer les informations car il va falloir récupérer la fin de la séquence, mais</span>
<span id="cb43-878"><a href="#cb43-878" aria-hidden="true" tabindex="-1"></a>on peut déjà construire l'information. </span>
<span id="cb43-879"><a href="#cb43-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-882"><a href="#cb43-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-883"><a href="#cb43-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-884"><a href="#cb43-884" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-885"><a href="#cb43-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-886"><a href="#cb43-886" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>diff_e<span class="sc">==-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb43-887"><a href="#cb43-887" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>e[<span class="fu">is.na</span>(df<span class="sc">$</span>e)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb43-888"><a href="#cb43-888" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">e  =</span> <span class="fu">sum</span>(e)) </span>
<span id="cb43-889"><a href="#cb43-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-890"><a href="#cb43-890" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-891"><a href="#cb43-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-892"><a href="#cb43-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-893"><a href="#cb43-893" aria-hidden="true" tabindex="-1"></a>**Récupération de l'année final avec succesion d'états de même type**</span>
<span id="cb43-894"><a href="#cb43-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-895"><a href="#cb43-895" aria-hidden="true" tabindex="-1"></a>La difficulté ici est apportée seulement par id=3. Jusqu'à 2025, on a successivement l'état 2 puis 3. Il va donc falloir récupérer cette dernière année de succession de 2 et 3, jusqu'à la censure ou jusqu'à un retour dans l'état 1.</span>
<span id="cb43-896"><a href="#cb43-896" aria-hidden="true" tabindex="-1"></a>S'il n'y avait pas ce genre de situation, l'utilisation de la variable *diff_e* aurait été suffisante pour récupérer l'année de fin lorsqu'on a plusieurs séquences (situations pour id=1,5).</span>
<span id="cb43-897"><a href="#cb43-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-898"><a href="#cb43-898" aria-hidden="true" tabindex="-1"></a>On va de nouveau utiliser un lead, mais sur la variable *e23*.</span>
<span id="cb43-899"><a href="#cb43-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-902"><a href="#cb43-902" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-903"><a href="#cb43-903" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-904"><a href="#cb43-904" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-905"><a href="#cb43-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-906"><a href="#cb43-906" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(nseq, diff_e)) <span class="co"># &lt;1&gt;  </span></span>
<span id="cb43-907"><a href="#cb43-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-908"><a href="#cb43-908" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">lead_e23 =</span> <span class="fu">lead</span>(e23, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="cn">NA</span>))  <span class="co"># &lt;2&gt;</span></span>
<span id="cb43-909"><a href="#cb43-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-910"><a href="#cb43-910" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>idem <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>e23 <span class="sc">==</span> df<span class="sc">$</span>lead_e23, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># &lt;3&gt;</span></span>
<span id="cb43-911"><a href="#cb43-911" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>idem[<span class="fu">is.na</span>(df<span class="sc">$</span>idem)]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb43-912"><a href="#cb43-912" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">idem  =</span> <span class="fu">sum</span>(idem)) <span class="co"># &lt;4&gt; </span></span>
<span id="cb43-913"><a href="#cb43-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-914"><a href="#cb43-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-915"><a href="#cb43-915" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-916"><a href="#cb43-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-917"><a href="#cb43-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-918"><a href="#cb43-918" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>On supprime les colonnes non utilisées pour gagner ici de la lisibilité</span>
<span id="cb43-919"><a href="#cb43-919" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>*lead* sur la variable e23.</span>
<span id="cb43-920"><a href="#cb43-920" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>La variable *idem* permet de repérer une suite d'état 2 et 3. On ne passe pas ici par une variable de différence (le faire par prudence si on le souhaite).</span>
<span id="cb43-921"><a href="#cb43-921" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Ici le total est égal à 1. Si on avait eu une séquence supplémentaire de 3, il serait égal à 2. L'important ici est de repérer la situation, soit 0 ou supérieur à 0.  </span>
<span id="cb43-922"><a href="#cb43-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-923"><a href="#cb43-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-924"><a href="#cb43-924" aria-hidden="true" tabindex="-1"></a>On doit maintenant récupérer la dernière année de fin des situations où idem&gt;0, et la placer</span>
<span id="cb43-925"><a href="#cb43-925" aria-hidden="true" tabindex="-1"></a>sur la première.</span>
<span id="cb43-926"><a href="#cb43-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-929"><a href="#cb43-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-930"><a href="#cb43-930" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-931"><a href="#cb43-931" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-932"><a href="#cb43-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-933"><a href="#cb43-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-934"><a href="#cb43-934" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin[<span class="fu">is.na</span>(df<span class="sc">$</span>fin)] <span class="ot">=</span> <span class="dv">2025</span>                <span class="co"># &lt;1&gt;</span></span>
<span id="cb43-935"><a href="#cb43-935" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lead_e23[<span class="fu">is.na</span>(df<span class="sc">$</span>lead_e23)]   <span class="ot">=</span> <span class="sc">-</span><span class="dv">10</span>     <span class="co"># &lt;2&gt;</span></span>
<span id="cb43-936"><a href="#cb43-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-937"><a href="#cb43-937" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>truefin <span class="ot">=</span> <span class="fu">ifelse</span>((df<span class="sc">$</span>lead_e23 <span class="sc">!=</span> df<span class="sc">$</span>e23) <span class="sc">&amp;</span> df<span class="sc">$</span>idem<span class="sc">&gt;</span><span class="dv">0</span>, df<span class="sc">$</span>fin,<span class="dv">0</span>) <span class="co"># &lt;3&gt;</span></span>
<span id="cb43-938"><a href="#cb43-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-939"><a href="#cb43-939" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">truefin =</span> <span class="fu">sum</span>(truefin))  <span class="co"># &lt;4&gt; </span></span>
<span id="cb43-940"><a href="#cb43-940" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>fin <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>idem<span class="sc">&gt;</span><span class="dv">0</span>, df<span class="sc">$</span>truefin, df<span class="sc">$</span>fin)  <span class="co"># &lt;4&gt;</span></span>
<span id="cb43-941"><a href="#cb43-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-942"><a href="#cb43-942" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(y,e23,lead_e23,idem))</span>
<span id="cb43-943"><a href="#cb43-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-944"><a href="#cb43-944" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-945"><a href="#cb43-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-946"><a href="#cb43-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-947"><a href="#cb43-947" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>On remplace l'année de la censure par sa valeur (important pour id=3).</span>
<span id="cb43-948"><a href="#cb43-948" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Pour régler un problème de gestion des NA avec <span class="in">`ifelse`</span>. A tester avec <span class="in">`if_else`</span> ou <span class="in">`case_when`</span>.</span>
<span id="cb43-949"><a href="#cb43-949" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>On recupère la valeur de l'année de fin lorsqu'il y a une succession d'états de même nature pour l'analyse.</span>
<span id="cb43-950"><a href="#cb43-950" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>on remplace la valeur dans la variable *fin* en cas de succession seulement.</span>
<span id="cb43-951"><a href="#cb43-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-952"><a href="#cb43-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-953"><a href="#cb43-953" aria-hidden="true" tabindex="-1"></a>On peut <span class="co">[</span><span class="ot">enfin</span><span class="co">]</span> sélectionner et conserver une seule ligne par individu et générer la variable de durée</span>
<span id="cb43-954"><a href="#cb43-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-957"><a href="#cb43-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-958"><a href="#cb43-958" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb43-959"><a href="#cb43-959" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code"</span></span>
<span id="cb43-960"><a href="#cb43-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-961"><a href="#cb43-961" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span> <span class="fu">select</span>(df,<span class="sc">-</span>truefin)</span>
<span id="cb43-962"><a href="#cb43-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-963"><a href="#cb43-963" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nn23     =</span> <span class="fu">cumsum</span>(n23)) </span>
<span id="cb43-964"><a href="#cb43-964" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">filter</span>(df, n23<span class="sc">==</span>nn23)</span>
<span id="cb43-965"><a href="#cb43-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-966"><a href="#cb43-966" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>dur<span class="ot">=</span> df<span class="sc">$</span>fin <span class="sc">-</span> df<span class="sc">$</span>deb <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb43-967"><a href="#cb43-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-968"><a href="#cb43-968" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">select</span>(df, <span class="sc">-</span><span class="fu">c</span>(n23,nn23))</span>
<span id="cb43-969"><a href="#cb43-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-970"><a href="#cb43-970" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(df)</span>
<span id="cb43-971"><a href="#cb43-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-972"><a href="#cb43-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>