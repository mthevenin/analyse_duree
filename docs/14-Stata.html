<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction à l’analyse des durées - 15&nbsp; Stata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-R.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./13-R.html">Programmation</a></li><li class="breadcrumb-item"><a href="./14-Stata.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">**Stata**</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction à l’analyse des durées</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mthevenin/analyse_duree" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./introduction_bio_durees.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Présentation - bibliographie - outils</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><strong>L’analyse des durées</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Données et théorie</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><strong>Les Données</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-theorie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><strong>La théorie</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Méthodes non paramétrique</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-fsurvie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Estimations des fonctions de survie</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-fsurvie_comp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><strong>Tests de comparaison</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Modèles à risques proportionnels</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-intro_mod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>Introduction</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-cox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><strong>Le modèle de Cox</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-discret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><strong>Modèle à durée discrète</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-tvc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><strong>Variables dynamiques</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Compléments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-parametrique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><strong>Modèles paramétriques</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-concurrent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><strong>Risques concurrents</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-annexe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><strong>Annexes</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Programmation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><strong>R</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Stata.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><strong>Stata</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#analyse-non-paramétrique" id="toc-analyse-non-paramétrique" class="nav-link active" data-scroll-target="#analyse-non-paramétrique"><span class="header-section-number">15.1</span> Analyse non paramétrique</a>
  <ul class="collapse">
  <li><a href="#méthode-actuarielle" id="toc-méthode-actuarielle" class="nav-link" data-scroll-target="#méthode-actuarielle"><span class="header-section-number">15.1.1</span> Méthode actuarielle</a></li>
  <li><a href="#méthode-kaplan-meier" id="toc-méthode-kaplan-meier" class="nav-link" data-scroll-target="#méthode-kaplan-meier"><span class="header-section-number">15.1.2</span> Méthode Kaplan-Meier</a></li>
  <li><a href="#comparaison-des-fonctions-de-survie-km" id="toc-comparaison-des-fonctions-de-survie-km" class="nav-link" data-scroll-target="#comparaison-des-fonctions-de-survie-km"><span class="header-section-number">15.1.3</span> Comparaison des fonctions de survie (KM)</a></li>
  </ul></li>
  <li><a href="#modèles-à-risques-proportionnels" id="toc-modèles-à-risques-proportionnels" class="nav-link" data-scroll-target="#modèles-à-risques-proportionnels"><span class="header-section-number">15.2</span> Modèles à risques proportionnels</a>
  <ul class="collapse">
  <li><a href="#modèle-de-cox" id="toc-modèle-de-cox" class="nav-link" data-scroll-target="#modèle-de-cox"><span class="header-section-number">15.2.1</span> Modèle de Cox</a></li>
  <li><a href="#modèle-à-temps-discret" id="toc-modèle-à-temps-discret" class="nav-link" data-scroll-target="#modèle-à-temps-discret"><span class="header-section-number">15.2.2</span> Modèle à temps discret</a></li>
  <li><a href="#paramétrisation-avec-durée-discrète" id="toc-paramétrisation-avec-durée-discrète" class="nav-link" data-scroll-target="#paramétrisation-avec-durée-discrète"><span class="header-section-number">15.2.3</span> Paramétrisation avec durée discrète</a></li>
  <li><a href="#modèles-paramétriques" id="toc-modèles-paramétriques" class="nav-link" data-scroll-target="#modèles-paramétriques"><span class="header-section-number">15.2.4</span> Modèles paramétriques</a></li>
  <li><a href="#risques-concurrents" id="toc-risques-concurrents" class="nav-link" data-scroll-target="#risques-concurrents"><span class="header-section-number">15.2.5</span> Risques concurrents</a></li>
  <li><a href="#non-paramétrique-estimation-des-ic" id="toc-non-paramétrique-estimation-des-ic" class="nav-link" data-scroll-target="#non-paramétrique-estimation-des-ic"><span class="header-section-number">15.2.6</span> Non paramétrique: estimation des IC</a></li>
  <li><a href="#modèle-multinomial-à-durée-discrète" id="toc-modèle-multinomial-à-durée-discrète" class="nav-link" data-scroll-target="#modèle-multinomial-à-durée-discrète"><span class="header-section-number">15.2.7</span> Modèle multinomial à durée discrète</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mthevenin/analyse_duree/edit/main/14-Stata.qmd" class="toc-action">Modifier cette page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><strong>Stata</strong></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Le document a été compilé avec le magique kernel jupyter <a href="https://github.com/hugetim/nbstata"><strong>nbstata</strong></a> programmé par <strong>Tim Huegerich</strong>. Comparé à l’ancienne solution <strong>statamarkdown</strong> qui exécutait Stata en mode batch, il n’y a pas photo au niveau du runtime, avec pratiquement aucune latence une fois le noyau chargé (attendre une quinzaine de seconde à la première compilation).</li>
<li>Ce pas à pas Stata n’a pas été inclus à la version PDF du support, les mises en application des formations qui lui sont associé étant maintenant exclusivement réalisées avec R.</li>
</ul>
</div>
</div>
<p>Ouverture de la base</p>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-stdout">
<pre><code>(prefix now "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/
&gt; bases")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(SAVASTATA created this dataset on 01AUG2019)
(prefix now "https://www.stata-press.com/data/r18")

     +------------------------------------------+
     | id   year   age   surgery   stime   died |
     |------------------------------------------|
  1. | 15     68    53         0       1      1 |
  2. | 43     70    43         0       2      1 |
  3. | 61     71    52         0       2      1 |
  4. | 75     72    52         0       2      1 |
  5. |  6     68    54         0       3      1 |
     |------------------------------------------|
  6. | 42     70    36         0       3      1 |
  7. | 54     71    47         0       3      1 |
  8. | 38     70    41         0       5      1 |
  9. | 85     73    47         0       5      1 |
 10. |  2     68    51         0       6      1 |
     +------------------------------------------+</code></pre>
</div>
</div>
<section id="analyse-non-paramétrique" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="analyse-non-paramétrique"><span class="header-section-number">15.1</span> Analyse non paramétrique</h2>
<section id="méthode-actuarielle" class="level3" data-number="15.1.1">
<h3 data-number="15.1.1" class="anchored" data-anchor-id="méthode-actuarielle"><span class="header-section-number">15.1.1</span> Méthode actuarielle</h3>
<p>Contrairement à la formation, l’estimation sera faite sur des intervalles de 30 jours</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ltable</span> stime died, interval(30) <span class="kw">graph</span> <span class="kw">ci</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                 Beg.                                 Std.
   Interval     total   Deaths   Lost   Survival     error     [95% conf. int.]
-------------------------------------------------------------------------------
    0    30       103       22      1     0.7854    0.0406     0.6926    0.8531
   30    60        80       14      2     0.6462    0.0475     0.5449    0.7305
   60    90        64       12      0     0.5250    0.0498     0.4232    0.6171
   90   120        52        5      1     0.4741    0.0499     0.3738    0.5677
  120   150        46        1      1     0.4636    0.0499     0.3637    0.5575
  150   180        44        2      0     0.4426    0.0498     0.3435    0.5369
  180   210        42        3      1     0.4106    0.0495     0.3132    0.5053
  210   240        38        1      0     0.3998    0.0494     0.3030    0.4945
  240   270        37        1      1     0.3888    0.0492     0.2928    0.4836
  270   300        35        2      0     0.3666    0.0488     0.2720    0.4614
  300   330        33        1      0     0.3555    0.0486     0.2618    0.4502
  330   360        32        3      1     0.3216    0.0478     0.2308    0.4157
  360   390        28        0      1     0.3216    0.0478     0.2308    0.4157
  390   420        27        0      1     0.3216    0.0478     0.2308    0.4157
  420   450        26        0      2     0.3216    0.0478     0.2308    0.4157
  480   510        24        0      1     0.3216    0.0478     0.2308    0.4157
  510   540        23        0      1     0.3216    0.0478     0.2308    0.4157
  540   570        22        0      1     0.3216    0.0478     0.2308    0.4157
  570   600        21        1      1     0.3059    0.0479     0.2155    0.4010
  600   630        19        0      1     0.3059    0.0479     0.2155    0.4010
  660   690        18        1      1     0.2885    0.0483     0.1982    0.3849
  720   750        16        1      0     0.2704    0.0485     0.1807    0.3681
  840   870        15        1      1     0.2518    0.0486     0.1629    0.3506
  900   930        13        0      1     0.2518    0.0486     0.1629    0.3506
  930   960        12        0      1     0.2518    0.0486     0.1629    0.3506
  960   990        11        1      0     0.2289    0.0493     0.1404    0.3304
  990  1020        10        1      0     0.2060    0.0494     0.1192    0.3093
 1020  1050         9        1      0     0.1831    0.0489     0.0992    0.2873
 1140  1170         8        0      1     0.1831    0.0489     0.0992    0.2873
 1320  1350         7        0      1     0.1831    0.0489     0.0992    0.2873
 1380  1410         6        1      2     0.1465    0.0510     0.0645    0.2602
 1560  1590         3        0      2     0.1465    0.0510     0.0645    0.2602
 1770  1800         1        0      1     0.1465    0.0510     0.0645    0.2602
-------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="14-Stata_files/figure-html/cell-3-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="14-Stata_files/figure-html/cell-3-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Récupération des quartiles de la durée</strong></p>
<p>Installation de la commande <code>qlt</code></p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>net install qlt, from(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/ado/qlt/"</span>) <span class="kw">replace</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>* <span class="kw">help</span> qlt</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">ltable</span> stime died, interval(30) <span class="kw">saving</span>(base, <span class="kw">replace</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> base, <span class="kw">clear</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(SAVASTATA created this dataset on 01AUG2019)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>qlt</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duree pour differents quantiles de la fonction de survie
Definition des bornes Stata-ltable
S(t)=0.90: t=        .
S(t)=0.75: t=    7.623
S(t)=0.50: t=   74.729
S(t)=0.25: t=  849.325
S(t)=0.10: t=        .</code></pre>
</div>
</div>
<p>Avec la définition des bornes des intervalles de Sas</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>qlt, sas</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duree pour differents quantiles de la fonction de survie
Definition des bornes Sas-lifetest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>S(t)=0.90: t=   13.977</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>S(t)=0.75: t=   37.623
S(t)=0.50: t=  104.729
S(t)=0.25: t=  906.993
S(t)=0.10: t=        .</code></pre>
</div>
</div>
</section>
<section id="méthode-kaplan-meier" class="level3" data-number="15.1.2">
<h3 data-number="15.1.2" class="anchored" data-anchor-id="méthode-kaplan-meier"><span class="header-section-number">15.1.2</span> Méthode Kaplan-Meier</h3>
<p><strong>Mode analyse des durées: stset</strong></p>
<p>Les données doivent être mises en mode analyse de durée avec la commande <code>stset</code> (<code>help stset</code>).</p>
<p>A minima la commande <code>stset</code> entre la variable de durée en argument principal et la variable de censure/évènement avec <code>failure(nom_var)</code> en option.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stset</span> stime, f(died)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> id stime died _st _d _t _t0 <span class="kw">in</span> 1/10</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Survival-time data settings

         Failure event: died!=0 &amp; died&lt;.
Observed time interval: (0, stime]
     Exit on or before: failure

--------------------------------------------------------------------------
        103  total observations
          0  exclusions
--------------------------------------------------------------------------
        103  observations remaining, representing
         75  failures in single-record/single-failure data
     31,938  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     1,799

     +-----------------------------------------+
     | id   stime   died   _st   _d   _t   _t0 |
     |-----------------------------------------|
  1. | 15       1      1     1    1    1     0 |
  2. | 43       2      1     1    1    2     0 |
  3. | 61       2      1     1    1    2     0 |
  4. | 75       2      1     1    1    2     0 |
  5. |  6       3      1     1    1    3     0 |
     |-----------------------------------------|
  6. | 42       3      1     1    1    3     0 |
  7. | 54       3      1     1    1    3     0 |
  8. | 38       5      1     1    1    5     0 |
  9. | 85       5      1     1    1    5     0 |
 10. |  2       6      1     1    1    6     0 |
     +-----------------------------------------+</code></pre>
</div>
</div>
<p><strong>Estimation de la fonction de survie</strong></p>
<p>La commande <code>sts list</code> permet d’afficher le tableau des estimations à chaque moment d’évènement</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le tableau des estimateurs n’est reporté que pour le format htl du support</p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sts</span> <span class="ot">list</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime

Kaplan–Meier survivor function

             At                  Survivor      Std.
  Time     risk   Fail   Lost    function     error     [95% conf. int.]
------------------------------------------------------------------------
     1      103      1      0      0.9903    0.0097     0.9331    0.9986
     2      102      3      0      0.9612    0.0190     0.8998    0.9852
     3       99      3      0      0.9320    0.0248     0.8627    0.9670
     5       96      2      0      0.9126    0.0278     0.8388    0.9535
     6       94      2      0      0.8932    0.0304     0.8155    0.9394
     8       92      1      0      0.8835    0.0316     0.8040    0.9321
     9       91      1      0      0.8738    0.0327     0.7926    0.9247
    11       90      0      1      0.8738    0.0327     0.7926    0.9247
    12       89      1      0      0.8640    0.0338     0.7811    0.9171
    16       88      3      0      0.8345    0.0367     0.7474    0.8937
    17       85      1      0      0.8247    0.0375     0.7363    0.8857
    18       84      1      0      0.8149    0.0383     0.7253    0.8777
    21       83      2      0      0.7952    0.0399     0.7034    0.8614
    28       81      1      0      0.7854    0.0406     0.6926    0.8531</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    30       80      1      0      0.7756    0.0412     0.6819    0.8448
    31       79      0      1      0.7756    0.0412     0.6819    0.8448
    32       78      1      0      0.7657    0.0419     0.6710    0.8363
    35       77      1      0      0.7557    0.0425     0.6603    0.8278
    36       76      1      0      0.7458    0.0431     0.6495    0.8192
    37       75      1      0      0.7358    0.0436     0.6388    0.8106
    39       74      1      1      0.7259    0.0442     0.6282    0.8019
    40       72      2      0      0.7057    0.0452     0.6068    0.7842
    43       70      1      0      0.6956    0.0457     0.5961    0.7752
    45       69      1      0      0.6856    0.0461     0.5855    0.7662
    50       68      1      0      0.6755    0.0465     0.5750    0.7572
    51       67      1      0      0.6654    0.0469     0.5645    0.7481
    53       66      1      0      0.6553    0.0472     0.5541    0.7390
    58       65      1      0      0.6452    0.0476     0.5437    0.7298
    61       64      1      0      0.6352    0.0479     0.5333    0.7206
    66       63      1      0      0.6251    0.0482     0.5230    0.7113
    68       62      2      0      0.6049    0.0487     0.5026    0.6926
    69       60      1      0      0.5948    0.0489     0.4924    0.6832
    72       59      2      0      0.5747    0.0493     0.4722    0.6643
    77       57      1      0      0.5646    0.0494     0.4621    0.6548
    78       56      1      0      0.5545    0.0496     0.4521    0.6453
    80       55      1      0      0.5444    0.0497     0.4422    0.6357
    81       54      1      0      0.5343    0.0498     0.4323    0.6261
    85       53      1      0      0.5243    0.0499     0.4224    0.6164
    90       52      1      0      0.5142    0.0499     0.4125    0.6067
    96       51      1      0      0.5041    0.0499     0.4027    0.5969
   100       50      1      0      0.4940    0.0499     0.3930    0.5872
   102       49      1      0      0.4839    0.0499     0.3833    0.5773
   109       48      0      1      0.4839    0.0499     0.3833    0.5773
   110       47      1      0      0.4736    0.0499     0.3733    0.5673
   131       46      0      1      0.4736    0.0499     0.3733    0.5673
   149       45      1      0      0.4631    0.0499     0.3632    0.5571
   153       44      1      0      0.4526    0.0499     0.3531    0.5468
   165       43      1      0      0.4421    0.0498     0.3430    0.5364
   180       42      0      1      0.4421    0.0498     0.3430    0.5364
   186       41      1      0      0.4313    0.0497     0.3327    0.5258
   188       40      1      0      0.4205    0.0497     0.3225    0.5152
   207       39      1      0      0.4097    0.0495     0.3123    0.5045
   219       38      1      0      0.3989    0.0494     0.3022    0.4938
   263       37      1      0      0.3881    0.0492     0.2921    0.4830
   265       36      0      1      0.3881    0.0492     0.2921    0.4830
   285       35      2      0      0.3660    0.0488     0.2714    0.4608
   308       33      1      0      0.3549    0.0486     0.2612    0.4496
   334       32      1      0      0.3438    0.0483     0.2510    0.4383
   340       31      1      1      0.3327    0.0480     0.2409    0.4270
   342       29      1      0      0.3212    0.0477     0.2305    0.4153
   370       28      0      1      0.3212    0.0477     0.2305    0.4153
   397       27      0      1      0.3212    0.0477     0.2305    0.4153
   427       26      0      1      0.3212    0.0477     0.2305    0.4153
   445       25      0      1      0.3212    0.0477     0.2305    0.4153
   482       24      0      1      0.3212    0.0477     0.2305    0.4153
   515       23      0      1      0.3212    0.0477     0.2305    0.4153
   545       22      0      1      0.3212    0.0477     0.2305    0.4153
   583       21      1      0      0.3059    0.0478     0.2156    0.4008
   596       20      0      1      0.3059    0.0478     0.2156    0.4008
   620       19      0      1      0.3059    0.0478     0.2156    0.4008
   670       18      0      1      0.3059    0.0478     0.2156    0.4008
   675       17      1      0      0.2879    0.0483     0.1976    0.3844
   733       16      1      0      0.2699    0.0485     0.1802    0.3676
   841       15      0      1      0.2699    0.0485     0.1802    0.3676
   852       14      1      0      0.2507    0.0487     0.1616    0.3497
   915       13      0      1      0.2507    0.0487     0.1616    0.3497
   941       12      0      1      0.2507    0.0487     0.1616    0.3497
   979       11      1      0      0.2279    0.0493     0.1394    0.3295
   995       10      1      0      0.2051    0.0494     0.1183    0.3085
  1032        9      1      0      0.1823    0.0489     0.0985    0.2865
  1141        8      0      1      0.1823    0.0489     0.0985    0.2865
  1321        7      0      1      0.1823    0.0489     0.0985    0.2865
  1386        6      1      0      0.1519    0.0493     0.0713    0.2606
  1400        5      0      1      0.1519    0.0493     0.0713    0.2606
  1407        4      0      1      0.1519    0.0493     0.0713    0.2606
  1571        3      0      1      0.1519    0.0493     0.0713    0.2606
  1586        2      0      1      0.1519    0.0493     0.0713    0.2606
  1799        1      0      1      0.1519    0.0493     0.0713    0.2606
------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>On récupére les quantiles de la durée avec <code>stci</code>. Par défaut la commande affiche la durée médiane. On peut choisir le quantile avec l’arguement p(valeur) en option</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stci</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">stci</span>, <span class="kw">p</span>(75)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">stci</span>, <span class="kw">p</span>(25)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime

             | Number of 
             |  subjects         50%      Std. err.    [95% conf. interval]
-------------+-------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Total |       103         100      38.64425           69        219

        Failure _d: died
  Analysis time _t: stime

             | Number of 
             |  subjects         75%      Std. err.    [95% conf. interval]
-------------+-------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Total |       103         979      144.4728          340          .</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime

             | Number of 
             |  subjects         25%      Std. err.    [95% conf. interval]
-------------+-------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Total |       103          36      9.033439           16         51</code></pre>
</div>
</div>
<p>Pour afficher le graphique des estimateurs KM, on utilise la commande <strong><code>sts graph</code></strong>. On ajoute ici l’affichage des intervalles de confiance avec l’option <code>ci</code></p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sts</span> <span class="kw">graph</span>, <span class="kw">ci</span> </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="14-Stata_files/figure-html/cell-12-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="14-Stata_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Les commandes <code>sts list</code>, <code>stci</code> et <code>sts graph</code> permettent avec l’option <code>by(nom_variable)</code> d’obtenir des comparaisons entre groupes.</p>
</section>
<section id="comparaison-des-fonctions-de-survie-km" class="level3" data-number="15.1.3">
<h3 data-number="15.1.3" class="anchored" data-anchor-id="comparaison-des-fonctions-de-survie-km"><span class="header-section-number">15.1.3</span> Comparaison des fonctions de survie (KM)</h3>
<p>On va comparer les fonctions de survie pour la variable <em>surgery</em>.</p>
<p><strong>Graphique</strong></p>
<p>On ajoute l’option <code>by(surgery)</code> à la commande <code>sts graph</code></p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sts</span> <span class="kw">graph</span>, <span class="kw">by</span>(surgery) <span class="kw">ci</span> <span class="bn">legend</span>(pos(6))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="14-Stata_files/figure-html/cell-13-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="14-Stata_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Tests du logrank</strong></p>
<p>Fonction <strong><code>sts test</code></strong>. On affichera ici plusieurs variantes du test.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">test</span> <span class="st">`"</span> <span class="st">"l"</span> <span class="st">"w"</span> <span class="st">"tw"</span> <span class="st">"p"</span> <span class="st">"'</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="st">foreach test2 of local test {</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="st">sts test surgery, `test2'</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime

Equality of survivor functions
Log-rank test

        |  Observed       Expected
surgery |    events         events
--------+-------------------------
      0 |        69          60.34
      1 |         6          14.66
--------+-------------------------
  Total |        75          75.00

                  chi2(1) =   6.59
                  Pr&gt;chi2 = 0.0103

        Failure _d: died
  Analysis time _t: stime

Equality of survivor functions
Wilcoxon–Breslow–Gehan test

        |  Observed       Expected       Sum of
surgery |    events         events        ranks
--------+--------------------------------------
      0 |        69          60.34          623
      1 |         6          14.66         -623
--------+--------------------------------------
  Total |        75          75.00            0

                               chi2(1) =   8.99
                               Pr&gt;chi2 = 0.0027

        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Equality of survivor functions
Tarone–Ware test

        |  Observed       Expected       Sum of
surgery |    events         events        ranks
--------+--------------------------------------
      0 |        69          60.34    73.105398
      1 |         6          14.66   -73.105398
--------+--------------------------------------
  Total |        75          75.00            0

                               chi2(1) =   8.46
                               Pr&gt;chi2 = 0.0036

        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Equality of survivor functions
Peto–Peto–Prentice test

        |  Observed       Expected       Sum of
surgery |    events         events        ranks
--------+--------------------------------------
      0 |        69          60.34    6.0505875
      1 |         6          14.66   -6.0505875
--------+--------------------------------------
  Total |        75          75.00            0

                               chi2(1) =   8.66
                               Pr&gt;chi2 = 0.0032</code></pre>
</div>
</div>
<p><em>Comparaison des rmst</em></p>
<p>Installation de la commande <strong><code>strmst2</code></strong></p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install strmst2</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Comparaison deux à deux (c’est pas plus mal comme cela). Je conseille de mettre les variables sous forme d’indicatrice.</li>
<li>Les labels de la variable ne sont jamais reportés. Ils sont remplacés par les modalités arm0 et arm1.</li>
<li>On peut changer la valeurs maximale de la durée avec l’option <code>tau(valeur)</code>.</li>
</ul>
<p>arm1 = Opération<br>
arm0 = pas d’opération</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>strmst2 surgery</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
Number of observations for analysis = 103
 
The truncation time, tau, was not specified. Thus, the default tau (the minimum
&gt;  of the
largest observed event time within each group), 995.000, is used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Restricted Mean Survival Time (RMST) by arm
-----------------------------------------------------------
   Group |  Estimate    Std. Err.      [95% Conf. Interval]
---------+-------------------------------------------------
   arm 1 |   734.758     104.187      530.554      938.961
   arm 0 |   310.168      42.481      226.907      393.429
-----------------------------------------------------------

Between-group contrast (arm 1 versus arm 0) 
------------------------------------------------------------------------
           Contrast  |  Estimate       [95% Conf. Interval]     P&gt;|z|
---------------------+--------------------------------------------------
RMST (arm 1 - arm 0) |   424.590      204.064      645.115      0.000
RMST (arm 1 / arm 0) |     2.369        1.610        3.486      0.000
------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
</section>
<section id="modèles-à-risques-proportionnels" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="modèles-à-risques-proportionnels"><span class="header-section-number">15.2</span> Modèles à risques proportionnels</h2>
<section id="modèle-de-cox" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="modèle-de-cox"><span class="header-section-number">15.2.1</span> Modèle de Cox</h3>
<section id="estimation-du-modèle" class="level4" data-number="15.2.1.1">
<h4 data-number="15.2.1.1" class="anchored" data-anchor-id="estimation-du-modèle"><span class="header-section-number">15.2.1.1</span> Estimation du modèle</h4>
<p>Commande <strong><code>stcox</code></strong></p>
<p>Avec la correction d’Efron (conseillé)</p>
<p><strong>HR</strong>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stcox</span> <span class="fu">year</span> age surgery, <span class="kw">nolog</span> noshow efron</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cox regression with Efron method for ties

No. of subjects =    103                                Number of obs =    103
No. of failures =     75
Time at risk    = 31,938
                                                        LR chi2(3)    =  17.63
Log likelihood = -289.30639                             Prob &gt; chi2   = 0.0005
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |      0.887      0.060    -1.78   0.076        0.778       1.012
         age |      1.030      0.014     2.19   0.029        1.003       1.058
     surgery |      0.373      0.163    -2.26   0.024        0.158       0.876
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p><strong>log(HR)</strong>:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stcox</span> <span class="fu">year</span> age surgery, <span class="kw">nolog</span> noshow efron nohr</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cox regression with Efron method for ties

No. of subjects =    103                                Number of obs =    103
No. of failures =     75
Time at risk    = 31,938
                                                        LR chi2(3)    =  17.63
Log likelihood = -289.30639                             Prob &gt; chi2   = 0.0005

------------------------------------------------------------------------------
          _t | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |     -0.120      0.067    -1.78   0.076       -0.252       0.012
         age |      0.030      0.014     2.19   0.029        0.003       0.056
     surgery |     -0.987      0.436    -2.26   0.024       -1.842      -0.132
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="test-de-lhypothèse-ph" class="level4" data-number="15.2.1.2">
<h4 data-number="15.2.1.2" class="anchored" data-anchor-id="test-de-lhypothèse-ph"><span class="header-section-number">15.2.1.2</span> Test de l’hypothèse PH</h4>
<p><strong>Test Grambsch-Therneau sur les résidus de Schoenfeld</strong></p>
<p>Le test OLS est exécuté avec la commande <strong><code>estat phtest</code></strong>. Je conseille d’ajouté l’option detail pour récupéré les test à un degré de liberté, le test omnibus n’étant pas fiable.</p>
<p>Par défaut <span class="math inline">\(f(t)=t\)</span>.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>* f(t)=t - par défaut </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> phtest, <span class="kw">detail</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>* f(t)= 1-km - solution par défaut <span class="kw">de</span> R</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> phtest, <span class="kw">detail</span> km</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Test of proportional-hazards assumption

Time function: Analysis time
--------------------------------------------------------
             |        rho     chi2       df    Prob&gt;chi2
-------------+------------------------------------------
        year |    0.10162     0.80        1       0.3720
         age |    0.12937     1.61        1       0.2043
     surgery |    0.29664     5.54        1       0.0186
-------------+------------------------------------------
 Global test |                8.76        3       0.0327
--------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Test of proportional-hazards assumption

Time function: 1 - Kaplan–Meier estimate
--------------------------------------------------------
             |        rho     chi2       df    Prob&gt;chi2
-------------+------------------------------------------
        year |    0.15920     1.96        1       0.1620
         age |    0.10907     1.15        1       0.2845
     surgery |    0.25096     3.96        1       0.0465
-------------+------------------------------------------
 Global test |                7.99        3       0.0462
--------------------------------------------------------</code></pre>
</div>
</div>
<p><strong>Intéraction avec une fonction de la durée</strong></p>
<p>Avec <span class="math inline">\(f(t)=t\)</span></p>
<p>L’intéraction s’ajoute directement en option en indiquant la ou les variables concernées (une seule de préférence) avec l’option <code>tvc(nom_variable)</code> et la transformation de la durée (variable <em>t</em>) avec l’option <code>texp(expression)</code>. Ici on a choisi <span class="math inline">\(ft(t)\)</span> soit l’expression dans l’option <code>texp(_t)</code></p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stcox</span> <span class="fu">year</span> age surgery, <span class="kw">nolog</span> noshow efron nohr tvc(surgery) texp(_t)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cox regression with Efron method for ties

No. of subjects =    103                                Number of obs =    103
No. of failures =     75
Time at risk    = 31,938
                                                        LR chi2(4)    =  21.58
Log likelihood = -287.32903                             Prob &gt; chi2   = 0.0002

------------------------------------------------------------------------------
          _t | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
main         |
        year |     -0.123      0.067    -1.84   0.066       -0.254       0.008
         age |      0.029      0.013     2.15   0.032        0.003       0.055
     surgery |     -1.755      0.674    -2.60   0.009       -3.077      -0.433
-------------+----------------------------------------------------------------
tvc          |
     surgery |      0.002      0.001     2.02   0.043        0.000       0.004
------------------------------------------------------------------------------
Note: Variables in tvc equation interacted with _t.</code></pre>
</div>
</div>
</section>
<section id="introduction-dune-variable-dynamique-binaire" class="level4" data-number="15.2.1.3">
<h4 data-number="15.2.1.3" class="anchored" data-anchor-id="introduction-dune-variable-dynamique-binaire"><span class="header-section-number">15.2.1.3</span> Introduction d’une variable dynamique (binaire)</h4>
<p><strong>Transformation de la base en format long aux temps d’évènement</strong></p>
<p><em>Etape 1</em></p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stset</span> stime, f(died) id(id)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Survival-time data settings

           ID variable: id
         Failure event: died!=0 &amp; died&lt;.
Observed time interval: (stime[_n-1], stime]
     Exit on or before: failure

--------------------------------------------------------------------------
        103  total observations
          0  exclusions
--------------------------------------------------------------------------
        103  observations remaining, representing
        103  subjects
         75  failures in single-failure-per-subject data
     31,938  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     1,799</code></pre>
</div>
</div>
<p><em>Etape 2</em></p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stsplit</span>, <span class="fu">at</span>(failure)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">stset</span> stime, f(died) id(id)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(62 failure times)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(3,470 observations (episodes) created)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Survival-time data settings

           ID variable: id
         Failure event: died!=0 &amp; died&lt;.
Observed time interval: (stime[_n-1], stime]
     Exit on or before: failure

--------------------------------------------------------------------------
      3,573  total observations
          0  exclusions
--------------------------------------------------------------------------
      3,573  observations remaining, representing
        103  subjects
         75  failures in single-failure-per-subject data
     31,938  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     1,799</code></pre>
</div>
</div>
<p><em>Etape 3</em></p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> tvc = transplant==1 &amp; wait&lt;=_t</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> id _t</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> id transplant wait tvc _d _t _t0 <span class="kw">if</span> id==10  , <span class="kw">noobs</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  +--------------------------------------------+
  | id   transp~t   wait   tvc   _d   _t   _t0 |
  |--------------------------------------------|
  | 10          1     12     0    0    1     0 |
  | 10          1     12     0    0    2     1 |
  | 10          1     12     0    0    3     2 |
  | 10          1     12     0    0    5     3 |
  | 10          1     12     0    0    6     5 |
  |--------------------------------------------|
  | 10          1     12     0    0    8     6 |
  | 10          1     12     0    0    9     8 |
  | 10          1     12     1    0   12     9 |
  | 10          1     12     1    0   16    12 |
  | 10          1     12     1    0   17    16 |
  |--------------------------------------------|
  | 10          1     12     1    0   18    17 |
  | 10          1     12     1    0   21    18 |
  | 10          1     12     1    0   28    21 |
  | 10          1     12     1    0   30    28 |
  | 10          1     12     1    0   32    30 |
  |--------------------------------------------|
  | 10          1     12     1    0   35    32 |
  | 10          1     12     1    0   36    35 |
  | 10          1     12     1    0   37    36 |
  | 10          1     12     1    0   39    37 |
  | 10          1     12     1    0   40    39 |
  |--------------------------------------------|
  | 10          1     12     1    0   43    40 |
  | 10          1     12     1    0   45    43 |
  | 10          1     12     1    0   50    45 |
  | 10          1     12     1    0   51    50 |
  | 10          1     12     1    0   53    51 |
  |--------------------------------------------|
  | 10          1     12     1    1   58    53 |
  +--------------------------------------------+</code></pre>
</div>
</div>
<p><strong>Estimation du modèle</strong></p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stcox</span> <span class="fu">year</span> age surgery tvc, <span class="kw">nolog</span> noshow efron nohr</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cox regression with Efron method for ties

No. of subjects =    103                                Number of obs =  3,573
No. of failures =     75
Time at risk    = 31,938
                                                        LR chi2(4)    =  17.70
Log likelihood = -289.27014                             Prob &gt; chi2   = 0.0014

------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          _t | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |     -0.120      0.067    -1.79   0.074       -0.252       0.012
         age |      0.030      0.014     2.19   0.029        0.003       0.058
     surgery |     -0.983      0.437    -2.25   0.024       -1.839      -0.127
         tvc |     -0.082      0.305    -0.27   0.787       -0.680       0.515
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
</section>
<section id="modèle-à-temps-discret" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="modèle-à-temps-discret"><span class="header-section-number">15.2.2</span> Modèle à temps discret</h3>
<p>Variable de durée = <em>mois</em></p>
<section id="mise-en-forme-de-la-base" class="level4" data-number="15.2.2.1">
<h4 data-number="15.2.2.1" class="anchored" data-anchor-id="mise-en-forme-de-la-base"><span class="header-section-number">15.2.2.1</span> Mise en forme de la base</h4>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>expand mois</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> id: <span class="kw">gen</span> t=<span class="dt">_n</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = died</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> <span class="fu">e</span>=0 <span class="kw">if</span> t&lt;mois</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> id <span class="fu">year</span> age surgery mois t <span class="fu">e</span>  <span class="kw">in</span> 1/31</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1,024 observations created)
(399 real changes made)

     +-------------------------------------------+
     | id   year   age   surgery   mois    t   e |
     |-------------------------------------------|
  1. |  1     67    30         0      2    1   0 |
  2. |  1     67    30         0      2    2   1 |
  3. |  2     68    51         0      1    1   1 |
  4. |  3     68    54         0      1    1   1 |
  5. |  4     68    40         0      2    1   0 |
     |-------------------------------------------|
  6. |  4     68    40         0      2    2   1 |
  7. |  5     68    20         0      1    1   1 |
  8. |  6     68    54         0      1    1   1 |
  9. |  7     68    50         0     23    1   0 |
 10. |  7     68    50         0     23    2   0 |
     |-------------------------------------------|
 11. |  7     68    50         0     23    3   0 |
 12. |  7     68    50         0     23    4   0 |
 13. |  7     68    50         0     23    5   0 |
 14. |  7     68    50         0     23    6   0 |
 15. |  7     68    50         0     23    7   0 |
     |-------------------------------------------|
 16. |  7     68    50         0     23    8   0 |
 17. |  7     68    50         0     23    9   0 |
 18. |  7     68    50         0     23   10   0 |
 19. |  7     68    50         0     23   11   0 |
 20. |  7     68    50         0     23   12   0 |
     |-------------------------------------------|
 21. |  7     68    50         0     23   13   0 |
 22. |  7     68    50         0     23   14   0 |
 23. |  7     68    50         0     23   15   0 |
 24. |  7     68    50         0     23   16   0 |
 25. |  7     68    50         0     23   17   0 |
     |-------------------------------------------|
 26. |  7     68    50         0     23   18   0 |
 27. |  7     68    50         0     23   19   0 |
 28. |  7     68    50         0     23   20   0 |
 29. |  7     68    50         0     23   21   0 |
 30. |  7     68    50         0     23   22   0 |
     |-------------------------------------------|
 31. |  7     68    50         0     23   23   1 |
     +-------------------------------------------+</code></pre>
</div>
</div>
</section>
<section id="paramétrisation-avec-durée-quantitative" class="level4" data-number="15.2.2.2">
<h4 data-number="15.2.2.2" class="anchored" data-anchor-id="paramétrisation-avec-durée-quantitative"><span class="header-section-number">15.2.2.2</span> Paramétrisation avec durée quantitative</h4>
<p>Les critères d’information</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> t2=t^2</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> t3=t^3</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">logit</span> <span class="fu">e</span>  t ,  <span class="kw">nolog</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">ic</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">logit</span> <span class="fu">e</span>  t t2 ,  <span class="kw">nolog</span> </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">ic</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">logit</span> <span class="fu">e</span>  t2 t3 ,  <span class="kw">nolog</span> </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> <span class="kw">ic</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      1,127  -275.6841  -250.2606       2   504.5212   514.5758
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      1,127  -275.6841  -243.0576       3   492.1152   507.1972
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      1,127  -275.6841  -254.3782       3   514.7563   529.8383
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
</div>
<p><strong>Estimation du modèle</strong></p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> <span class="fu">year</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">gen</span> year2 = <span class="fu">year</span> - <span class="ot">`r(mean)'</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> age</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">gen</span> age2 = age - <span class="ot">`r(mean)'</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> <span class="fu">e</span> t t2 t3 year2 age2 surgery, <span class="kw">nolog</span> <span class="kw">or</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Logistic regression                                     Number of obs =  1,127
                                                        LR chi2(6)    =  90.69
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -230.33671                             Pseudo R2     = 0.1645

------------------------------------------------------------------------------
           e | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           t |      0.689      0.057    -4.52   0.000        0.587       0.810
          t2 |      1.014      0.005     2.83   0.005        1.004       1.024
          t3 |      1.000      0.000    -2.11   0.035        1.000       1.000
       year2 |      0.876      0.065    -1.80   0.072        0.758       1.012
        age2 |      1.034      0.015     2.27   0.023        1.005       1.064
     surgery |      0.364      0.163    -2.25   0.024        0.151       0.877
       _cons |      0.440      0.110    -3.29   0.001        0.270       0.718</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
Note: _cons estimates baseline odds.</code></pre>
</div>
</div>
</section>
</section>
<section id="paramétrisation-avec-durée-discrète" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="paramétrisation-avec-durée-discrète"><span class="header-section-number">15.2.3</span> Paramétrisation avec durée discrète</h3>
<p>Pour l’exemple seulement, on procède à un regroupement des intervalles découpés sur les quartiles de la durée</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">xtile</span> ct4=t, n(4)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> id ct4: <span class="kw">keep</span> <span class="kw">if</span> <span class="dt">_n</span>==_N</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span>  ct4 <span class="fu">e</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(930 observations deleted)

         4 |
 quantiles |           e
      of t |         0          1 |     Total
-----------+----------------------+----------
         1 |        50         53 |       103 
         2 |        35         11 |        46 
         3 |        27          5 |        32 
         4 |        10          6 |        16 
-----------+----------------------+----------
     Total |       122         75 |       197 </code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> <span class="fu">e</span> i.ct4  <span class="fu">year</span> age surgery,  <span class="kw">nolog</span> <span class="kw">or</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Logistic regression                                     Number of obs =    197
                                                        LR chi2(6)    =  39.30
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -111.23965                             Pseudo R2     = 0.1501
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
           e | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         ct4 |
          1  |      1.000  (base)
          2  |      0.356      0.149    -2.47   0.014        0.157       0.809
          3  |      0.199      0.108    -2.96   0.003        0.068       0.578
          4  |      0.619      0.371    -0.80   0.424        0.191       2.005
             |
        year |      0.816      0.076    -2.18   0.029        0.680       0.980
         age |      1.048      0.019     2.53   0.011        1.011       1.087
     surgery |      0.330      0.166    -2.21   0.027        0.123       0.882
       _cons |   2.54e+05   1.69e+06     1.87   0.061        0.552    1.17e+11
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.</code></pre>
</div>
</div>
</section>
<section id="modèles-paramétriques" class="level3" data-number="15.2.4">
<h3 data-number="15.2.4" class="anchored" data-anchor-id="modèles-paramétriques"><span class="header-section-number">15.2.4</span> Modèles paramétriques</h3>
<p>Juste un exemple pour le modèle de <strong>weibull</strong></p>
<p>Commande <strong><code>streg</code></strong></p>
<p>Par défaut, le modèle de Weibull est exécuté sous paramétrisation PH. Pour une paramétrisation type AFT, ajouter l’option <em>time</em>.</p>
<p><strong>PH</strong>: défaut</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>*<span class="kw">qui</span> <span class="kw">stset</span> stime, f(died) <span class="co">// penser à mettre la base en mode analyse de durée</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">streg</span> <span class="fu">year</span> age surgery , dist(<span class="kw">weibull</span>) <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |      0.914      0.061    -1.36   0.175        0.802       1.041
         age |      1.035      0.014     2.47   0.014        1.007       1.063
     surgery |      0.334      0.145    -2.52   0.012        0.143       0.783
       _cons |      5.368     25.895     0.35   0.728        0.000   68506.303
-------------+----------------------------------------------------------------
       /ln_p |     -0.587      0.093    -6.33   0.000       -0.769      -0.405
-------------+----------------------------------------------------------------
           p |      0.556      0.052                         0.464       0.667
         1/p |      1.798      0.167                         1.499       2.157
------------------------------------------------------------------------------
Note: _cons estimates baseline hazard.</code></pre>
</div>
</div>
<p><strong>AFT</strong></p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">streg</span> <span class="fu">year</span> age surgery , dist(<span class="kw">weibull</span>) time <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        Failure _d: died
  Analysis time _t: stime</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
          _t | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |      0.162      0.122     1.33   0.184       -0.077       0.401
         age |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     -0.062      0.025    -2.49   0.013       -0.110      -0.013
     surgery |      1.970      0.779     2.53   0.011        0.443       3.498
       _cons |     -3.022      8.728    -0.35   0.729      -20.129      14.085
-------------+----------------------------------------------------------------
       /ln_p |     -0.587      0.093    -6.33   0.000       -0.769      -0.405
-------------+----------------------------------------------------------------
           p |      0.556      0.052                         0.464       0.667
         1/p |      1.798      0.167                         1.499       2.157
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="risques-concurrents" class="level3" data-number="15.2.5">
<h3 data-number="15.2.5" class="anchored" data-anchor-id="risques-concurrents"><span class="header-section-number">15.2.5</span> Risques concurrents</h3>
</section>
<section id="non-paramétrique-estimation-des-ic" class="level3" data-number="15.2.6">
<h3 data-number="15.2.6" class="anchored" data-anchor-id="non-paramétrique-estimation-des-ic"><span class="header-section-number">15.2.6</span> Non paramétrique: estimation des IC</h3>
<p>Installer les commandes <code>stcompet</code> et <code>stcomlist</code></p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install stcompet</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install stcomlist</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le risque d’intérêt est compet=1, le risque concurrent est compet=2. La commande externe <strong><code>stcompet</code></strong> permet d’estimer les CIF mais ne propose pas d’output des estimateurs <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. On utilise alors la commande <strong><code>stcomlist</code></strong> en précisant le ou les risques concurrent (ici compet=2)</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">stset</span> stime, failure(compet==1)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>stcomlist, compet1(2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Survival-time data settings

         Failure event: compet==1
Observed time interval: (0, stime]
     Exit on or before: failure

--------------------------------------------------------------------------
        103  total observations
          0  exclusions
--------------------------------------------------------------------------
        103  observations remaining, representing
         56  failures in single-record/single-failure data
     31,938  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =     1,799</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
            failure:  compet == 1
 competing failures:  compet == 2

    Time       CIF         SE     [95% Conf. Int.]
--------------------------------------------------
       1    0.0097     0.0097     0.0009    0.0477
       2    0.0388     0.0190     0.0127    0.0892
       3    0.0583     0.0231     0.0239    0.1149
       5    0.0777     0.0264     0.0363    0.1395
       6    0.0874     0.0278     0.0429    0.1515
       8    0.0971     0.0292     0.0497    0.1634
       9    0.1068     0.0304     0.0566    0.1751</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      12    0.1166     0.0316     0.0638    0.1868
      16    0.1362     0.0338     0.0785    0.2099
      18    0.1461     0.0349     0.0860    0.2212
      21    0.1657     0.0367     0.1014    0.2437
      32    0.1756     0.0376     0.1093    0.2550
      37    0.1856     0.0384     0.1173    0.2662
      40    0.1957     0.0393     0.1254    0.2775
      43    0.2058     0.0400     0.1337    0.2888
      45    0.2158     0.0408     0.1420    0.2999
      50    0.2259     0.0415     0.1503    0.3110
      51    0.2360     0.0422     0.1588    0.3221
      53    0.2461     0.0428     0.1673    0.3330
      58    0.2562     0.0434     0.1759    0.3439
      61    0.2662     0.0440     0.1845    0.3548
      66    0.2763     0.0445     0.1932    0.3656
      69    0.2864     0.0450     0.2020    0.3763
      72    0.3066     0.0459     0.2197    0.3976
      77    0.3167     0.0464     0.2286    0.4082
      78    0.3267     0.0467     0.2376    0.4187
      81    0.3368     0.0471     0.2466    0.4292
      85    0.3469     0.0475     0.2556    0.4396
      90    0.3570     0.0478     0.2648    0.4500
      96    0.3671     0.0481     0.2739    0.4604
     102    0.3771     0.0484     0.2831    0.4707
     110    0.3874     0.0487     0.2925    0.4812
     149    0.3980     0.0489     0.3021    0.4920
     165    0.4085     0.0492     0.3118    0.5027
     186    0.4193     0.0495     0.3217    0.5137
     188    0.4301     0.0497     0.3316    0.5246
     207    0.4408     0.0499     0.3417    0.5354
     219    0.4516     0.0501     0.3517    0.5462
     263    0.4624     0.0502     0.3618    0.5570
     285    0.4846     0.0505     0.3826    0.5791
     308    0.4957     0.0506     0.3931    0.5900
     340    0.5068     0.0507     0.4037    0.6009
     583    0.5221     0.0514     0.4171    0.6168
     675    0.5401     0.0524     0.4322    0.6361
     733    0.5580     0.0532     0.4477    0.6548
     995    0.5808     0.0548     0.4659    0.6795
    1032    0.6036     0.0559     0.4851    0.7031
    1386    0.6340     0.0583     0.5083    0.7357


            failure:  compet == 2
 competing failures:  compet == 1

    Time       CIF         SE     [95% Conf. Int.]
--------------------------------------------------
       3    0.0097     0.0097     0.0009    0.0477
       6    0.0194     0.0136     0.0038    0.0619
      16    0.0292     0.0166     0.0079    0.0761
      17    0.0391     0.0191     0.0128    0.0897
      28    0.0489     0.0213     0.0182    0.1029
      30    0.0587     0.0232     0.0240    0.1157
      35    0.0686     0.0250     0.0302    0.1286
      36    0.0786     0.0267     0.0367    0.1411
      39    0.0885     0.0282     0.0435    0.1534
      40    0.0986     0.0296     0.0504    0.1658
      68    0.1188     0.0322     0.0650    0.1901
      80    0.1288     0.0334     0.0724    0.2020
     100    0.1389     0.0345     0.0800    0.2138
     153    0.1495     0.0356     0.0880    0.2261
     334    0.1605     0.0368     0.0964    0.2392
     342    0.1720     0.0381     0.1052    0.2526
     852    0.1913     0.0417     0.1175    0.2787
     979    0.2141     0.0460     0.1320    0.3094</code></pre>
</div>
</div>
</section>
<section id="modèle-multinomial-à-durée-discrète" class="level3" data-number="15.2.7">
<h3 data-number="15.2.7" class="anchored" data-anchor-id="modèle-multinomial-à-durée-discrète"><span class="header-section-number">15.2.7</span> Modèle multinomial à durée discrète</h3>
<p>Rappel: Le modèle de Cox <em>cause-specific</em> s’excute facilement. Il suffit de passer la ou les causes concurrente en censure à droite. De même le modèle Fine-Gray (critiqué) est estimable avec la commande usine <strong><code>stcrreg</code></strong></p>
<p>Attention le modèle modèle multinomial n’est pas directement relié aux CIF. Il permet néanmoins d’estimer des probabilités conditionnelles qui tiennent pleinement compte de concurrence entre les différentes issues. Pour la variable de durée on utilise la variable <em>mois</em></p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> expand mois</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">bysort</span> id: <span class="kw">gen</span> t=<span class="dt">_n</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">gen</span> t2=t*t</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> <span class="fu">year</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">gen</span> year2 = <span class="fu">year</span> - <span class="ot">`r(mean)'</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> age</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">gen</span> age2 = age - <span class="ot">`r(mean)'</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">e</span> = compet</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> <span class="fu">e</span>=0 <span class="kw">if</span> t&lt;mois</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mlogit</span> <span class="fu">e</span> t t2 year2 age2 surgery, rrr <span class="kw">noheader</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(399 real changes made)
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 0:  Log likelihood = -318.13171  
Iteration 1:  Log likelihood = -285.78811  
Iteration 2:  Log likelihood = -275.20206  
Iteration 3:  Log likelihood = -275.00574  
Iteration 4:  Log likelihood = -275.00542  
Iteration 5:  Log likelihood = -275.00542  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
           e |        RRR   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           t |      0.816      0.034    -4.91   0.000        0.752       0.885
          t2 |      1.003      0.001     3.53   0.000        1.001       1.005
       year2 |      0.879      0.072    -1.57   0.116        0.749       1.032
        age2 |      1.045      0.018     2.51   0.012        1.010       1.081
     surgery |      0.318      0.171    -2.13   0.033        0.110       0.913
       _cons |      0.222      0.052    -6.49   0.000        0.141       0.350
-------------+----------------------------------------------------------------
2            |
           t |      0.817      0.056    -2.93   0.003        0.713       0.935
          t2 |      1.003      0.002     1.94   0.052        1.000       1.006
       year2 |      0.816      0.113    -1.47   0.141        0.622       1.070
        age2 |      1.011      0.025     0.45   0.654        0.964       1.061
     surgery |      0.541      0.422    -0.79   0.431        0.117       2.496
       _cons |      0.078      0.029    -6.94   0.000        0.038       0.160
------------------------------------------------------------------------------
Note: _cons estimates baseline relative risk for each outcome.</code></pre>
</div>
</div>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>on doit cependant l’installer pour utiliser la commande suivante<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./13-R.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><strong>R</strong></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb91" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - lightbox</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> nbstata</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Stata**</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Le document a été compilé avec le magique kernel jupyter <span class="co">[</span><span class="ot">**nbstata**</span><span class="co">](https://github.com/hugetim/nbstata)</span> programmé par **Tim Huegerich**. Comparé à l'ancienne solution **statamarkdown** qui exécutait Stata en mode batch, il n'y a pas photo au niveau du runtime, avec pratiquement aucune latence une fois le noyau chargé (attendre une quinzaine de seconde à la première compilation).</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Ce pas à pas Stata n'a pas été inclus à la version PDF du support, les mises en application des formations qui lui sont associé étant maintenant exclusivement réalisées avec R. </span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>Ouverture de la base</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="in">*| echo : false</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a><span class="in">*| message : false</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a><span class="in">*| warning : false</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/bases/"</span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a><span class="in">webuse  "transplantation_m", clear</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="in">list id year age surgery stime died in 1/10</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyse non paramétrique</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a><span class="fu">### Méthode actuarielle</span></span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>Contrairement à la formation, l'estimation sera faite sur des intervalles de 30 jours</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a><span class="in">ltable stime died, interval(30) graph ci</span></span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>**Récupération des quartiles de la durée**  </span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>Installation de la commande <span class="in">`qlt`</span></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a><span class="in">*| eval : false</span></span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a><span class="in">net install qlt, from("https://raw.githubusercontent.com/mthevenin/analyse_duree/master/ado/qlt/") replace</span></span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a><span class="in">* help qlt</span></span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a><span class="in">qui ltable stime died, interval(30) saving(base, replace)</span></span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a><span class="in">use base, clear</span></span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-74"><a href="#cb91-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-75"><a href="#cb91-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a><span class="in">qlt</span></span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-84"><a href="#cb91-84" aria-hidden="true" tabindex="-1"></a>Avec la définition des bornes des intervalles de Sas</span>
<span id="cb91-85"><a href="#cb91-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-88"><a href="#cb91-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-89"><a href="#cb91-89" aria-hidden="true" tabindex="-1"></a><span class="in">qlt, sas</span></span>
<span id="cb91-90"><a href="#cb91-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-91"><a href="#cb91-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-92"><a href="#cb91-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-93"><a href="#cb91-93" aria-hidden="true" tabindex="-1"></a><span class="fu">### Méthode Kaplan-Meier</span></span>
<span id="cb91-94"><a href="#cb91-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-95"><a href="#cb91-95" aria-hidden="true" tabindex="-1"></a>**Mode analyse des durées: stset**</span>
<span id="cb91-96"><a href="#cb91-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-97"><a href="#cb91-97" aria-hidden="true" tabindex="-1"></a>Les données doivent être mises en mode analyse de durée avec la commande <span class="in">`stset`</span> (<span class="in">`help stset`</span>).</span>
<span id="cb91-98"><a href="#cb91-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-101"><a href="#cb91-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-102"><a href="#cb91-102" aria-hidden="true" tabindex="-1"></a><span class="in">*| include: false</span></span>
<span id="cb91-103"><a href="#cb91-103" aria-hidden="true" tabindex="-1"></a><span class="in">*| echo : false</span></span>
<span id="cb91-104"><a href="#cb91-104" aria-hidden="true" tabindex="-1"></a><span class="in">*| message : false</span></span>
<span id="cb91-105"><a href="#cb91-105" aria-hidden="true" tabindex="-1"></a><span class="in">*| warning : false</span></span>
<span id="cb91-106"><a href="#cb91-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-107"><a href="#cb91-107" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/bases/"</span></span>
<span id="cb91-108"><a href="#cb91-108" aria-hidden="true" tabindex="-1"></a><span class="in">webuse  "transplantation_m", clear</span></span>
<span id="cb91-109"><a href="#cb91-109" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set</span></span>
<span id="cb91-110"><a href="#cb91-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-111"><a href="#cb91-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-112"><a href="#cb91-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-113"><a href="#cb91-113" aria-hidden="true" tabindex="-1"></a>A minima la commande <span class="in">`stset`</span> entre la variable de durée en argument principal et la variable de censure/évènement avec <span class="in">`failure(nom_var)`</span> en option. </span>
<span id="cb91-114"><a href="#cb91-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-117"><a href="#cb91-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-118"><a href="#cb91-118" aria-hidden="true" tabindex="-1"></a><span class="in">stset stime, f(died)</span></span>
<span id="cb91-119"><a href="#cb91-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-120"><a href="#cb91-120" aria-hidden="true" tabindex="-1"></a><span class="in">list id stime died _st _d _t _t0 in 1/10</span></span>
<span id="cb91-121"><a href="#cb91-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-122"><a href="#cb91-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-123"><a href="#cb91-123" aria-hidden="true" tabindex="-1"></a>**Estimation de la fonction de survie**  </span>
<span id="cb91-124"><a href="#cb91-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-125"><a href="#cb91-125" aria-hidden="true" tabindex="-1"></a>La commande <span class="in">`sts list`</span> permet d'afficher le tableau des estimations à chaque moment d'évènement</span>
<span id="cb91-126"><a href="#cb91-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-127"><a href="#cb91-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-128"><a href="#cb91-128" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb91-129"><a href="#cb91-129" aria-hidden="true" tabindex="-1"></a>Le tableau des estimateurs n'est reporté que pour le format htl du support</span>
<span id="cb91-130"><a href="#cb91-130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb91-131"><a href="#cb91-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-132"><a href="#cb91-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-133"><a href="#cb91-133" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb91-136"><a href="#cb91-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-137"><a href="#cb91-137" aria-hidden="true" tabindex="-1"></a><span class="in">sts list</span></span>
<span id="cb91-138"><a href="#cb91-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-139"><a href="#cb91-139" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb91-140"><a href="#cb91-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-141"><a href="#cb91-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-142"><a href="#cb91-142" aria-hidden="true" tabindex="-1"></a>On récupére les quantiles de la durée avec <span class="in">`stci`</span>. Par défaut la commande affiche la durée médiane. On peut choisir le quantile avec l'arguement p(valeur) en option</span>
<span id="cb91-143"><a href="#cb91-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-146"><a href="#cb91-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-147"><a href="#cb91-147" aria-hidden="true" tabindex="-1"></a><span class="in">stci</span></span>
<span id="cb91-148"><a href="#cb91-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-149"><a href="#cb91-149" aria-hidden="true" tabindex="-1"></a><span class="in">stci, p(75)</span></span>
<span id="cb91-150"><a href="#cb91-150" aria-hidden="true" tabindex="-1"></a><span class="in">stci, p(25)</span></span>
<span id="cb91-151"><a href="#cb91-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-152"><a href="#cb91-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-153"><a href="#cb91-153" aria-hidden="true" tabindex="-1"></a>Pour afficher le graphique des estimateurs KM, on utilise la commande **`sts graph`**. On ajoute ici l'affichage des intervalles de confiance avec l'option <span class="in">`ci`</span></span>
<span id="cb91-154"><a href="#cb91-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-157"><a href="#cb91-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-158"><a href="#cb91-158" aria-hidden="true" tabindex="-1"></a><span class="in">sts graph, ci </span></span>
<span id="cb91-159"><a href="#cb91-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-160"><a href="#cb91-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-161"><a href="#cb91-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-162"><a href="#cb91-162" aria-hidden="true" tabindex="-1"></a>Les commandes <span class="in">`sts list`</span>, <span class="in">`stci`</span> et <span class="in">`sts graph`</span> permettent avec l'option <span class="in">`by(nom_variable)`</span> d'obtenir des comparaisons entre groupes.</span>
<span id="cb91-163"><a href="#cb91-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-164"><a href="#cb91-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-165"><a href="#cb91-165" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparaison des fonctions de survie (KM)</span></span>
<span id="cb91-166"><a href="#cb91-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-167"><a href="#cb91-167" aria-hidden="true" tabindex="-1"></a>On va comparer les fonctions de survie pour la variable *surgery*. </span>
<span id="cb91-168"><a href="#cb91-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-169"><a href="#cb91-169" aria-hidden="true" tabindex="-1"></a>**Graphique**</span>
<span id="cb91-170"><a href="#cb91-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-171"><a href="#cb91-171" aria-hidden="true" tabindex="-1"></a>On ajoute l'option <span class="in">`by(surgery)`</span> à la commande <span class="in">`sts graph`</span></span>
<span id="cb91-172"><a href="#cb91-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-175"><a href="#cb91-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-176"><a href="#cb91-176" aria-hidden="true" tabindex="-1"></a><span class="in">sts graph, by(surgery) ci legend(pos(6))</span></span>
<span id="cb91-177"><a href="#cb91-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-178"><a href="#cb91-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-179"><a href="#cb91-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-180"><a href="#cb91-180" aria-hidden="true" tabindex="-1"></a>**Tests du logrank** </span>
<span id="cb91-181"><a href="#cb91-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-182"><a href="#cb91-182" aria-hidden="true" tabindex="-1"></a>Fonction **`sts test`**. On affichera ici plusieurs variantes du test.</span>
<span id="cb91-183"><a href="#cb91-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-186"><a href="#cb91-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-187"><a href="#cb91-187" aria-hidden="true" tabindex="-1"></a><span class="in">local test `" "l" "w" "tw" "p" "'</span></span>
<span id="cb91-188"><a href="#cb91-188" aria-hidden="true" tabindex="-1"></a><span class="in">foreach test2 of local test {</span></span>
<span id="cb91-189"><a href="#cb91-189" aria-hidden="true" tabindex="-1"></a><span class="in">sts test surgery, `test2'</span></span>
<span id="cb91-190"><a href="#cb91-190" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb91-191"><a href="#cb91-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-192"><a href="#cb91-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-193"><a href="#cb91-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-194"><a href="#cb91-194" aria-hidden="true" tabindex="-1"></a>*Comparaison des rmst*  </span>
<span id="cb91-195"><a href="#cb91-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-196"><a href="#cb91-196" aria-hidden="true" tabindex="-1"></a>Installation de la commande **`strmst2`**</span>
<span id="cb91-197"><a href="#cb91-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-200"><a href="#cb91-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-201"><a href="#cb91-201" aria-hidden="true" tabindex="-1"></a><span class="in">*| eval : false</span></span>
<span id="cb91-202"><a href="#cb91-202" aria-hidden="true" tabindex="-1"></a><span class="in">ssc install strmst2</span></span>
<span id="cb91-203"><a href="#cb91-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-204"><a href="#cb91-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-205"><a href="#cb91-205" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Comparaison deux à deux (c'est pas plus mal comme cela). Je conseille de mettre les variables sous forme d'indicatrice.</span>
<span id="cb91-206"><a href="#cb91-206" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Les labels de la variable ne sont jamais reportés. Ils sont remplacés par les modalités arm0 et arm1.</span>
<span id="cb91-207"><a href="#cb91-207" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>On peut changer la valeurs maximale de la durée avec l'option <span class="in">`tau(valeur)`</span>.</span>
<span id="cb91-208"><a href="#cb91-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-209"><a href="#cb91-209" aria-hidden="true" tabindex="-1"></a>arm1 = Opération  </span>
<span id="cb91-210"><a href="#cb91-210" aria-hidden="true" tabindex="-1"></a>arm0 = pas d'opération  </span>
<span id="cb91-211"><a href="#cb91-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-214"><a href="#cb91-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-215"><a href="#cb91-215" aria-hidden="true" tabindex="-1"></a><span class="in">strmst2 surgery</span></span>
<span id="cb91-216"><a href="#cb91-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-217"><a href="#cb91-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-218"><a href="#cb91-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-219"><a href="#cb91-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modèles à risques proportionnels</span></span>
<span id="cb91-220"><a href="#cb91-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-221"><a href="#cb91-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modèle de Cox</span></span>
<span id="cb91-222"><a href="#cb91-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-223"><a href="#cb91-223" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Estimation du modèle</span></span>
<span id="cb91-224"><a href="#cb91-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-225"><a href="#cb91-225" aria-hidden="true" tabindex="-1"></a>Commande **`stcox`**</span>
<span id="cb91-226"><a href="#cb91-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-227"><a href="#cb91-227" aria-hidden="true" tabindex="-1"></a>Avec la correction d'Efron (conseillé)</span>
<span id="cb91-228"><a href="#cb91-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-229"><a href="#cb91-229" aria-hidden="true" tabindex="-1"></a>**HR**:</span>
<span id="cb91-230"><a href="#cb91-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-233"><a href="#cb91-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-234"><a href="#cb91-234" aria-hidden="true" tabindex="-1"></a><span class="in">stcox year age surgery, nolog noshow efron</span></span>
<span id="cb91-235"><a href="#cb91-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-236"><a href="#cb91-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-237"><a href="#cb91-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-238"><a href="#cb91-238" aria-hidden="true" tabindex="-1"></a>**log(HR)**:</span>
<span id="cb91-239"><a href="#cb91-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-242"><a href="#cb91-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-243"><a href="#cb91-243" aria-hidden="true" tabindex="-1"></a><span class="in">stcox year age surgery, nolog noshow efron nohr</span></span>
<span id="cb91-244"><a href="#cb91-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-245"><a href="#cb91-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-246"><a href="#cb91-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-247"><a href="#cb91-247" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Test de l'hypothèse PH</span></span>
<span id="cb91-248"><a href="#cb91-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-249"><a href="#cb91-249" aria-hidden="true" tabindex="-1"></a>**Test Grambsch-Therneau sur les résidus de Schoenfeld**</span>
<span id="cb91-250"><a href="#cb91-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-251"><a href="#cb91-251" aria-hidden="true" tabindex="-1"></a>Le test OLS est exécuté avec la commande **`estat phtest`**. Je conseille d'ajouté l'option detail pour récupéré les test à un degré de liberté, le test omnibus n'étant pas fiable.</span>
<span id="cb91-252"><a href="#cb91-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-253"><a href="#cb91-253" aria-hidden="true" tabindex="-1"></a>Par défaut $f(t)=t$. </span>
<span id="cb91-254"><a href="#cb91-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-257"><a href="#cb91-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-258"><a href="#cb91-258" aria-hidden="true" tabindex="-1"></a><span class="in">* f(t)=t - par défaut </span></span>
<span id="cb91-259"><a href="#cb91-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-260"><a href="#cb91-260" aria-hidden="true" tabindex="-1"></a><span class="in">estat phtest, detail</span></span>
<span id="cb91-261"><a href="#cb91-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-262"><a href="#cb91-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-263"><a href="#cb91-263" aria-hidden="true" tabindex="-1"></a><span class="in">* f(t)= 1-km - solution par défaut de R</span></span>
<span id="cb91-264"><a href="#cb91-264" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb91-265"><a href="#cb91-265" aria-hidden="true" tabindex="-1"></a><span class="in">estat phtest, detail km</span></span>
<span id="cb91-266"><a href="#cb91-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-267"><a href="#cb91-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-268"><a href="#cb91-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-269"><a href="#cb91-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-270"><a href="#cb91-270" aria-hidden="true" tabindex="-1"></a>**Intéraction avec une fonction de la durée**</span>
<span id="cb91-271"><a href="#cb91-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-272"><a href="#cb91-272" aria-hidden="true" tabindex="-1"></a>Avec $f(t)=t$</span>
<span id="cb91-273"><a href="#cb91-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-274"><a href="#cb91-274" aria-hidden="true" tabindex="-1"></a>L'intéraction s'ajoute directement en option en indiquant la ou les variables concernées (une seule de préférence) avec l'option <span class="in">`tvc(nom_variable)`</span> et la transformation de la durée (variable *t*) avec l'option <span class="in">`texp(expression)`</span>. Ici on a choisi $ft(t)$ soit l'expression dans l'option <span class="in">`texp(_t)`</span></span>
<span id="cb91-275"><a href="#cb91-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-276"><a href="#cb91-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-279"><a href="#cb91-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-280"><a href="#cb91-280" aria-hidden="true" tabindex="-1"></a><span class="in">stcox year age surgery, nolog noshow efron nohr tvc(surgery) texp(_t)</span></span>
<span id="cb91-281"><a href="#cb91-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-282"><a href="#cb91-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-283"><a href="#cb91-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-284"><a href="#cb91-284" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Introduction d'une variable dynamique (binaire)</span></span>
<span id="cb91-285"><a href="#cb91-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-286"><a href="#cb91-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-287"><a href="#cb91-287" aria-hidden="true" tabindex="-1"></a>**Transformation de la base en format long aux temps d'évènement**  </span>
<span id="cb91-288"><a href="#cb91-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-289"><a href="#cb91-289" aria-hidden="true" tabindex="-1"></a>*Etape 1*</span>
<span id="cb91-290"><a href="#cb91-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-293"><a href="#cb91-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-294"><a href="#cb91-294" aria-hidden="true" tabindex="-1"></a><span class="in">stset stime, f(died) id(id)</span></span>
<span id="cb91-295"><a href="#cb91-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-296"><a href="#cb91-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-297"><a href="#cb91-297" aria-hidden="true" tabindex="-1"></a>*Etape 2*</span>
<span id="cb91-300"><a href="#cb91-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-301"><a href="#cb91-301" aria-hidden="true" tabindex="-1"></a><span class="in">stsplit, at(failure)</span></span>
<span id="cb91-302"><a href="#cb91-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-303"><a href="#cb91-303" aria-hidden="true" tabindex="-1"></a><span class="in">stset stime, f(died) id(id)</span></span>
<span id="cb91-304"><a href="#cb91-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-305"><a href="#cb91-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-306"><a href="#cb91-306" aria-hidden="true" tabindex="-1"></a>*Etape 3*</span>
<span id="cb91-309"><a href="#cb91-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-310"><a href="#cb91-310" aria-hidden="true" tabindex="-1"></a><span class="in">gen tvc = transplant==1 &amp; wait&lt;=_t</span></span>
<span id="cb91-311"><a href="#cb91-311" aria-hidden="true" tabindex="-1"></a><span class="in">sort id _t</span></span>
<span id="cb91-312"><a href="#cb91-312" aria-hidden="true" tabindex="-1"></a><span class="in">list id transplant wait tvc _d _t _t0 if id==10  , noobs</span></span>
<span id="cb91-313"><a href="#cb91-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-314"><a href="#cb91-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-315"><a href="#cb91-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-316"><a href="#cb91-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-317"><a href="#cb91-317" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**  </span>
<span id="cb91-318"><a href="#cb91-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-321"><a href="#cb91-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-322"><a href="#cb91-322" aria-hidden="true" tabindex="-1"></a><span class="in">stcox year age surgery tvc, nolog noshow efron nohr</span></span>
<span id="cb91-323"><a href="#cb91-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-324"><a href="#cb91-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-325"><a href="#cb91-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-326"><a href="#cb91-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modèle  à temps discret</span></span>
<span id="cb91-327"><a href="#cb91-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-328"><a href="#cb91-328" aria-hidden="true" tabindex="-1"></a>Variable de durée = *mois*</span>
<span id="cb91-329"><a href="#cb91-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-330"><a href="#cb91-330" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mise en forme de la base</span></span>
<span id="cb91-331"><a href="#cb91-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-334"><a href="#cb91-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-335"><a href="#cb91-335" aria-hidden="true" tabindex="-1"></a><span class="in">*| include: false</span></span>
<span id="cb91-336"><a href="#cb91-336" aria-hidden="true" tabindex="-1"></a><span class="in">*| echo : false</span></span>
<span id="cb91-337"><a href="#cb91-337" aria-hidden="true" tabindex="-1"></a><span class="in">*| message : false</span></span>
<span id="cb91-338"><a href="#cb91-338" aria-hidden="true" tabindex="-1"></a><span class="in">*| warning : false</span></span>
<span id="cb91-339"><a href="#cb91-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-340"><a href="#cb91-340" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/bases/"</span></span>
<span id="cb91-341"><a href="#cb91-341" aria-hidden="true" tabindex="-1"></a><span class="in">webuse  "transplantation_m", clear</span></span>
<span id="cb91-342"><a href="#cb91-342" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set</span></span>
<span id="cb91-343"><a href="#cb91-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-344"><a href="#cb91-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-345"><a href="#cb91-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-346"><a href="#cb91-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-347"><a href="#cb91-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-350"><a href="#cb91-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-351"><a href="#cb91-351" aria-hidden="true" tabindex="-1"></a><span class="in">expand mois</span></span>
<span id="cb91-352"><a href="#cb91-352" aria-hidden="true" tabindex="-1"></a><span class="in">bysort id: gen t=_n</span></span>
<span id="cb91-353"><a href="#cb91-353" aria-hidden="true" tabindex="-1"></a><span class="in">gen e = died</span></span>
<span id="cb91-354"><a href="#cb91-354" aria-hidden="true" tabindex="-1"></a><span class="in">replace e=0 if t&lt;mois</span></span>
<span id="cb91-355"><a href="#cb91-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-356"><a href="#cb91-356" aria-hidden="true" tabindex="-1"></a><span class="in">list id year age surgery mois t e  in 1/31</span></span>
<span id="cb91-357"><a href="#cb91-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-358"><a href="#cb91-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-359"><a href="#cb91-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-360"><a href="#cb91-360" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Paramétrisation avec durée quantitative</span></span>
<span id="cb91-361"><a href="#cb91-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-362"><a href="#cb91-362" aria-hidden="true" tabindex="-1"></a>Les critères d'information </span>
<span id="cb91-363"><a href="#cb91-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-366"><a href="#cb91-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-367"><a href="#cb91-367" aria-hidden="true" tabindex="-1"></a><span class="in">gen t2=t^2</span></span>
<span id="cb91-368"><a href="#cb91-368" aria-hidden="true" tabindex="-1"></a><span class="in">gen t3=t^3</span></span>
<span id="cb91-369"><a href="#cb91-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-370"><a href="#cb91-370" aria-hidden="true" tabindex="-1"></a><span class="in">qui logit e  t ,  nolog </span></span>
<span id="cb91-371"><a href="#cb91-371" aria-hidden="true" tabindex="-1"></a><span class="in">estat ic</span></span>
<span id="cb91-372"><a href="#cb91-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-373"><a href="#cb91-373" aria-hidden="true" tabindex="-1"></a><span class="in">qui logit e  t t2 ,  nolog </span></span>
<span id="cb91-374"><a href="#cb91-374" aria-hidden="true" tabindex="-1"></a><span class="in">estat ic</span></span>
<span id="cb91-375"><a href="#cb91-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-376"><a href="#cb91-376" aria-hidden="true" tabindex="-1"></a><span class="in">qui logit e  t2 t3 ,  nolog </span></span>
<span id="cb91-377"><a href="#cb91-377" aria-hidden="true" tabindex="-1"></a><span class="in">estat ic</span></span>
<span id="cb91-378"><a href="#cb91-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-379"><a href="#cb91-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-380"><a href="#cb91-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-381"><a href="#cb91-381" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**</span>
<span id="cb91-382"><a href="#cb91-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-385"><a href="#cb91-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-386"><a href="#cb91-386" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum year</span></span>
<span id="cb91-387"><a href="#cb91-387" aria-hidden="true" tabindex="-1"></a><span class="in">qui gen year2 = year - `r(mean)'</span></span>
<span id="cb91-388"><a href="#cb91-388" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum age</span></span>
<span id="cb91-389"><a href="#cb91-389" aria-hidden="true" tabindex="-1"></a><span class="in">qui gen age2 = age - `r(mean)'</span></span>
<span id="cb91-390"><a href="#cb91-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-391"><a href="#cb91-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-392"><a href="#cb91-392" aria-hidden="true" tabindex="-1"></a><span class="in">logit e t t2 t3 year2 age2 surgery, nolog or</span></span>
<span id="cb91-393"><a href="#cb91-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-394"><a href="#cb91-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-395"><a href="#cb91-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-396"><a href="#cb91-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Paramétrisation avec durée discrète</span></span>
<span id="cb91-397"><a href="#cb91-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-398"><a href="#cb91-398" aria-hidden="true" tabindex="-1"></a>Pour l'exemple seulement, on procède à un regroupement des intervalles découpés sur les quartiles de la durée</span>
<span id="cb91-399"><a href="#cb91-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-400"><a href="#cb91-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-403"><a href="#cb91-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-404"><a href="#cb91-404" aria-hidden="true" tabindex="-1"></a><span class="in">*| include: false</span></span>
<span id="cb91-405"><a href="#cb91-405" aria-hidden="true" tabindex="-1"></a><span class="in">*| echo : false</span></span>
<span id="cb91-406"><a href="#cb91-406" aria-hidden="true" tabindex="-1"></a><span class="in">*| message : false</span></span>
<span id="cb91-407"><a href="#cb91-407" aria-hidden="true" tabindex="-1"></a><span class="in">*| warning : false</span></span>
<span id="cb91-408"><a href="#cb91-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-409"><a href="#cb91-409" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/bases/"</span></span>
<span id="cb91-410"><a href="#cb91-410" aria-hidden="true" tabindex="-1"></a><span class="in">webuse  "transplantation_m", clear</span></span>
<span id="cb91-411"><a href="#cb91-411" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set</span></span>
<span id="cb91-412"><a href="#cb91-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-413"><a href="#cb91-413" aria-hidden="true" tabindex="-1"></a><span class="in">expand mois</span></span>
<span id="cb91-414"><a href="#cb91-414" aria-hidden="true" tabindex="-1"></a><span class="in">bysort id: gen t=_n</span></span>
<span id="cb91-415"><a href="#cb91-415" aria-hidden="true" tabindex="-1"></a><span class="in">gen e = died</span></span>
<span id="cb91-416"><a href="#cb91-416" aria-hidden="true" tabindex="-1"></a><span class="in">replace e=0 if t&lt;mois</span></span>
<span id="cb91-417"><a href="#cb91-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-418"><a href="#cb91-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-419"><a href="#cb91-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-420"><a href="#cb91-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-423"><a href="#cb91-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-424"><a href="#cb91-424" aria-hidden="true" tabindex="-1"></a><span class="in">xtile ct4=t, n(4)</span></span>
<span id="cb91-425"><a href="#cb91-425" aria-hidden="true" tabindex="-1"></a><span class="in">bysort id ct4: keep if _n==_N</span></span>
<span id="cb91-426"><a href="#cb91-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-427"><a href="#cb91-427" aria-hidden="true" tabindex="-1"></a><span class="in">tab  ct4 e</span></span>
<span id="cb91-428"><a href="#cb91-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-429"><a href="#cb91-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-430"><a href="#cb91-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-433"><a href="#cb91-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-434"><a href="#cb91-434" aria-hidden="true" tabindex="-1"></a><span class="in">logit e i.ct4  year age surgery,  nolog or</span></span>
<span id="cb91-435"><a href="#cb91-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-436"><a href="#cb91-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-437"><a href="#cb91-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-438"><a href="#cb91-438" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modèles paramétriques</span></span>
<span id="cb91-439"><a href="#cb91-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-440"><a href="#cb91-440" aria-hidden="true" tabindex="-1"></a>Juste un exemple pour le modèle de **weibull**</span>
<span id="cb91-441"><a href="#cb91-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-442"><a href="#cb91-442" aria-hidden="true" tabindex="-1"></a>Commande **`streg`**</span>
<span id="cb91-443"><a href="#cb91-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-444"><a href="#cb91-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-445"><a href="#cb91-445" aria-hidden="true" tabindex="-1"></a>Par défaut, le modèle de Weibull est exécuté sous paramétrisation PH. Pour une paramétrisation type AFT, ajouter l'option *time*.</span>
<span id="cb91-446"><a href="#cb91-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-449"><a href="#cb91-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-450"><a href="#cb91-450" aria-hidden="true" tabindex="-1"></a><span class="in">*| include: false</span></span>
<span id="cb91-451"><a href="#cb91-451" aria-hidden="true" tabindex="-1"></a><span class="in">*| echo : false</span></span>
<span id="cb91-452"><a href="#cb91-452" aria-hidden="true" tabindex="-1"></a><span class="in">*| message : false</span></span>
<span id="cb91-453"><a href="#cb91-453" aria-hidden="true" tabindex="-1"></a><span class="in">*| warning : false</span></span>
<span id="cb91-454"><a href="#cb91-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-455"><a href="#cb91-455" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set "https://raw.githubusercontent.com//mthevenin/analyse_duree/master/bases/"</span></span>
<span id="cb91-456"><a href="#cb91-456" aria-hidden="true" tabindex="-1"></a><span class="in">webuse  "transplantation_m", clear</span></span>
<span id="cb91-457"><a href="#cb91-457" aria-hidden="true" tabindex="-1"></a><span class="in">webuse set</span></span>
<span id="cb91-458"><a href="#cb91-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-459"><a href="#cb91-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-460"><a href="#cb91-460" aria-hidden="true" tabindex="-1"></a><span class="in">qui stset stime, f(died)</span></span>
<span id="cb91-461"><a href="#cb91-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-462"><a href="#cb91-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-463"><a href="#cb91-463" aria-hidden="true" tabindex="-1"></a>**PH**: défaut</span>
<span id="cb91-464"><a href="#cb91-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-467"><a href="#cb91-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-468"><a href="#cb91-468" aria-hidden="true" tabindex="-1"></a><span class="in">*qui stset stime, f(died) // penser à mettre la base en mode analyse de durée</span></span>
<span id="cb91-469"><a href="#cb91-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-470"><a href="#cb91-470" aria-hidden="true" tabindex="-1"></a><span class="in">streg year age surgery , dist(weibull) nolog noheader</span></span>
<span id="cb91-471"><a href="#cb91-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-472"><a href="#cb91-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-473"><a href="#cb91-473" aria-hidden="true" tabindex="-1"></a>**AFT**</span>
<span id="cb91-474"><a href="#cb91-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-477"><a href="#cb91-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-478"><a href="#cb91-478" aria-hidden="true" tabindex="-1"></a><span class="in">streg year age surgery , dist(weibull) time nolog noheader</span></span>
<span id="cb91-479"><a href="#cb91-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-480"><a href="#cb91-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-481"><a href="#cb91-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-482"><a href="#cb91-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-483"><a href="#cb91-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Risques concurrents</span></span>
<span id="cb91-484"><a href="#cb91-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-485"><a href="#cb91-485" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non paramétrique: estimation des IC</span></span>
<span id="cb91-486"><a href="#cb91-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-487"><a href="#cb91-487" aria-hidden="true" tabindex="-1"></a>Installer les commandes ```stcompet``` et ```stcomlist``` </span>
<span id="cb91-488"><a href="#cb91-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-491"><a href="#cb91-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-492"><a href="#cb91-492" aria-hidden="true" tabindex="-1"></a><span class="in">*| eval: FALSE</span></span>
<span id="cb91-493"><a href="#cb91-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-494"><a href="#cb91-494" aria-hidden="true" tabindex="-1"></a><span class="in">ssc install stcompet</span></span>
<span id="cb91-495"><a href="#cb91-495" aria-hidden="true" tabindex="-1"></a><span class="in">ssc install stcomlist</span></span>
<span id="cb91-496"><a href="#cb91-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-497"><a href="#cb91-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-498"><a href="#cb91-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-499"><a href="#cb91-499" aria-hidden="true" tabindex="-1"></a>Le risque d'intérêt est compet=1, le risque concurrent est compet=2. </span>
<span id="cb91-500"><a href="#cb91-500" aria-hidden="true" tabindex="-1"></a>La commande externe **`stcompet`** permet d'estimer les CIF mais ne propose pas d'output des estimateurs ^[on doit cependant l'installer pour utiliser la commande suivante]. On utilise alors la commande **`stcomlist`** en précisant le ou les risques concurrent (ici compet=2)</span>
<span id="cb91-501"><a href="#cb91-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-502"><a href="#cb91-502" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb91-505"><a href="#cb91-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-506"><a href="#cb91-506" aria-hidden="true" tabindex="-1"></a><span class="in">stset stime, failure(compet==1)</span></span>
<span id="cb91-507"><a href="#cb91-507" aria-hidden="true" tabindex="-1"></a><span class="in">stcomlist, compet1(2)</span></span>
<span id="cb91-508"><a href="#cb91-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-509"><a href="#cb91-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-510"><a href="#cb91-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-511"><a href="#cb91-511" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modèle multinomial à durée discrète</span></span>
<span id="cb91-512"><a href="#cb91-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-513"><a href="#cb91-513" aria-hidden="true" tabindex="-1"></a>Rappel: Le modèle de Cox *cause-specific* s'excute facilement. Il suffit de passer la ou les causes concurrente en censure à droite. De même le modèle Fine-Gray (critiqué) est estimable avec la commande usine **`stcrreg`**</span>
<span id="cb91-514"><a href="#cb91-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-515"><a href="#cb91-515" aria-hidden="true" tabindex="-1"></a>Attention le modèle modèle multinomial n'est pas directement relié aux CIF. Il permet néanmoins d'estimer des probabilités conditionnelles qui tiennent pleinement compte de concurrence entre les différentes issues.</span>
<span id="cb91-516"><a href="#cb91-516" aria-hidden="true" tabindex="-1"></a>Pour la variable de durée on utilise la variable *mois*</span>
<span id="cb91-517"><a href="#cb91-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-520"><a href="#cb91-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb91-521"><a href="#cb91-521" aria-hidden="true" tabindex="-1"></a><span class="in">qui expand mois</span></span>
<span id="cb91-522"><a href="#cb91-522" aria-hidden="true" tabindex="-1"></a><span class="in">qui bysort id: gen t=_n</span></span>
<span id="cb91-523"><a href="#cb91-523" aria-hidden="true" tabindex="-1"></a><span class="in">qui gen t2=t*t</span></span>
<span id="cb91-524"><a href="#cb91-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-525"><a href="#cb91-525" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum year</span></span>
<span id="cb91-526"><a href="#cb91-526" aria-hidden="true" tabindex="-1"></a><span class="in">qui gen year2 = year - `r(mean)'</span></span>
<span id="cb91-527"><a href="#cb91-527" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum age</span></span>
<span id="cb91-528"><a href="#cb91-528" aria-hidden="true" tabindex="-1"></a><span class="in">qui gen age2 = age - `r(mean)'</span></span>
<span id="cb91-529"><a href="#cb91-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-530"><a href="#cb91-530" aria-hidden="true" tabindex="-1"></a><span class="in">gen e = compet</span></span>
<span id="cb91-531"><a href="#cb91-531" aria-hidden="true" tabindex="-1"></a><span class="in">replace e=0 if t&lt;mois</span></span>
<span id="cb91-532"><a href="#cb91-532" aria-hidden="true" tabindex="-1"></a><span class="in">mlogit e t t2 year2 age2 surgery, rrr noheader</span></span>
<span id="cb91-533"><a href="#cb91-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","descPosition":"bottom","selector":".lightbox","loop":true,"closeEffect":"zoom"});</script>



</body></html>