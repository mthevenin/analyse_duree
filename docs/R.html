<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.207">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analyse des durées - R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Stata.html" rel="next">
<link href="./frailty.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Analyse des durées</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mthevenin/analyse_duree"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:marc.thevenin@ined.fr"><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false"><strong>Données et théorie</strong></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Donnees.html" class="sidebar-item-text sidebar-link">Les Données</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false"><strong>Méthodes non paramétriques</strong></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fsurvie.html" class="sidebar-item-text sidebar-link">Les fonctions de survie</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./comp_fsurvie.html" class="sidebar-item-text sidebar-link">Tests de comparaison</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false"><strong>Modèles à risques proportionnels</strong></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_mod.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cox.html" class="sidebar-item-text sidebar-link">Modèle de Cox</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discret.html" class="sidebar-item-text sidebar-link">Modèle temps discret</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dynamiques.html" class="sidebar-item-text sidebar-link">Variables dynamiques</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false"><strong>Compléments</strong></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametrique.html" class="sidebar-item-text sidebar-link">Modèles paramétriques</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./concurrent.html" class="sidebar-item-text sidebar-link">Risques concurrents</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./frailty.html" class="sidebar-item-text sidebar-link">Fragilité et immunité</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true"><strong>Programmation</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R.html" class="sidebar-item-text sidebar-link active">R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stata.html" class="sidebar-item-text sidebar-link">Stata</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sas.html" class="sidebar-item-text sidebar-link">SAS</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Python.html" class="sidebar-item-text sidebar-link">PYTHON</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#packages-et-fonctions" id="toc-packages-et-fonctions" class="nav-link active" data-scroll-target="#packages-et-fonctions">Packages et fonctions</a>
  <ul class="collapse">
  <li><a href="#listes" id="toc-listes" class="nav-link" data-scroll-target="#listes">Listes</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation"><strong>Installation</strong></a></li>
  <li><a href="#survival-v2-versus-v3" id="toc-survival-v2-versus-v3" class="nav-link" data-scroll-target="#survival-v2-versus-v3"><strong>Survival v2 versus v3</strong></a></li>
  </ul></li>
  <li><a href="#analyse-non-paramétrique" id="toc-analyse-non-paramétrique" class="nav-link" data-scroll-target="#analyse-non-paramétrique"><strong>Analyse Non paramétrique</strong></a>
  <ul class="collapse">
  <li><a href="#méthode-actuarielle" id="toc-méthode-actuarielle" class="nav-link" data-scroll-target="#méthode-actuarielle"><strong>Méthode actuarielle</strong></a></li>
  <li><a href="#méthode-kaplan-meier" id="toc-méthode-kaplan-meier" class="nav-link" data-scroll-target="#méthode-kaplan-meier"><strong>Méthode Kaplan-Meier</strong></a></li>
  </ul></li>
  <li><a href="#modèle-de-cox" id="toc-modèle-de-cox" class="nav-link" data-scroll-target="#modèle-de-cox"><strong>Modèle de Cox</strong></a>
  <ul class="collapse">
  <li><a href="#estimation-du-modèle" id="toc-estimation-du-modèle" class="nav-link" data-scroll-target="#estimation-du-modèle"><strong>Estimation du modèle</strong></a></li>
  <li><a href="#hypothèse-ph" id="toc-hypothèse-ph" class="nav-link" data-scroll-target="#hypothèse-ph"><strong>Hypothèse PH</strong></a>
  <ul class="collapse">
  <li><a href="#test-grambsch-therneau" id="toc-test-grambsch-therneau" class="nav-link" data-scroll-target="#test-grambsch-therneau">Test Grambsch-Therneau</a></li>
  <li><a href="#introduction-dune-intéraction" id="toc-introduction-dune-intéraction" class="nav-link" data-scroll-target="#introduction-dune-intéraction">Introduction d’une intéraction</a></li>
  </ul></li>
  <li><a href="#variable-dynamique-binaire" id="toc-variable-dynamique-binaire" class="nav-link" data-scroll-target="#variable-dynamique-binaire"><strong>Variable dynamique (binaire)</strong></a></li>
  </ul></li>
  <li><a href="#analyse-en-temps-discret" id="toc-analyse-en-temps-discret" class="nav-link" data-scroll-target="#analyse-en-temps-discret"><strong>Analyse en temps discret</strong></a>
  <ul class="collapse">
  <li><a href="#ft-quantitative" id="toc-ft-quantitative" class="nav-link" data-scroll-target="#ft-quantitative"><strong><span class="math inline">\(f(t)\)</span> quantitative</strong></a></li>
  <li><a href="#ft-discrète" id="toc-ft-discrète" class="nav-link" data-scroll-target="#ft-discrète"><strong><span class="math inline">\(f(t)\)</span> discrète </strong></a></li>
  </ul></li>
  <li><a href="#modèles-usuels" id="toc-modèles-usuels" class="nav-link" data-scroll-target="#modèles-usuels"><strong>Modèles usuels</strong></a>
  <ul class="collapse">
  <li><a href="#modèle-de-weibull" id="toc-modèle-de-weibull" class="nav-link" data-scroll-target="#modèle-de-weibull"><strong>Modèle de Weibull</strong></a></li>
  </ul></li>
  <li><a href="#risques-concurrents" id="toc-risques-concurrents" class="nav-link" data-scroll-target="#risques-concurrents"><strong>Risques concurrents</strong></a>
  <ul class="collapse">
  <li><a href="#incidences-cumulées" id="toc-incidences-cumulées" class="nav-link" data-scroll-target="#incidences-cumulées"><strong>Incidences cumulées</strong></a></li>
  <li><a href="#modèles" id="toc-modèles" class="nav-link" data-scroll-target="#modèles"><strong>Modèles</strong></a>
  <ul class="collapse">
  <li><a href="#fine-gray" id="toc-fine-gray" class="nav-link" data-scroll-target="#fine-gray"><strong>Fine-Gray</strong></a></li>
  <li><a href="#modèle-multinomial" id="toc-modèle-multinomial" class="nav-link" data-scroll-target="#modèle-multinomial"><strong>Modèle multinomial</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Programme de cette section: <a href="programme_R.R">Lien</a></p>
<section id="packages-et-fonctions" class="level1">
<h1>Packages et fonctions</h1>
<section id="listes" class="level2">
<h2 class="anchored" data-anchor-id="listes">Listes</h2>
<table class="table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Analyse</strong></th>
<th>Packages - fonctions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Non paramétrique</strong></td>
<td><ul>
<li><p><code>discsurv</code></p>
<ul>
<li><code>lifetable</code></li>
<li><code>contToDisc</code></li>
</ul></li>
<li><p><code>survival</code></p>
<ul>
<li><code>survfit</code></li>
<li><code>survdif</code></li>
</ul></li>
<li><p><code>survRM2</code></p>
<ul>
<li><code>rmst2</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Modèles à risques proportionnel</strong></td>
<td><ul>
<li><code>survival</code>
<ul>
<li><code>coxph</code></li>
<li><code>cox.zph</code> (v3) <code>cox.zphold</code> (récupération v2)</li>
<li><code>survsplit</code></li>
</ul></li>
<li>base et <code>tydir</code>
<ul>
<li><code>uncount</code></li>
<li><code>glm</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Modèles paramétriques (ph ou aft)</strong></td>
<td><ul>
<li><p><code>survival</code></p>
<ul>
<li><code>survreg</code></li>
</ul></li>
<li><p><code>flexsurv</code></p>
<ul>
<li><code>survreg</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Risques concurents</strong></td>
<td><ul>
<li><p><code>cmprsk</code></p>
<ul>
<li><code>cuminc</code></li>
</ul></li>
<li><p><code>nnet</code></p>
<ul>
<li><code>multinom</code></li>
</ul></li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Autres (graphiques - mise en forme)</strong></td>
<td><ul>
<li><p><code>survminer</code></p></li>
<li><p><code>jtools</code></p></li>
<li><p><code>stargazer</code> - <code>gtsummary</code></p></li>
</ul></td>
</tr>
</tbody>
</table>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation"><strong>Installation</strong></h2>
<p>Les dernières versions de certains packages peuvent être installées via Github (ex: <code>survminer</code>). Pour les récupérer, passer par le package <code>devtools</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survival")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survminer")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("flexsurv")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survRM2")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyr")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtools")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("jtools")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("RecordLinkage")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtsummary")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("cmprsk")</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtsummary")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#install.package(stargazer)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("muhaz")</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#library(RecordLinkage)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#library(gtsummary)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discSurv)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(muhaz)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="survival-v2-versus-v3" class="level2">
<h2 class="anchored" data-anchor-id="survival-v2-versus-v3"><strong>Survival v2 versus v3</strong></h2>
<p><br> Se reporter à la partie sur les risques proportionnels.</p>
<p>::: {.cell filename=’ installation survival 2.44-1 (30 mars 2019)’}</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(remotes)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_version</span>(<span class="st">"survival"</span>, <span class="at">version =</span> <span class="st">"2.44-1"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
</section>
</section>
<section id="analyse-non-paramétrique" class="level1">
<h1><strong>Analyse Non paramétrique</strong></h1>
<p>Chargement de la base transplantation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<section id="méthode-actuarielle" class="level2">
<h2 class="anchored" data-anchor-id="méthode-actuarielle"><strong>Méthode actuarielle</strong></h2>
<p>La fonction disponible du paquet <code>discsurv</code>, <em><code>lifetable</code></em>, a des fonctionalités plutôt limitées. Si on peut depuis une MAJ récente définir des intervalles de durée, il n’y a toujours pas d’estimateurs les différents quantiles de la courbe de survie.</p>
<p>Pire, la programmation est rendue un peu compliquée pour pas grand chose. On doit s’assurer que la base est bien en format <code>data.frame</code>.<br>
Je donne les codes pour info, sans plus de commentaires.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">=</span> <span class="fu">as.data.frame</span>(trans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Fonction <code>lifeTable</code></strong></p>
<p><strong><em>Intervalle par defaut <span class="math inline">\(dt=1\)</span></em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">=</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles t = journalier"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" title="S(t) méthode actuarielle avec discSurv (1)" data-gallery="quarto-lightbox-gallery-1"><img src="R_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
<p></p><figcaption class="figure-caption">S(t) méthode actuarielle avec <code>discSurv</code> (1)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong><em>Intervalle <span class="math inline">\(dt=30\)</span></em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit le vecteur des intervalles (il n'y avait pas plus simple????)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(<span class="fu">max</span>(trans<span class="sc">$</span>stime)<span class="sc">/</span><span class="dv">30</span>)<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Base dis avec une nouvelle variable de durée =&gt; timeDisc </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">contToDisc</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">intervalLimits =</span> dt )</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>dis, <span class="at">timeColumn=</span><span class="st">"timeDisc"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles dt = 30 jours"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" title="S(t) méthode actuarielle avec discSurv (2)" data-gallery="quarto-lightbox-gallery-2"><img src="R_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
<p></p><figcaption class="figure-caption">S(t) méthode actuarielle avec <code>discSurv</code> (2)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Sur les abcisses, ce sont les valeurs des intervalles qui sont reportés: 10=300 jours. Ce n’est vraiment pas terrible. Pour ce type d’estimateurs, il est préférable d’utiliser Sas ou Stata.</p>
</section>
<section id="méthode-kaplan-meier" class="level2">
<h2 class="anchored" data-anchor-id="méthode-kaplan-meier"><strong>Méthode Kaplan-Meier</strong></h2>
<p>Le package survival est le principal outil d’analyse des durée. Le package survminer permet d’améliorer la présentation des graphiques. <br></p>
<p><strong>Estimation des fonctions de survie</strong><br>
<br> Fonction <code>survfit</code><br>
Syntaxe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> x, <span class="at">data =</span> base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut renseigner directement les variables permettant de calculer la durée et non la variable de durée elle-même. Cette méthode est utilisée lorsqu’on introduit une variable dynamique dans un modèle semi-paramétrique (<code>coxph</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(variable_start, variable_end, status) <span class="sc">~</span> x, <span class="at">data =</span> nom_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sans comparaison de groupes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call: survfit(formula = Surv(stime, died) ~ 1, data = trans)

       n events median 0.95LCL 0.95UCL
[1,] 103     75    100      72     263</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call: survfit(formula = Surv(stime, died) ~ 1, data = trans)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1    103       1    0.990 0.00966       0.9715        1.000
    2    102       3    0.961 0.01904       0.9246        0.999
    3     99       3    0.932 0.02480       0.8847        0.982
    5     96       2    0.913 0.02782       0.8597        0.969
    6     94       2    0.893 0.03043       0.8355        0.955
    8     92       1    0.883 0.03161       0.8237        0.948
    9     91       1    0.874 0.03272       0.8119        0.940
   12     89       1    0.864 0.03379       0.8002        0.933
   16     88       3    0.835 0.03667       0.7656        0.910
   17     85       1    0.825 0.03753       0.7543        0.902
   18     84       1    0.815 0.03835       0.7431        0.894
   21     83       2    0.795 0.03986       0.7208        0.877
   28     81       1    0.785 0.04056       0.7098        0.869
   30     80       1    0.776 0.04122       0.6989        0.861
   32     78       1    0.766 0.04188       0.6878        0.852
   35     77       1    0.756 0.04250       0.6769        0.844
   36     76       1    0.746 0.04308       0.6659        0.835
   37     75       1    0.736 0.04364       0.6551        0.827
   39     74       1    0.726 0.04417       0.6443        0.818
   40     72       2    0.706 0.04519       0.6225        0.800
   43     70       1    0.696 0.04565       0.6117        0.791
   45     69       1    0.686 0.04609       0.6009        0.782
   50     68       1    0.675 0.04650       0.5902        0.773
   51     67       1    0.665 0.04689       0.5796        0.764
   53     66       1    0.655 0.04725       0.5690        0.755
   58     65       1    0.645 0.04759       0.5584        0.746
   61     64       1    0.635 0.04790       0.5479        0.736
   66     63       1    0.625 0.04819       0.5374        0.727
   68     62       2    0.605 0.04870       0.5166        0.708
   69     60       1    0.595 0.04892       0.5063        0.699
   72     59       2    0.575 0.04929       0.4857        0.680
   77     57       1    0.565 0.04945       0.4755        0.670
   78     56       1    0.554 0.04958       0.4654        0.661
   80     55       1    0.544 0.04970       0.4552        0.651
   81     54       1    0.534 0.04979       0.4451        0.641
   85     53       1    0.524 0.04986       0.4351        0.632
   90     52       1    0.514 0.04991       0.4251        0.622
   96     51       1    0.504 0.04994       0.4151        0.612
  100     50       1    0.494 0.04995       0.4052        0.602
  102     49       1    0.484 0.04993       0.3953        0.592
  110     47       1    0.474 0.04992       0.3852        0.582
  149     45       1    0.463 0.04991       0.3749        0.572
  153     44       1    0.453 0.04987       0.3647        0.562
  165     43       1    0.442 0.04981       0.3545        0.551
  186     41       1    0.431 0.04975       0.3440        0.541
  188     40       1    0.420 0.04966       0.3336        0.530
  207     39       1    0.410 0.04954       0.3233        0.519
  219     38       1    0.399 0.04940       0.3130        0.509
  263     37       1    0.388 0.04923       0.3027        0.498
  285     35       2    0.366 0.04885       0.2817        0.475
  308     33       1    0.355 0.04861       0.2713        0.464
  334     32       1    0.344 0.04834       0.2610        0.453
  340     31       1    0.333 0.04804       0.2507        0.442
  342     29       1    0.321 0.04773       0.2401        0.430
  583     21       1    0.306 0.04785       0.2252        0.416
  675     17       1    0.288 0.04830       0.2073        0.400
  733     16       1    0.270 0.04852       0.1898        0.384
  852     14       1    0.251 0.04873       0.1712        0.367
  979     11       1    0.228 0.04934       0.1491        0.348
  995     10       1    0.205 0.04939       0.1279        0.329
 1032      9       1    0.182 0.04888       0.1078        0.308
 1386      6       1    0.152 0.04928       0.0804        0.287</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="R_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Le premier output <code>fit</code> permet d’obtenir la durée médiane, ici égale à 100 (<span class="math inline">\(S(100)=0.494\)</span>). Le second avec la fonction <strong><code>summary</code></strong> permet d’obtenir une table des estimateurs. La fonction de survie peut être tracée avec la fonction <strong><code>plot</code></strong> (en pointillés les intervalles de confiance).</p>
<p><br> On peut obtenir des graphes de meilleur qualité avec la librairie <strong><code>survminer</code></strong>.<br>
Avec la fonction <strong><code>ggsurvplot</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="R_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>On peut ajouter la population encore soumise au risque à plusieurs points d’observation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="R_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Comparaison des fonctions de survie</strong></p>
<p>On va comparer les deuxfonctions de survie pour la variable <em>surgery</em>, celle pour les personnes non opérées et celle pour les personnes opérées.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call: survfit(formula = Surv(stime, died) ~ surgery, data = trans)

           n events median 0.95LCL 0.95UCL
surgery=0 91     69     78      61     153
surgery=1 12      6    979     583      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="R_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Tests du log-rank</strong></p>
<p>On utilise la fonction <strong><code>survdiff</code></strong>, avec comme variante le test de Peto-Peto (<code>rho=1</code>).<br>
La syntaxe est quasiment identique à la fonction <code>survdiff</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">rho=</span><span class="dv">1</span>, <span class="at">data =</span> trans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
survdiff(formula = Surv(stime, died) ~ surgery, data = trans, 
    rho = 1)

           N Observed Expected (O-E)^2/E (O-E)^2/V
surgery=0 91    45.28    39.12     0.968      8.65
surgery=1 12     2.03     8.18     4.630      8.65

 Chisq= 8.7  on 1 degrees of freedom, p= 0.003 </code></pre>
</div>
</div>
<p>Ici la variable est binaire. Si on veux tester deux à deux les niveaux d’une variable catégorielle à plus de deux modalités, on utilise la fonction <strong><code>pairwise_survdiff</code></strong> de <code>survminer</code> (syntaxe identique que <code>survdiff</code>).</p>
<p><strong>Comparaison des RMST</strong></p>
<p>La fonction <strong><code>rmst2</code></strong> du package <strong><code>survRM2</code></strong> permet de comparer les RMST entre 2 groupes (et pas plus). La strate pour les comparaisons doit être renommée <em>arm</em>. La fonction, issue d’une commande de Stata, n’est pas très souple.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>arm<span class="ot">=</span>trans<span class="sc">$</span>surgery</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">rmst2</span>(trans<span class="sc">$</span>stime, trans<span class="sc">$</span>died, trans<span class="sc">$</span>arm, <span class="at">tau=</span><span class="cn">NULL</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
The truncation time, tau, was not specified. Thus, the default tau  1407  is used. 

Restricted Mean Survival Time (RMST) by arm 
                Est.      se lower .95 upper .95
RMST (arm=1) 884.576 151.979   586.702  1182.450
RMST (arm=0) 379.148  58.606   264.283   494.012


Restricted Mean Time Lost (RMTL) by arm 
                 Est.      se lower .95 upper .95
RMTL (arm=1)  522.424 151.979   224.550   820.298
RMTL (arm=0) 1027.852  58.606   912.988  1142.717


Between-group contrast 
                        Est. lower .95 upper .95     p
RMST (arm=1)-(arm=0) 505.428   186.175   824.682 0.002
RMST (arm=1)/(arm=0)   2.333     1.483     3.670 0.000
RMTL (arm=1)/(arm=0)   0.508     0.284     0.909 0.022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="R_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="modèle-de-cox" class="level1">
<h1><strong>Modèle de Cox</strong></h1>
<p>Ici tout est estimé avec des fonctions du package <code>survival</code>:</p>
<ul>
<li>Estimation du modèle: <code>coxph</code>.</li>
<li>Test de Grambsch-Therneau: <code>cox.zph</code>.</li>
<li>Introduction d’une variable dynamique: <code>survsplit</code>.</li>
</ul>
<section id="estimation-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="estimation-du-modèle"><strong>Estimation du modèle</strong></h2>
<p>Par défaut, R utilise la correction d’Efron pour les évènements simultanés. Il est préférable de ne pas la modifier.</p>
<p>Syntaxe:</p>
<pre><code>coxph(Surv(time, status) ~ x1 + x2 + ....., data=base, ties="nom_correction"))</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
coxph(formula = Surv(stime, died) ~ year + age + surgery, data = trans)

  n= 103, number of events= 75 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)  
year    -0.11963   0.88725  0.06734 -1.776   0.0757 .
age      0.02958   1.03002  0.01352  2.187   0.0287 *
surgery -0.98732   0.37257  0.43626 -2.263   0.0236 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
year       0.8872     1.1271    0.7775    1.0124
age        1.0300     0.9709    1.0031    1.0577
surgery    0.3726     2.6840    0.1584    0.8761

Concordance= 0.653  (se = 0.032 )
Likelihood ratio test= 17.63  on 3 df,   p=5e-04
Wald test            = 15.76  on 3 df,   p=0.001
Score (logrank) test = 16.71  on 3 df,   p=8e-04</code></pre>
</div>
</div>
<p>La table des résultats reporte le logarithme des Risques Ratios (coef) ainsi que les RR (exp(coef)). Il est intéressant de regarder la valeur de concordance (Harrel’s) qui donne des indications sur la qualité de l’ajustement (proche de l’AUC/ROC).</p>
<p>On peut représenter sous forme graphique les résultats avec la fonction <strong><code>ggforest</code></strong> de <code>survminer</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .get_data(model, data = data): The `data` argument is not provided.
Data will be extracted from model fit.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="R_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hypothèse-ph" class="level2">
<h2 class="anchored" data-anchor-id="hypothèse-ph"><strong>Hypothèse PH</strong></h2>
<section id="test-grambsch-therneau" class="level3">
<h3 class="anchored" data-anchor-id="test-grambsch-therneau">Test Grambsch-Therneau</h3>
<p><strong>Résidus de Schoenfeld</strong><br>
On utilise la fonction <strong><code>cox.zph</code></strong> pour effectuer ce test.<br>
Le test peut utiliser plusieurs fonctions de la durée. Par défaut la fonction utilise <span class="math inline">\(1-KM\)</span>, soit le complémentaire de l’estimateur de Kaplan-Meier (option <code>transform="km"</code>).</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Mise à jour à venir: test simplifié et test exact
</div>
</div>
<div class="callout-body-container callout-body">
<p>Attention aux résultats entre le test de la v2 et de la v3 de <code>survival</code>. Les deux sont présentés, avec un test reposant sur une régression linéaire entre les résidus de Schoenfeld et une fonction de la durée (ici f(t)=t): OLS dans le cas du test simplifié et GLS dans le cas du test exact. Le passage d’un test à l’autre ne me semble pas neutre du point de vue des données utilisées, en particulier celles qui mesurent la durée. Pour illustrer le problème les résultats du test de Grambsch-Therneau sont donnés pour les deux versions.</p>
<p>Pour l’instant je préconise de rester à la version antérieure du test, en raison de son lien très fort avec une régression linéaire entre les résidus standardisés et une fonction de la durée, mais également en termes de reproductibilité, les autres applications utilisant cette version originale. Je donne la marche à suivre pour exécuter ce test.</p>
<p>Dans une analyse, je conseille de préciser dans une analyse la version du test qui a été exécutée. Le test simplifié est actuellement la seule solution dans Stata, Sas ou Python.</p>
</div>
</div>
<p><strong><span style="color: #CC0066">Résultat du test avec la v3 de survival</span></strong></p>
<p>Avec <code>transform="km"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>        chisq df     p
year    3.309  1 0.069
age     0.922  1 0.337
surgery 5.494  1 0.019
GLOBAL  8.581  3 0.035</code></pre>
</div>
</div>
<p>Avec <code>transform="identity"</code> (<span class="math inline">\(f(t)=t\)</span>) [remarque: solution de Stata par défaut].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>        chisq df     p
year     4.54  1 0.033
age      1.71  1 0.191
surgery  4.92  1 0.027
GLOBAL   9.47  3 0.024</code></pre>
</div>
</div>
<p>Remarque: avec la v3, quelques options ont été ajoutées tel que <em><code>terms</code></em> qui permet pour une variable catégorielle à plus de deux modalités de choisir entre un sous test multiple sur la variable (k modalités =&gt; k-1 degré de liberté) et une série de tests à 1 degré de liberté sur chaque modalité (k-1 tests). De mon point de vue préférer la seconde solution avec <strong><code>terms=FALSE</code></strong>.</p>
<p><strong><span style="color: #CC0066">Résultat du test avec la v2 de survival</span></strong></p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><span style="color:#CC0066"> J’ai récupéré la fonction de la version précédente de survival (identique Sas, Stata, Python), renommée <code>cox.zphold</code>. Elle se trouve à cette adresse. :[<a href="https://github.com/mthevenin/analyse_duree/tree/main/cox.zphold" class="uri">https://github.com/mthevenin/analyse_duree/tree/main/cox.zphold</a>].</span></p>
<ul>
<li>Une fois enregistrée avec comme nom de fichier <code>cox.zphold.R</code>, la charger dans le programme d’analyse avec la fonction <code>source()</code></li>
<li>Après avoir estimé le modèle de Cox, exécuter la fonction <strong><code>cox.zphold()</code></strong></li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"D:/D/Marc/SMS/FORMATIONS/2022/Durée2/a distribuer/cox.zphold.R"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery,   <span class="at">data =</span> trans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>          rho chisq      p
year    0.159  1.96 0.1620
age     0.109  1.15 0.2845
surgery 0.251  3.96 0.0465
GLOBAL     NA  7.99 0.0462</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>          rho chisq      p
year    0.102 0.797 0.3720
age     0.129 1.612 0.2043
surgery 0.297 5.539 0.0186
GLOBAL     NA 8.756 0.0327</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Régression linéaire ordinaire sur les résidus de Schoenfeld
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour information, avec une OLS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>resid<span class="ot">=</span> <span class="fu">resid</span>(coxfit, <span class="at">type=</span><span class="st">"scaledsch"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">names</span>(coxfit<span class="sc">$</span>coefficients)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>coln <span class="ot">=</span> <span class="fu">c</span>(varnames)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resid) <span class="ot">=</span> <span class="fu">c</span>(coln)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>times    <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dimnames</span>(resid)[[<span class="dv">1</span>]])</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> <span class="fu">data.frame</span>(resid)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> <span class="fu">cbind</span>(resid, <span class="at">t=</span>times)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>year    <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(year<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>age     <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(age<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>surgery <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(surgery<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values de l'OLS #</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour year:"</span>,    year<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>[1] "p-value pour year: 0.38565336851861"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour age:"</span>,     age<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>[1] "p-value pour age: 0.268640363261224"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour surgery:"</span>, surgery<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>[1] "p-value pour surgery: 0.00975820981508909"</code></pre>
</div>
</div>
<p>On est trés proche des résulats du test simplifié effectué avec la v2 de <code>survival</code>. Et c’est tout à fait normal.</p>
</div>
</div>
</section>
<section id="introduction-dune-intéraction" class="level3">
<h3 class="anchored" data-anchor-id="introduction-dune-intéraction">Introduction d’une intéraction</h3>
<p>Lorsque la covariable n’est pas continue, elle doit être transformée en indicatrice. Vérifier que les résultats du modèle sont bien identiques avec le modèle estimé précédemment (ne pas oublier d’omettre le niveau en référence).<br>
Ici la variable surgery est déjà sous forme d’indicatrice (0,1).<br>
La variable d’intéraction est <strong><code>tt(nom-variable)</code></strong>, la fonction de la durée (ici forme linéaire simple) est indiquée en option de la fonction: <strong><code>tt = function(x, t, ...) x*t</code></strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> <span class="fu">tt</span>(surgery), <span class="at">data =</span> trans, <span class="at">tt =</span> <span class="cf">function</span>(x, t, ...) x<span class="sc">*</span>t)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
coxph(formula = Surv(stime, died) ~ year + age + surgery + tt(surgery), 
    data = trans, tt = function(x, t, ...) x * t)

  n= 103, number of events= 75 

                 coef exp(coef)  se(coef)      z Pr(&gt;|z|)   
year        -0.123074  0.884198  0.066835 -1.841  0.06555 . 
age          0.028888  1.029310  0.013449  2.148  0.03172 * 
surgery     -1.754738  0.172953  0.674391 -2.602  0.00927 **
tt(surgery)  0.002231  1.002234  0.001102  2.024  0.04299 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

            exp(coef) exp(-coef) lower .95 upper .95
year           0.8842     1.1310   0.77564    1.0080
age            1.0293     0.9715   1.00253    1.0568
surgery        0.1730     5.7819   0.04612    0.6486
tt(surgery)    1.0022     0.9978   1.00007    1.0044

Concordance= 0.656  (se = 0.032 )
Likelihood ratio test= 21.58  on 4 df,   p=2e-04
Wald test            = 16.99  on 4 df,   p=0.002
Score (logrank) test = 19  on 4 df,   p=8e-04</code></pre>
</div>
</div>
<p><strong>Rappel</strong>: le paramètre estimé pour <strong><code>tt(surgery)</code></strong> ne reporte pas un rapport de risques, mais un rapport de de deux rapports de risques (c’est bien une double différence sur l’échelle d’estimation - log -).</p>
<p><br></p>
</section>
</section>
<section id="variable-dynamique-binaire" class="level2">
<h2 class="anchored" data-anchor-id="variable-dynamique-binaire"><strong>Variable dynamique (binaire)</strong></h2>
<p>La dimension dynamique est le fait d’avoir été opéré pour une greffe du coeur.<br>
<br></p>
<ul>
<li><strong>Etape 1</strong>: créer un vecteur donnant les durées aux temps d’évènement.</li>
<li><strong>Etape 2</strong>: appliquer ce vecteurs de points de coupure à la fonction <code>survsplit</code>.</li>
<li><strong>Etape 3</strong>: modifier la variable transplant (ou créer une nouvelle) à l’aide de la variable <strong>wait</strong> qui prend la valeur 1 à partir du jour de la greffe, 0 avant.</li>
</ul>
<p><em>Etape 1</em> Création de l’objet cut (vecteur)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cut<span class="ot">=</span> <span class="fu">unique</span>(trans<span class="sc">$</span>stime[trans<span class="sc">$</span>died <span class="sc">==</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Etape 2</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>tvc <span class="ot">=</span> <span class="fu">survSplit</span>(<span class="at">data =</span> trans, <span class="at">cut =</span> cut, <span class="at">end =</span> <span class="st">"stime"</span>, <span class="at">start =</span> <span class="st">"stime0"</span>, <span class="at">event =</span> <span class="st">"died"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remarque: pour estimer le modèle de Cox de départ avec cette base longue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> tvc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
coxph(formula = Surv(stime0, stime, died) ~ year + age + surgery, 
    data = tvc)

            coef exp(coef) se(coef)      z      p
year    -0.11963   0.88725  0.06734 -1.776 0.0757
age      0.02958   1.03002  0.01352  2.187 0.0287
surgery -0.98732   0.37257  0.43626 -2.263 0.0236

Likelihood ratio test=17.63  on 3 df, p=0.0005243
n= 3573, number of events= 75 </code></pre>
</div>
</div>
<p><em>Etape 3</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tvc<span class="sc">$</span>tvc<span class="ot">=</span><span class="fu">ifelse</span>(tvc<span class="sc">$</span>transplant<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> tvc<span class="sc">$</span>wait<span class="sc">&lt;=</span>tvc<span class="sc">$</span>stime,<span class="dv">1</span>,<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Estimation du modèle</strong><br>
En format long, on doit préciser dans la formule l’intervalle de durée avec les variables stime0 (début) et stime(fin)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tvcfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> tvc, <span class="at">data =</span> tvc)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tvcfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
coxph(formula = Surv(stime0, stime, died) ~ year + age + surgery + 
    tvc, data = tvc)

  n= 3573, number of events= 75 

            coef exp(coef) se(coef)      z Pr(&gt;|z|)  
year    -0.12032   0.88664  0.06734 -1.787   0.0740 .
age      0.03044   1.03091  0.01390  2.190   0.0285 *
surgery -0.98289   0.37423  0.43655 -2.251   0.0244 *
tvc     -0.08221   0.92108  0.30484 -0.270   0.7874  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        exp(coef) exp(-coef) lower .95 upper .95
year       0.8866      1.128    0.7770    1.0117
age        1.0309      0.970    1.0032    1.0594
surgery    0.3742      2.672    0.1591    0.8805
tvc        0.9211      1.086    0.5068    1.6741

Concordance= 0.659  (se = 0.032 )
Likelihood ratio test= 17.7  on 4 df,   p=0.001
Wald test            = 15.79  on 4 df,   p=0.003
Score (logrank) test = 16.74  on 4 df,   p=0.002</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(tvcfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .get_data(model, data = data): The `data` argument is not provided.
Data will be extracted from model fit.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="R_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="analyse-en-temps-discret" class="level1">
<h1><strong>Analyse en temps discret</strong></h1>
<p>Pour la durée, on va utiliser la variable mois (en fait regroupement sur 30 jours).<br>
La fonction <code>uncount</code> du package <code>tidy</code> permettra de splitter la base au temps d’observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">uncount</span>(trans,mois)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> dt[<span class="fu">order</span>(dt<span class="sc">$</span>id),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre class="result"><code>

|    | id| year| age| died| stime| surgery| transplant| wait| compet|
|:---|--:|----:|---:|----:|-----:|-------:|----------:|----:|------:|
|48  |  1|   67|  30|    1|    50|       0|          0|    0|      1|
|49  |  1|   67|  30|    1|    50|       0|          0|    0|      1|
|10  |  2|   68|  51|    1|     6|       0|          0|    0|      1|
|18  |  3|   68|  54|    1|    16|       0|          1|    1|      1|
|36  |  4|   68|  40|    1|    39|       0|          1|   36|      2|
|37  |  4|   68|  40|    1|    39|       0|          1|   36|      2|
|20  |  5|   68|  20|    1|    18|       0|          0|    0|      1|
|5   |  6|   68|  54|    1|     3|       0|          0|    0|      2|
|466 |  7|   68|  50|    1|   675|       0|          1|   51|      1|
|467 |  7|   68|  50|    1|   675|       0|          1|   51|      1|
|468 |  7|   68|  50|    1|   675|       0|          1|   51|      1|</code></pre>
</div>
</div>
<p>La variable mois a été supprimée, on va générer une variable type compteur pour mesurer la durée à chaque point d’observation. On va également recréer la variable (renommée T).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>T <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>sum)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, ],)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>

|    | id| year| age| died| stime| surgery| transplant| wait| compet|  x|  t|  T|
|:---|--:|----:|---:|----:|-----:|-------:|----------:|----:|------:|--:|--:|--:|
|48  |  1|   67|  30|    1|    50|       0|          0|    0|      1|  1|  1|  2|
|49  |  1|   67|  30|    1|    50|       0|          0|    0|      1|  1|  2|  2|
|10  |  2|   68|  51|    1|     6|       0|          0|    0|      1|  1|  1|  1|
|18  |  3|   68|  54|    1|    16|       0|          1|    1|      1|  1|  1|  1|
|36  |  4|   68|  40|    1|    39|       0|          1|   36|      2|  1|  1|  2|
|37  |  4|   68|  40|    1|    39|       0|          1|   36|      2|  1|  2|  2|
|20  |  5|   68|  20|    1|    18|       0|          0|    0|      1|  1|  1|  1|
|5   |  6|   68|  54|    1|     3|       0|          0|    0|      2|  1|  1|  1|
|466 |  7|   68|  50|    1|   675|       0|          1|   51|      1|  1|  1| 23|
|467 |  7|   68|  50|    1|   675|       0|          1|   51|      1|  1|  2| 23|
|468 |  7|   68|  50|    1|   675|       0|          1|   51|      1|  1|  3| 23|</code></pre>
</div>
</div>
<p><em>Remarque : j’utilise ici le code standard de R, on peut faire la même chose avec dplyr de manière plus rapide (mise à jour à prévoir)</em>.<br>
<br> Si un individu est décédé, died=1 est reporté sur toute les lignes (idem qu’avec la variable dynamique). On va modifier la variable tel que <em>died=0 si t&lt;T$</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>died[dt<span class="sc">$</span>t<span class="sc">&lt;</span>dt<span class="sc">$</span>T]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, ],)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>

|    | id| year| age| died| stime| surgery| transplant| wait| compet|  x|  t|  T|
|:---|--:|----:|---:|----:|-----:|-------:|----------:|----:|------:|--:|--:|--:|
|48  |  1|   67|  30|    0|    50|       0|          0|    0|      1|  1|  1|  2|
|49  |  1|   67|  30|    1|    50|       0|          0|    0|      1|  1|  2|  2|
|10  |  2|   68|  51|    1|     6|       0|          0|    0|      1|  1|  1|  1|
|18  |  3|   68|  54|    1|    16|       0|          1|    1|      1|  1|  1|  1|
|36  |  4|   68|  40|    0|    39|       0|          1|   36|      2|  1|  1|  2|
|37  |  4|   68|  40|    1|    39|       0|          1|   36|      2|  1|  2|  2|
|20  |  5|   68|  20|    1|    18|       0|          0|    0|      1|  1|  1|  1|
|5   |  6|   68|  54|    1|     3|       0|          0|    0|      2|  1|  1|  1|
|466 |  7|   68|  50|    0|   675|       0|          1|   51|      1|  1|  1| 23|
|467 |  7|   68|  50|    0|   675|       0|          1|   51|      1|  1|  2| 23|
|468 |  7|   68|  50|    0|   675|       0|          1|   51|      1|  1|  3| 23|</code></pre>
</div>
</div>
<p><br></p>
<section id="ft-quantitative" class="level2">
<h2 class="anchored" data-anchor-id="ft-quantitative"><strong><span class="math inline">\(f(t)\)</span> quantitative</strong></h2>
<p>Avec un effet quadratique d’ordre 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t2<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>dtfit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data=</span>dt, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(dtfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>MODEL INFO:
Observations: 1127
Dependent Variable: died
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 84.70, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.19
Pseudo-R² (McFadden) = 0.15
AIC = 478.67, BIC = 508.83 

Standard errors: MLE
------------------------------------------------
                     Est.   S.E.   z val.      p
----------------- ------- ------ -------- ------
(Intercept)          7.74   5.22     1.48   0.14
t                   -0.20   0.04    -5.63   0.00
t2                   0.00   0.00     3.98   0.00
year                -0.15   0.07    -2.04   0.04
age                  0.03   0.01     2.35   0.02
surgery             -1.00   0.45    -2.24   0.02
------------------------------------------------</code></pre>
</div>
</div>
<p>*<strong>Remarque sur la présentation de l’output</strong>: la fonction <code>summ</code> est intégrée au package <code>jtools</code>. Elle ne fonctionne qu’avec le package <code>Recordlinkage</code> qui doit être installé et chargé.</p>
</section>
<section id="ft-discrète" class="level2">
<h2 class="anchored" data-anchor-id="ft-discrète"><strong><span class="math inline">\(f(t)\)</span> discrète </strong></h2>
<p>On va créer une variable de type dicrète regroupant la variable <em>t</em> sur ses quartiles (pour l’exemple seulement, tous types de regroupement est envisageable).<br>
On va utiliser la fonction <code>quantcut</code> du package <code>gtools</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ct4 <span class="ot">&lt;-</span> <span class="fu">quantcut</span>(dt<span class="sc">$</span>t)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt<span class="sc">$</span>ct4) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
  [1,4]  (4,11] (11,23] (23,60] 
    299     275     282     271 </code></pre>
</div>
</div>
<p>On va générer un compteur et un total d’observations sur la strate regroupant <em>id</em> et <em>ct4</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>n <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>cumsum)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>N <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On conserve la dernière observation dans la strate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">subset</span>(dt, n<span class="sc">==</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Estimation du modèle</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> ct4 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data=</span>dt2, <span class="at">family=</span>binomial)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>MODEL INFO:
Observations: 197
Dependent Variable: died
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(6) = 39.30, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.25
Pseudo-R² (McFadden) = 0.15
AIC = 236.48, BIC = 259.46 

Standard errors: MLE
------------------------------------------------
                     Est.   S.E.   z val.      p
----------------- ------- ------ -------- ------
(Intercept)         12.45   6.65     1.87   0.06
ct4(4,11]           -1.03   0.42    -2.47   0.01
ct4(11,23]          -1.62   0.54    -2.96   0.00
ct4(23,60]          -0.48   0.60    -0.80   0.42
year                -0.20   0.09    -2.18   0.03
age                  0.05   0.02     2.53   0.01
surgery             -1.11   0.50    -2.21   0.03
------------------------------------------------</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="modèles-usuels" class="level1">
<h1><strong>Modèles usuels</strong></h1>
<p>On utilise la fonction <code>survreg</code> du package <code>survival</code></p>
<section id="modèle-de-weibull" class="level2">
<h2 class="anchored" data-anchor-id="modèle-de-weibull"><strong>Modèle de Weibull</strong></h2>
<p><strong>De type AFT</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>weibull <span class="ot">=</span> <span class="fu">survreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibull"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weibull)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
Call:
survreg(formula = Surv(stime, died) ~ year + age + surgery, data = trans, 
    dist = "weibull")
              Value Std. Error     z       p
(Intercept) -3.0220     8.7284 -0.35   0.729
year         0.1620     0.1218  1.33   0.184
age         -0.0615     0.0247 -2.49   0.013
surgery      1.9703     0.7794  2.53   0.011
Log(scale)   0.5868     0.0927  6.33 2.5e-10

Scale= 1.8 

Weibull distribution
Loglik(model)= -488.2   Loglik(intercept only)= -497.6
    Chisq= 18.87 on 3 degrees of freedom, p= 0.00029 
Number of Newton-Raphson Iterations: 5 
n= 103 </code></pre>
</div>
</div>
<p><strong>De type PH</strong><br>
<br> La paramétrisation PH n’est pas possible avec la fonction <code>survreg</code>.<br>
Il faut utiliser le package <code>flexsurv</code>, qui permet également d’estimer les modèles paramétriques disponibles avec <code>survival</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour estimer le modèle de Weibull de type PH, on utilise en option <code>dist="weibullPH"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">flexsurvreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibullPH"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Call:
flexsurvreg(formula = Surv(stime, died) ~ year + age + surgery, 
    data = trans, dist = "weibullPH")

Estimates: 
         data mean  est        L95%       U95%       se         exp(est) 
shape           NA   5.56e-01   4.64e-01   6.67e-01   5.16e-02         NA
scale           NA   5.37e+00   4.27e-04   6.75e+04   2.59e+01         NA
year      7.06e+01  -9.01e-02  -2.20e-01   3.97e-02   6.62e-02   9.14e-01
age       4.46e+01   3.42e-02   7.13e-03   6.13e-02   1.38e-02   1.03e+00
surgery   1.17e-01  -1.10e+00  -1.95e+00  -2.45e-01   4.34e-01   3.34e-01
         L95%       U95%     
shape           NA         NA
scale           NA         NA
year      8.03e-01   1.04e+00
age       1.01e+00   1.06e+00
surgery   1.43e-01   7.83e-01

N = 103,  Events: 75,  Censored: 28
Total time at risk: 31938
Log-likelihood = -488.1683, df = 5
AIC = 986.3366</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="risques-concurrents" class="level1">
<h1><strong>Risques concurrents</strong></h1>
<p>Package <code>cmprsk</code> pour l’analyse paramétrique et le modèle de Fine-Gray.</p>
<p>Package cmprsk pour l’analyse non paramétrique et le modèle de Fine-Gray. La variable de censure/évènement, <em>compet</em>, correspond à la variable died avec une modalité supplémentaire simulée. On suppose l’existence d’une cause supplémentaire au décès autre qu’une malformation cardiaque et non strictement indépendante de cell-ci.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variable compet</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>compet) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
 0  1  2 
28 56 19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variable died</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>died) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
 0  1 
28 75 </code></pre>
</div>
</div>
<section id="incidences-cumulées" class="level2">
<h2 class="anchored" data-anchor-id="incidences-cumulées"><strong>Incidences cumulées</strong></h2>
<p>On utilise la fonction <code>cuminc</code> du package <code>cmprsk</code>.</p>
<p><em>Pas de comparaison</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>ic </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Estimates and Variances:
$est
          500      1000      1500
1 1 0.5067598 0.5808345 0.6340038
1 2 0.1720161 0.2140841 0.2140841

$var
            500        1000        1500
1 1 0.002619449 0.003131847 0.003676516
1 2 0.001473283 0.002203770 0.002203770</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="R_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Avec survminer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="R_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><em>Comparaison</em></p>
<p>Le test de Gray est automatiquement exécuté.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, <span class="at">group=</span>compet<span class="sc">$</span>surgery, <span class="at">rho=</span><span class="dv">1</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ic </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Tests:
      stat         pv df
1 4.604792 0.03188272  1
2 0.272147 0.60189515  1
Estimates and Variances:
$est
           500      1000      1500
0 1 0.54917896 0.5940358 0.6604903
1 1 0.18181818 0.4242424        NA
0 2 0.18168014 0.2066006 0.2066006
1 2 0.09090909 0.2121212        NA

$var
            500        1000        1500
0 1 0.002955869 0.003335897 0.004199157
1 1 0.014958678 0.033339569          NA
0 2 0.001727112 0.002271242 0.002271242
1 2 0.008449138 0.022024737          NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="R_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Avec survminer. Pour avoir un seul graphique pour toutes les courbes ajouter l’option <strong><code>multiple_panels = F</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="R_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic, <span class="at">multiple_panels =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="R_files/figure-html/unnamed-chunk-46-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="R_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="modèles" class="level2">
<h2 class="anchored" data-anchor-id="modèles"><strong>Modèles</strong></h2>
<section id="fine-gray" class="level3">
<h3 class="anchored" data-anchor-id="fine-gray"><strong>Fine-Gray</strong></h3>
<p>Attention à l’interprétation des “Risks/Hazards ratio”. Modèle dont l’utilisation est assez critiquée, il n’est pas impossible que le retire à un moment ou un autre. Comme on travaille</p>
<p>Fonction <code>crr</code> du plackage <code>cmprsk</code>.<br>
Peu pratique les covariables doivent être introduites sous forme de matrice (n observation * k variables). Pour les covariables discrètes, prévoir la forme binaire et l’omission de la catégorie de référence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> compet[<span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"surgery"</span>)]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">as.matrix</span>(c)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">crr</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>Competing Risks Regression

Call:
crr(ftime = compet$stime, fstatus = compet$compet, cov1 = c)

           coef exp(coef) se(coef)     z p-value
year    -0.0724     0.930   0.0713 -1.02   0.310
age      0.0370     1.038   0.0176  2.10   0.036
surgery -0.8688     0.419   0.4488 -1.94   0.053

        exp(coef) exp(-coef)  2.5% 97.5%
year        0.930      1.075 0.809  1.07
age         1.038      0.964 1.002  1.07
surgery     0.419      2.384 0.174  1.01

Num. cases = 103
Pseudo Log-likelihood = -228 
Pseudo likelihood ratio test = 11.2  on 3 df,</code></pre>
</div>
</div>
</section>
<section id="modèle-multinomial" class="level3">
<h3 class="anchored" data-anchor-id="modèle-multinomial"><strong>Modèle multinomial</strong></h3>
<p>On va de nouveau utiliser la variable mois (temps discret).<br>
Le modèle sera estimé à l’aide la fonction <code>multinom</code> du package <code>nnet</code>, les p-values doivent-être programmées, l’output ne donnant que les erreurs-types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("nnet")</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Transformation de la base</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>compet<span class="sc">$</span>T <span class="ot">=</span> compet<span class="sc">$</span>mois</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">uncount</span>(compet, mois)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(td<span class="sc">$</span>x, td<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t2 <span class="ot">=</span> td<span class="sc">$</span>t<span class="sc">*</span>td<span class="sc">$</span>t</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(td<span class="sc">$</span>t<span class="sc">&lt;</span>td<span class="sc">$</span>T,<span class="dv">0</span>, td<span class="sc">$</span>compet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Estimation</em></p>
<p>Pour estimer le modèle, on utilise la fonction <code>mlogit</code> du package <code>nnet</code>. Les p-values seront calculées à partir d’un test bilatéral (statistique z). Pour avoir un output correct, on peut conseiler le package gtsummary (fonction <code>tlb_regression</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>competfit <span class="ot">=</span> <span class="fu">multinom</span>(<span class="at">formula =</span> e <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> td)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code># weights:  21 (12 variable)
initial  value 1238.136049 
iter  10 value 579.836377
iter  20 value 387.824428
iter  30 value 277.775477
iter  40 value 275.151304
iter  50 value 275.005454
final  value 275.005419 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(competfit)</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#z = summary(competfit)$coefficients/summary(competfit)$standard.errors</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#p &lt;- (1 - pnorm(abs(z), 0, 1)) * 2</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co">#p</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(competfit, <span class="at">type =</span> <span class="st">"text"</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">star.cutoffs =</span> <span class="cn">NA</span>, <span class="at">omit.table.layout =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="result"><code>
====================================================
                         Dependent variable:        
                  ----------------------------------
                         1                 2        
                        (1)               (2)       
----------------------------------------------------
t                      -0.203           -0.202      
                  (-0.284, -0.123) (-0.338, -0.067) 
                                                    
t2                     0.003             0.003      
                   (0.001, 0.005)  (-0.00003, 0.006)
                                                    
year                   -0.128           -0.204      
                  (-0.151, -0.106) (-0.235, -0.172) 
                                                    
age                    0.044             0.011      
                   (0.011, 0.077)   (-0.036, 0.058) 
                                                    
surgery                -1.147           -0.614      
                  (-2.190, -0.105)  (-2.106, 0.878) 
                                                    
Constant               5.647            11.316      
                   (5.632, 5.662)  (11.290, 11.342) 
                                                    
----------------------------------------------------
Akaike Inf. Crit.     574.011           574.011     
====================================================</code></pre>
</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./frailty.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Fragilité et immunité</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Stata.html" class="pagination-link">
        <span class="nav-page-text">Stata</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb96" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "R"</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">   - lightbox</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">render =</span> knitr<span class="sc">::</span>normal_print)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (shiny)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (rsconnect)</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(memisc)</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>Programme de cette section: <span class="co">[</span><span class="ot">Lien</span><span class="co">](programme_R.R)</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Packages et fonctions</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Listes</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>| **Analyse**                             | Packages - fonctions                                  |</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>+=========================================+=======================================================+</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>| **Non paramétrique**                    | -   <span class="in">`discsurv`</span>                                        |</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`lifetable`</span>                                   |</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`contToDisc`</span>                                  |</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survfit`</span>                                     |</span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survdif`</span>                                     |</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`survRM2`</span>                                         |</span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`rmst2`</span>                                       |</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>| **Modèles à risques proportionnel**     | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`coxph`</span>                                       |</span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`cox.zph`</span> (v3) <span class="in">`cox.zphold`</span> (récupération v2) |</span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survsplit`</span>                                   |</span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>|                                         | -   base et <span class="in">`tydir`</span>                                   |</span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`uncount`</span>                                     |</span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`glm`</span>                                         |</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a>| **Modèles paramétriques (ph ou aft)**   | -   <span class="in">`survival`</span>                                        |</span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survreg`</span>                                     |</span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`flexsurv`</span>                                        |</span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`survreg`</span>                                     |</span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>| **Risques concurents**                  | -   <span class="in">`cmprsk`</span>                                          |</span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`cuminc`</span>                                      |</span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`nnet`</span>                                            |</span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a>|                                         |     -   <span class="in">`multinom`</span>                                    |</span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a>| **Autres (graphiques - mise en forme)** | -   <span class="in">`survminer`</span>                                       |</span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`jtools`</span>                                          |</span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a>|                                         |                                                       |</span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a>|                                         | -   <span class="in">`stargazer`</span> - <span class="in">`gtsummary`</span>                         |</span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a>+-----------------------------------------+-------------------------------------------------------+</span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Installation**</span></span>
<span id="cb96-79"><a href="#cb96-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-80"><a href="#cb96-80" aria-hidden="true" tabindex="-1"></a>Les dernières versions de certains packages peuvent être installées via Github (ex: <span class="in">`survminer`</span>). Pour les récupérer, passer par le package ```devtools```.  </span>
<span id="cb96-81"><a href="#cb96-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-82"><a href="#cb96-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-83"><a href="#cb96-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb96-84"><a href="#cb96-84" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survival")</span></span>
<span id="cb96-85"><a href="#cb96-85" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survminer")</span></span>
<span id="cb96-86"><a href="#cb96-86" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("flexsurv")</span></span>
<span id="cb96-87"><a href="#cb96-87" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survRM2")</span></span>
<span id="cb96-88"><a href="#cb96-88" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyr")</span></span>
<span id="cb96-89"><a href="#cb96-89" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtools")</span></span>
<span id="cb96-90"><a href="#cb96-90" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("jtools")</span></span>
<span id="cb96-91"><a href="#cb96-91" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("RecordLinkage")</span></span>
<span id="cb96-92"><a href="#cb96-92" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtsummary")</span></span>
<span id="cb96-93"><a href="#cb96-93" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("cmprsk")</span></span>
<span id="cb96-94"><a href="#cb96-94" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("gtsummary")</span></span>
<span id="cb96-95"><a href="#cb96-95" aria-hidden="true" tabindex="-1"></a><span class="co">#install.package(stargazer)</span></span>
<span id="cb96-96"><a href="#cb96-96" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("muhaz")</span></span>
<span id="cb96-97"><a href="#cb96-97" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb96-98"><a href="#cb96-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb96-99"><a href="#cb96-99" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb96-100"><a href="#cb96-100" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survRM2)</span>
<span id="cb96-101"><a href="#cb96-101" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb96-102"><a href="#cb96-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb96-103"><a href="#cb96-103" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb96-104"><a href="#cb96-104" aria-hidden="true" tabindex="-1"></a><span class="co">#library(RecordLinkage)</span></span>
<span id="cb96-105"><a href="#cb96-105" aria-hidden="true" tabindex="-1"></a><span class="co">#library(gtsummary)</span></span>
<span id="cb96-106"><a href="#cb96-106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span>
<span id="cb96-107"><a href="#cb96-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discSurv)</span>
<span id="cb96-108"><a href="#cb96-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(muhaz)</span>
<span id="cb96-109"><a href="#cb96-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb96-110"><a href="#cb96-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-111"><a href="#cb96-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-112"><a href="#cb96-112" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-113"><a href="#cb96-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-114"><a href="#cb96-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Survival v2 versus v3**</span></span>
<span id="cb96-115"><a href="#cb96-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-116"><a href="#cb96-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-117"><a href="#cb96-117" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-118"><a href="#cb96-118" aria-hidden="true" tabindex="-1"></a>Se reporter à la partie sur les risques proportionnels.   </span>
<span id="cb96-119"><a href="#cb96-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-120"><a href="#cb96-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filename=" installation survival 2.44-1 (30 mars 2019)", eval=FALSE}</span></span>
<span id="cb96-121"><a href="#cb96-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-122"><a href="#cb96-122" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(remotes)</span>
<span id="cb96-123"><a href="#cb96-123" aria-hidden="true" tabindex="-1"></a><span class="fu">install_version</span>(<span class="st">"survival"</span>, <span class="at">version =</span> <span class="st">"2.44-1"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb96-124"><a href="#cb96-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-125"><a href="#cb96-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-126"><a href="#cb96-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-127"><a href="#cb96-127" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Analyse Non paramétrique**</span></span>
<span id="cb96-128"><a href="#cb96-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-129"><a href="#cb96-129" aria-hidden="true" tabindex="-1"></a>Chargement de la base transplantation</span>
<span id="cb96-130"><a href="#cb96-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-133"><a href="#cb96-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-134"><a href="#cb96-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb96-135"><a href="#cb96-135" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb96-136"><a href="#cb96-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-137"><a href="#cb96-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-138"><a href="#cb96-138" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-139"><a href="#cb96-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-140"><a href="#cb96-140" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Méthode actuarielle**</span></span>
<span id="cb96-141"><a href="#cb96-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-142"><a href="#cb96-142" aria-hidden="true" tabindex="-1"></a>La fonction disponible du paquet <span class="in">`discsurv`</span>, *`lifetable`*, a des fonctionalités plutôt limitées. Si on peut depuis une MAJ récente définir des intervalles de durée, il n'y a toujours pas d'estimateurs les différents quantiles de la courbe de survie.   </span>
<span id="cb96-143"><a href="#cb96-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-144"><a href="#cb96-144" aria-hidden="true" tabindex="-1"></a>Pire, la programmation est rendue un peu compliquée pour pas grand chose. On doit s'assurer que la base est bien en format <span class="in">`data.frame`</span>.   </span>
<span id="cb96-145"><a href="#cb96-145" aria-hidden="true" tabindex="-1"></a>Je donne les codes pour info, sans plus de commentaires.</span>
<span id="cb96-146"><a href="#cb96-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-149"><a href="#cb96-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-150"><a href="#cb96-150" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">=</span> <span class="fu">as.data.frame</span>(trans)</span>
<span id="cb96-151"><a href="#cb96-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-152"><a href="#cb96-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-153"><a href="#cb96-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-154"><a href="#cb96-154" aria-hidden="true" tabindex="-1"></a>**Fonction `lifeTable`**  </span>
<span id="cb96-155"><a href="#cb96-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-156"><a href="#cb96-156" aria-hidden="true" tabindex="-1"></a>***Intervalle par defaut $dt=1$***  </span>
<span id="cb96-157"><a href="#cb96-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-158"><a href="#cb96-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, class.output="result"}</span></span>
<span id="cb96-159"><a href="#cb96-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "S(t) méthode actuarielle avec `discSurv` (1)"</span></span>
<span id="cb96-160"><a href="#cb96-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-161"><a href="#cb96-161" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">=</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb96-162"><a href="#cb96-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-163"><a href="#cb96-163" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles t = journalier"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span>
<span id="cb96-164"><a href="#cb96-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-165"><a href="#cb96-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-166"><a href="#cb96-166" aria-hidden="true" tabindex="-1"></a>***Intervalle $dt=30$***</span>
<span id="cb96-167"><a href="#cb96-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE, class.output="result"}</span></span>
<span id="cb96-168"><a href="#cb96-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap:  "S(t) méthode actuarielle avec `discSurv` (2)"</span></span>
<span id="cb96-169"><a href="#cb96-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-170"><a href="#cb96-170" aria-hidden="true" tabindex="-1"></a><span class="co"># On définit le vecteur des intervalles (il n'y avait pas plus simple????)</span></span>
<span id="cb96-171"><a href="#cb96-171" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(<span class="fu">max</span>(trans<span class="sc">$</span>stime)<span class="sc">/</span><span class="dv">30</span>)<span class="sc">*</span><span class="dv">30</span></span>
<span id="cb96-172"><a href="#cb96-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-173"><a href="#cb96-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Base dis avec une nouvelle variable de durée =&gt; timeDisc </span></span>
<span id="cb96-174"><a href="#cb96-174" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> <span class="fu">contToDisc</span>(<span class="at">dataShort=</span>trans, <span class="at">timeColumn=</span><span class="st">"stime"</span>, <span class="at">intervalLimits =</span> dt )</span>
<span id="cb96-175"><a href="#cb96-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-176"><a href="#cb96-176" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> <span class="fu">lifeTable</span>(<span class="at">dataShort=</span>dis, <span class="at">timeColumn=</span><span class="st">"timeDisc"</span>, <span class="at">eventColumn =</span> <span class="st">"died"</span>)</span>
<span id="cb96-177"><a href="#cb96-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-178"><a href="#cb96-178" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lt, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(lt<span class="sc">$</span>Output)[<span class="dv">1</span>], <span class="at">y =</span> lt<span class="sc">$</span>Output<span class="sc">$</span>S, <span class="at">xlab =</span> <span class="st">"Intervalles dt = 30 jours"</span>, <span class="at">ylab=</span><span class="st">"S(t)"</span>)</span>
<span id="cb96-179"><a href="#cb96-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-180"><a href="#cb96-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-181"><a href="#cb96-181" aria-hidden="true" tabindex="-1"></a>Sur les abcisses, ce sont les valeurs des intervalles qui sont reportés: 10=300 jours. Ce n'est vraiment pas terrible. Pour ce type d'estimateurs, il est préférable d'utiliser Sas ou Stata.</span>
<span id="cb96-182"><a href="#cb96-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-183"><a href="#cb96-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-184"><a href="#cb96-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Méthode Kaplan-Meier**</span></span>
<span id="cb96-185"><a href="#cb96-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-186"><a href="#cb96-186" aria-hidden="true" tabindex="-1"></a>Le package survival est le principal outil d'analyse des durée. Le package survminer permet d'améliorer la présentation des graphiques. </span>
<span id="cb96-187"><a href="#cb96-187" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-188"><a href="#cb96-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-189"><a href="#cb96-189" aria-hidden="true" tabindex="-1"></a>**Estimation des fonctions de survie**  </span>
<span id="cb96-190"><a href="#cb96-190" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-191"><a href="#cb96-191" aria-hidden="true" tabindex="-1"></a>Fonction ```survfit```  </span>
<span id="cb96-192"><a href="#cb96-192" aria-hidden="true" tabindex="-1"></a>Syntaxe</span>
<span id="cb96-193"><a href="#cb96-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb96-194"><a href="#cb96-194" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> x, <span class="at">data =</span> base)</span>
<span id="cb96-195"><a href="#cb96-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-196"><a href="#cb96-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-197"><a href="#cb96-197" aria-hidden="true" tabindex="-1"></a>On peut renseigner directement les variables permettant de calculer la durée et non la variable de durée elle-même. Cette méthode est utilisée lorsqu'on introduit une variable dynamique dans un modèle semi-paramétrique (<span class="in">`coxph`</span>).</span>
<span id="cb96-198"><a href="#cb96-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-199"><a href="#cb96-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb96-200"><a href="#cb96-200" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(variable_start, variable_end, status) <span class="sc">~</span> x, <span class="at">data =</span> nom_base)</span>
<span id="cb96-201"><a href="#cb96-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-202"><a href="#cb96-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-203"><a href="#cb96-203" aria-hidden="true" tabindex="-1"></a>Sans comparaison de groupes:  </span>
<span id="cb96-204"><a href="#cb96-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-205"><a href="#cb96-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-206"><a href="#cb96-206" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb96-207"><a href="#cb96-207" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb96-208"><a href="#cb96-208" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb96-209"><a href="#cb96-209" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span>
<span id="cb96-210"><a href="#cb96-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-211"><a href="#cb96-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-212"><a href="#cb96-212" aria-hidden="true" tabindex="-1"></a>Le premier output <span class="in">`fit`</span> permet d'obtenir la durée médiane, ici égale à 100 ($S(100)=0.494$). Le second  avec la fonction **`summary`** permet d'obtenir une table des estimateurs. La fonction de survie peut être tracée avec la fonction **`plot`** (en pointillés les intervalles de confiance).  </span>
<span id="cb96-213"><a href="#cb96-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-214"><a href="#cb96-214" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-215"><a href="#cb96-215" aria-hidden="true" tabindex="-1"></a>On peut obtenir des graphes de  meilleur qualité avec la librairie **`survminer`**.  </span>
<span id="cb96-216"><a href="#cb96-216" aria-hidden="true" tabindex="-1"></a>Avec la fonction **`ggsurvplot`**</span>
<span id="cb96-217"><a href="#cb96-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-218"><a href="#cb96-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-219"><a href="#cb96-219" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-220"><a href="#cb96-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-221"><a href="#cb96-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-222"><a href="#cb96-222" aria-hidden="true" tabindex="-1"></a>On peut ajouter la population encore soumise au risque à plusieurs points d'observation</span>
<span id="cb96-223"><a href="#cb96-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-224"><a href="#cb96-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-225"><a href="#cb96-225" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-226"><a href="#cb96-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-227"><a href="#cb96-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-228"><a href="#cb96-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-229"><a href="#cb96-229" aria-hidden="true" tabindex="-1"></a>**Comparaison des fonctions de survie** </span>
<span id="cb96-230"><a href="#cb96-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-231"><a href="#cb96-231" aria-hidden="true" tabindex="-1"></a>On va comparer les deuxfonctions de survie pour la variable *surgery*, celle pour les personnes non opérées et celle pour les personnes opérées.  </span>
<span id="cb96-232"><a href="#cb96-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-233"><a href="#cb96-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-234"><a href="#cb96-234" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb96-235"><a href="#cb96-235" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb96-236"><a href="#cb96-236" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">risk.table =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-237"><a href="#cb96-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-238"><a href="#cb96-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-239"><a href="#cb96-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-240"><a href="#cb96-240" aria-hidden="true" tabindex="-1"></a>**Tests du log-rank**</span>
<span id="cb96-241"><a href="#cb96-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-242"><a href="#cb96-242" aria-hidden="true" tabindex="-1"></a>On utilise la fonction **`survdiff`**, avec comme variante le test de Peto-Peto (<span class="in">`rho=1`</span>).  </span>
<span id="cb96-243"><a href="#cb96-243" aria-hidden="true" tabindex="-1"></a>La syntaxe est quasiment identique à la fonction <span class="in">`survdiff`</span>.  </span>
<span id="cb96-244"><a href="#cb96-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-245"><a href="#cb96-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-246"><a href="#cb96-246" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(stime, died) <span class="sc">~</span> surgery, <span class="at">rho=</span><span class="dv">1</span>, <span class="at">data =</span> trans)</span>
<span id="cb96-247"><a href="#cb96-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-248"><a href="#cb96-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-249"><a href="#cb96-249" aria-hidden="true" tabindex="-1"></a>Ici la variable est binaire. Si on veux tester deux à deux les niveaux d'une variable catégorielle à plus de deux modalités, on utilise la fonction **`pairwise_survdiff`** de <span class="in">`survminer`</span> (syntaxe identique que ```survdiff```).  </span>
<span id="cb96-250"><a href="#cb96-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-251"><a href="#cb96-251" aria-hidden="true" tabindex="-1"></a>**Comparaison des RMST**</span>
<span id="cb96-252"><a href="#cb96-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-253"><a href="#cb96-253" aria-hidden="true" tabindex="-1"></a>La fonction **`rmst2`** du package **`survRM2`** permet de comparer les RMST entre 2 groupes (et pas plus). La strate</span>
<span id="cb96-254"><a href="#cb96-254" aria-hidden="true" tabindex="-1"></a>pour les comparaisons doit être renommée *arm*. La fonction, issue d'une commande de Stata, n'est pas très souple.</span>
<span id="cb96-255"><a href="#cb96-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-256"><a href="#cb96-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-257"><a href="#cb96-257" aria-hidden="true" tabindex="-1"></a>trans<span class="sc">$</span>arm<span class="ot">=</span>trans<span class="sc">$</span>surgery</span>
<span id="cb96-258"><a href="#cb96-258" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">rmst2</span>(trans<span class="sc">$</span>stime, trans<span class="sc">$</span>died, trans<span class="sc">$</span>arm, <span class="at">tau=</span><span class="cn">NULL</span>)</span>
<span id="cb96-259"><a href="#cb96-259" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb96-260"><a href="#cb96-260" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a)</span>
<span id="cb96-261"><a href="#cb96-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-262"><a href="#cb96-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-263"><a href="#cb96-263" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-264"><a href="#cb96-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-265"><a href="#cb96-265" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Modèle de Cox**</span></span>
<span id="cb96-266"><a href="#cb96-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-267"><a href="#cb96-267" aria-hidden="true" tabindex="-1"></a>Ici tout est estimé avec des fonctions du package ```survival```:  </span>
<span id="cb96-268"><a href="#cb96-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-269"><a href="#cb96-269" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Estimation du modèle: ```coxph```.</span>
<span id="cb96-270"><a href="#cb96-270" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Test de Grambsch-Therneau: ```cox.zph```.</span>
<span id="cb96-271"><a href="#cb96-271" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Introduction d'une variable dynamique: ```survsplit```.</span>
<span id="cb96-272"><a href="#cb96-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-273"><a href="#cb96-273" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Estimation du modèle**</span></span>
<span id="cb96-274"><a href="#cb96-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-275"><a href="#cb96-275" aria-hidden="true" tabindex="-1"></a>Par défaut, R utilise la correction d'Efron pour les évènements simultanés. Il est préférable de ne pas la modifier.</span>
<span id="cb96-276"><a href="#cb96-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-277"><a href="#cb96-277" aria-hidden="true" tabindex="-1"></a>Syntaxe:</span>
<span id="cb96-278"><a href="#cb96-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-279"><a href="#cb96-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-280"><a href="#cb96-280" aria-hidden="true" tabindex="-1"></a><span class="in">coxph(Surv(time, status) ~ x1 + x2 + ....., data=base, ties="nom_correction"))</span></span>
<span id="cb96-281"><a href="#cb96-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-282"><a href="#cb96-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-283"><a href="#cb96-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-284"><a href="#cb96-284" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans)</span>
<span id="cb96-285"><a href="#cb96-285" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit)</span>
<span id="cb96-286"><a href="#cb96-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-287"><a href="#cb96-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-288"><a href="#cb96-288" aria-hidden="true" tabindex="-1"></a>La table des résultats reporte le logarithme des Risques Ratios (coef) ainsi que les RR (exp(coef)). Il est intéressant de regarder la valeur de concordance (Harrel's) qui donne des indications sur la qualité de l'ajustement (proche de l'AUC/ROC).  </span>
<span id="cb96-289"><a href="#cb96-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-290"><a href="#cb96-290" aria-hidden="true" tabindex="-1"></a>On peut représenter sous forme graphique les résultats avec la fonction **`ggforest`** de <span class="in">`survminer`</span></span>
<span id="cb96-291"><a href="#cb96-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-292"><a href="#cb96-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-293"><a href="#cb96-293" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(coxfit)</span>
<span id="cb96-294"><a href="#cb96-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-295"><a href="#cb96-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-296"><a href="#cb96-296" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Hypothèse PH**</span></span>
<span id="cb96-297"><a href="#cb96-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-298"><a href="#cb96-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-299"><a href="#cb96-299" aria-hidden="true" tabindex="-1"></a><span class="fu">### Test Grambsch-Therneau</span></span>
<span id="cb96-300"><a href="#cb96-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-301"><a href="#cb96-301" aria-hidden="true" tabindex="-1"></a>**Résidus de Schoenfeld**  </span>
<span id="cb96-302"><a href="#cb96-302" aria-hidden="true" tabindex="-1"></a>On utilise la fonction **`cox.zph`** pour effectuer ce test.  </span>
<span id="cb96-303"><a href="#cb96-303" aria-hidden="true" tabindex="-1"></a>Le test peut utiliser plusieurs fonctions de la durée. Par défaut la fonction utilise $1-KM$, soit le complémentaire de l'estimateur de Kaplan-Meier (option <span class="in">`transform="km"`</span>).</span>
<span id="cb96-304"><a href="#cb96-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-305"><a href="#cb96-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-306"><a href="#cb96-306" aria-hidden="true" tabindex="-1"></a>::: callout-warning </span>
<span id="cb96-307"><a href="#cb96-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-308"><a href="#cb96-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mise à jour à venir: test simplifié et test exact</span></span>
<span id="cb96-309"><a href="#cb96-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-310"><a href="#cb96-310" aria-hidden="true" tabindex="-1"></a>Attention aux résultats entre le test de la v2 et de la v3 de <span class="in">`survival`</span>. Les deux sont présentés, avec un test reposant sur une régression linéaire entre les résidus de Schoenfeld et une fonction de la durée (ici f(t)=t): OLS dans le cas du test simplifié et GLS dans le cas du test exact. Le passage d'un test à l'autre ne me semble pas neutre du point de vue des données utilisées, en particulier celles qui mesurent la durée. Pour illustrer le problème les résultats du test de Grambsch-Therneau sont donnés pour les deux versions.  </span>
<span id="cb96-311"><a href="#cb96-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-312"><a href="#cb96-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-313"><a href="#cb96-313" aria-hidden="true" tabindex="-1"></a>Pour l'instant je préconise de rester à la version antérieure du test, en raison de son lien très fort avec une régression linéaire entre les résidus standardisés et une fonction de la durée, mais également en termes de reproductibilité, les autres applications utilisant cette version originale. Je donne la marche à suivre pour exécuter ce test.  </span>
<span id="cb96-314"><a href="#cb96-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-315"><a href="#cb96-315" aria-hidden="true" tabindex="-1"></a>Dans une analyse, je conseille de préciser dans une analyse la version du test qui a été exécutée. Le test simplifié est actuellement la seule solution dans Stata, Sas ou Python.</span>
<span id="cb96-316"><a href="#cb96-316" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb96-317"><a href="#cb96-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-318"><a href="#cb96-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-319"><a href="#cb96-319" aria-hidden="true" tabindex="-1"></a>**&lt;span style="color: #CC0066"&gt;Résultat du test avec la v3 de survival&lt;/span&gt;**</span>
<span id="cb96-320"><a href="#cb96-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-321"><a href="#cb96-321" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`transform="km"`</span></span>
<span id="cb96-322"><a href="#cb96-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-323"><a href="#cb96-323" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit)</span>
<span id="cb96-324"><a href="#cb96-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-325"><a href="#cb96-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-326"><a href="#cb96-326" aria-hidden="true" tabindex="-1"></a>Avec <span class="in">`transform="identity"`</span> ($f(t)=t$) <span class="co">[</span><span class="ot">remarque: solution de Stata par défaut</span><span class="co">]</span>.</span>
<span id="cb96-327"><a href="#cb96-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-328"><a href="#cb96-328" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span>
<span id="cb96-329"><a href="#cb96-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-330"><a href="#cb96-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-331"><a href="#cb96-331" aria-hidden="true" tabindex="-1"></a>Remarque: avec la v3, quelques options ont été ajoutées tel que *`terms`* qui permet pour une variable catégorielle à plus de deux modalités de choisir entre un sous test multiple sur la variable (k modalités =&gt; k-1 degré de liberté) et une série de tests à 1 degré de liberté sur chaque modalité (k-1 tests). De mon point de vue préférer la seconde solution avec **`terms=FALSE`**.</span>
<span id="cb96-332"><a href="#cb96-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-333"><a href="#cb96-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-334"><a href="#cb96-334" aria-hidden="true" tabindex="-1"></a>**&lt;span style="color: #CC0066"&gt;Résultat du test avec la v2 de survival&lt;/span&gt;**  </span>
<span id="cb96-335"><a href="#cb96-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-336"><a href="#cb96-336" aria-hidden="true" tabindex="-1"></a>::: callout-warning   </span>
<span id="cb96-337"><a href="#cb96-337" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:#CC0066"</span><span class="kw">&gt;</span></span>
<span id="cb96-338"><a href="#cb96-338" aria-hidden="true" tabindex="-1"></a>J’ai récupéré la fonction de la version précédente de survival (identique Sas, Stata, Python), renommée <span class="in">`cox.zphold`</span>. Elle se trouve à cette adresse. :<span class="co">[</span><span class="ot">&lt;https://github.com/mthevenin/analyse_duree/tree/main/cox.zphold&gt;</span><span class="co">]</span>.  </span>
<span id="cb96-339"><a href="#cb96-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-340"><a href="#cb96-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-341"><a href="#cb96-341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Une fois enregistrée avec comme nom de fichier <span class="in">`cox.zphold.R`</span>, la charger dans le programme d’analyse avec la fonction <span class="in">`source()`</span> </span>
<span id="cb96-342"><a href="#cb96-342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Après avoir estimé le modèle de Cox, exécuter la fonction **`cox.zphold()`**</span>
<span id="cb96-343"><a href="#cb96-343" aria-hidden="true" tabindex="-1"></a>:::  </span>
<span id="cb96-344"><a href="#cb96-344" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-345"><a href="#cb96-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-346"><a href="#cb96-346" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"D:/D/Marc/SMS/FORMATIONS/2022/Durée2/a distribuer/cox.zphold.R"</span>)</span>
<span id="cb96-347"><a href="#cb96-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-348"><a href="#cb96-348" aria-hidden="true" tabindex="-1"></a>coxfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery,   <span class="at">data =</span> trans)</span>
<span id="cb96-349"><a href="#cb96-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-350"><a href="#cb96-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-351"><a href="#cb96-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-352"><a href="#cb96-352" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit)</span>
<span id="cb96-353"><a href="#cb96-353" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zphold</span>(coxfit, <span class="at">transform=</span><span class="st">"identity"</span>)</span>
<span id="cb96-354"><a href="#cb96-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-355"><a href="#cb96-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-356"><a href="#cb96-356" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb96-357"><a href="#cb96-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-358"><a href="#cb96-358" aria-hidden="true" tabindex="-1"></a><span class="fu">## Régression linéaire ordinaire sur les résidus de Schoenfeld</span></span>
<span id="cb96-359"><a href="#cb96-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-360"><a href="#cb96-360" aria-hidden="true" tabindex="-1"></a>Pour information, avec une OLS </span>
<span id="cb96-361"><a href="#cb96-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-362"><a href="#cb96-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-363"><a href="#cb96-363" aria-hidden="true" tabindex="-1"></a>resid<span class="ot">=</span> <span class="fu">resid</span>(coxfit, <span class="at">type=</span><span class="st">"scaledsch"</span>)</span>
<span id="cb96-364"><a href="#cb96-364" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">names</span>(coxfit<span class="sc">$</span>coefficients)</span>
<span id="cb96-365"><a href="#cb96-365" aria-hidden="true" tabindex="-1"></a>coln <span class="ot">=</span> <span class="fu">c</span>(varnames)</span>
<span id="cb96-366"><a href="#cb96-366" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resid) <span class="ot">=</span> <span class="fu">c</span>(coln)</span>
<span id="cb96-367"><a href="#cb96-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-368"><a href="#cb96-368" aria-hidden="true" tabindex="-1"></a>times    <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dimnames</span>(resid)[[<span class="dv">1</span>]])</span>
<span id="cb96-369"><a href="#cb96-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-370"><a href="#cb96-370" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> <span class="fu">data.frame</span>(resid)</span>
<span id="cb96-371"><a href="#cb96-371" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> <span class="fu">cbind</span>(resid, <span class="at">t=</span>times)</span>
<span id="cb96-372"><a href="#cb96-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-373"><a href="#cb96-373" aria-hidden="true" tabindex="-1"></a>year    <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(year<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb96-374"><a href="#cb96-374" aria-hidden="true" tabindex="-1"></a>age     <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(age<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb96-375"><a href="#cb96-375" aria-hidden="true" tabindex="-1"></a>surgery <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(surgery<span class="sc">~</span>t, <span class="at">data=</span>resid))</span>
<span id="cb96-376"><a href="#cb96-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-377"><a href="#cb96-377" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb96-378"><a href="#cb96-378" aria-hidden="true" tabindex="-1"></a><span class="co"># p-values de l'OLS #</span></span>
<span id="cb96-379"><a href="#cb96-379" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb96-380"><a href="#cb96-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-381"><a href="#cb96-381" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour year:"</span>,    year<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span>
<span id="cb96-382"><a href="#cb96-382" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour age:"</span>,     age<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span>
<span id="cb96-383"><a href="#cb96-383" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"p-value pour surgery:"</span>, surgery<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>])</span>
<span id="cb96-384"><a href="#cb96-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-385"><a href="#cb96-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-386"><a href="#cb96-386" aria-hidden="true" tabindex="-1"></a>On est trés proche des résulats du test simplifié effectué avec la v2 de <span class="in">`survival`</span>. Et c'est tout à fait normal.</span>
<span id="cb96-387"><a href="#cb96-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-388"><a href="#cb96-388" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb96-389"><a href="#cb96-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-390"><a href="#cb96-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-391"><a href="#cb96-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introduction d'une intéraction</span></span>
<span id="cb96-392"><a href="#cb96-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-393"><a href="#cb96-393" aria-hidden="true" tabindex="-1"></a>Lorsque la covariable n'est pas continue, elle doit être transformée en indicatrice. Vérifier que les résultats du modèle sont bien identiques avec le modèle estimé précédemment (ne pas oublier d'omettre le niveau en référence).  </span>
<span id="cb96-394"><a href="#cb96-394" aria-hidden="true" tabindex="-1"></a>Ici la variable surgery est déjà sous forme d'indicatrice (0,1).  </span>
<span id="cb96-395"><a href="#cb96-395" aria-hidden="true" tabindex="-1"></a>La variable d'intéraction est **`tt(nom-variable)`**, la fonction de la durée (ici forme linéaire simple) est indiquée en option de la fonction: **`tt = function(x, t, ...) x*t`**.</span>
<span id="cb96-396"><a href="#cb96-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-397"><a href="#cb96-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-398"><a href="#cb96-398" aria-hidden="true" tabindex="-1"></a>coxfit2 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> <span class="fu">tt</span>(surgery), <span class="at">data =</span> trans, <span class="at">tt =</span> <span class="cf">function</span>(x, t, ...) x<span class="sc">*</span>t)</span>
<span id="cb96-399"><a href="#cb96-399" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxfit2)</span>
<span id="cb96-400"><a href="#cb96-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-401"><a href="#cb96-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-402"><a href="#cb96-402" aria-hidden="true" tabindex="-1"></a>**Rappel**: le paramètre estimé pour **`tt(surgery)`** ne reporte pas un rapport de risques, mais un rapport de de deux rapports de risques (c'est bien une double différence sur l'échelle d'estimation - log -).  </span>
<span id="cb96-403"><a href="#cb96-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-404"><a href="#cb96-404" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-405"><a href="#cb96-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-406"><a href="#cb96-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Variable dynamique (binaire)**</span></span>
<span id="cb96-407"><a href="#cb96-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-408"><a href="#cb96-408" aria-hidden="true" tabindex="-1"></a>La dimension dynamique est le fait d'avoir été opéré pour une greffe du coeur.  </span>
<span id="cb96-409"><a href="#cb96-409" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-410"><a href="#cb96-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-411"><a href="#cb96-411" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 1**: créer un vecteur donnant les durées aux temps d'évènement.</span>
<span id="cb96-412"><a href="#cb96-412" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 2**: appliquer ce vecteurs de points de coupure à la fonction ```survsplit```.</span>
<span id="cb96-413"><a href="#cb96-413" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**Etape 3**: modifier la variable transplant (ou créer une nouvelle) à l'aide de la variable **wait** qui prend la valeur 1 à partir du jour de la greffe, 0 avant.</span>
<span id="cb96-414"><a href="#cb96-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-415"><a href="#cb96-415" aria-hidden="true" tabindex="-1"></a>*Etape 1*</span>
<span id="cb96-416"><a href="#cb96-416" aria-hidden="true" tabindex="-1"></a>Création de l'objet cut (vecteur)</span>
<span id="cb96-419"><a href="#cb96-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb96-420"><a href="#cb96-420" aria-hidden="true" tabindex="-1"></a>cut<span class="ot">=</span> <span class="fu">unique</span>(trans<span class="sc">$</span>stime[trans<span class="sc">$</span>died <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb96-421"><a href="#cb96-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-422"><a href="#cb96-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-423"><a href="#cb96-423" aria-hidden="true" tabindex="-1"></a>*Etape 2*</span>
<span id="cb96-424"><a href="#cb96-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-425"><a href="#cb96-425" aria-hidden="true" tabindex="-1"></a>tvc <span class="ot">=</span> <span class="fu">survSplit</span>(<span class="at">data =</span> trans, <span class="at">cut =</span> cut, <span class="at">end =</span> <span class="st">"stime"</span>, <span class="at">start =</span> <span class="st">"stime0"</span>, <span class="at">event =</span> <span class="st">"died"</span>)</span>
<span id="cb96-426"><a href="#cb96-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-427"><a href="#cb96-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-428"><a href="#cb96-428" aria-hidden="true" tabindex="-1"></a>Remarque: pour estimer le modèle de Cox de départ avec cette base longue.</span>
<span id="cb96-429"><a href="#cb96-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-430"><a href="#cb96-430" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> tvc)</span>
<span id="cb96-431"><a href="#cb96-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-432"><a href="#cb96-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-433"><a href="#cb96-433" aria-hidden="true" tabindex="-1"></a>*Etape 3*</span>
<span id="cb96-434"><a href="#cb96-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-435"><a href="#cb96-435" aria-hidden="true" tabindex="-1"></a>tvc<span class="sc">$</span>tvc<span class="ot">=</span><span class="fu">ifelse</span>(tvc<span class="sc">$</span>transplant<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> tvc<span class="sc">$</span>wait<span class="sc">&lt;=</span>tvc<span class="sc">$</span>stime,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb96-436"><a href="#cb96-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-437"><a href="#cb96-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-438"><a href="#cb96-438" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**  </span>
<span id="cb96-439"><a href="#cb96-439" aria-hidden="true" tabindex="-1"></a>En format long, on doit préciser dans la formule l'intervalle de durée avec les variables stime0 (début) et stime(fin) </span>
<span id="cb96-440"><a href="#cb96-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-441"><a href="#cb96-441" aria-hidden="true" tabindex="-1"></a>tvcfit <span class="ot">=</span> <span class="fu">coxph</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime0, stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery <span class="sc">+</span> tvc, <span class="at">data =</span> tvc)</span>
<span id="cb96-442"><a href="#cb96-442" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tvcfit)</span>
<span id="cb96-443"><a href="#cb96-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-444"><a href="#cb96-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-445"><a href="#cb96-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-446"><a href="#cb96-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-447"><a href="#cb96-447" aria-hidden="true" tabindex="-1"></a><span class="fu">ggforest</span>(tvcfit)</span>
<span id="cb96-448"><a href="#cb96-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-449"><a href="#cb96-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-450"><a href="#cb96-450" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-451"><a href="#cb96-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-452"><a href="#cb96-452" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Analyse en temps discret**</span></span>
<span id="cb96-453"><a href="#cb96-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-454"><a href="#cb96-454" aria-hidden="true" tabindex="-1"></a>Pour la durée, on va utiliser la variable mois (en fait regroupement sur 30 jours).  </span>
<span id="cb96-455"><a href="#cb96-455" aria-hidden="true" tabindex="-1"></a>La fonction ```uncount``` du package ```tidy``` permettra de splitter la base au temps d'observation.  </span>
<span id="cb96-456"><a href="#cb96-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-457"><a href="#cb96-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb96-458"><a href="#cb96-458" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb96-459"><a href="#cb96-459" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb96-460"><a href="#cb96-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-461"><a href="#cb96-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-462"><a href="#cb96-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-463"><a href="#cb96-463" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">uncount</span>(trans,mois)</span>
<span id="cb96-464"><a href="#cb96-464" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> dt[<span class="fu">order</span>(dt<span class="sc">$</span>id),]</span>
<span id="cb96-465"><a href="#cb96-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-466"><a href="#cb96-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-467"><a href="#cb96-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F, class.output="result"}</span></span>
<span id="cb96-468"><a href="#cb96-468" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt,<span class="dv">11</span>) <span class="sc">|&gt;</span></span>
<span id="cb96-469"><a href="#cb96-469" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span> <span class="fu">kable</span>()</span>
<span id="cb96-470"><a href="#cb96-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-471"><a href="#cb96-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-472"><a href="#cb96-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-473"><a href="#cb96-473" aria-hidden="true" tabindex="-1"></a>La variable mois a été supprimée, on va générer une variable type compteur pour mesurer la durée à chaque point d'observation. On va également recréer la variable (renommée T).    </span>
<span id="cb96-474"><a href="#cb96-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-475"><a href="#cb96-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-476"><a href="#cb96-476" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb96-477"><a href="#cb96-477" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb96-478"><a href="#cb96-478" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>T <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, <span class="at">FUN=</span>sum)</span>
<span id="cb96-479"><a href="#cb96-479" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, ],)</span>
<span id="cb96-480"><a href="#cb96-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-481"><a href="#cb96-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-482"><a href="#cb96-482" aria-hidden="true" tabindex="-1"></a>*Remarque : j’utilise ici le code standard de R, on peut faire la même chose avec dplyr de manière plus rapide (mise à jour à prévoir)*.   </span>
<span id="cb96-483"><a href="#cb96-483" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-484"><a href="#cb96-484" aria-hidden="true" tabindex="-1"></a>Si un individu est décédé, died=1 est reporté sur toute les lignes (idem qu'avec la variable dynamique). On va modifier la variable tel que *died=0 si t&lt;T$*.</span>
<span id="cb96-485"><a href="#cb96-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-486"><a href="#cb96-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-487"><a href="#cb96-487" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>died[dt<span class="sc">$</span>t<span class="sc">&lt;</span>dt<span class="sc">$</span>T]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb96-488"><a href="#cb96-488" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, ],)</span>
<span id="cb96-489"><a href="#cb96-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-490"><a href="#cb96-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-491"><a href="#cb96-491" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-492"><a href="#cb96-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-493"><a href="#cb96-493" aria-hidden="true" tabindex="-1"></a><span class="fu">## **$f(t)$ quantitative**</span></span>
<span id="cb96-494"><a href="#cb96-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-495"><a href="#cb96-495" aria-hidden="true" tabindex="-1"></a>Avec un effet quadratique d'ordre 2.  </span>
<span id="cb96-496"><a href="#cb96-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-497"><a href="#cb96-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-498"><a href="#cb96-498" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>t2<span class="ot">=</span>dt<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb96-499"><a href="#cb96-499" aria-hidden="true" tabindex="-1"></a>dtfit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data=</span>dt, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb96-500"><a href="#cb96-500" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(dtfit)</span>
<span id="cb96-501"><a href="#cb96-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-502"><a href="#cb96-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-503"><a href="#cb96-503" aria-hidden="true" tabindex="-1"></a>***Remarque sur la présentation de l'output**: la fonction <span class="in">`summ`</span> est intégrée au package <span class="in">`jtools`</span>. Elle ne fonctionne qu'avec le package ```Recordlinkage``` qui doit être installé et chargé.  </span>
<span id="cb96-504"><a href="#cb96-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-505"><a href="#cb96-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-506"><a href="#cb96-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-507"><a href="#cb96-507" aria-hidden="true" tabindex="-1"></a><span class="fu">## **$f(t)$ discrète **</span></span>
<span id="cb96-508"><a href="#cb96-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-509"><a href="#cb96-509" aria-hidden="true" tabindex="-1"></a>On va créer une variable de type dicrète regroupant la variable *t* sur ses quartiles (pour l'exemple seulement, tous types de regroupement est envisageable).  </span>
<span id="cb96-510"><a href="#cb96-510" aria-hidden="true" tabindex="-1"></a>On va utiliser la fonction <span class="in">`quantcut`</span> du package <span class="in">`gtools`</span>.</span>
<span id="cb96-511"><a href="#cb96-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-512"><a href="#cb96-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-513"><a href="#cb96-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, class.output="result"}</span></span>
<span id="cb96-514"><a href="#cb96-514" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>ct4 <span class="ot">&lt;-</span> <span class="fu">quantcut</span>(dt<span class="sc">$</span>t)</span>
<span id="cb96-515"><a href="#cb96-515" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt<span class="sc">$</span>ct4) </span>
<span id="cb96-516"><a href="#cb96-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-517"><a href="#cb96-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-518"><a href="#cb96-518" aria-hidden="true" tabindex="-1"></a>On va générer un compteur et un total d'observations sur la strate regroupant *id* et *ct4*.</span>
<span id="cb96-519"><a href="#cb96-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-520"><a href="#cb96-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-521"><a href="#cb96-521" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>n <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>cumsum)</span>
<span id="cb96-522"><a href="#cb96-522" aria-hidden="true" tabindex="-1"></a>dt<span class="sc">$</span>N <span class="ot">=</span> <span class="fu">ave</span>(dt<span class="sc">$</span>x,dt<span class="sc">$</span>id, dt<span class="sc">$</span>ct4, <span class="at">FUN=</span>sum)</span>
<span id="cb96-523"><a href="#cb96-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-524"><a href="#cb96-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-525"><a href="#cb96-525" aria-hidden="true" tabindex="-1"></a>On conserve la dernière observation dans la strate.  </span>
<span id="cb96-526"><a href="#cb96-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-527"><a href="#cb96-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-528"><a href="#cb96-528" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">subset</span>(dt, n<span class="sc">==</span>N)</span>
<span id="cb96-529"><a href="#cb96-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-530"><a href="#cb96-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-531"><a href="#cb96-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-532"><a href="#cb96-532" aria-hidden="true" tabindex="-1"></a>**Estimation du modèle**</span>
<span id="cb96-533"><a href="#cb96-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-534"><a href="#cb96-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, class.output="result"}</span></span>
<span id="cb96-535"><a href="#cb96-535" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(died <span class="sc">~</span> ct4 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data=</span>dt2, <span class="at">family=</span>binomial)</span>
<span id="cb96-536"><a href="#cb96-536" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(fit)</span>
<span id="cb96-537"><a href="#cb96-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-538"><a href="#cb96-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-539"><a href="#cb96-539" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-540"><a href="#cb96-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-541"><a href="#cb96-541" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Modèles usuels**</span></span>
<span id="cb96-542"><a href="#cb96-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-543"><a href="#cb96-543" aria-hidden="true" tabindex="-1"></a>On utilise la fonction ```survreg``` du package ```survival```</span>
<span id="cb96-544"><a href="#cb96-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-545"><a href="#cb96-545" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Modèle de Weibull**</span></span>
<span id="cb96-546"><a href="#cb96-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-547"><a href="#cb96-547" aria-hidden="true" tabindex="-1"></a>**De type AFT**  </span>
<span id="cb96-548"><a href="#cb96-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, class.output="result"}</span></span>
<span id="cb96-549"><a href="#cb96-549" aria-hidden="true" tabindex="-1"></a>weibull <span class="ot">=</span> <span class="fu">survreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibull"</span>)</span>
<span id="cb96-550"><a href="#cb96-550" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weibull)</span>
<span id="cb96-551"><a href="#cb96-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-552"><a href="#cb96-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-553"><a href="#cb96-553" aria-hidden="true" tabindex="-1"></a>**De type PH**  </span>
<span id="cb96-554"><a href="#cb96-554" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-555"><a href="#cb96-555" aria-hidden="true" tabindex="-1"></a>La paramétrisation PH n'est pas possible avec la fonction ```survreg```.  </span>
<span id="cb96-556"><a href="#cb96-556" aria-hidden="true" tabindex="-1"></a>Il faut utiliser le package ```flexsurv```, qui permet également d'estimer les modèles paramétriques disponibles avec ```survival```.  </span>
<span id="cb96-557"><a href="#cb96-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-558"><a href="#cb96-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-559"><a href="#cb96-559" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb96-560"><a href="#cb96-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-561"><a href="#cb96-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-562"><a href="#cb96-562" aria-hidden="true" tabindex="-1"></a>Pour estimer le modèle de Weibull de type PH, on utilise en option ```dist="weibullPH"```.  </span>
<span id="cb96-563"><a href="#cb96-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-564"><a href="#cb96-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-565"><a href="#cb96-565" aria-hidden="true" tabindex="-1"></a><span class="fu">flexsurvreg</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(stime, died) <span class="sc">~</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> trans, <span class="at">dist=</span><span class="st">"weibullPH"</span>)</span>
<span id="cb96-566"><a href="#cb96-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-567"><a href="#cb96-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-568"><a href="#cb96-568" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-569"><a href="#cb96-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-570"><a href="#cb96-570" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Risques concurrents**</span></span>
<span id="cb96-571"><a href="#cb96-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-572"><a href="#cb96-572" aria-hidden="true" tabindex="-1"></a>Package ```cmprsk``` pour l'analyse paramétrique et le modèle de Fine-Gray.  </span>
<span id="cb96-573"><a href="#cb96-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-574"><a href="#cb96-574" aria-hidden="true" tabindex="-1"></a>Package cmprsk pour l’analyse non paramétrique et le modèle de Fine-Gray.</span>
<span id="cb96-575"><a href="#cb96-575" aria-hidden="true" tabindex="-1"></a>La variable de censure/évènement, *compet*, correspond à la variable died avec une modalité supplémentaire simulée. On suppose l’existence d’une cause supplémentaire au décès autre qu’une malformation cardiaque et non strictement indépendante de cell-ci.</span>
<span id="cb96-576"><a href="#cb96-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-577"><a href="#cb96-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-578"><a href="#cb96-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=F, class.output="result"}</span></span>
<span id="cb96-579"><a href="#cb96-579" aria-hidden="true" tabindex="-1"></a>compet <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv"</span>)</span>
<span id="cb96-580"><a href="#cb96-580" aria-hidden="true" tabindex="-1"></a><span class="co"># variable compet</span></span>
<span id="cb96-581"><a href="#cb96-581" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>compet) </span>
<span id="cb96-582"><a href="#cb96-582" aria-hidden="true" tabindex="-1"></a><span class="co"># variable died</span></span>
<span id="cb96-583"><a href="#cb96-583" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compet<span class="sc">$</span>died) </span>
<span id="cb96-584"><a href="#cb96-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-585"><a href="#cb96-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-586"><a href="#cb96-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-587"><a href="#cb96-587" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Incidences cumulées**</span></span>
<span id="cb96-588"><a href="#cb96-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-589"><a href="#cb96-589" aria-hidden="true" tabindex="-1"></a>On utilise la fonction ```cuminc``` du package ```cmprsk```.  </span>
<span id="cb96-590"><a href="#cb96-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-591"><a href="#cb96-591" aria-hidden="true" tabindex="-1"></a>*Pas de comparaison*</span>
<span id="cb96-592"><a href="#cb96-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-593"><a href="#cb96-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-594"><a href="#cb96-594" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet)</span>
<span id="cb96-595"><a href="#cb96-595" aria-hidden="true" tabindex="-1"></a>ic </span>
<span id="cb96-596"><a href="#cb96-596" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span>
<span id="cb96-597"><a href="#cb96-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-598"><a href="#cb96-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-599"><a href="#cb96-599" aria-hidden="true" tabindex="-1"></a>Avec survminer</span>
<span id="cb96-600"><a href="#cb96-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-601"><a href="#cb96-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-602"><a href="#cb96-602" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span>
<span id="cb96-603"><a href="#cb96-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-604"><a href="#cb96-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-605"><a href="#cb96-605" aria-hidden="true" tabindex="-1"></a>*Comparaison*</span>
<span id="cb96-606"><a href="#cb96-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-607"><a href="#cb96-607" aria-hidden="true" tabindex="-1"></a>Le test de Gray est automatiquement exécuté.</span>
<span id="cb96-608"><a href="#cb96-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-609"><a href="#cb96-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-610"><a href="#cb96-610" aria-hidden="true" tabindex="-1"></a>ic <span class="ot">=</span> <span class="fu">cuminc</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, <span class="at">group=</span>compet<span class="sc">$</span>surgery, <span class="at">rho=</span><span class="dv">1</span>)</span>
<span id="cb96-611"><a href="#cb96-611" aria-hidden="true" tabindex="-1"></a>ic </span>
<span id="cb96-612"><a href="#cb96-612" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ic)</span>
<span id="cb96-613"><a href="#cb96-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-614"><a href="#cb96-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-615"><a href="#cb96-615" aria-hidden="true" tabindex="-1"></a>Avec survminer. Pour avoir un seul graphique pour toutes les courbes ajouter l'option **`multiple_panels = F`**</span>
<span id="cb96-616"><a href="#cb96-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-617"><a href="#cb96-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-618"><a href="#cb96-618" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic)</span>
<span id="cb96-619"><a href="#cb96-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-620"><a href="#cb96-620" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcompetingrisks</span>(<span class="at">fit =</span> ic, <span class="at">multiple_panels =</span> F)</span>
<span id="cb96-621"><a href="#cb96-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-622"><a href="#cb96-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-623"><a href="#cb96-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-624"><a href="#cb96-624" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb96-625"><a href="#cb96-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-626"><a href="#cb96-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Modèles**</span></span>
<span id="cb96-627"><a href="#cb96-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-628"><a href="#cb96-628" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Fine-Gray**</span></span>
<span id="cb96-629"><a href="#cb96-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-630"><a href="#cb96-630" aria-hidden="true" tabindex="-1"></a>Attention à l'interprétation des "Risks/Hazards ratio".  Modèle dont l'utilisation est assez critiquée, il n'est pas impossible que le retire à un moment ou un autre. Comme on travaille</span>
<span id="cb96-631"><a href="#cb96-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-632"><a href="#cb96-632" aria-hidden="true" tabindex="-1"></a>Fonction ```crr``` du plackage ```cmprsk```.  </span>
<span id="cb96-633"><a href="#cb96-633" aria-hidden="true" tabindex="-1"></a>Peu pratique les covariables doivent être introduites sous forme de matrice (n observation * k variables). Pour les covariables discrètes, prévoir la forme binaire et l'omission de la catégorie de référence.</span>
<span id="cb96-634"><a href="#cb96-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-635"><a href="#cb96-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-636"><a href="#cb96-636" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> compet[<span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"surgery"</span>)]</span>
<span id="cb96-637"><a href="#cb96-637" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">as.matrix</span>(c)</span>
<span id="cb96-638"><a href="#cb96-638" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">crr</span>(compet<span class="sc">$</span>stime, compet<span class="sc">$</span>compet, c))</span>
<span id="cb96-639"><a href="#cb96-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-640"><a href="#cb96-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-641"><a href="#cb96-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-642"><a href="#cb96-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Modèle multinomial**</span></span>
<span id="cb96-643"><a href="#cb96-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-644"><a href="#cb96-644" aria-hidden="true" tabindex="-1"></a>On va de nouveau utiliser la variable mois (temps discret).  </span>
<span id="cb96-645"><a href="#cb96-645" aria-hidden="true" tabindex="-1"></a>Le modèle sera estimé à l'aide la fonction ```multinom``` du package ```nnet```, les p-values doivent-être programmées, l'output ne donnant que les erreurs-types.  </span>
<span id="cb96-646"><a href="#cb96-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-647"><a href="#cb96-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-648"><a href="#cb96-648" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("nnet")</span></span>
<span id="cb96-649"><a href="#cb96-649" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb96-650"><a href="#cb96-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-651"><a href="#cb96-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-652"><a href="#cb96-652" aria-hidden="true" tabindex="-1"></a>*Transformation de la base*  </span>
<span id="cb96-653"><a href="#cb96-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-654"><a href="#cb96-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-655"><a href="#cb96-655" aria-hidden="true" tabindex="-1"></a>compet<span class="sc">$</span>T <span class="ot">=</span> compet<span class="sc">$</span>mois</span>
<span id="cb96-656"><a href="#cb96-656" aria-hidden="true" tabindex="-1"></a>td <span class="ot">=</span> <span class="fu">uncount</span>(compet, mois)</span>
<span id="cb96-657"><a href="#cb96-657" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>x<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb96-658"><a href="#cb96-658" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">ave</span>(td<span class="sc">$</span>x, td<span class="sc">$</span>id, <span class="at">FUN=</span>cumsum)</span>
<span id="cb96-659"><a href="#cb96-659" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>t2 <span class="ot">=</span> td<span class="sc">$</span>t<span class="sc">*</span>td<span class="sc">$</span>t</span>
<span id="cb96-660"><a href="#cb96-660" aria-hidden="true" tabindex="-1"></a>td<span class="sc">$</span>e <span class="ot">=</span> <span class="fu">ifelse</span>(td<span class="sc">$</span>t<span class="sc">&lt;</span>td<span class="sc">$</span>T,<span class="dv">0</span>, td<span class="sc">$</span>compet)</span>
<span id="cb96-661"><a href="#cb96-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-662"><a href="#cb96-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-663"><a href="#cb96-663" aria-hidden="true" tabindex="-1"></a>*Estimation*</span>
<span id="cb96-664"><a href="#cb96-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-665"><a href="#cb96-665" aria-hidden="true" tabindex="-1"></a>Pour estimer le modèle, on utilise la fonction ```mlogit``` du package ```nnet```. Les p-values seront calculées à partir d'un test bilatéral (statistique z). </span>
<span id="cb96-666"><a href="#cb96-666" aria-hidden="true" tabindex="-1"></a>Pour avoir un output correct, on peut conseiler le package gtsummary (fonction <span class="in">`tlb_regression`</span>).</span>
<span id="cb96-667"><a href="#cb96-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-668"><a href="#cb96-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{R, message=FALSE, class.output="result"}</span></span>
<span id="cb96-669"><a href="#cb96-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-670"><a href="#cb96-670" aria-hidden="true" tabindex="-1"></a>competfit <span class="ot">=</span> <span class="fu">multinom</span>(<span class="at">formula =</span> e <span class="sc">~</span> t <span class="sc">+</span> t2 <span class="sc">+</span> year <span class="sc">+</span> age <span class="sc">+</span> surgery, <span class="at">data =</span> td)</span>
<span id="cb96-671"><a href="#cb96-671" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(competfit)</span></span>
<span id="cb96-672"><a href="#cb96-672" aria-hidden="true" tabindex="-1"></a><span class="co">#z = summary(competfit)$coefficients/summary(competfit)$standard.errors</span></span>
<span id="cb96-673"><a href="#cb96-673" aria-hidden="true" tabindex="-1"></a><span class="co">#p &lt;- (1 - pnorm(abs(z), 0, 1)) * 2</span></span>
<span id="cb96-674"><a href="#cb96-674" aria-hidden="true" tabindex="-1"></a><span class="co">#p</span></span>
<span id="cb96-675"><a href="#cb96-675" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(competfit, <span class="at">type =</span> <span class="st">"text"</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">star.cutoffs =</span> <span class="cn">NA</span>, <span class="at">omit.table.layout =</span> <span class="st">"n"</span>)</span>
<span id="cb96-676"><a href="#cb96-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-677"><a href="#cb96-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-678"><a href="#cb96-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-679"><a href="#cb96-679" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Marc Thévenin - Ined-Sms - Octobre 2022</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","selector":".lightbox","openEffect":"zoom","loop":true,"closeEffect":"zoom"});</script>



</body></html>