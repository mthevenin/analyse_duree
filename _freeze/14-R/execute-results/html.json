{
  "hash": "7f3f34e207ccf46ad07df26fec3f4ada",
  "result": {
    "engine": "knitr",
    "markdown": "---\n#title: \"R\" \n---\n\n\n\n\n\n# R\n\nProgramme de cette section: [Lien](programme_R.R)\n\n\n## Packages et fonctions\n\n\n+-----------------------------------------+-------------------------------------------------------+\n| **Analyse**                             | Packages - Fonctions                                  |\n+=========================================+=======================================================+\n| **Non paramétrique**                    | -   `discsurv`                                        |\n|                                         |                                                       |\n|                                         |     -   `lifetable`                                   |\n|                                         |     -   `contToDisc`                                  |\n|                                         |                                                       |\n|                                         | -   `survival`                                        |\n|                                         |                                                       |\n|                                         |     -   `survfit`                                     |\n|                                         |     -   `survdif`                                     |\n|                                         |                                                       |\n|                                         | -   `survRM2`                                         |\n|                                         |                                                       |\n|                                         |     -   `rmst2`                                       |\n+-----------------------------------------+-------------------------------------------------------+\n| **Modèles à risques proportionnel**     | -   `survival`                                        |\n|                                         |     -   `coxph`                                       |\n|                                         |     -   `cox.zph` (v3) `cox.zphold` (récupération v2) |\n|                                         |     -   `survsplit`                                   |\n|                                         | -   base et `tydir`                                   |\n|                                         |     -   `uncount`                                     |\n|                                         |     -   `glm`                                         |\n+-----------------------------------------+-------------------------------------------------------+\n| **Modèles paramétriques (ph ou aft)**   | -   `survival`                                        |\n|                                         |                                                       |\n|                                         |     -   `survreg`                                     |\n|                                         |                                                       |\n|                                         | -   `flexsurv`                                        |\n|                                         |                                                       |\n|                                         |     -   `survreg`                                     |\n+-----------------------------------------+-------------------------------------------------------+\n| **Risques concurents**                  | -   `cmprsk`                                          |\n|                                         |                                                       |\n|                                         |     -   `cuminc`                                      |\n|                                         |                                                       |\n|                                         | -   `nnet`                                            |\n|                                         |                                                       |\n|                                         |     -   `multinom`                                    |\n+-----------------------------------------+-------------------------------------------------------+\n| **Autres (graphiques - mise en forme)** | -   `survminer`                                       |\n|                                         | -   `ggsurvfit` (new 2024)                            |\n|                                         |                                                       |\n|                                         | -   `jtools`                                          |\n|                                         |                                                       |\n|                                         | -  `gtsummary`                                        |\n+-----------------------------------------+-------------------------------------------------------+\n\n\n::: callout-note\n\n#### Package ggsurvfit\n \nPour les représentations graphiques, grâce à Nicolas Robette que je remercie, je vais commencer à substituer les fonctions du package de **`survminer`** par celles du package `ggsurvfit`.    \nDans un premier temps, cette mise à jour est effetuée pour les estimateurs de Kaplan Meier. Pour les risques concurrents, également pris en charge par `ggsurvfit`, il faudra également changer de package pour l'estimation, en utilisant [**`tidycmprsk`**](https://mskcc-epi-bio.github.io/tidycmprsk/reference/cuminc.html) plutôt que le vieillissant `cmprsk`.   \n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"survival\")\n#install.packages(\"survminer\")\n#install.packages(\"flexsurv\")\n#install.packages(\"survRM2\")\n#install.packages(\"tidyr\")\n#install.packages(\"dplyr\")\n#install.packages(\"jtools\")\n#install.packages(\"gtools\")\n#install.packages(\"cmprsk\")\n#install.package(\"gtsummary\")\n#install.packages(\"muhaz\")\n#install.packages(\"nnet\")\n\nlibrary(survival)\nlibrary(survminer)\nlibrary(ggsurvfit)\nlibrary(flexsurv)\nlibrary(survRM2)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(jtools)\nlibrary(gtools)\nlibrary(cmprsk)\nlibrary(discSurv)\nlibrary(gtsummary)\nlibrary(muhaz)\nlibrary(nnet)\n```\n:::\n\n\n\n\n## Analyse Non paramétrique {#sec-test}\n\nChargement de la base transplantation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\ntrans <- read.csv(\"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv\")\n```\n:::\n\n\n\n### Méthode actuarielle\n\nLa fonction disponible du paquet `discsurv`, *`lifetable()`*, a des fonctionalités plutôt limitées. Si on peut maintenant définir des intervalles de durée, il n'y a toujours pas d'estimateurs les différents quantiles de la courbe de survie, ce qui limite fortement sont utilisation.   \n\nLa programmation est rendue un peu compliquée pour pas grand chose. Je donne les codes pour information, sans plus de commentaires.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrans = as.data.frame(trans)\n```\n:::\n\n\n\n**Fonction `lifeTable`**  \n\n***Intervalle par defaut $dt=1$***  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlt = lifeTable(dataShort=trans, timeColumn=\"stime\", eventColumn = \"died\")\n\nplot(lt, x = 1:dim(lt$Output)[1], y = lt$Output$S, xlab = \"Intervalles t = journalier\", ylab=\"S(t)\")\n```\n\n::: {.cell-output-display}\n![S(t) méthode actuarielle avec `discSurv` (1)](14-R_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n***Intervalle $dt=30$***\n\n::: {.cell}\n\n```{.r .cell-code}\n# On définit un vecteur définissant les intervalles (il n'y avait pas plus simple????)\ndt <- 1:ceiling(max(trans$stime)/30)*30\n\n# Base dis avec une nouvelle variable de durée => timeDisc \n\ndis <- contToDisc(dataShort=trans, timeColumn=\"stime\", intervalLimits = dt )\n\nlt <- lifeTable(dataShort=dis, timeColumn=\"timeDisc\", eventColumn = \"died\")\n\nplot(lt, x = 1:dim(lt$Output)[1], y = lt$Output$S, xlab = \"Intervalles dt = 30 jours\", ylab=\"S(t)\")\n```\n\n::: {.cell-output-display}\n![Méthode actuarielle avec `discSurv` (2)](14-R_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nSur les abscisses, ce sont les valeurs des intervalles qui sont reportés: 10=300 jours. Ce n'est vraiment pas terrible. Pour ce type d'estimateurs, il est donc préférable d'utiliser Stata (ou Sas {{<fa solid cross>}}.\n\n\n### Méthode Kaplan-Meier\n\nLe package **`survival`** est le principal outil d'analyse des durée. Le package **`survminer`** permet d'améliorer grandement la présentation des graphiques. \n\n\n**Estimation des fonctions de survie**  \n\nFonction **`survfit`**  \n\n```{.r filename=\"Syntaxe\"}\n\nfit <- survfit(Surv(time, status) ~ x, data = nom_base)\n```\n\nOn peut renseigner directement les variables permettant de calculer la durée et non la variable de durée elle-même. Cette méthode est utilisée lorsqu'on introduit une variable dynamique dans un modèle semi-paramétrique de Cox (`coxph`).\n\n```{.r filename=\"Syntaxe\"}\n\nfit <- survfit(Surv(variable_start, variable_end, status) ~ x, data = nom_base)\n```\n\n\nSans comparaison de groupes:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- survfit(Surv(stime, died) ~ 1, data = trans)\n\nfit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: survfit(formula = Surv(stime, died) ~ 1, data = trans)\n\n       n events median 0.95LCL 0.95UCL\n[1,] 103     75    100      72     263\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: survfit(formula = Surv(stime, died) ~ 1, data = trans)\n\n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1    103       1    0.990 0.00966       0.9715        1.000\n    2    102       3    0.961 0.01904       0.9246        0.999\n    3     99       3    0.932 0.02480       0.8847        0.982\n    5     96       2    0.913 0.02782       0.8597        0.969\n    6     94       2    0.893 0.03043       0.8355        0.955\n    8     92       1    0.883 0.03161       0.8237        0.948\n    9     91       1    0.874 0.03272       0.8119        0.940\n   12     89       1    0.864 0.03379       0.8002        0.933\n   16     88       3    0.835 0.03667       0.7656        0.910\n   17     85       1    0.825 0.03753       0.7543        0.902\n   18     84       1    0.815 0.03835       0.7431        0.894\n   21     83       2    0.795 0.03986       0.7208        0.877\n   28     81       1    0.785 0.04056       0.7098        0.869\n   30     80       1    0.776 0.04122       0.6989        0.861\n   32     78       1    0.766 0.04188       0.6878        0.852\n   35     77       1    0.756 0.04250       0.6769        0.844\n   36     76       1    0.746 0.04308       0.6659        0.835\n   37     75       1    0.736 0.04364       0.6551        0.827\n   39     74       1    0.726 0.04417       0.6443        0.818\n   40     72       2    0.706 0.04519       0.6225        0.800\n   43     70       1    0.696 0.04565       0.6117        0.791\n   45     69       1    0.686 0.04609       0.6009        0.782\n   50     68       1    0.675 0.04650       0.5902        0.773\n   51     67       1    0.665 0.04689       0.5796        0.764\n   53     66       1    0.655 0.04725       0.5690        0.755\n   58     65       1    0.645 0.04759       0.5584        0.746\n   61     64       1    0.635 0.04790       0.5479        0.736\n   66     63       1    0.625 0.04819       0.5374        0.727\n   68     62       2    0.605 0.04870       0.5166        0.708\n   69     60       1    0.595 0.04892       0.5063        0.699\n   72     59       2    0.575 0.04929       0.4857        0.680\n   77     57       1    0.565 0.04945       0.4755        0.670\n   78     56       1    0.554 0.04958       0.4654        0.661\n   80     55       1    0.544 0.04970       0.4552        0.651\n   81     54       1    0.534 0.04979       0.4451        0.641\n   85     53       1    0.524 0.04986       0.4351        0.632\n   90     52       1    0.514 0.04991       0.4251        0.622\n   96     51       1    0.504 0.04994       0.4151        0.612\n  100     50       1    0.494 0.04995       0.4052        0.602\n  102     49       1    0.484 0.04993       0.3953        0.592\n  110     47       1    0.474 0.04992       0.3852        0.582\n  149     45       1    0.463 0.04991       0.3749        0.572\n  153     44       1    0.453 0.04987       0.3647        0.562\n  165     43       1    0.442 0.04981       0.3545        0.551\n  186     41       1    0.431 0.04975       0.3440        0.541\n  188     40       1    0.420 0.04966       0.3336        0.530\n  207     39       1    0.410 0.04954       0.3233        0.519\n  219     38       1    0.399 0.04940       0.3130        0.509\n  263     37       1    0.388 0.04923       0.3027        0.498\n  285     35       2    0.366 0.04885       0.2817        0.475\n  308     33       1    0.355 0.04861       0.2713        0.464\n  334     32       1    0.344 0.04834       0.2610        0.453\n  340     31       1    0.333 0.04804       0.2507        0.442\n  342     29       1    0.321 0.04773       0.2401        0.430\n  583     21       1    0.306 0.04785       0.2252        0.416\n  675     17       1    0.288 0.04830       0.2073        0.400\n  733     16       1    0.270 0.04852       0.1898        0.384\n  852     14       1    0.251 0.04873       0.1712        0.367\n  979     11       1    0.228 0.04934       0.1491        0.348\n  995     10       1    0.205 0.04939       0.1279        0.329\n 1032      9       1    0.182 0.04888       0.1078        0.308\n 1386      6       1    0.152 0.04928       0.0804        0.287\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(fit)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nLe premier output `fit` permet d'obtenir la durée médiane, ici égale à 100 ($S(100)=0.494$). Le second  avec la fonction **`summary`** permet d'obtenir une table des estimateurs. La fonction de survie peut être tracée avec la fonction **`plot`** (en pointillés les intervalles de confiance).  \n\n\nOn peut obtenir des graphes demeilleur qualité avec le package **`ggsurvfit`**^[Changement avec la version précédente qui utilisait le package **`survminer`**]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsurvfit(fit) \n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nOn peut ajouter la population encore soumise au risque à plusieurs points d'observation avec l'argument `risk.table = TRUE`, les intervalles de confiances.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsurvfit(fit) +\nadd_confidence_interval() +  \n    add_risktable()\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n### Comparaison des S(t) méthode KM\n\nOn va comparer les deux fonctions de séjour pour la variable *surgery*, celle pour les personnes non opérées et celle pour les personnes opérées.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- survfit(Surv(stime, died) ~ surgery, data = trans)\nfit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: survfit(formula = Surv(stime, died) ~ surgery, data = trans)\n\n           n events median 0.95LCL 0.95UCL\nsurgery=0 91     69     78      61     153\nsurgery=1 12      6    979     583      NA\n```\n\n\n:::\n\n```{.r .cell-code}\nggsurvfit(fit) +\nadd_confidence_interval() +  \n    add_risktable()\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n**Tests du logrank**\n\nOn utilise la fonction **`survdiff`**, avec comme variante le test des frères Peto (`rho=1`).  \nLa syntaxe est quasiment identique à la fonction `survdiff`.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(stime, died) ~ surgery, rho=1, data = trans)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nsurvdiff(formula = Surv(stime, died) ~ surgery, data = trans, \n    rho = 1)\n\n           N Observed Expected (O-E)^2/E (O-E)^2/V\nsurgery=0 91    45.28    39.12     0.968      8.65\nsurgery=1 12     2.03     8.18     4.630      8.65\n\n Chisq= 8.7  on 1 degrees of freedom, p= 0.003 \n```\n\n\n:::\n:::\n\n\nIci la variable est binaire. Si on veux tester deux à deux les niveaux d'une variable catégorielle à plus de deux modalités, il est fortement conseillé d'utiliser la fonction **`pairwise_survdiff`** de `survminer` (syntaxe identique que `survdiff`).  \n\n**Comparaison des RMST**\n\nLa fonction **`rmst2`** du package **`survRM2`** permet de comparer les RMST entre 2 groupes . La strate\npour les comparaisons doit être impérativement renommée *arm*. La fonction, issue d'une commande de Stata, n'est pas très souple.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrans$arm=trans$surgery\na=rmst2(trans$stime, trans$died, trans$arm, tau=NULL)\nprint(a)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nThe truncation time, tau, was not specified. Thus, the default tau  1407  is used. \n\nRestricted Mean Survival Time (RMST) by arm \n                Est.      se lower .95 upper .95\nRMST (arm=1) 884.576 151.979   586.702  1182.450\nRMST (arm=0) 379.148  58.606   264.283   494.012\n\n\nRestricted Mean Time Lost (RMTL) by arm \n                 Est.      se lower .95 upper .95\nRMTL (arm=1)  522.424 151.979   224.550   820.298\nRMTL (arm=0) 1027.852  58.606   912.988  1142.717\n\n\nBetween-group contrast \n                        Est. lower .95 upper .95     p\nRMST (arm=1)-(arm=0) 505.428   186.175   824.682 0.002\nRMST (arm=1)/(arm=0)   2.333     1.483     3.670 0.000\nRMTL (arm=1)/(arm=0)   0.508     0.284     0.909 0.022\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(a)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n## Modèle de Cox\n\nIci tout est estimé, de nouveau, avec des fonctions du package `survival`:  \n\n* Estimation du modèle: `coxph`.\n* Test de Grambsch-Therneau: `cox.zph` et `cox.oldzph`.\n* Introduction d'une variable dynamique: allongement de la base avec `survsplit`.\n\n### Estimation du modèle\n\nPar défaut, R utilise la correction d'Efron pour les évènements simultanés. Il est préférable de ne pas la modifier.\n\nSyntaxe:\n\n```{.r filename=\"Syntaxe\"}\ncoxph(Surv(time, status) ~ x1 + x2 + ....., data=base, ties=\"nom_correction\"))\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoxfit = coxph(formula = Surv(stime, died) ~ year + age + surgery, data = trans)\nsummary(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(stime, died) ~ year + age + surgery, data = trans)\n\n  n= 103, number of events= 75 \n\n            coef exp(coef) se(coef)      z Pr(>|z|)\nyear    -0.11963   0.88725  0.06734 -1.776   0.0757\nage      0.02958   1.03002  0.01352  2.187   0.0287\nsurgery -0.98732   0.37257  0.43626 -2.263   0.0236\n\n        exp(coef) exp(-coef) lower .95 upper .95\nyear       0.8872     1.1271    0.7775    1.0124\nage        1.0300     0.9709    1.0031    1.0577\nsurgery    0.3726     2.6840    0.1584    0.8761\n\nConcordance= 0.653  (se = 0.032 )\nLikelihood ratio test= 17.63  on 3 df,   p=5e-04\nWald test            = 15.76  on 3 df,   p=0.001\nScore (logrank) test = 16.71  on 3 df,   p=8e-04\n```\n\n\n:::\n\n```{.r .cell-code}\ntbl_regression(coxfit, exponentiate = TRUE,)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'sass':\n  method    from  \n  print.css memisc\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"fatytaitof\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fatytaitof table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fatytaitof thead, #fatytaitof tbody, #fatytaitof tfoot, #fatytaitof tr, #fatytaitof td, #fatytaitof th {\n  border-style: none;\n}\n\n#fatytaitof p {\n  margin: 0;\n  padding: 0;\n}\n\n#fatytaitof .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fatytaitof .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fatytaitof .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fatytaitof .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fatytaitof .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fatytaitof .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fatytaitof .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fatytaitof .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fatytaitof .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fatytaitof .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fatytaitof .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fatytaitof .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fatytaitof .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fatytaitof .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fatytaitof .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fatytaitof .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fatytaitof .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fatytaitof .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fatytaitof .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fatytaitof .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fatytaitof .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fatytaitof .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fatytaitof .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fatytaitof .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fatytaitof .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fatytaitof .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fatytaitof .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fatytaitof .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fatytaitof .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fatytaitof .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fatytaitof .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fatytaitof .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fatytaitof .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fatytaitof .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fatytaitof .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fatytaitof .gt_left {\n  text-align: left;\n}\n\n#fatytaitof .gt_center {\n  text-align: center;\n}\n\n#fatytaitof .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fatytaitof .gt_font_normal {\n  font-weight: normal;\n}\n\n#fatytaitof .gt_font_bold {\n  font-weight: bold;\n}\n\n#fatytaitof .gt_font_italic {\n  font-style: italic;\n}\n\n#fatytaitof .gt_super {\n  font-size: 65%;\n}\n\n#fatytaitof .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fatytaitof .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fatytaitof .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fatytaitof .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fatytaitof .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fatytaitof .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fatytaitof .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#fatytaitof .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#fatytaitof div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipIUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;HR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipIUioq\"><div class='gt_from_md'><p><strong>HR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">year</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.89</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.78, 1.01</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.076</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.03</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.00, 1.06</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.029</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.37</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.16, 0.88</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.024</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"SFIgPSBIYXphcmQgUmF0aW8sIENJID0gQ29uZmlkZW5jZSBJbnRlcnZhbA==\"><div class='gt_from_md'><p>HR = Hazard Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nL'output des résultats reporte le logarithme des Risques Ratios (coef) ainsi que les RR (exp(coef)). Il est intéressant de regarder la valeur de concordance (Harrel's) qui donne des indications sur la qualité de l'ajustement (proche de l'AUC/ROC d'un modèle probabiliste standard).  \n\nOn peut représenter sous forme graphique les résultats avec la fonction **`ggforest`** de `survminer`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggforest(coxfit)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in .get_data(model, data = data): The `data` argument is not provided.\nData will be extracted from model fit.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Hypothèse PH\n\n\n#### Test Grambsch-Therneau\n\n**Résidus de Schoenfeld**  \n\nTraditionnellement, on utilise la fonction **`cox.zph`**. \n\nDepuis la v3 du package (2020), il permet d'effectuer le test original de Grambsch-Therneau qui repose sur le calcul exact des résidus. \nMalheureusement, celui ci pose de gros problèmes en présence de covariables corrélées, même faiblement. Situation classique dans les sciences sociales. **Je ne déconseille fortement de l'utiliser**. Il est donc préférable de rester sur le test reposant sur les moindres carrés ordinaires, implémenté jusqu'en 2023, et le seule disponible avec les autres outils: Stata, Python et Sas {{<fa solid cross>}}. On maintiendra donc une reproductibilité du test dans le temps et dans l'espace des logiciel. \n\n\nLe test peut utiliser plusieurs transformation de la durée. Par défaut la fonction utilise $1-KM$, soit le complémentaire de l'estimateur de Kaplan-Meier (option `transform=\"km\"`). Cette expression complémentaire permet juste d'avoir une suite de valeur partant de 0 (la valeur de la fonction de survie partant par définition de 1).\n\n\n[Test GLS (v3 de survival)... WARNING]{.box_warning}   \n   \n   \nAvec `transform=\"km\"`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncox.zph(coxfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        chisq df     p\nyear    3.309  1 0.069\nage     0.922  1 0.337\nsurgery 5.494  1 0.019\nGLOBAL  8.581  3 0.035\n```\n\n\n:::\n:::\n\n\nAvec `transform=\"identity\"` ($f(t)=t$)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncox.zph(coxfit, transform=\"identity\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        chisq df     p\nyear     4.54  1 0.033\nage      1.71  1 0.191\nsurgery  4.92  1 0.027\nGLOBAL   9.47  3 0.024\n```\n\n\n:::\n:::\n\n\nRemarque: avec la v3 de survival, quelques options ont été ajoutées tel que *`terms`* qui permet pour une variable catégorielle à plus de deux modalités de choisir entre un sous test multiple sur la variable (k modalités => k-1 degré de liberté) et une série de tests à 1 degré de liberté sur chaque modalité (k-1 tests). De mon point de vue préférer la seconde solution avec **`terms=FALSE`**. Le test de Grambsch-Therneau sous sa forme multiple étant  particulièrement sensible au nombre de degrés de liberté, il est à mon sens préférable d'évaluer la proportionnalité variable par variable, donc degré de liberté par degré de liberté.\n\n\n[Test OLS (v2 de survival - Stata - Sas - Python)...Use it]{.box_text} \n\n\n::: {.cell filename='Récupération du test ols'}\n\n```{.r .cell-code}\nsource(\"https://raw.githubusercontent.com/mthevenin/analyse_duree/main/cox.zphold/cox.zphold.R\")\n```\n:::\n\n::: {.cell filename='Exécution du test ols'}\n\n```{.r .cell-code}\ncox.zphold(coxfit, transform=\"identity\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in is.R(): 'is.R' est obsolète.\nVoir help(\"Deprecated\") et help(\"base-deprecated\").\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          rho chisq      p\nyear    0.102 0.797 0.3720\nage     0.129 1.612 0.2043\nsurgery 0.297 5.539 0.0186\nGLOBAL     NA 8.756 0.0327\n```\n\n\n:::\n:::\n\n\n\nOn voit ici clairement que le test exact accentue la déviation vers la. C'est du tout simplement à la corrélation entre la variable *surgery* et la variable *year*. Les conclusions de S.Metzger sont ici bien vérifiées.\n\n\n#### Introduction d'une intéraction\n\nLorsque la covariable n'est pas continue, elle doit être impérativement transformée en indicatrice ^[c'est le cas ici, la variable *surgery* est bien codée (0;1)]. Penser à vérifier en amont que les résultats du modèle sont bien identiques avec le modèle estimé précédemment (ne pas oublier d'omettre le niveau en référence).  \n\nLa variable d'intéraction est **`tt(nom_variable)`**, la fonction de la durée (ici forme linéaire simple) est indiquée en option de la fonction: **`tt = function(x, t, ...) x*t`**. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoxfit2 = coxph(formula = Surv(stime, died) ~ year + age + surgery + tt(surgery), \n                data = trans, tt = function(x, t, ...) x*t)\n\nsummary(coxfit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(stime, died) ~ year + age + surgery + tt(surgery), \n    data = trans, tt = function(x, t, ...) x * t)\n\n  n= 103, number of events= 75 \n\n                 coef exp(coef)  se(coef)      z Pr(>|z|)   \nyear        -0.123074  0.884198  0.066835 -1.841  0.06555 . \nage          0.028888  1.029310  0.013449  2.148  0.03172 * \nsurgery     -1.754738  0.172953  0.674391 -2.602  0.00927 **\ntt(surgery)  0.002231  1.002234  0.001102  2.024  0.04299 * \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n            exp(coef) exp(-coef) lower .95 upper .95\nyear           0.8842     1.1310   0.77564    1.0080\nage            1.0293     0.9715   1.00253    1.0568\nsurgery        0.1730     5.7819   0.04612    0.6486\ntt(surgery)    1.0022     0.9978   1.00007    1.0044\n\nConcordance= 0.656  (se = 0.032 )\nLikelihood ratio test= 21.58  on 4 df,   p=2e-04\nWald test            = 16.99  on 4 df,   p=0.002\nScore (logrank) test = 19  on 4 df,   p=8e-04\n```\n\n\n:::\n\n```{.r .cell-code}\ntbl_regression(coxfit2, exponentiate = TRUE, estimate_fun = purrr::partial(style_ratio, digits = 3))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'sass':\n  method    from  \n  print.css memisc\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"hqfkqwnhvg\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hqfkqwnhvg table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hqfkqwnhvg thead, #hqfkqwnhvg tbody, #hqfkqwnhvg tfoot, #hqfkqwnhvg tr, #hqfkqwnhvg td, #hqfkqwnhvg th {\n  border-style: none;\n}\n\n#hqfkqwnhvg p {\n  margin: 0;\n  padding: 0;\n}\n\n#hqfkqwnhvg .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hqfkqwnhvg .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hqfkqwnhvg .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hqfkqwnhvg .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hqfkqwnhvg .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hqfkqwnhvg .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hqfkqwnhvg .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hqfkqwnhvg .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hqfkqwnhvg .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hqfkqwnhvg .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hqfkqwnhvg .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hqfkqwnhvg .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hqfkqwnhvg .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hqfkqwnhvg .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hqfkqwnhvg .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hqfkqwnhvg .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hqfkqwnhvg .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hqfkqwnhvg .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hqfkqwnhvg .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hqfkqwnhvg .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hqfkqwnhvg .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hqfkqwnhvg .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hqfkqwnhvg .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hqfkqwnhvg .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hqfkqwnhvg .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hqfkqwnhvg .gt_left {\n  text-align: left;\n}\n\n#hqfkqwnhvg .gt_center {\n  text-align: center;\n}\n\n#hqfkqwnhvg .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hqfkqwnhvg .gt_font_normal {\n  font-weight: normal;\n}\n\n#hqfkqwnhvg .gt_font_bold {\n  font-weight: bold;\n}\n\n#hqfkqwnhvg .gt_font_italic {\n  font-style: italic;\n}\n\n#hqfkqwnhvg .gt_super {\n  font-size: 65%;\n}\n\n#hqfkqwnhvg .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hqfkqwnhvg .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hqfkqwnhvg .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hqfkqwnhvg .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hqfkqwnhvg .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hqfkqwnhvg .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hqfkqwnhvg .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#hqfkqwnhvg .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#hqfkqwnhvg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipIUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;HR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipIUioq\"><div class='gt_from_md'><p><strong>HR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">year</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.884</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.776, 1.008</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.066</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.029</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.003, 1.057</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.032</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.173</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.046, 0.649</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.009</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">tt(surgery)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.000, 1.004</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.043</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"SFIgPSBIYXphcmQgUmF0aW8sIENJID0gQ29uZmlkZW5jZSBJbnRlcnZhbA==\"><div class='gt_from_md'><p>HR = Hazard Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n**Rappel**: le paramètre estimé pour **`tt(surgery)`** ne reporte pas un rapport de risques, mais un rapport de de deux rapports de risques. C'est bien une double différence sur l'échelle d'estimation (log).  \n\n\n### Introduction d'une variable dynamique (binaire)\n\nLa dimension dynamique est ici le fait d'avoir été opéré pour une greffe du coeur.  \n\n* **Etape 1**: créer un vecteur donnant les durées aux temps d'évènement.\n* **Etape 2**: appliquer ce vecteurs de points de coupure à la fonction ```survsplit```.\n* **Etape 3**: modifier la variable transplant (ou créer une nouvelle) à l'aide de la variable **wait** qui prend la valeur 1 à partir du jour de la greffe, 0 avant.\n\n* *Etape 1*: création de l'objet cut (vecteur), qui récupère les moments où au moins un évènement est observé.\n\n::: {.cell}\n\n```{.r .cell-code}\ncut= unique(trans$stime[trans$died == 1])\n\ncut\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]    1    2    3    5    6    8    9   12   16   17   18   21   28   30   32\n[16]   35   36   37   39   40   43   45   50   51   53   58   61   66   68   69\n[31]   72   77   78   80   81   85   90   96  100  102  110  149  153  165  186\n[46]  188  207  219  263  285  308  334  340  342  583  675  733  852  979  995\n[61] 1032 1386\n```\n\n\n:::\n:::\n\n\n*Etape 2*: allonger la base aux durées d'évènement\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntvc = survSplit(data = trans, cut = cut, end = \"stime\", start = \"stime0\", event = \"died\")\n\nhead(tvc, n=20 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   id year age surgery transplant wait mois compet arm stime0 stime died\n1  15   68  53       0          0    0    1      1   0      0     1    1\n2  43   70  43       0          0    0    1      1   0      0     1    0\n3  43   70  43       0          0    0    1      1   0      1     2    1\n4  61   71  52       0          0    0    1      1   0      0     1    0\n5  61   71  52       0          0    0    1      1   0      1     2    1\n6  75   72  52       0          0    0    1      1   0      0     1    0\n7  75   72  52       0          0    0    1      1   0      1     2    1\n8   6   68  54       0          0    0    1      2   0      0     1    0\n9   6   68  54       0          0    0    1      2   0      1     2    0\n10  6   68  54       0          0    0    1      2   0      2     3    1\n11 42   70  36       0          0    0    1      1   0      0     1    0\n12 42   70  36       0          0    0    1      1   0      1     2    0\n13 42   70  36       0          0    0    1      1   0      2     3    1\n14 54   71  47       0          0    0    1      1   0      0     1    0\n15 54   71  47       0          0    0    1      1   0      1     2    0\n16 54   71  47       0          0    0    1      1   0      2     3    1\n17 38   70  41       0          1    5    1      1   0      0     1    0\n18 38   70  41       0          1    5    1      1   0      1     2    0\n19 38   70  41       0          1    5    1      1   0      2     3    0\n20 38   70  41       0          1    5    1      1   0      3     5    1\n```\n\n\n:::\n:::\n\n\n\nOn vérifie qu'on obtient les même résultats avec le modèle sans tvc\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoxph(formula = Surv(stime0, stime, died) ~ year + age + surgery, data = tvc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(stime0, stime, died) ~ year + age + surgery, \n    data = tvc)\n\n            coef exp(coef) se(coef)      z      p\nyear    -0.11963   0.88725  0.06734 -1.776 0.0757\nage      0.02958   1.03002  0.01352  2.187 0.0287\nsurgery -0.98732   0.37257  0.43626 -2.263 0.0236\n\nLikelihood ratio test=17.63  on 3 df, p=0.0005243\nn= 3573, number of events= 75 \n```\n\n\n:::\n:::\n\n\n* *Etape 3*: on génère la variable dynamique de sorte que les personnes n'apparaissent pas greffés avant l'opération\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntvc$tvc=ifelse(tvc$transplant==1 & tvc$wait<=tvc$stime,1,0)\n```\n:::\n\n\n**Estimation du modèle**  \nEn format long, on doit préciser dans la formule l'intervalle de durée avec les variables `stime0` (le début) et `stime` (la fin). \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntvcfit = coxph(formula = Surv(stime0, stime, died) ~ year + age + surgery + tvc, data = tvc)\n\nsummary(tvcfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(stime0, stime, died) ~ year + age + surgery + \n    tvc, data = tvc)\n\n  n= 3573, number of events= 75 \n\n            coef exp(coef) se(coef)      z Pr(>|z|)  \nyear    -0.12032   0.88664  0.06734 -1.787   0.0740 .\nage      0.03044   1.03091  0.01390  2.190   0.0285 *\nsurgery -0.98289   0.37423  0.43655 -2.251   0.0244 *\ntvc     -0.08221   0.92108  0.30484 -0.270   0.7874  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n        exp(coef) exp(-coef) lower .95 upper .95\nyear       0.8866      1.128    0.7770    1.0117\nage        1.0309      0.970    1.0032    1.0594\nsurgery    0.3742      2.672    0.1591    0.8805\ntvc        0.9211      1.086    0.5068    1.6741\n\nConcordance= 0.659  (se = 0.032 )\nLikelihood ratio test= 17.7  on 4 df,   p=0.001\nWald test            = 15.79  on 4 df,   p=0.003\nScore (logrank) test = 16.74  on 4 df,   p=0.002\n```\n\n\n:::\n\n```{.r .cell-code}\ntbl_regression(tvcfit, exponentiate = TRUE, estimate_fun = purrr::partial(style_ratio, digits = 3))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"wurbqxhefw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#wurbqxhefw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#wurbqxhefw thead, #wurbqxhefw tbody, #wurbqxhefw tfoot, #wurbqxhefw tr, #wurbqxhefw td, #wurbqxhefw th {\n  border-style: none;\n}\n\n#wurbqxhefw p {\n  margin: 0;\n  padding: 0;\n}\n\n#wurbqxhefw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#wurbqxhefw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#wurbqxhefw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#wurbqxhefw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#wurbqxhefw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#wurbqxhefw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#wurbqxhefw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#wurbqxhefw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#wurbqxhefw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#wurbqxhefw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#wurbqxhefw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#wurbqxhefw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#wurbqxhefw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#wurbqxhefw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#wurbqxhefw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wurbqxhefw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#wurbqxhefw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#wurbqxhefw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#wurbqxhefw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wurbqxhefw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#wurbqxhefw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wurbqxhefw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#wurbqxhefw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wurbqxhefw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wurbqxhefw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wurbqxhefw .gt_left {\n  text-align: left;\n}\n\n#wurbqxhefw .gt_center {\n  text-align: center;\n}\n\n#wurbqxhefw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#wurbqxhefw .gt_font_normal {\n  font-weight: normal;\n}\n\n#wurbqxhefw .gt_font_bold {\n  font-weight: bold;\n}\n\n#wurbqxhefw .gt_font_italic {\n  font-style: italic;\n}\n\n#wurbqxhefw .gt_super {\n  font-size: 65%;\n}\n\n#wurbqxhefw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#wurbqxhefw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#wurbqxhefw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#wurbqxhefw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#wurbqxhefw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#wurbqxhefw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#wurbqxhefw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#wurbqxhefw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#wurbqxhefw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipIUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;HR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipIUioq\"><div class='gt_from_md'><p><strong>HR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">year</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.887</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.777, 1.012</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.074</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.031</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.003, 1.059</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.029</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.374</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.159, 0.880</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.024</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">tvc</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.921</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.507, 1.674</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.8</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"SFIgPSBIYXphcmQgUmF0aW8sIENJID0gQ29uZmlkZW5jZSBJbnRlcnZhbA==\"><div class='gt_from_md'><p>HR = Hazard Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggforest(tvcfit)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in .get_data(model, data = data): The `data` argument is not provided.\nData will be extracted from model fit.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n## Modèles à durée discrète\n\nPour la durée, on va utiliser la variable *mois* (regroupement sur 30 jours de *stime*).  \n\nLa fonction **`uncount`** du package `tidyr` permettra de splitter la base aux durées d'observation. C'est ici la principale différence avec le modèle de Cox qui est une estimation aux durées d'évènement   \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrans <- read.csv(\"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv\")\n```\n:::\n\n\n\nLa variable *mois*, va être supprimée avec `uncount`. Comme on en aura besoin plus loin pour générer proprement la variable évènement, on peut créer ici une variable mirroir.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrans$T = trans$mois\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndt = uncount(trans,mois)\ndt = dt[order(dt$id),]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(dt,11) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    id year age died stime surgery transplant wait compet  T\n48   1   67  30    1    50       0          0    0      1  2\n49   1   67  30    1    50       0          0    0      1  2\n10   2   68  51    1     6       0          0    0      1  1\n18   3   68  54    1    16       0          1    1      1  1\n36   4   68  40    1    39       0          1   36      2  2\n37   4   68  40    1    39       0          1   36      2  2\n20   5   68  20    1    18       0          0    0      1  1\n5    6   68  54    1     3       0          0    0      2  1\n466  7   68  50    1   675       0          1   51      1 23\n467  7   68  50    1   675       0          1   51      1 23\n468  7   68  50    1   675       0          1   51      1 23\n```\n\n\n:::\n:::\n\n\n\nOn va générer une variable type compteur pour mesurer la durée à chaque point d'observation. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt$x=1\ndt$t = ave(dt$x,dt$id, FUN=cumsum)\n\nhead(dt, n=8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   id year age died stime surgery transplant wait compet T x t\n48  1   67  30    1    50       0          0    0      1 2 1 1\n49  1   67  30    1    50       0          0    0      1 2 1 2\n10  2   68  51    1     6       0          0    0      1 1 1 1\n18  3   68  54    1    16       0          1    1      1 1 1 1\n36  4   68  40    1    39       0          1   36      2 2 1 1\n37  4   68  40    1    39       0          1   36      2 2 1 2\n20  5   68  20    1    18       0          0    0      1 1 1 1\n5   6   68  54    1     3       0          0    0      2 1 1 1\n```\n\n\n:::\n:::\n\n\n\nSi un individu est décédé, died=1 est reporté sur toute les lignes (idem qu'avec la variable dynamique). On va modifier la variable tel que *died=0 si t<T$*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt = arrange(dt,id,t)\n\ndt$died[dt$t<dt$T]=0\n\nhead(dt, n=8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id year age died stime surgery transplant wait compet T x t\n1  1   67  30    0    50       0          0    0      1 2 1 1\n2  1   67  30    1    50       0          0    0      1 2 1 2\n3  2   68  51    1     6       0          0    0      1 1 1 1\n4  3   68  54    1    16       0          1    1      1 1 1 1\n5  4   68  40    0    39       0          1   36      2 2 1 1\n6  4   68  40    1    39       0          1   36      2 2 1 2\n7  5   68  20    1    18       0          0    0      1 1 1 1\n8  6   68  54    1     3       0          0    0      2 1 1 1\n```\n\n\n:::\n:::\n\n\n### $f(t)$ quantitative\n\nAvec un effet quadratique d'ordre 3 ^[Attention ici cela marche bien. Bien vérifier qu'il n'y a pas un problème d'overfitting, comme c'est le cas dans le TP. \n\nOn centre également les variables *year* et *age* sur leur valeur moyenne pour donner un sens à la constante \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt$t2=dt$t^2\ndt$t3=dt$t^3\n\nmy = mean(dt$year)\ndt$yearb = dt$year - my\nma = mean(dt$age)\ndt$ageb = dt$age  - ma\n\n\ndtfit = glm(died ~ t + t2 + t3 + yearb + ageb + surgery, data=dt, family=\"binomial\")\nsumm(dtfit, confint=TRUE, exp=TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 1127 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> died </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> binomial </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> logit </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> χ²(6) </td>\n   <td style=\"text-align:right;\"> 90.69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> p </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.20 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 474.67 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> BIC </td>\n   <td style=\"text-align:right;\"> 509.86 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> exp(Est.) </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> z val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 0.44 </td>\n   <td style=\"text-align:right;\"> 0.27 </td>\n   <td style=\"text-align:right;\"> 0.72 </td>\n   <td style=\"text-align:right;\"> -3.29 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> t </td>\n   <td style=\"text-align:right;\"> 0.69 </td>\n   <td style=\"text-align:right;\"> 0.59 </td>\n   <td style=\"text-align:right;\"> 0.81 </td>\n   <td style=\"text-align:right;\"> -4.52 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> t2 </td>\n   <td style=\"text-align:right;\"> 1.01 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 1.02 </td>\n   <td style=\"text-align:right;\"> 2.83 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> t3 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> -2.11 </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> yearb </td>\n   <td style=\"text-align:right;\"> 0.88 </td>\n   <td style=\"text-align:right;\"> 0.76 </td>\n   <td style=\"text-align:right;\"> 1.01 </td>\n   <td style=\"text-align:right;\"> -1.80 </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> ageb </td>\n   <td style=\"text-align:right;\"> 1.03 </td>\n   <td style=\"text-align:right;\"> 1.00 </td>\n   <td style=\"text-align:right;\"> 1.06 </td>\n   <td style=\"text-align:right;\"> 2.27 </td>\n   <td style=\"text-align:right;\"> 0.02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> surgery </td>\n   <td style=\"text-align:right;\"> 0.36 </td>\n   <td style=\"text-align:right;\"> 0.15 </td>\n   <td style=\"text-align:right;\"> 0.88 </td>\n   <td style=\"text-align:right;\"> -2.25 </td>\n   <td style=\"text-align:right;\"> 0.02 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: MLE</td></tr></tfoot>\n</table>\n`````\n:::\n\n```{.r .cell-code}\ntbl_regression(dtfit, exponentiate = TRUE, estimate_fun = purrr::partial(style_ratio, digits = 3))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"tavjstvzkw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#tavjstvzkw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#tavjstvzkw thead, #tavjstvzkw tbody, #tavjstvzkw tfoot, #tavjstvzkw tr, #tavjstvzkw td, #tavjstvzkw th {\n  border-style: none;\n}\n\n#tavjstvzkw p {\n  margin: 0;\n  padding: 0;\n}\n\n#tavjstvzkw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#tavjstvzkw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#tavjstvzkw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#tavjstvzkw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#tavjstvzkw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#tavjstvzkw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#tavjstvzkw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#tavjstvzkw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#tavjstvzkw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#tavjstvzkw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#tavjstvzkw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#tavjstvzkw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#tavjstvzkw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#tavjstvzkw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#tavjstvzkw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tavjstvzkw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#tavjstvzkw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#tavjstvzkw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#tavjstvzkw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tavjstvzkw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#tavjstvzkw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tavjstvzkw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#tavjstvzkw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tavjstvzkw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tavjstvzkw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tavjstvzkw .gt_left {\n  text-align: left;\n}\n\n#tavjstvzkw .gt_center {\n  text-align: center;\n}\n\n#tavjstvzkw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#tavjstvzkw .gt_font_normal {\n  font-weight: normal;\n}\n\n#tavjstvzkw .gt_font_bold {\n  font-weight: bold;\n}\n\n#tavjstvzkw .gt_font_italic {\n  font-style: italic;\n}\n\n#tavjstvzkw .gt_super {\n  font-size: 65%;\n}\n\n#tavjstvzkw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#tavjstvzkw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#tavjstvzkw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#tavjstvzkw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#tavjstvzkw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#tavjstvzkw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#tavjstvzkw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#tavjstvzkw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#tavjstvzkw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipPUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;OR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipPUioq\"><div class='gt_from_md'><p><strong>OR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">t</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.689</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.582, 0.805</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">t2</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.014</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.005, 1.025</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.005</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">t3</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.000, 1.000</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.035</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">yearb</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.876</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.756, 1.011</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.072</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">ageb</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.034</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.006, 1.066</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.023</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.364</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.136, 0.815</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.024</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"T1IgPSBPZGRzIFJhdGlvLCBDSSA9IENvbmZpZGVuY2UgSW50ZXJ2YWw=\"><div class='gt_from_md'><p>OR = Odds Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n### $f(t)$ en indicatrices\n\nOn va créer une variable de type discrète regroupant la variable *t* sur ses quartiles (pour l'exemple seulement, tous types de regroupement est envisageable).  \nOn utilisera utiliser la fonction `quantcut` du package `gtools`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt$ct4 <- quantcut(dt$t)\ntable(dt$ct4) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  [1,4]  (4,11] (11,23] (23,60] \n    299     275     282     271 \n```\n\n\n:::\n:::\n\n\nOn va générer un compteur et un total d'observations sur la strate regroupant *id* et *ct4*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt$n = ave(dt$x,dt$id, dt$ct4, FUN=cumsum)\ndt$N = ave(dt$x,dt$id, dt$ct4, FUN=sum)\n```\n:::\n\n\nOn conserve la dernière observation dans la strate.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt2 = subset(dt, n==N)\n```\n:::\n\n\n**Estimation du modèle**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit = glm(died ~ ct4 + yearb + ageb + surgery, data=dt2, family=binomial)\nsumm(fit, confint=TRUE, exp=TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Observations </td>\n   <td style=\"text-align:right;\"> 197 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Dependent variable </td>\n   <td style=\"text-align:right;\"> died </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Type </td>\n   <td style=\"text-align:right;\"> Generalized linear model </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Family </td>\n   <td style=\"text-align:right;\"> binomial </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Link </td>\n   <td style=\"text-align:right;\"> logit </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> χ²(6) </td>\n   <td style=\"text-align:right;\"> 39.30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> p </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (Cragg-Uhler) </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Pseudo-R² (McFadden) </td>\n   <td style=\"text-align:right;\"> 0.15 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> AIC </td>\n   <td style=\"text-align:right;\"> 236.48 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> BIC </td>\n   <td style=\"text-align:right;\"> 259.46 </td>\n  </tr>\n</tbody>\n</table> <table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> exp(Est.) </th>\n   <th style=\"text-align:right;\"> 2.5% </th>\n   <th style=\"text-align:right;\"> 97.5% </th>\n   <th style=\"text-align:right;\"> z val. </th>\n   <th style=\"text-align:right;\"> p </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 1.17 </td>\n   <td style=\"text-align:right;\"> 0.77 </td>\n   <td style=\"text-align:right;\"> 1.79 </td>\n   <td style=\"text-align:right;\"> 0.73 </td>\n   <td style=\"text-align:right;\"> 0.47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> ct4(4,11] </td>\n   <td style=\"text-align:right;\"> 0.36 </td>\n   <td style=\"text-align:right;\"> 0.16 </td>\n   <td style=\"text-align:right;\"> 0.81 </td>\n   <td style=\"text-align:right;\"> -2.47 </td>\n   <td style=\"text-align:right;\"> 0.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> ct4(11,23] </td>\n   <td style=\"text-align:right;\"> 0.20 </td>\n   <td style=\"text-align:right;\"> 0.07 </td>\n   <td style=\"text-align:right;\"> 0.58 </td>\n   <td style=\"text-align:right;\"> -2.96 </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> ct4(23,60] </td>\n   <td style=\"text-align:right;\"> 0.62 </td>\n   <td style=\"text-align:right;\"> 0.19 </td>\n   <td style=\"text-align:right;\"> 2.01 </td>\n   <td style=\"text-align:right;\"> -0.80 </td>\n   <td style=\"text-align:right;\"> 0.42 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> yearb </td>\n   <td style=\"text-align:right;\"> 0.82 </td>\n   <td style=\"text-align:right;\"> 0.68 </td>\n   <td style=\"text-align:right;\"> 0.98 </td>\n   <td style=\"text-align:right;\"> -2.18 </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> ageb </td>\n   <td style=\"text-align:right;\"> 1.05 </td>\n   <td style=\"text-align:right;\"> 1.01 </td>\n   <td style=\"text-align:right;\"> 1.09 </td>\n   <td style=\"text-align:right;\"> 2.53 </td>\n   <td style=\"text-align:right;\"> 0.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> surgery </td>\n   <td style=\"text-align:right;\"> 0.33 </td>\n   <td style=\"text-align:right;\"> 0.12 </td>\n   <td style=\"text-align:right;\"> 0.88 </td>\n   <td style=\"text-align:right;\"> -2.21 </td>\n   <td style=\"text-align:right;\"> 0.03 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Standard errors: MLE</td></tr></tfoot>\n</table>\n`````\n:::\n\n```{.r .cell-code}\ntbl_regression(fit, exponentiate = TRUE, estimate_fun = purrr::partial(style_ratio, digits = 3))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"twvdjqwdmm\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#twvdjqwdmm table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#twvdjqwdmm thead, #twvdjqwdmm tbody, #twvdjqwdmm tfoot, #twvdjqwdmm tr, #twvdjqwdmm td, #twvdjqwdmm th {\n  border-style: none;\n}\n\n#twvdjqwdmm p {\n  margin: 0;\n  padding: 0;\n}\n\n#twvdjqwdmm .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#twvdjqwdmm .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#twvdjqwdmm .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#twvdjqwdmm .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#twvdjqwdmm .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#twvdjqwdmm .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#twvdjqwdmm .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#twvdjqwdmm .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#twvdjqwdmm .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#twvdjqwdmm .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#twvdjqwdmm .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#twvdjqwdmm .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#twvdjqwdmm .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#twvdjqwdmm .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#twvdjqwdmm .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#twvdjqwdmm .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#twvdjqwdmm .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#twvdjqwdmm .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#twvdjqwdmm .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#twvdjqwdmm .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#twvdjqwdmm .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#twvdjqwdmm .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#twvdjqwdmm .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#twvdjqwdmm .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#twvdjqwdmm .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#twvdjqwdmm .gt_left {\n  text-align: left;\n}\n\n#twvdjqwdmm .gt_center {\n  text-align: center;\n}\n\n#twvdjqwdmm .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#twvdjqwdmm .gt_font_normal {\n  font-weight: normal;\n}\n\n#twvdjqwdmm .gt_font_bold {\n  font-weight: bold;\n}\n\n#twvdjqwdmm .gt_font_italic {\n  font-style: italic;\n}\n\n#twvdjqwdmm .gt_super {\n  font-size: 65%;\n}\n\n#twvdjqwdmm .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#twvdjqwdmm .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#twvdjqwdmm .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#twvdjqwdmm .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#twvdjqwdmm .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#twvdjqwdmm .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#twvdjqwdmm .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#twvdjqwdmm .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#twvdjqwdmm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipPUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;OR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipPUioq\"><div class='gt_from_md'><p><strong>OR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">ct4</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    [1,4]</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">—</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">—</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    (4,11]</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.356</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.152, 0.792</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.014</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    (11,23]</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.199</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.061, 0.541</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.003</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    (23,60]</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.619</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.183, 1.981</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.4</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">yearb</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.816</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.677, 0.977</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.029</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">ageb</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.048</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">1.012, 1.089</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.011</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.330</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.113, 0.837</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.027</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"T1IgPSBPZGRzIFJhdGlvLCBDSSA9IENvbmZpZGVuY2UgSW50ZXJ2YWw=\"><div class='gt_from_md'><p>OR = Odds Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n\n## Modèles paramétriques usuels\n\n\nPour le modèle de **Weibull** par exemple.\n\n* De type **AFT** \n\nOn utilise la fonction `survreg` du package **`survival`**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweibull = survreg(formula = Surv(stime, died) ~ year + age + surgery, data = trans, dist=\"weibull\")\nsummary(weibull)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nsurvreg(formula = Surv(stime, died) ~ year + age + surgery, data = trans, \n    dist = \"weibull\")\n              Value Std. Error     z       p\n(Intercept) -3.0220     8.7284 -0.35   0.729\nyear         0.1620     0.1218  1.33   0.184\nage         -0.0615     0.0247 -2.49   0.013\nsurgery      1.9703     0.7794  2.53   0.011\nLog(scale)   0.5868     0.0927  6.33 2.5e-10\n\nScale= 1.8 \n\nWeibull distribution\nLoglik(model)= -488.2   Loglik(intercept only)= -497.6\n\tChisq= 18.87 on 3 degrees of freedom, p= 0.00029 \nNumber of Newton-Raphson Iterations: 5 \nn= 103 \n```\n\n\n:::\n\n```{.r .cell-code}\ntbl_regression(weibull, exponentiate = TRUE, estimate_fun = purrr::partial(style_ratio, digits = 3))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `exponentiate` argument is not supported in the `tidy()` method\nfor `survreg` objects and will be ignored.\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"hemexfulon\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hemexfulon table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hemexfulon thead, #hemexfulon tbody, #hemexfulon tfoot, #hemexfulon tr, #hemexfulon td, #hemexfulon th {\n  border-style: none;\n}\n\n#hemexfulon p {\n  margin: 0;\n  padding: 0;\n}\n\n#hemexfulon .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hemexfulon .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hemexfulon .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hemexfulon .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hemexfulon .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hemexfulon .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hemexfulon .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hemexfulon .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hemexfulon .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hemexfulon .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hemexfulon .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hemexfulon .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hemexfulon .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hemexfulon .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hemexfulon .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hemexfulon .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hemexfulon .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hemexfulon .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hemexfulon .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hemexfulon .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hemexfulon .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hemexfulon .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hemexfulon .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hemexfulon .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hemexfulon .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hemexfulon .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hemexfulon .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hemexfulon .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hemexfulon .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hemexfulon .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hemexfulon .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hemexfulon .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hemexfulon .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hemexfulon .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hemexfulon .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hemexfulon .gt_left {\n  text-align: left;\n}\n\n#hemexfulon .gt_center {\n  text-align: center;\n}\n\n#hemexfulon .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hemexfulon .gt_font_normal {\n  font-weight: normal;\n}\n\n#hemexfulon .gt_font_bold {\n  font-weight: bold;\n}\n\n#hemexfulon .gt_font_italic {\n  font-style: italic;\n}\n\n#hemexfulon .gt_super {\n  font-size: 65%;\n}\n\n#hemexfulon .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hemexfulon .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hemexfulon .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hemexfulon .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hemexfulon .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hemexfulon .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hemexfulon .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#hemexfulon .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#hemexfulon div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipleHAoQmV0YSkqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;exp(Beta)&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipleHAoQmV0YSkqKg==\"><div class='gt_from_md'><p><strong>exp(Beta)</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">year</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.162</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-0.077, 0.401</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.2</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.062</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">-0.110, -0.013</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.013</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1.970</td>\n<td headers=\"conf.low\" class=\"gt_row gt_center\">0.443, 3.498</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.011</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"Q0kgPSBDb25maWRlbmNlIEludGVydmFs\"><div class='gt_from_md'><p>CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n* De type **PH**  \n\nLa paramétrisation PH n'est pas possible avec la fonction `survreg`.   Il faut utiliser le package **`flexsurv`**, qui permet également d'estimer les modèles paramétriques disponibles avec `survival`. La syntaxe est quasiment identique.  \n\nPour estimer le modèle de Weibull de type PH, on utilise en option l'agument `dist=\"weibullPH`.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nweibullph = flexsurvreg(formula = Surv(stime, died) ~ year + age + surgery, data = trans, dist=\"weibullPH\")\nweibullph\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nflexsurvreg(formula = Surv(stime, died) ~ year + age + surgery, \n    data = trans, dist = \"weibullPH\")\n\nEstimates: \n         data mean  est        L95%       U95%       se         exp(est) \nshape           NA   5.56e-01   4.64e-01   6.67e-01   5.16e-02         NA\nscale           NA   5.37e+00   4.21e-04   6.85e+04   2.59e+01         NA\nyear      7.06e+01  -9.01e-02  -2.20e-01   4.00e-02   6.64e-02   9.14e-01\nage       4.46e+01   3.42e-02   7.11e-03   6.13e-02   1.38e-02   1.03e+00\nsurgery   1.17e-01  -1.10e+00  -1.95e+00  -2.45e-01   4.34e-01   3.34e-01\n         L95%       U95%     \nshape           NA         NA\nscale           NA         NA\nyear      8.02e-01   1.04e+00\nage       1.01e+00   1.06e+00\nsurgery   1.43e-01   7.83e-01\n\nN = 103,  Events: 75,  Censored: 28\nTotal time at risk: 31938\nLog-likelihood = -488.1683, df = 5\nAIC = 986.3366\n```\n\n\n:::\n:::\n\n\n\n## Risques concurrents\n\n\n::: callout-important\nMise à jour des packages prévues pour la fin de l'année: \n\n* `cmprsk`    => `tidycmprsk`\n* `survminer` => `ggsurvfit` \n\n:::\n\nLe package `cmprsk` pour l'analyse non paramétrique et le modèle de Fine-Gray (non traité).  \n\nPackage cmprsk pour l’analyse non paramétrique et le modèle de Fine-Gray.\nLa variable de censure/évènement, *compet*, correspond à la variable died avec une modalité supplémentaire simulée. On suppose l’existence d’une cause supplémentaire au décès autre qu’une malformation cardiaque et non strictement indépendante de cell-ci.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompet <- read.csv(\"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv\")\n# variable compet\ntable(compet$compet) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n 0  1  2 \n28 56 19 \n```\n\n\n:::\n\n```{.r .cell-code}\n# variable died\ntable(compet$died) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n 0  1 \n28 75 \n```\n\n\n:::\n:::\n\n\n\n#### Incidences cumulées\n\nOn utilise la fonction `cuminc` du package **`cmprsk`**.  \n\n\n*Pas de comparaison de groupes*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nic = cuminc(compet$stime, compet$compet)\nic \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and Variances:\n$est\n          500      1000      1500\n1 1 0.5067598 0.5808345 0.6340038\n1 2 0.1720161 0.2140841 0.2140841\n\n$var\n            500        1000        1500\n1 1 0.002619449 0.003131847 0.003676516\n1 2 0.001473283 0.002203770 0.002203770\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(ic)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\nAvec `survminer`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggcompetingrisks(fit = ic)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n*Comparaison de groupes*\n\nLe test de Gray est automatiquement exécuté.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nic = cuminc(compet$stime, compet$compet, group=compet$surgery, rho=1)\nic \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTests:\n      stat         pv df\n1 4.604792 0.03188272  1\n2 0.272147 0.60189515  1\nEstimates and Variances:\n$est\n           500      1000      1500\n0 1 0.54917896 0.5940358 0.6604903\n1 1 0.18181818 0.4242424        NA\n0 2 0.18168014 0.2066006 0.2066006\n1 2 0.09090909 0.2121212        NA\n\n$var\n            500        1000        1500\n0 1 0.002955869 0.003335897 0.004199157\n1 1 0.014958678 0.033339569          NA\n0 2 0.001727112 0.002271242 0.002271242\n1 2 0.008449138 0.022024737          NA\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(ic)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\nAvec `survminer`, pour obtenir un seul graphique pour toutes les courbes ajouter l'option **`multiple_panels = F`**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggcompetingrisks(fit = ic)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggcompetingrisks(fit = ic, multiple_panels = F)\n```\n\n::: {.cell-output-display}\n![](14-R_files/figure-html/unnamed-chunk-42-2.png){width=672}\n:::\n:::\n\n\n\n#### Modèles\n\n\nOn va utilisé seulement le modèle multinomial à durée discrète, le modèle *fine-gray* pendant du modèle de Cox pour les risques concurrents étant fortement critiqué. Si une analyse de type *cause-specific* est envisageable (issues concurrentes traitées comme des censures à droites) on utilise simplement la fonction `coxph` de `survival`.\n\nOn va de nouveau utiliser la variable mois (durée discrète).  Le modèle sera estimé à l'aide la fonction **`multinom`** du très vieillissant package `nnet`, les p-values doivent-être programmées, l'output ne donnant que les erreurs-types.  \n\n*Mise en forme de la base*  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompet <- read.csv(\"https://raw.githubusercontent.com/mthevenin/analyse_duree/master/bases/transplantation.csv\")\n\ncompet$T = compet$mois\ntd = uncount(compet, mois)\ntd = arrange(td, id)\n\ntd$x=1\ntd$t = ave(td$x, td$id, FUN=cumsum)\ntd$t2 = td$t^2\n\nmy = mean(td$year)\ntd$yearb = td$year - my\nma = mean(td$age)\ntd$ageb = td$age  - ma\n\ntd$e = ifelse(td$t<td$T,0, td$compet)\n```\n:::\n\n\n*Estimation*\n\nPour estimer le modèle, on utilise la fonction **`mlogit`**. Les p-values seront calculées à partir d'un test bilatéral (statistique z). \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompetfit = multinom(formula = e ~ t + t2 + yearb + ageb + surgery, data = td)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# weights:  21 (12 variable)\ninitial  value 1238.136049 \niter  10 value 608.949443\niter  20 value 341.102661\niter  30 value 277.143136\niter  40 value 275.005451\nfinal  value 275.005419 \nconverged\n```\n\n\n:::\n\n```{.r .cell-code}\ntbl_regression(competfit, exponentiate = TRUE,)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"efgwbvhlxa\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#efgwbvhlxa table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#efgwbvhlxa thead, #efgwbvhlxa tbody, #efgwbvhlxa tfoot, #efgwbvhlxa tr, #efgwbvhlxa td, #efgwbvhlxa th {\n  border-style: none;\n}\n\n#efgwbvhlxa p {\n  margin: 0;\n  padding: 0;\n}\n\n#efgwbvhlxa .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#efgwbvhlxa .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#efgwbvhlxa .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#efgwbvhlxa .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#efgwbvhlxa .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#efgwbvhlxa .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#efgwbvhlxa .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#efgwbvhlxa .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#efgwbvhlxa .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#efgwbvhlxa .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#efgwbvhlxa .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#efgwbvhlxa .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#efgwbvhlxa .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#efgwbvhlxa .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#efgwbvhlxa .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#efgwbvhlxa .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#efgwbvhlxa .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#efgwbvhlxa .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#efgwbvhlxa .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#efgwbvhlxa .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#efgwbvhlxa .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#efgwbvhlxa .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#efgwbvhlxa .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#efgwbvhlxa .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#efgwbvhlxa .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#efgwbvhlxa .gt_left {\n  text-align: left;\n}\n\n#efgwbvhlxa .gt_center {\n  text-align: center;\n}\n\n#efgwbvhlxa .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#efgwbvhlxa .gt_font_normal {\n  font-weight: normal;\n}\n\n#efgwbvhlxa .gt_font_bold {\n  font-weight: bold;\n}\n\n#efgwbvhlxa .gt_font_italic {\n  font-style: italic;\n}\n\n#efgwbvhlxa .gt_super {\n  font-size: 65%;\n}\n\n#efgwbvhlxa .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#efgwbvhlxa .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#efgwbvhlxa .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#efgwbvhlxa .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#efgwbvhlxa .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#efgwbvhlxa .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#efgwbvhlxa .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#efgwbvhlxa .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#efgwbvhlxa div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipDaGFyYWN0ZXJpc3RpYyoq\"><div class='gt_from_md'><p><strong>Characteristic</strong></p>\n</div></div></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipPUioq&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;OR&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"KipPUioq\"><div class='gt_from_md'><p><strong>OR</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;Kio5NSUgQ0kqKg==&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;95% CI&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><div data-qmd-base64=\"Kio5NSUgQ0kqKg==\"><div class='gt_from_md'><p><strong>95% CI</strong></p>\n</div></div><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;div data-qmd-base64=&quot;KipwLXZhbHVlKio=&quot;&gt;&lt;div class='gt_from_md'&gt;&lt;p&gt;&lt;strong&gt;p-value&lt;/strong&gt;&lt;/p&gt;&#10;&lt;/div&gt;&lt;/div&gt;\"><div data-qmd-base64=\"KipwLXZhbHVlKio=\"><div class='gt_from_md'><p><strong>p-value</strong></p>\n</div></div></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"4\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"1\">1</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"1  label\" class=\"gt_row gt_left\">t</td>\n<td headers=\"1  estimate\" class=\"gt_row gt_center\">0.82</td>\n<td headers=\"1  conf.low\" class=\"gt_row gt_center\">0.75, 0.88</td>\n<td headers=\"1  p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"1  label\" class=\"gt_row gt_left\">t2</td>\n<td headers=\"1  estimate\" class=\"gt_row gt_center\">1.00</td>\n<td headers=\"1  conf.low\" class=\"gt_row gt_center\">1.00, 1.00</td>\n<td headers=\"1  p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"1  label\" class=\"gt_row gt_left\">yearb</td>\n<td headers=\"1  estimate\" class=\"gt_row gt_center\">0.88</td>\n<td headers=\"1  conf.low\" class=\"gt_row gt_center\">0.75, 1.03</td>\n<td headers=\"1  p.value\" class=\"gt_row gt_center\">0.12</td></tr>\n    <tr><td headers=\"1  label\" class=\"gt_row gt_left\">ageb</td>\n<td headers=\"1  estimate\" class=\"gt_row gt_center\">1.04</td>\n<td headers=\"1  conf.low\" class=\"gt_row gt_center\">1.01, 1.08</td>\n<td headers=\"1  p.value\" class=\"gt_row gt_center\">0.012</td></tr>\n    <tr><td headers=\"1  label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"1  estimate\" class=\"gt_row gt_center\">0.32</td>\n<td headers=\"1  conf.low\" class=\"gt_row gt_center\">0.11, 0.91</td>\n<td headers=\"1  p.value\" class=\"gt_row gt_center\">0.033</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"4\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"2\">2</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"2  label\" class=\"gt_row gt_left\">t</td>\n<td headers=\"2  estimate\" class=\"gt_row gt_center\">0.82</td>\n<td headers=\"2  conf.low\" class=\"gt_row gt_center\">0.71, 0.94</td>\n<td headers=\"2  p.value\" class=\"gt_row gt_center\">0.003</td></tr>\n    <tr><td headers=\"2  label\" class=\"gt_row gt_left\">t2</td>\n<td headers=\"2  estimate\" class=\"gt_row gt_center\">1.00</td>\n<td headers=\"2  conf.low\" class=\"gt_row gt_center\">1.00, 1.01</td>\n<td headers=\"2  p.value\" class=\"gt_row gt_center\">0.052</td></tr>\n    <tr><td headers=\"2  label\" class=\"gt_row gt_left\">yearb</td>\n<td headers=\"2  estimate\" class=\"gt_row gt_center\">0.82</td>\n<td headers=\"2  conf.low\" class=\"gt_row gt_center\">0.62, 1.07</td>\n<td headers=\"2  p.value\" class=\"gt_row gt_center\">0.14</td></tr>\n    <tr><td headers=\"2  label\" class=\"gt_row gt_left\">ageb</td>\n<td headers=\"2  estimate\" class=\"gt_row gt_center\">1.01</td>\n<td headers=\"2  conf.low\" class=\"gt_row gt_center\">0.96, 1.06</td>\n<td headers=\"2  p.value\" class=\"gt_row gt_center\">0.7</td></tr>\n    <tr><td headers=\"2  label\" class=\"gt_row gt_left\">surgery</td>\n<td headers=\"2  estimate\" class=\"gt_row gt_center\">0.54</td>\n<td headers=\"2  conf.low\" class=\"gt_row gt_center\">0.12, 2.50</td>\n<td headers=\"2  p.value\" class=\"gt_row gt_center\">0.4</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;\"><sup>1</sup></span> <div data-qmd-base64=\"T1IgPSBPZGRzIFJhdGlvLCBDSSA9IENvbmZpZGVuY2UgSW50ZXJ2YWw=\"><div class='gt_from_md'><p>OR = Odds Ratio, CI = Confidence Interval</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}